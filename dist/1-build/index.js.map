{"version":3,"file":"index.js","sources":["../../app/groundTexture.svg","../../app/math.ts","../../app/geometry/geometry.ts","../../app/geometry/csg.ts","../../app/game/models.ts","../../app/game/world-state.ts","../../app/game/models-factory.ts","../../app/game/level.ts","../../app/camera.ts","../../app/csm.ts","../../app/music/audio-context.ts","../../app/page.ts","../../app/gl.ts","../../app/player.ts","../../app/utils/keycodes.ts","../../app/shaders-utils.ts","../../app/game/models-render.ts","../../app/main-loop.ts","../../app/shaders/main-vertex.vert","../../app/shaders/main-fragment.frag","../../app/shaders/sky-fragment.frag","../../app/shaders/csm-vertex.vert","../../app/shaders/void-fragment.frag","../../app/shaders/sky-vertex.vert","../../app/shaders/collider-fragment.frag","../../app/load-step.ts","../../app/music/song.ts","../../app/music/music-player.ts","../../app/index.ts","../../app/game/triangle-buffers.ts"],"sourcesContent":["export default \"__VITE_ASSET__b9f78ae4__\"","export const integers_map = <T>(n: number, fn: (i: number) => T) => Array.from(Array(n), (_, i) => fn(i));\n\n/** Amount to be multiplied to an angle in degrees to obtain an angle in radians, approximately 0.017453292519943295 */\nexport const DEG_TO_RAD = Math.PI / 180;\n\nexport const min = /* @__PURE__ */ (a: number, b: number) => (a < b ? a : b);\n\nexport const max = /* @__PURE__ */ (a: number, b: number) => (a > b ? a : b);\n\nexport const abs = /* @__PURE__ */ (n: number) => (n < 0 ? -n : n);\n\nexport const threshold = (value: number | undefined, amount: number) => (abs(value!) > amount ? value! : 0);\n\nexport const clamp01 = /* @__PURE__ */ (t: number) => (t < 0 ? 0 : t > 1 ? 1 : t);\n\n/** Linear interpolation */\nexport const lerp = /* @__PURE__ */ (a: number, b: number, t: number) => a + (b - a) * clamp01(t);\n\nexport const lerpneg = /* @__PURE__ */ (v: number, t: number) => {\n  v = clamp01(v);\n  return lerp(v, 1 - v, t);\n};\n\n/**\n * Trigonometry - Wrap an angle so it is always between -PI and PI\n * @param radians The angle in radians to wrap between -PI and PI\n * @returns The angle in radians wrapped so it is always between -PI and PI\n */\nexport const angle_wrap_radians = /* @__PURE__ */ (radians: number): number =>\n  Math.atan2(Math.sin(radians), Math.cos(radians));\n\nexport const angle_wrap_degrees = /* @__PURE__ */ (degrees: number): number =>\n  angle_wrap_radians(degrees * DEG_TO_RAD) / DEG_TO_RAD;\n\nexport const angle_lerp = /* @__PURE__ */ (a0: number, a1: number, t: number) => {\n  const da = (a1 - a0) % (Math.PI * 2);\n  return a0 + (((2 * da) % (Math.PI * 2)) - da) * clamp01(t);\n};\n\nexport const angle_lerp_degrees = /* @__PURE__ */ (a0: number, a1: number, t: number) =>\n  angle_lerp(a0 * DEG_TO_RAD, a1 * DEG_TO_RAD, t) / DEG_TO_RAD;\n\nexport interface Vec2 {\n  x: number;\n  y: number;\n}\n\nexport interface Vec3 {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport interface Vec4 {\n  x: number;\n  y: number;\n  z: number;\n  w: number;\n}\n\nexport interface Vec3Optional {\n  x?: number | undefined;\n  y?: number | undefined;\n  z?: number | undefined;\n}\n\nexport interface Plane {\n  x: number;\n  y: number;\n  z: number;\n  w: number;\n}\n\nexport type Vec2In = Readonly<Vec2>;\n\nexport type Vec3In = Readonly<Vec3>;\n\nexport type Vec4In = Readonly<Vec4>;\n\nexport const vec3_distance = /* @__PURE__ */ ({ x, y, z }: Vec3In, b: Vec3In): number =>\n  Math.hypot(x - b.x, y - b.y, z - b.z);\n\nexport const vec3_dot = /* @__PURE__ */ ({ x, y, z }: Vec3In, b: Vec3In): number => x * b.x + y * b.y + z * b.z;\n\n/**\n * Computes a polygon plane using the Newell's method.\n * We are not using plane from 3 points algorithm,\n * because this can handle coplanar points and has precision problems.\n */\nexport const plane_fromPolygon = /* @__PURE__ */ (polygon: readonly Vec3In[]): Plane => {\n  // Newell's method\n  let x = 0;\n  let y = 0;\n  let z = 0;\n  let a = polygon.at(-1)!;\n  let b: Vec3In | number;\n  for (b of polygon) {\n    x += (a.y - b.y) * (a.z + b.z);\n    y += (a.z - b.z) * (a.x + b.x);\n    z += (a.x - b.x) * (a.y + b.y);\n    a = b;\n  }\n  b = Math.hypot(x, y, z);\n  x /= b;\n  y /= b;\n  z /= b;\n  return { x, y, z, w: x * a.x + y * a.y + z * a.z };\n};\n\n/** The identity matrix */\nexport const identity: DOMMatrixReadOnly = /* @__PURE__ */ new DOMMatrix();\n\nexport const float32Array16Temp = new Float32Array(16);\n\nexport const matrixToArray = (\n  $matrix: DOMMatrixReadOnly,\n  output: Float32Array | number[] = float32Array16Temp,\n  index: number = 0,\n) => {\n  index *= 16;\n  output[index++] = $matrix.m11;\n  output[index++] = $matrix.m12;\n  output[index++] = $matrix.m13;\n  output[index++] = $matrix.m14;\n  output[index++] = $matrix.m21;\n  output[index++] = $matrix.m22;\n  output[index++] = $matrix.m23;\n  output[index++] = $matrix.m24;\n  output[index++] = $matrix.m31;\n  output[index++] = $matrix.m32;\n  output[index++] = $matrix.m33;\n  output[index++] = $matrix.m34;\n  output[index++] = $matrix.m41;\n  output[index++] = $matrix.m42;\n  output[index++] = $matrix.m43;\n  output[index] = $matrix.m44;\n  return output;\n};\n\nexport const mat_perspectiveXY = /* @__PURE__ */ (mx: number, my: number, near: number, far: number) => [\n  mx,\n  0,\n  0,\n  0,\n  0,\n  my,\n  0,\n  0,\n  0,\n  0,\n  (far + near) / (near - far),\n  -1,\n  0,\n  0,\n  (2 * far * near) / (near - far),\n  0,\n];\n","import { abs, integers_map, identity, type Vec3, type Vec3Optional } from \"../math\";\n\nexport const GQuad = /* @__PURE__ */ [\n  { x: -1, z: 1 },\n  { x: 1, z: 1 },\n  { x: 1, z: -1 },\n  { x: -1, z: -1 },\n];\n\nexport interface Polygon<TVec3 = Vec3> extends Array<TVec3> {\n  /** Polygon material */\n  $color?: number | undefined;\n\n  /** Smooth normals? */\n  $smooth?: 0 | 1 | undefined;\n}\n\nexport const polygon_color = (polygon: Polygon, color: number | undefined, smooth?: 0 | 1 | undefined): Polygon => {\n  polygon.$smooth = smooth;\n  polygon.$color = color;\n  return polygon;\n};\n\nexport const vec3_transform = /* @__PURE__ */ ({ x, y, z }: Readonly<Vec3Optional>, m: DOMMatrixReadOnly): Vec3 => {\n  ({ x, y, z } = m.transformPoint({ x, y, z }));\n  return { x, y, z };\n};\n\nexport const polygon_transform = /* @__PURE__ */ (\n  polygon: Polygon<Readonly<Vec3Optional>>,\n  m: DOMMatrixReadOnly,\n  color: number | undefined = polygon.$color,\n): Polygon =>\n  polygon_color(\n    polygon.map((p) => vec3_transform(p, m)),\n    color,\n    polygon.$smooth,\n  );\n\nexport const polygons_transform = /* @__PURE__ */ (\n  polygons: Polygon<Readonly<Vec3Optional>>[],\n  m: DOMMatrixReadOnly,\n  color?: number | undefined,\n) => polygons.map((polygon) => polygon_transform(polygon, m, color));\n\n/**\n * Creates a regular polygon\n * The polygon will face up (normal 0, -1, 0).\n */\nexport const polygon_regular = /* @__PURE__ */ (segments: number, elongate: number = 0): Polygon =>\n  integers_map(segments, (i) => {\n    const z = Math.cos(Math.PI * 2 * (i / segments));\n    return {\n      x: Math.sin(Math.PI * 2 * (i / segments)),\n      y: 0,\n      z: abs(z) < 0.01 ? z : z < 0 ? z - elongate : z + elongate,\n    };\n  });\n\n/**\n * Connects a top and a bottom polygon with side polygons.\n * Top and bottom polygons must have the same length.\n * Top polygon is supposed to be flipped.\n */\nexport const cylinder_sides = /* @__PURE__ */ (btm: Polygon, top: Polygon, smooth?: 0 | 1 | undefined): Polygon[] =>\n  btm.map((btmi, i, { length }) =>\n    polygon_color(\n      [btmi, top[length - i - 1]!, top[length - ((i + 1) % length) - 1]!, btm[(i + 1) % length]!],\n      btm.$color,\n      smooth,\n    ),\n  );\n\n/** Simplest composition of polygon functions. */\nexport const cylinder = /* @__PURE__ */ (\n  segments?: number,\n  smooth?: 0 | 1,\n  topSize: number = 0,\n  elongate?: number,\n): Polygon[] => {\n  const points = segments ? polygon_regular(segments, elongate) : GQuad;\n  const top = polygon_transform(points, identity.translate(0, 1).scale3d(topSize > 0 ? topSize : 1));\n  const bottom = polygon_transform(points, identity.translate(0, -1).scale3d(topSize < 0 ? -topSize : 1)).reverse();\n  return [...cylinder_sides(bottom as Polygon, top, smooth), top, bottom];\n};\n\nexport const sphere = /* @__PURE__ */ (\n  slices: number,\n  stacks = slices,\n  vertexFunc: (slice: number, stack: number, polygon: Polygon) => Vec3 = (x: number, y: number) => {\n    y *= Math.PI / stacks;\n    x *= (Math.PI * 2) / slices;\n    return { x: Math.cos(x) * Math.sin(y), y: Math.cos(y), z: Math.sin(x) * Math.sin(y) };\n  },\n): Polygon[] => {\n  const polygons: Polygon[] = [];\n  for (let i = 0; i < slices; i++) {\n    for (let j = 0; j < stacks; j++) {\n      const polygon = polygon_color([], 0, 1);\n      const vertex = (x: number, y: number) => polygon.push(vertexFunc(x, y, polygon));\n      polygons.push(polygon);\n      vertex(i, j);\n      if (j) {\n        vertex((i + 1) % slices, j);\n      }\n      if (j < stacks - 1) {\n        vertex((i + 1) % slices, j + (1 % stacks));\n      }\n      vertex(i, j + (1 % stacks));\n    }\n  }\n  return polygons;\n};\n","import { plane_fromPolygon, type Vec3, type Vec3In, type Plane, vec3_dot } from \"../math\";\nimport { polygon_color, type Polygon } from \"./geometry\";\n\nexport const PLANE_EPSILON = 0.00008;\n\nexport interface CSGPolygon {\n  $polygon: Polygon;\n\n  $flipped: 0 | boolean;\n\n  /**\n   * When a polygon is splitted, this will contain the polygon from which this polygon was splitted.\n   * This is then used by csg_polygons to merge back splitted polygons if they are both present,\n   * to reduce the number of vertices and triangles.\n   */\n  $parent: CSGPolygon | 0;\n}\n\nexport interface CSGNode extends Plane {\n  /** Coplanar polygons */\n  $polygons: CSGPolygon[];\n  /** Front child */\n  $front: CSGNode | 0;\n  /** Back child */\n  $back: CSGNode | 0;\n}\n\nexport type CSGInput = CSGNode | readonly Polygon[];\n\ninterface SplitPolygonResult {\n  $front: CSGPolygon | undefined | false;\n  $back: CSGPolygon | undefined | false;\n}\n\nconst CSGPolygon_splitSpanning = /* @__PURE__ */ (plane: Plane, polygon: CSGPolygon): SplitPolygonResult => {\n  const fpoints: Vec3[] = [];\n  const bpoints: Vec3[] = [];\n  const { $polygon, $flipped } = polygon;\n  let jd: number;\n  let iv: Vec3In = $polygon.at(-1)!;\n  let id: number = vec3_dot(plane, iv) - plane.w;\n  for (const jv of $polygon) {\n    jd = vec3_dot(plane, jv) - plane.w;\n    if (id < PLANE_EPSILON) {\n      bpoints.push(iv);\n    }\n    if (id > -PLANE_EPSILON) {\n      fpoints.push(iv);\n    }\n    if ((id > PLANE_EPSILON && jd < -PLANE_EPSILON) || (id < -PLANE_EPSILON && jd > PLANE_EPSILON)) {\n      id /= jd - id;\n      iv = {\n        x: iv.x + (iv.x - jv.x) * id,\n        y: iv.y + (iv.y - jv.y) * id,\n        z: iv.z + (iv.z - jv.z) * id,\n      };\n      fpoints.push(iv);\n      bpoints.push(iv);\n    }\n    iv = jv;\n    id = jd;\n  }\n  return {\n    $front: fpoints.length > 2 && {\n      $polygon: polygon_color(fpoints, $polygon.$color, $polygon.$smooth),\n      $flipped,\n      $parent: polygon,\n    },\n    $back: bpoints.length > 2 && {\n      $polygon: polygon_color(bpoints, $polygon.$color, $polygon.$smooth),\n      $flipped,\n      $parent: polygon,\n    },\n  };\n};\n\nconst CSGPolygon_split = /* @__PURE__ */ (plane: Plane, polygon: CSGPolygon): SplitPolygonResult => {\n  const { $polygon } = polygon;\n  let $front: CSGPolygon | undefined;\n  let $back: CSGPolygon | undefined;\n  let d: number;\n  for (let i = 0; i < $polygon.length; ++i) {\n    d = vec3_dot(plane, $polygon[i]!) - plane.w;\n    if (d < -PLANE_EPSILON) {\n      $back = polygon;\n    } else if (d > PLANE_EPSILON) {\n      $front = polygon;\n    }\n    if ($back && $front) {\n      return CSGPolygon_splitSpanning(plane, polygon);\n    }\n  }\n  return { $front, $back };\n};\n\nconst csg_tree_addPolygon = /* @__PURE__ */ (\n  node: CSGNode | 0 | undefined,\n  polygon: CSGPolygon,\n  plane: Plane = plane_fromPolygon(polygon.$polygon),\n): CSGNode => {\n  if (node) {\n    const { $front, $back } = CSGPolygon_split(node, polygon);\n    if (!$front && !$back) {\n      node.$polygons.push(polygon); // Coplanar\n    }\n    if ($front) {\n      node.$front = csg_tree_addPolygon(node.$front, $front, plane);\n    }\n    if ($back) {\n      node.$back = csg_tree_addPolygon(node.$back, $back, plane);\n    }\n  } else {\n    const { x, y, z, w } = plane;\n    node = { x, y, z, w, $polygons: [polygon], $front: 0, $back: 0 };\n  }\n  return node;\n};\n\nconst csg_tree_clipNode = /* @__PURE__ */ (\n  anode: CSGNode,\n  bnode: CSGNode,\n  polygonPlaneFlipped: -1 | 1,\n): CSGPolygon[] => {\n  const result: CSGPolygon[] = [];\n  const recursion = (node: CSGNode, polygon: CSGPolygon) => {\n    let { $front, $back } = CSGPolygon_split(node, polygon);\n    if (!$front && !$back) {\n      if (polygonPlaneFlipped * vec3_dot(node, bnode) > 0) {\n        $front = polygon; // Coplanar front\n      } else {\n        $back = polygon; // Coplanar back\n      }\n    }\n    if ($front) {\n      if (node.$front) {\n        recursion(node.$front, $front);\n      } else {\n        result.push($front);\n      }\n    }\n    if ($back && node.$back) {\n      recursion(node.$back, $back);\n    }\n  };\n\n  for (const polygon of bnode.$polygons) {\n    recursion(anode, polygon);\n  }\n  return result;\n};\n\n/** Loop through all nodes in a tree */\nconst csg_tree_each = (node: CSGNode | 0 | undefined, fn: (node: CSGNode) => void): unknown =>\n  node && (fn(node), csg_tree_each(node.$front, fn), csg_tree_each(node.$back, fn));\n\n/**\n * If the given argument is a list of polygons, a new BSP tree built from the list of polygons is returned.\n * If the given argument is already a BSP tree, return it as is.\n * Note that array cannot be empty.\n */\nexport const csg_tree = /* @__PURE__ */ (n: CSGInput): CSGNode =>\n  (n as Polygon[]).length\n    ? // Build a BSP tree from a list of polygons\n      ((n as Polygon[]).reduce<CSGNode | 0>(\n        (prev, $polygon) => csg_tree_addPolygon(prev, { $polygon, $flipped: 0, $parent: 0 }),\n        0,\n      ) as CSGNode)\n    : // An object? We assume is a BSP tree.\n      (n as CSGNode);\n\n/** Convert solid space to empty space and empty space to solid space. */\nexport const csg_tree_flip = <T extends CSGNode | 0 | undefined>(root: T): T => {\n  csg_tree_each(root, (node) => {\n    const { $front, $back } = node;\n    node.$back = $front;\n    node.$front = $back;\n    node.x *= -1;\n    node.y *= -1;\n    node.z *= -1;\n    node.w *= -1;\n    for (const polygon of node.$polygons) {\n      polygon.$flipped = !polygon.$flipped;\n    }\n  });\n  return root;\n};\n\n/**\n * Union a[0] = a[0] U a[1] U a[2] U ...\n */\nexport const csg_union = /* @__PURE__ */ (...inputs: CSGInput[]): CSGNode =>\n  inputs.reduce((a: CSGInput, b: CSGInput | undefined): CSGNode => {\n    const polygonsToAdd: [Plane, CSGPolygon[]][] = [];\n    a = csg_tree(a);\n    if (b) {\n      b = csg_tree(b);\n\n      // clip to a, b\n      csg_tree_each(a, (node) => (node.$polygons = csg_tree_clipNode(b as CSGNode, node, 1)));\n\n      // get the list of polygons to be added from b clipped to a\n      csg_tree_each(b, (node) => polygonsToAdd.push([node, csg_tree_clipNode(a as CSGNode, node, -1)]));\n\n      // add the polygons to a\n      for (const [plane, polygons] of polygonsToAdd) {\n        for (const pp of polygons) {\n          csg_tree_addPolygon(a, pp, plane);\n        }\n      }\n    }\n    return a;\n  }) as CSGNode;\n\n/**\n * Subtraction a = a - (b[0] U b[1] U ...)\n * Note that a will be modified if is a tree.\n */\nexport const csg_subtract = /* @__PURE__ */ (a: CSGInput, ...b: CSGInput[]): CSGNode =>\n  csg_tree_flip(csg_union(csg_tree_flip(csg_tree(a)), ...b));\n\n/**\n * Extracts all the polygons from a BSP tree.\n * Some polygons will be merged, to reduce the number of triangles.\n */\nexport const csg_polygons = /* @__PURE__ */ (tree: CSGNode): Polygon[] => {\n  const byParent = new Map<CSGPolygon, CSGPolygon>();\n  const allPolygons = new Map<CSGPolygon, 0 | boolean>();\n\n  /** Adds a polygon, and replaces two splitted polygons that have the same parent with the parent */\n  const add = (polygon: CSGPolygon): CSGPolygon => {\n    if (polygon.$parent) {\n      const found = byParent.get(polygon.$parent);\n      if (found) {\n        allPolygons.delete(found);\n        polygon = add(polygon.$parent);\n      } else {\n        byParent.set(polygon.$parent, polygon);\n      }\n    }\n    return polygon;\n  };\n\n  csg_tree_each(tree, (node) => {\n    for (const polygon of node.$polygons) {\n      allPolygons.set(add(polygon), polygon.$flipped);\n    }\n  });\n\n  return Array.from(allPolygons, ([{ $polygon }, flipped]) => {\n    const polygon = $polygon.map(({ x, y, z }) => ({ x, y, z }));\n    return polygon_color(flipped ? polygon.reverse() : polygon, $polygon.$color, $polygon.$smooth);\n  });\n};\n\nexport const csg_polygons_subtract = (...input: CSGInput[]) => csg_polygons((csg_subtract as any)(...input));\n\nexport const csg_polygons_union = (...input: CSGInput[]) => csg_polygons(csg_union(...input));\n","import type { Vec3 } from \"../math\";\nimport type { Polygon } from \"../geometry/geometry\";\n\nexport interface Model {\n  $matrix: DOMMatrixReadOnly;\n  $modelId: number;\n  $kind: MODEL_KIND;\n  $polygons: Polygon[] | null;\n  _update?: () => DOMMatrixReadOnly;\n  $vertexBegin?: number;\n  $vertexEnd?: number;\n}\n\nexport interface Lever {\n  $value: 0 | 1;\n  $lerpValue: number;\n  $lerpValue2: number;\n  $parent: Model;\n  _update: () => void;\n  $matrix?: DOMMatrixReadOnly;\n  $locMatrix?: DOMMatrixReadOnly;\n}\n\nexport interface Soul {\n  $value: 0 | 1;\n  _update: () => void;\n  $matrix?: DOMMatrixReadOnly;\n}\n\nexport type Circle = [number, number, number];\n\nexport const allModels: Model[] = [];\n\n/** Fixed number of levers */\n\nexport const levers: Lever[] = [];\n\n/** Fixed number of souls */\nexport const SOULS_COUNT = 13;\n\nexport const souls: Soul[] = [];\n\nexport const player_position_final: Vec3 = {\n  x: 0,\n  y: 0,\n  z: 0,\n};\n\nexport const MODEL_KIND_MESH = 0;\n\nexport const MODEL_KIND_GAME = 1;\n\nexport const MODEL_KIND_GAME_NO_ATTACH_PLAYER = 2;\n\nexport type MODEL_KIND = typeof MODEL_KIND_MESH | typeof MODEL_KIND_GAME | typeof MODEL_KIND_GAME_NO_ATTACH_PLAYER;\n\nexport const MODEL_ID_STATIC_WORLD = 1;\n\nexport const MODEL_ID_FIRST_BOAT = 2;\n\nexport const MODEL_ID_PLAYER_BODY = 37;\n\nexport const MODEL_ID_PLAYER_LEG0 = 38;\n\nexport const MODEL_ID_PLAYER_LEG1 = 39;\n\nexport const MODEL_ID_LEVER = 40;\n\nexport const MODEL_ID_SOUL_COLLISION = 41;\n\nexport const MODEL_ID_SOUL = 42;\n","import { lerp, angle_wrap_degrees, lerpneg, abs, clamp01, min } from \"../math\";\nimport { allModels, levers, souls, SOULS_COUNT } from \"./models\";\n\nexport const KEY_LEFT = 0;\n\nexport const KEY_FRONT = 1;\n\nexport const KEY_RIGHT = 2;\n\nexport const KEY_BACK = 3;\n\nexport const KEY_INTERACT = 5;\n\nexport const keyboard_downKeys: (boolean | 0 | 1 | undefined)[] = [];\n\nexport let souls_collected_count = 0;\n\n/** Minimum 15.3 frames per second */\nexport const GAME_TIME_MAX_DELTA_TIME = 0.066;\n\nexport let absoluteTime = 0;\n\nexport let gameTime = 0;\n\nexport let gameTimeDelta: number = GAME_TIME_MAX_DELTA_TIME;\n\nexport let mainMenuVisible: boolean | undefined;\n\nexport const setMainMenuVisible = (visible: boolean) => {\n  mainMenuVisible = visible;\n};\n\nlet _globalTime: number | undefined;\n\nlet _messageEndTime = 1;\n\nexport const lerpDamp = /* @__PURE__ */ (from: number, to: number, speed: number) =>\n  lerp(from, to, 1 - Math.exp(-speed * gameTimeDelta));\n\nexport const gameTimeUpdate = (time: number) => {\n  const dt = (time - (_globalTime || time)) / 1000;\n  if (mainMenuVisible) {\n    gameTimeDelta = 0;\n    keyboard_downKeys[KEY_INTERACT] = 0;\n  } else {\n    gameTimeDelta = min(GAME_TIME_MAX_DELTA_TIME, dt);\n  }\n  gameTime += gameTimeDelta;\n  absoluteTime += dt;\n  _globalTime = time;\n};\n\n// export const gameTimeUpdate = (time: number) => {\n//   if (mainMenuVisible) {\n//     keyboard_downKeys[KEY_INTERACT] = 0;\n//   }\n//   const delta = (time - (_globalTime || time)) / 1000;\n//   if (delta >= 0.06) {\n//     gameTimeDelta = mainMenuVisible ? 0 : Math.min(GAME_TIME_MAX_DELTA_TIME, (time - (_globalTime || time)) / 1000);\n//     gameTime += gameTimeDelta;\n//     _globalTime = time;\n//   } else {\n//     gameTimeDelta = 0;\n//   }\n//   absoluteTime += delta;\n//   if (!_globalTime) {\n//     _globalTime = time;\n//   }\n// };\n\nexport const LOCAL_STORAGE_SAVED_GAME_KEY = \"DanteSP22\";\n\nexport let player_last_pulled_lever = 0;\n\nexport let rotatingPlatform1Rotation = 0;\n\nexport let rotatingPlatform2Rotation = 0;\n\nexport let rotatingHexCorridorRotation = 0;\n\nexport let game_completed: 0 | 1 = 0;\n\nexport let firstBoatLerp = 0;\n\nexport let secondBoatLerp = 0;\n\nconst showMessage = (message: string, duration: number) => {\n  if (_messageEndTime < Infinity) {\n    _messageEndTime = gameTime + duration;\n    h4.innerHTML = message;\n  }\n};\n\nexport const worldStateUpdate = () => {\n  const shouldRotatePlatforms = lerpneg(levers[12]!.$lerpValue, levers[13]!.$lerpValue);\n\n  rotatingHexCorridorRotation = lerp(\n    lerpDamp(rotatingHexCorridorRotation, 0, 1),\n    angle_wrap_degrees(rotatingHexCorridorRotation + gameTimeDelta * 60),\n    levers[5]!.$lerpValue - levers[6]!.$lerpValue2,\n  );\n\n  rotatingPlatform1Rotation = lerp(\n    lerpDamp(rotatingPlatform1Rotation, 0, 5),\n    angle_wrap_degrees(rotatingPlatform1Rotation + gameTimeDelta * 56),\n    shouldRotatePlatforms,\n  );\n\n  rotatingPlatform2Rotation = lerp(\n    lerpDamp(rotatingPlatform2Rotation, 0, 4),\n    angle_wrap_degrees(rotatingPlatform2Rotation + gameTimeDelta * 48),\n    shouldRotatePlatforms,\n  );\n\n  secondBoatLerp = lerpDamp(secondBoatLerp, levers[9]!.$lerpValue2, 0.2 + 0.3 * abs(levers[9]!.$lerpValue2 * 2 - 1));\n\n  firstBoatLerp = lerpDamp(\n    firstBoatLerp,\n    game_completed ? lerp(firstBoatLerp, -9, gameTimeDelta * 1.5) : clamp01(gameTime / 3),\n    1,\n  );\n\n  if (_messageEndTime && gameTime > _messageEndTime) {\n    _messageEndTime = 0;\n    h4.innerHTML = \"\";\n  }\n\n  if (levers[0]!.$value && levers[0]!.$lerpValue > 0.8) {\n    if (souls_collected_count < SOULS_COUNT) {\n      showMessage(\"Not leaving now, there are souls to catch!\", 3);\n      levers[0]!.$value = 0;\n    } else if (!game_completed) {\n      showMessage(\"Well done. They will be punished.<br>Thanks for playing\", Infinity);\n      game_completed = 1;\n    }\n  }\n\n  for (const model of allModels) {\n    if (model._update) {\n      model.$matrix = model._update();\n    }\n  }\n\n  for (const lever of levers) {\n    lever._update();\n  }\n\n  for (const soul of souls) {\n    soul._update();\n  }\n};\n\nexport const updateCollectedSoulsCounter = () =>\n  (h3.innerHTML = [\"0\", \"I\", \"II\", \"III\", \"IV\", \"V\", \"VI\", \"VII\", \"VIII\", \"IX\", \"X\", \"XI\", \"XII\", \"XIII\"][\n    (souls_collected_count = souls.reduce((acc, { $value }) => acc + $value, 0))\n  ]!);\n\nexport const loadGame = () => {\n  try {\n    const [savedLevers, savedSouls, savedLastPulledLever, savedGameTime, savedSecondBoatLerp] = JSON.parse(\n      localStorage[LOCAL_STORAGE_SAVED_GAME_KEY]!,\n    );\n    levers.map(\n      (lever, index) =>\n        (lever.$lerpValue = lever.$lerpValue2 = lever.$value = index ? ((savedLevers[index] | 0) as 0 | 1) : 0),\n    );\n    souls.map((soul, index) => (soul.$value = (savedSouls[index] | 0) as 0 | 1));\n    player_last_pulled_lever = savedLastPulledLever;\n    gameTime = savedGameTime;\n    secondBoatLerp = savedSecondBoatLerp;\n  } catch (e) {\n    if (DEBUG) {\n      console.log(e);\n    }\n  }\n  firstBoatLerp = clamp01(player_last_pulled_lever);\n};\n\nexport const saveGame = () => {\n  localStorage[LOCAL_STORAGE_SAVED_GAME_KEY] = JSON.stringify([\n    levers.map(({ $value }) => $value),\n    souls.map(({ $value }) => $value),\n    player_last_pulled_lever,\n    gameTime,\n    secondBoatLerp,\n  ]);\n};\n\nexport const onSoulCollected = () => {\n  showMessage(\n    [\n      ,\n      \"Mark Zuckemberg<br>made the world worse\",\n      ,\n      \"Andrzej Mazur<br>for the js13k competition\",\n      \"Donald Trump<br>lies\",\n      \"Kim Jong-un<br>Dictator, liked pineapple on pizza\",\n      \"Maxime Euziere<br>forced me to finish this game\",\n      \"She traded NFTs apes\",\n      ,\n      \"Vladimir Putin<br>evil war\",\n      \"He was not a good person\",\n      ,\n      \"Salvatore Previti<br>made this evil game<br><br>Done. Go back to the boat\",\n    ][souls_collected_count] || 'Catched a \"crypto bro\".<br>\"Web3\" is all scam, lies and grift',\n    souls_collected_count && souls_collected_count < 12 ? 5 : 7,\n  );\n\n  updateCollectedSoulsCounter();\n  saveGame();\n};\n\nexport const onPlayerPullLever = (leverIndex: number) => {\n  if (DEBUG) {\n    console.log(\"switch lever \" + leverIndex + \" = \" + levers[leverIndex]?.$value);\n  }\n\n  if (leverIndex) {\n    showMessage(\"* click *\", 1);\n  }\n  player_last_pulled_lever = leverIndex;\n  saveGame();\n};\n","import { min, max, angle_lerp_degrees, DEG_TO_RAD, abs, identity, type Vec3Optional, vec3_distance } from \"../math\";\nimport { cylinder, polygons_transform, type Polygon } from \"../geometry/geometry\";\nimport {\n  levers,\n  souls,\n  allModels,\n  MODEL_ID_FIRST_BOAT,\n  MODEL_KIND_GAME,\n  type Circle,\n  type Lever,\n  type Model,\n  type Soul,\n  type MODEL_KIND,\n  player_position_final,\n} from \"./models\";\nimport {\n  keyboard_downKeys,\n  KEY_INTERACT,\n  onPlayerPullLever,\n  lerpDamp,\n  gameTimeDelta,\n  gameTime,\n  onSoulCollected,\n} from \"./world-state\";\n\nconst LEVER_SENSITIVITY_RADIUS = 3;\nconst SOUL_SENSITIVITY_RADIUS = 1.55;\n\nexport const material = NO_INLINE(\n  (r: number, g: number, b: number, a: number = 0): number =>\n    ((a * 255) << 24) | ((b * 255) << 16) | ((g * 255) << 8) | (r * 255),\n);\n\nexport let currentEditModel: Model;\n\nexport const newModel = (fn: (model: Model) => void, $kind: MODEL_KIND = MODEL_KIND_GAME) => {\n  const previousModel = currentEditModel;\n  const model: Model = {\n    $matrix: identity,\n    $modelId: allModels.length,\n    $kind,\n    $polygons: [],\n  };\n  allModels.push((currentEditModel = model));\n  fn(model);\n  currentEditModel = previousModel;\n  return model;\n};\n\nexport const meshAdd = (\n  polygons: Polygon<Readonly<Vec3Optional>>[],\n  transform: DOMMatrixReadOnly = identity,\n  color?: number | undefined,\n) => currentEditModel.$polygons!.push(...polygons_transform(polygons, transform, color));\n\nexport const newLever = (transform: DOMMatrixReadOnly): void => {\n  const $parent = currentEditModel;\n  const index = levers.length;\n  const lever: Lever = {\n    $value: 0,\n    $lerpValue: 0,\n    $lerpValue2: 0,\n    $parent,\n    _update: () => {\n      const { $value, $lerpValue, $lerpValue2 } = lever;\n      const locMatrix = $parent.$matrix.multiply(transform);\n      lever.$locMatrix = locMatrix;\n\n      if (\n        vec3_distance(locMatrix.transformPoint(), player_position_final) < LEVER_SENSITIVITY_RADIUS &&\n        keyboard_downKeys[KEY_INTERACT]\n      ) {\n        if ($lerpValue < 0.3 || $lerpValue > 0.7) {\n          lever.$value = $value ? 0 : 1;\n          onPlayerPullLever(index);\n        }\n      }\n\n      lever.$lerpValue = lerpDamp($lerpValue, $value, 4);\n      lever.$lerpValue2 = lerpDamp($lerpValue2, $value, 1);\n      lever.$matrix = locMatrix.rotate(lever.$lerpValue * 60 - 30, 0).translateSelf(0, 1);\n    },\n  };\n  levers.push(lever);\n\n  meshAdd(cylinder(5), transform.translate(-0.2).rotate(90, 90).scale(0.4, 0.1, 0.5), material(0.4, 0.5, 0.5));\n  meshAdd(cylinder(5), transform.translate(0.2).rotate(90, 90).scale(0.4, 0.1, 0.5), material(0.4, 0.5, 0.5));\n  meshAdd(cylinder(), transform.translate(0, -0.4).scale(0.5, 0.1, 0.5), material(0.5, 0.5, 0.4));\n};\n\nexport const newSoul = (transform: DOMMatrixReadOnly, ...walkingPath: number[][]) => {\n  const parentModel = currentEditModel;\n  const index = souls.length;\n  const circles = (walkingPath as Circle[]).map(([x, z, w]) => ({ x, z, w }));\n  let circle = circles[0]!;\n  let { x: targetX, z: targetZ } = circle;\n  let soulX = targetX;\n  let soulZ = targetZ;\n  let dirX = -1;\n  let dirZ = 0;\n  let randAngle = 0;\n  let lookAngle = 0;\n  let prevX = 0;\n  let prevZ = 0;\n  let velocity = 3;\n  let wasInside: boolean | undefined | 1 = 1;\n\n  const soul: Soul = {\n    $value: 0,\n    _update: () => {\n      if (!soul.$value) {\n        let isInside: boolean | undefined;\n        let contextualVelocity = 1;\n        let mindist = Infinity;\n\n        for (const c of circles) {\n          const { x, z, w } = c;\n          const distance = Math.hypot(targetX - x, targetZ - z);\n          const circleSDF = distance - w;\n          isInside ||= distance < w;\n          if (circleSDF > 0 && circleSDF < mindist) {\n            mindist = circleSDF;\n            circle = c;\n          }\n          contextualVelocity = min(contextualVelocity, distance / w);\n        }\n\n        if (!isInside) {\n          const { x, z, w } = circle;\n          const ax = targetX - x;\n          const az = targetZ - z;\n          let magnitude = Math.hypot(ax, az);\n          let angle = Math.atan2(-az, ax);\n          if (wasInside) {\n            randAngle = ((Math.random() - 0.5) * Math.PI) / 2;\n            velocity = max(1, velocity / (1 + Math.random()));\n          }\n          angle += randAngle;\n          dirX = -Math.cos(angle);\n          dirZ = Math.sin(angle);\n          if (magnitude > 0.1) {\n            // limit the vector length to the circle radius, as a security measure\n            magnitude = min(magnitude, w) / (magnitude || 1);\n            targetX = ax * magnitude + x;\n            targetZ = az * magnitude + z;\n          }\n        }\n\n        wasInside = isInside;\n\n        velocity = lerpDamp(velocity, 3 + (1 - contextualVelocity) * 6, 3 + contextualVelocity);\n        soulX = lerpDamp(soulX, (targetX = lerpDamp(targetX, targetX + dirX, velocity)), velocity);\n        soulZ = lerpDamp(soulZ, (targetZ = lerpDamp(targetZ, targetZ + dirZ, velocity)), velocity);\n\n        lookAngle = angle_lerp_degrees(\n          lookAngle,\n          Math.atan2(soulX - prevX, soulZ - prevZ) / DEG_TO_RAD - 180,\n          3 * gameTimeDelta,\n        );\n\n        prevX = soulX;\n        prevZ = soulZ;\n\n        const soulPos = (soul.$matrix = parentModel.$matrix.multiply(\n          transform.translate(soulX, 0, soulZ).rotateSelf(0, lookAngle, Math.sin(gameTime * 1.7) * 7),\n        )).transformPoint();\n\n        if (vec3_distance(soulPos, player_position_final) < SOUL_SENSITIVITY_RADIUS) {\n          soul.$value = 1;\n          onSoulCollected();\n        }\n      }\n\n      if (soul.$value) {\n        soul.$matrix = allModels[MODEL_ID_FIRST_BOAT]!.$matrix.translate(\n          (index % 4) * 1.2 - 1.7 + Math.sin(gameTime + index) / 7,\n          -2,\n          -5.5 + ((index / 4) | 0) * 1.7 + abs((index % 4) - 2) + Math.cos(gameTime / 1.5 + index) / 6,\n        );\n      }\n    },\n  };\n\n  if (DEBUG_FLAG0) {\n    for (const c of circles) {\n      meshAdd(cylinder(12), transform.translate(c.x, -1.7, c.z).scale(c.w, 0.01, c.w), material(0.3, 0.3, 0.38));\n    }\n  }\n\n  souls.push(soul);\n};\n","import { abs, clamp01, integers_map, lerpneg, max, min, identity } from \"../math\";\nimport {\n  GQuad,\n  cylinder,\n  polygons_transform,\n  polygon_regular,\n  sphere,\n  cylinder_sides,\n  polygon_transform,\n  type Polygon,\n} from \"../geometry/geometry\";\nimport { csg_union, csg_polygons_subtract } from \"../geometry/csg\";\nimport {\n  levers,\n  MODEL_KIND_MESH,\n  MODEL_KIND_GAME_NO_ATTACH_PLAYER,\n  MODEL_ID_FIRST_BOAT,\n  MODEL_ID_PLAYER_BODY,\n  MODEL_ID_PLAYER_LEG0,\n  MODEL_ID_PLAYER_LEG1,\n  MODEL_ID_LEVER,\n  MODEL_ID_SOUL_COLLISION,\n  MODEL_ID_SOUL,\n  souls,\n} from \"./models\";\nimport {\n  gameTime,\n  firstBoatLerp,\n  secondBoatLerp,\n  rotatingHexCorridorRotation,\n  rotatingPlatform1Rotation,\n  rotatingPlatform2Rotation,\n} from \"./world-state\";\nimport { currentEditModel, material, meshAdd, newLever, newModel, newSoul } from \"./models-factory\";\n\nconst checkModelId = DEBUG\n  ? (name: string, expectedId: number) => {\n      console.log(`model ${name} id: ${currentEditModel.$modelId}`);\n      if (currentEditModel.$modelId !== expectedId) {\n        throw new Error(`Model ${name} id should be ${expectedId} but is ${currentEditModel.$modelId}`);\n      }\n    }\n  : () => {};\n\nexport const build_life_the_universe_and_everything = () => {\n  if (DEBUG) {\n    console.time(\"build_life_the_universe_and_everything\");\n  }\n  const HORN_STACKS = 10;\n\n  const hornsMatrices = integers_map(HORN_STACKS + 1, (i: number) =>\n    identity\n      .translate(Math.sin((i / HORN_STACKS) * Math.PI), i / HORN_STACKS)\n      .rotate(10 * (i / HORN_STACKS))\n      .scale(1.0001 - i / HORN_STACKS, 0, 1 - i / HORN_STACKS),\n  );\n\n  const hornPolygons = integers_map(HORN_STACKS, (i) =>\n    cylinder_sides(\n      polygon_transform(polygon_regular(18), hornsMatrices[i]!).reverse(),\n      polygon_transform(polygon_regular(18), hornsMatrices[i + 1]!),\n      1,\n    ),\n  ).flat();\n\n  // Initialize the full screen triangle for the sky. Must be the first model.\n\n  newModel(() => meshAdd([GQuad.slice(1)], identity.translate(-2).scale3d(3).rotate(90, 0)), MODEL_KIND_MESH);\n\n  newModel(() => {\n    const getBoatAnimationMatrix = (x: number, y: number, z: number) =>\n      identity\n        .translate(x + Math.sin(gameTime + 2) / 5, y + Math.sin(gameTime * 0.8) / 3, z)\n        .rotateSelf(Math.sin(gameTime) * 2, Math.sin(gameTime * 0.7), Math.sin(gameTime * 0.9));\n\n    const makeBigArcPolygons = (height: number) =>\n      csg_polygons_subtract(\n        polygons_transform(cylinder(), identity.translate(0, -height / 2).scale(6, height - 1, 2.2)),\n        polygons_transform(cylinder(), identity.translate(0, -height / 2 - 6).scale(4, height - 3, 4)),\n        polygons_transform(\n          cylinder(32, 1),\n          identity\n            .translate(0, height / 2 - 9)\n            .rotate(90, 0, 90)\n            .scale3d(4),\n        ),\n      );\n\n    const boatPolygons = csg_polygons_subtract(\n      polygons_transform(\n        cylinder(20, 1, 1.15, 1),\n        identity.translate(0, -3).scale(3.5, 1, 3.5),\n        material(0.7, 0.4, 0.25, 0.7),\n      ),\n      polygons_transform(\n        cylinder(20, 1, 1.3, 1),\n        identity.translate(0, -2.5).scale(2.6, 1, 3),\n        material(0.7, 0.4, 0.25, 0.2),\n      ),\n      polygons_transform(cylinder(), identity.translate(4, -1.2).scale3d(2), material(0.7, 0.4, 0.25, 0.3)),\n    );\n\n    const gateBarsPolygons = integers_map(7, (i) =>\n      polygons_transform(\n        cylinder(6, 1),\n        identity.translate(4 * (i / 6 - 0.5), 3).scale(0.2, 3, 0.2),\n        material(0.3, 0.3, 0.38),\n      ),\n    ).flat();\n\n    // ========= FIRST BOAT (modelId:2) ========= //\n\n    newModel((model) => {\n      checkModelId(\"FIRST_BOAT\", MODEL_ID_FIRST_BOAT);\n      model._update = () => getBoatAnimationMatrix(-12, 4.2, -66 + firstBoatLerp * 40);\n      meshAdd(boatPolygons);\n\n      // LEVER 0 - lever over the first boat\n      newLever(identity.translate(0, -3, 4));\n    });\n\n    // LEVER 1 - lever for the first gate, after the first boat\n    newLever(identity.translate(-5.4, 1.5, -19).rotate(0, -90));\n\n    // ========= WORLD! ========= //\n\n    // SOUL 0 - soul after first boat\n    newSoul(identity.translate(-0.5, 2.8, -20), [0, 0, 2.5], [0, -3, 2.5]);\n\n    // SOUL 1 - soul after first gate\n    newSoul(\n      identity.translate(0, 2.8),\n      [5, 10, 3],\n      [-5, 10, 3],\n      ...polygon_regular(18).map(({ x, z }) => [x * 7, z * 10, 4.5 - abs(x) * 2]),\n    );\n\n    // first boat attachment\n\n    meshAdd(cylinder(), identity.translate(-5, -0.2, -26).scale(3.2, 1, 2.5).skewX(3), material(0.8, 0.8, 0.8, 0.2));\n\n    // gate columns\n    GQuad.map(({ x, z }) =>\n      meshAdd(cylinder(6), identity.translate(x * 3, 3, z * 15).scale(0.7, 4, 0.7), material(0.6, 0.3, 0.3, 0.4)),\n    );\n\n    // in and out\n    [-23, 22].map((z) => meshAdd(cylinder(), identity.translate(0, 0, z).scale(3, 1, 8), material(0.9, 0.9, 0.9, 0.2)));\n\n    [-15, 15].map((z, i) => {\n      //  gate top\n      meshAdd(cylinder(), identity.translate(0, 6.3, z).scale(4, 0.3, 1), material(0.3, 0.3, 0.3, 0.4));\n      //  gate bottom\n      meshAdd(cylinder(), identity.translate(0, 1, z).scale(3, 0.2, 0.35), material(0.5, 0.5, 0.5, 0.3));\n      // in and out gate bars\n      newModel((model) => {\n        model._update = () => identity.translate(0, 0, z).scale(1, clamp01(1.22 - levers[i + 1]!.$lerpValue), 1);\n        meshAdd(gateBarsPolygons);\n      });\n    });\n\n    // horns\n\n    integers_map(5, (i) =>\n      integers_map(2, (j) =>\n        meshAdd(\n          hornPolygons,\n          identity\n            .translate((j - 0.5) * 18.5, 0, i * 4.8 - 9.5)\n            .rotate(0, 180 - j * 180)\n            .scale(1.2, 10, 1.2),\n          material(1, 1, 0.8, 0.2),\n        ),\n      ),\n    );\n\n    meshAdd(cylinder(), identity.translate(3, 1.5, -20).scale(0.5, 2, 5), material(0.7, 0.7, 0.7, 0.2));\n\n    // first lever pad\n    meshAdd(\n      cylinder(),\n      identity.translate(-3.4, -0.2, -19).scale(2, 1, 1.5).rotate(0, -90),\n      material(0.75, 0.75, 0.75, 0.2),\n    );\n    meshAdd(cylinder(5), identity.translate(-5.4, 0, -19).scale(2, 1, 2).rotate(0, -90), material(0.6, 0.3, 0.3, 0.4));\n\n    // descent\n\n    meshAdd(\n      cylinder(),\n      identity.rotate(0, 60).translate(14.8, -1.46, -1).rotate(-30).scale(4, 0.6, 4.5),\n      material(0.8, 0.2, 0.2, 0.5),\n    );\n\n    // base\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          // lower base\n          polygons_transform(\n            cylinder(6, 0, 0, 0.3),\n            identity.translate(8, -3, -4).scale(13, 1, 13),\n            material(0.7, 0.7, 0.7, 0.2),\n          ),\n\n          // hole extension\n          polygons_transform(cylinder(6), identity.translate(0, -8).scale(9, 8, 8), material(0.4, 0.2, 0.5, 0.5)),\n\n          // middle base\n          polygons_transform(\n            cylinder(6, 0, 0, 0.3),\n            identity.translate(0, -0.92).scale(13, 2, 13),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n        ),\n        // hole\n        polygons_transform(cylinder(5), identity.scale(5, 30, 5), material(0.4, 0.2, 0.6, 0.5)),\n\n        // smooth hole\n        polygons_transform(\n          cylinder(5, 0, 1.5),\n          identity.translate(0, 1).scale(4.5, 0.3, 4.5),\n          material(0.7, 0.5, 0.9, 0.2),\n        ),\n\n        // descent cut\n        polygons_transform(\n          cylinder(),\n          identity.rotate(0, 60).translate(14, 0.7, -1).rotate(-35).scale(2, 2, 2),\n          material(0.5, 0.5, 0.5, 0.5),\n        ),\n\n        // lower lever pad\n        polygons_transform(\n          cylinder(6),\n          identity.translate(15, -1.5, 4).scale(3.5, 1, 3.5),\n          material(0.5, 0.5, 0.5, 0.5),\n        ),\n      ),\n    );\n\n    // moving central platform in the first level\n\n    newModel((model) => {\n      model._update = () =>\n        identity.translate(\n          0,\n          levers[3]!.$lerpValue > 0.01\n            ? (Math.cos(gameTime * 1.5) * 5 + 2) * levers[3]!.$lerpValue2 * (1 - levers[2]!.$lerpValue) +\n                (1 - levers[3]!.$lerpValue) * -15\n            : // invisible\n              -500,\n          0,\n        );\n      meshAdd(cylinder(5), identity.translate(0, -0.2).scale(5, 1, 5), material(0.6, 0.65, 0.7, 0.3));\n\n      // LEVER 2 - lever over the central moving platform\n      newLever(identity.translate(0, 1.2));\n    });\n\n    // LEVER 3, lever in the descent of the first level\n    newLever(identity.translate(15, -2, 4));\n\n    // ******** LEVEL 2 ********\n\n    const level2Oscillation = () => min(levers[2]!.$lerpValue2, 1 - levers[4]!.$lerpValue2);\n\n    const blackPlatform = (freq: number, amplitude: number, pz: number) =>\n      newModel((model) => {\n        model._update = () =>\n          identity.translate(level2Oscillation() * Math.sin(freq * 3 + gameTime * freq) * amplitude);\n        GQuad.map(({ x, z }) => {\n          // column body\n          meshAdd(\n            cylinder(11, 1),\n            identity.translate(x * 4, 4, pz + z * 4).scale(0.8, 3, 0.8),\n            material(0.5, 0.3, 0.7, 0.6),\n          );\n          // column top\n          meshAdd(cylinder(), identity.translate(x * 4, 7, pz + z * 4).scale(1, 0.3), material(0.5, 0.5, 0.5, 0.3));\n        });\n\n        meshAdd(\n          csg_polygons_subtract(\n            polygons_transform(cylinder(), identity.translate(0, 0, pz).scale(5, 1, 5), material(0.8, 0.8, 0.8, 0.3)),\n            ...[-1, 1].map((i) =>\n              polygons_transform(\n                cylinder(),\n                identity\n                  .translate(5 * i, 0.2, pz)\n                  .rotate(i * -30)\n                  .scale(4, 1, 2),\n                material(0.8, 0.8, 0.8, 0.3),\n              ),\n            ),\n          ),\n        );\n        // bottom\n        meshAdd(cylinder(), identity.translate(0, -3, pz).scale(8, 2, 8), material(0.4, 0.4, 0.4, 0.3));\n      });\n\n    blackPlatform(0.7, 12, 35);\n    blackPlatform(1, 8.2, 55);\n\n    // central oscillating platform\n    newModel((model) => {\n      model._update = () => identity.translate(level2Oscillation() * Math.sin(gameTime / 1.5 + 2) * 12);\n      meshAdd(\n        csg_polygons_subtract(\n          csg_union(\n            polygons_transform(cylinder(), identity.scale(1.5, 1, 5), material(0.9, 0.9, 0.9, 0.2)),\n            polygons_transform(cylinder(6), identity.scale(4, 1, 5), material(0.9, 0.9, 0.9, 0.2)),\n            polygons_transform(cylinder(), identity.translate(0, -2).scale(2, 3.2, 1.9), material(0.3, 0.8, 0.5, 0.5)),\n            polygons_transform(\n              cylinder(16, 1, 0, 4),\n              identity.scale(1, 1, 1.5).rotate(0, 90),\n              material(0.9, 0.9, 0.9, 0.2),\n            ),\n          ),\n          polygons_transform(cylinder(), identity.scale(1.3, 10, 1.3), material(0.2, 0.7, 0.4, 0.6)),\n        ),\n        identity.translate(0, 0, 45),\n      );\n\n      // SOUL 2 - soul over the central oscillating platform in the second level\n      newSoul(identity.translate(0, 2.8, 45), [0, 0, 4.5]);\n    });\n\n    const level3Oscillation = () =>\n      clamp01(1 - level2Oscillation() * 5) * lerpneg(levers[4]!.$lerpValue, levers[5]!.$lerpValue);\n\n    // ******** LEVEL 3 ********\n\n    meshAdd(cylinder(), identity.translate(-21.1 + 2.45, -3, 55).scale(2.45, 1.4, 2.7), material(0.9, 0.9, 0.9, 0.2));\n\n    // triangle platform\n\n    newModel((model) => {\n      model._update = () => identity.translate((1 - level2Oscillation()) * 9.8);\n\n      meshAdd(cylinder(3), identity.translate(-23, -1.7, 55.8).scale(5, 0.7, 8.3), material(0.3, 0.6, 0.6, 0.2));\n      meshAdd(cylinder(8), identity.translate(-23, -2.2, 66.5).scale(1.5, 1.2, 1.5), material(0.8, 0.8, 0.8, 0.2));\n      meshAdd(cylinder(), identity.translate(-23, -3, 55).scale(5.2, 1.7, 3), material(0.5, 0.5, 0.5, 0.3));\n      meshAdd(cylinder(), identity.translate(-23, -2.2, 62).scale(3, 1, 4), material(0.5, 0.5, 0.5, 0.3));\n\n      newLever(identity.translate(-23, -0.5, 66.5));\n    });\n\n    // vertically oscillating mini platforms\n\n    newModel((model) => {\n      model._update = () => identity.translate(0, level3Oscillation() * Math.sin(gameTime * (1.5 * 0.9)) * 4);\n\n      meshAdd(cylinder(), identity.translate(-21.1 - 1.45, -3, 55).scale(1.45, 1.4, 2.7), material(0.7, 0.7, 0.7, 0.2));\n\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(), identity.scale(3, 1.4, 2.7)),\n          polygons_transform(cylinder(), identity.scale(1.2, 8, 1.2)),\n        ),\n        identity.translate(-33, -3, 55),\n        material(0.7, 0.7, 0.7, 0.2),\n      );\n    });\n\n    // horizontaly oscillating mini platforms\n\n    newModel((model) => {\n      model._update = () => identity.translate(0, 0, level3Oscillation() * Math.sin(gameTime * 0.9) * 8);\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(\n            cylinder(),\n            identity.translate(-27, -3, 55).scale(3, 1.4, 2.7),\n            material(0.9, 0.9, 0.9, 0.2),\n          ),\n          polygons_transform(cylinder(), identity.translate(-27, -3, 55).scale(1, 3), material(0.9, 0.9, 0.9, 0.2)),\n        ),\n      );\n\n      meshAdd(cylinder(), identity.translate(-39, -3, 55).scale(3, 1.4, 2.7), material(0.9, 0.9, 0.9, 0.2));\n    });\n\n    // hex corridor door\n\n    newModel((model) => {\n      model._update = () => identity.translate(0, levers[4]!.$lerpValue2 * -6.5);\n      meshAdd(\n        cylinder(6),\n        identity.translate(-44.5, 0, 55).rotate(90, 90).rotate(0, 90).scale(5.9, 0.5, 5.9),\n        material(0.7, 0.7, 0.7, 0.4),\n      );\n    });\n\n    newLever(identity.translate(-55, -1.1, 46).rotate(0, 90));\n\n    meshAdd(cylinder(6), identity.translate(-61.3, -2.4, 49).scale(3, 1, 5), material(0.4, 0.6, 0.6, 0.3));\n    meshAdd(cylinder(7), identity.translate(-57, -2.6, 46).scale(4, 1, 4), material(0.8, 0.8, 0.8, 0.3));\n\n    // hex corridor\n\n    const hexCorridorPolygons = [\n      ...polygons_transform(cylinder(), identity.translate(0, -3).scale(11, 1.4, 3), material(0.9, 0.9, 0.9, 0.2)),\n      ...csg_polygons_subtract(\n        polygons_transform(cylinder(6), identity.rotate(90).scale(6, 8, 6), material(0.3, 0.6, 0.6, 0.3)),\n        polygons_transform(\n          cylinder(4, 0, 0.01),\n          identity.translate(0, 6).scale(12, 2, 0.75).rotate(0, 45),\n          material(0.3, 0.6, 0.6, 0.3),\n        ),\n        polygons_transform(cylinder(6), identity.rotate(90).scale(5, 12, 5), material(0.3, 0.6, 0.6, 0.3)),\n        ...[5, 0, -5].map((x) =>\n          polygons_transform(\n            cylinder(5),\n            identity.translate(x, 2.5).rotate(90, 0, 36).scale(1.8, 10, 1.8),\n            material(0.3, 0.6, 0.6, 0.3),\n          ),\n        ),\n      ),\n    ];\n\n    meshAdd(hexCorridorPolygons, identity.translate(-53, 0, 55));\n\n    // rotating hex corridor\n\n    newModel((model) => {\n      model._update = () => {\n        return identity\n          .translate(-75, (1 - levers[5]!.$lerpValue2) * (1 - levers[6]!.$lerpValue) * 3, 55)\n          .rotate(180 * (1 - levers[5]!.$lerpValue2) + rotatingHexCorridorRotation, 0);\n      };\n      meshAdd(hexCorridorPolygons);\n    }, MODEL_KIND_GAME_NO_ATTACH_PLAYER);\n\n    // connection from rotating hex corridor to platforms\n\n    meshAdd(\n      cylinder(),\n      identity.translate(-88.3, -5.1, 55).rotate(-30).scale(5, 1.25, 4.5),\n      material(0.7, 0.7, 0.7, 0.2),\n    );\n\n    meshAdd(\n      cylinder(3, 0, -0.5),\n      identity.translate(-88.4, -3.9, 55).rotate(0, -90, 17).scale(3, 1.45, 5.9),\n      material(0.8, 0.8, 0.8, 0.2),\n    );\n\n    // platform after the rotating hex corridor\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          // base\n          polygons_transform(\n            cylinder(),\n            identity.translate(-100, -2.5, 55).scale(8, 1, 8),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n          // right path to the boat\n          polygons_transform(\n            cylinder(),\n            identity.translate(-113, -2.6, 55).scale(6.2, 1.1, 3).skewX(3),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n          // straiht line\n          polygons_transform(\n            cylinder(),\n            identity.translate(-100, -2.6, 70).scale(3, 1.1, 7),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n          // 45 degrees detour\n          polygons_transform(\n            cylinder(),\n            identity.translate(-96, -2.6, 73).rotate(0, 45).scale(3, 1.1, 5),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n          // 45 degrees detour hexagon\n          polygons_transform(\n            cylinder(6),\n            identity.translate(-88.79, -2.6, 80.21).scale(6, 1.1, 6).rotate(0, 15),\n            material(0.6, 0.6, 0.6, 0.3),\n          ),\n\n          // ascension\n          polygons_transform(\n            cylinder(),\n            identity.translate(-100, -1.1, 82.39).rotate(-15, 0).scale(3, 1.1, 6),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n          // ascension continuation\n          polygons_transform(\n            cylinder(),\n            identity.translate(-100, 0.42, 92).scale(3, 1.1, 4.1),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n        ),\n\n        // decorative octagon\n        polygons_transform(\n          cylinder(8),\n          identity.translate(-100, -1, 55).scale(7, 0.9, 7),\n          material(0.3, 0.3, 0.3, 0.4),\n        ),\n        polygons_transform(\n          cylinder(8),\n          identity.translate(-100, -2, 55).scale(4, 0.3, 4),\n          material(0.4, 0.4, 0.4, 0.5),\n        ),\n        polygons_transform(\n          cylinder(8),\n          identity.translate(-100, -3, 55).scale(0.6, 1, 0.6),\n          material(0.4, 0.4, 0.4, 0.5),\n        ),\n      ),\n    );\n\n    // SOUL 3 - soul in the central area, after the rotating hex corridor\n    newSoul(identity.translate(-100, 0.2, 55), [0, 0, 7.5], [-8, 0, 3.5], [-12, 0, 3.5], [-15, 0, 3.5]);\n\n    // SOUL 4 - soul after the central gate\n    newSoul(identity.translate(-89, 0.2, 80), [0, 0, 6]);\n\n    // first arc door\n\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(cylinder(), identity.translate(-100, 1, 63).scale(7.5, 4), material(0.5, 0.5, 0.5, 0.4)),\n        polygons_transform(cylinder(), identity.translate(-100, 0, 70).scale(2, 2, 10), material(0.5, 0.5, 0.5, 0.4)),\n        polygons_transform(\n          cylinder(20, 1),\n          identity.translate(-100, 2, 70).scale(2, 2, 10).rotate(90, 0),\n          material(0.5, 0.5, 0.5, 0.4),\n        ),\n      ),\n    );\n\n    // gate bars\n    newModel((model) => {\n      model._update = () => identity.translate(-99.7, -1.9, 63.5).scale(1, clamp01(1.1 - levers[6]!.$lerpValue), 1);\n      meshAdd(gateBarsPolygons);\n    });\n\n    // hex columns\n\n    GQuad.map(({ x, z }) => {\n      meshAdd(\n        cylinder(6),\n        identity.translate(-100 + x * 7, -3, z * 7 + 55).scale(1, 8.1),\n        material(0.6, 0.15, 0.15, 0.8),\n      );\n      [4, -0.4].map((i) =>\n        meshAdd(\n          cylinder(6),\n          identity.translate(-100 + x * 7, i, z * 7 + 55).scale(1.3, 0.5, 1.3),\n          material(0.4, 0.2, 0.2, 0.8),\n        ),\n      );\n    });\n\n    // crystals\n\n    integers_map(7, (i) => {\n      meshAdd(\n        cylinder(((i * 23 + 1) % 5) + 5, 0, 0.55),\n        identity\n          .translate(-101 + Math.sin(i) * 5 + i, -2.3 - i, 44.9 - i * 2.8)\n          .scaleSelf(5 + i / 2, 1 + i / 6, 5 + i / 3),\n        material(0.5 - i / 17, 0.5 - (i & 1) / 9, 0.6, 0.3),\n      );\n    });\n\n    // crystals continuation pad\n\n    meshAdd(cylinder(), identity.translate(-87, -9.5, 24).scale(7, 1, 3), material(0.4, 0.5, 0.6, 0.4));\n\n    // lever pad\n\n    meshAdd(cylinder(4), identity.translate(-86, -9.2, 27).scale(5, 1, 5), material(0.5, 0.6, 0.7, 0.3));\n\n    meshAdd(cylinder(12, 1), identity.translate(-86, -9, 31).scale(1.5, 1, 1.5), material(0.3, 0.3, 0.4, 0.1));\n\n    newLever(identity.translate(-86, -7.5, 31));\n\n    // elevators\n\n    const shouldOscillate = () => lerpneg(levers[7]!.$lerpValue2, levers[6]!.$lerpValue2);\n\n    newModel((model) => {\n      model._update = () =>\n        identity.translate(\n          0,\n          (1 - max(levers[6]!.$lerpValue, levers[7]!.$lerpValue)) * 3.5 + shouldOscillate() * Math.sin(gameTime) * 5,\n        );\n      [0, 12, 24].map((x) =>\n        meshAdd(\n          cylinder(),\n          identity.translate(x - 76.9, x / -13 - 10, 24).scale(2.8, 1.5, 3),\n          material(0.2, 0.5, 0.6, 0.2),\n        ),\n      );\n    });\n\n    newModel((model) => {\n      model._update = () =>\n        identity.translate(\n          0,\n          shouldOscillate() * Math.sin(gameTime + 3) * 6,\n          Math.sin(gameTime * 0.6 + 1) * 6 * shouldOscillate(),\n        );\n      [6, 18].map((x) =>\n        meshAdd(\n          cylinder(),\n          identity.translate(x - 76.9, x / -13 - 10, 24).scale(2.8, 1.5, 3),\n          material(0.1, 0.4, 0.5, 0.2),\n        ),\n      );\n    });\n\n    // pad after elevators\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          // lever pad\n          polygons_transform(cylinder(5), identity.translate(0, 0, -7).scale(2, 1.2, 2), material(0.2, 0.4, 0.7, 0.3)),\n          // blue pentagon\n          polygons_transform(cylinder(5), identity.scale(9, 1.2, 9), material(0, 0.2, 0.3, 0.5)),\n          // base\n          polygons_transform(cylinder(), identity.scale(11, 1, 13), material(0.3, 0.4, 0.6, 0.3)),\n        ),\n        polygons_transform(cylinder(5), identity.scale(5.4, 5, 5.4), material(0, 0.2, 0.3, 0.5)),\n      ),\n      identity.translate(-38.9, -11.3, 17),\n    );\n\n    newLever(identity.translate(-38.9, -9.6, 10));\n\n    // central sculpture/monument\n\n    newModel((model) => {\n      model._update = () => identity.translate(0, levers[7]!.$lerpValue2 * -7.3);\n\n      meshAdd(\n        csg_polygons_subtract(\n          csg_union(\n            polygons_transform(\n              cylinder(5),\n              identity.translate(0, 2).scale(5, 7, 5).skewY(8),\n              material(0.2, 0.4, 0.5, 0.5),\n            ),\n            polygons_transform(\n              cylinder(5),\n              identity.translate(0, 6).scale(1.1, 7, 1.1).skewY(-8),\n              material(0.25, 0.35, 0.5, 0.5),\n            ),\n            polygons_transform(\n              cylinder(5),\n              identity.translate(0, 9).scale(0.6, 7, 0.6).skewY(8),\n              material(0.35, 0.3, 0.5, 0.5),\n            ),\n          ),\n          polygons_transform(cylinder(5), identity.scale(4, 8, 4), material(0.2, 0.4, 0.5, 0.5)),\n          polygons_transform(\n            cylinder(5),\n            identity.translate(0, 5).scale(1.5, 1.5, 8).rotate(90, 0, 35),\n            material(0.2, 0.4, 0.5, 0.5),\n          ),\n        ),\n        identity.translate(-38.9, -11.3, 17),\n      );\n\n      // SOUL 5 - soul over the central sculpture/monument\n      newSoul(\n        identity.translate(-39.1, -0.6, 17).rotate(11),\n        ...polygon_regular(15).map(({ x, z }) => [x * 3, z * 3, 1.2]),\n      );\n    });\n\n    // columns\n\n    GQuad.map(({ x, z }) => {\n      meshAdd(\n        cylinder(14, 1),\n        identity.translate(x * 9 - 38.9, -7.3, z * 11 + 17).scale(1, 4),\n        material(0.25, 0.25, 0.25, 1),\n      );\n      [1.5, 8].map((y) =>\n        meshAdd(\n          cylinder(17, 1),\n          identity\n            .translate(x * 9 - 38.9, -7.3, z * 11 + 17)\n            .translate(0, y - 4)\n            .scale(1.5, 0.5, 1.5),\n          material(0.6, 0.6, 0.6, 0.3),\n        ),\n      );\n    });\n\n    // Grid with holes\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          // holed base\n          polygons_transform(\n            cylinder(6),\n            identity.translate(0, 0, -36).scale(15, 1.2, 15),\n            material(0.7, 0.7, 0.7, 0.3),\n          ),\n          // after monument continuation\n          polygons_transform(cylinder(), identity.translate(0, 0, -18).scale(4, 1.2, 6), material(0.45, 0.4, 0.6, 0.3)),\n        ),\n        ...integers_map(6, (z) =>\n          integers_map(6, (x) =>\n            polygons_transform(\n              cylinder(6),\n              identity.translate(x * 4.6 - 12 + 2 * (z & 1), 0, z * 4.6 - 50 + Math.sin(x * 4) * 2).scale(2, 5, 2),\n              material(0.7, 0.7, 0.7, 0.3),\n            ),\n          ),\n        ).flat(),\n      ),\n      identity.translate(-38.9, -11.3, 17),\n    );\n\n    // SOUL 6 - soul over the grid with hex holes\n    newSoul(identity.translate(-38.9, -8.4, -21), [-7, -2.5, 6], [6, -3, 6], [0, -5, 7]);\n\n    // Detour lever pad\n    meshAdd(cylinder(5), identity.translate(-84, -2, 85).scale(4, 0.8, 4).rotate(0, 10), material(0.8, 0.1, 0.25, 0.4));\n\n    // Detour lever\n    newLever(identity.translate(-84, -0.5, 85).rotate(0, 45));\n\n    // ******** SECOND BOAT ********\n\n    newModel((model) => {\n      model._update = () => getBoatAnimationMatrix(-123, 1.4, 55 + secondBoatLerp * -65);\n      meshAdd(boatPolygons);\n      newLever(identity.translate(0, -3, -4).rotate(0, 180));\n    });\n\n    // ******** LEVEL AFTER SECOND BOAT ********\n\n    // pushing rods\n\n    const shouldPushRods = () => lerpneg(levers[10]!.$lerpValue, levers[11]!.$lerpValue);\n    const shouldBlockRods = () => (1 - levers[10]!.$lerpValue) * (1 - shouldPushRods());\n\n    const pushingRod = csg_polygons_subtract(\n      polygons_transform(\n        cylinder(),\n        identity.translate(0, -0.5, 1).scale(1.15, 1.2, 6.5),\n        material(0.25, 0.25, 0.35, 0.3),\n      ),\n      polygons_transform(cylinder(3), identity.translate(0, 0, -5.5).scale(3, 2), material(0.6, 0.3, 0.4, 0.3)),\n      ...[-1.2, 1.2].map((i) =>\n        polygons_transform(\n          cylinder(),\n          identity.translate(i, -0.5, 1).scale(0.14, 0.3, 6.5),\n          material(0.7, 0.2, 0, 0.3),\n        ),\n      ),\n    );\n\n    newModel((model) => {\n      model._update = () => identity.translate(0, -2, shouldPushRods() * abs(Math.sin(gameTime * 1.1)) * -8.5 + 10);\n      integers_map(2, (x) => meshAdd(pushingRod, identity.translate(-110 + x * 9 + (x & 1), 1.7, -12)));\n    });\n\n    newModel((model) => {\n      model._update = () => identity.translate(0, -2, shouldPushRods() * abs(Math.sin(gameTime * 2.1)) * -8.5 + 10);\n      integers_map(2, (x) => meshAdd(pushingRod, identity.translate(-110 + (x + 2) * 9 + (x & 1), 1.7, -12)));\n    });\n\n    newModel((model) => {\n      model._update = () =>\n        identity.translate(0, -2, max(shouldBlockRods(), shouldPushRods() * abs(Math.sin(gameTime * 1.5))) * -8.5 + 10);\n      integers_map(3, (x) => meshAdd(pushingRod, identity.translate(-106 + x * 9, 1.7, -12)));\n    });\n\n    // pushing rods container\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          polygons_transform(cylinder(), identity.translate(26.5, -1.6, 10).scale(20, 2.08, 3)),\n          polygons_transform(cylinder(), identity.translate(26.5, -0.6, 10).scale(19, 2, 0.5)),\n        ),\n        ...integers_map(4, (x) =>\n          polygons_transform(cylinder(), identity.translate(13 + x * 9 + (x & 1), -0.8, 9).scale(1.35, 1.35, 9)),\n        ),\n        ...integers_map(3, (x) =>\n          polygons_transform(cylinder(), identity.translate(17 + x * 9, -0.8, 9).scale(1.35, 1.35, 9)),\n        ),\n      ),\n      identity.translate(-123, 0, -12),\n      material(0.5, 0.5, 0.6, 0.2),\n    );\n\n    // boat attachment\n\n    newLever(identity.translate(-116, -1.4, -18).rotate(0, 180));\n\n    meshAdd(cylinder(), identity.translate(-116, -2.6, -12).scale(3.2, 1.1, 4).skewX(3), material(0.8, 0.8, 0.8, 0.2));\n    meshAdd(cylinder(6), identity.translate(-116, -2.6, -16.5).scale(3.2, 0.8, 3), material(0.6, 0.5, 0.7, 0.2));\n\n    meshAdd(cylinder(), identity.translate(-115.5, -17, -12).scale(0.5, 15, 2.2), material(0.6, 0.6, 0.6, 0.3));\n\n    meshAdd(cylinder(8), identity.translate(-114, -17, -2).scale(2, 15, 2), material(0.6, 0.6, 0.6, 0.3));\n    meshAdd(cylinder(8), identity.translate(-79, -17, -2).scale(2, 15, 2), material(1, 1, 1, 0.3));\n\n    meshAdd(cylinder(), identity.translate(-77, -17, -50.5).scale(2.2, 15, 0.5), material(0.6, 0.6, 0.6, 0.3));\n\n    // arcs\n\n    integers_map(3, (i) => {\n      meshAdd(makeBigArcPolygons(16), identity.translate(i * 12 - 109, -9, -12), material(0.6, 0.6, 0.6, 0.3));\n\n      meshAdd(\n        makeBigArcPolygons(16),\n        identity.translate(-77, -9, i * -12 - 8 - 12).rotate(0, 90),\n        material(0.6, 0.6, 0.6, 0.3),\n      );\n    });\n\n    // tower\n\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(\n          cylinder(12),\n          identity.translate(-77, -14.5, -12).scale(4, 17.5, 4),\n          material(0.7, 0.7, 0.7, 0.2),\n        ),\n        polygons_transform(\n          cylinder(),\n          identity.translate(-79, 0.1, -12).scale(3.5, 2, 1.3),\n          material(0.4, 0.5, 0.6, 0.2),\n        ),\n        polygons_transform(\n          cylinder(),\n          identity.translate(-77, 0.1, -14).scale(1.5, 2, 2),\n          material(0.4, 0.5, 0.6, 0.2),\n        ),\n        polygons_transform(\n          cylinder(12),\n          identity.translate(-77, 3.1, -12).scale(3, 5, 3),\n          material(0.4, 0.5, 0.6, 0.2),\n        ),\n      ),\n    );\n\n    // internal pad\n\n    meshAdd(cylinder(), identity.translate(-84.9, -4.3, -40).rotate(12).scale(6, 1, 3), material(0.6, 0.6, 0.6, 0.3));\n    meshAdd(cylinder(9), identity.translate(-98, -18.4, -40).scale(2.5, 13.5, 2.5), material(0.5, 0.5, 0.5, 0.3));\n\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(cylinder(), identity.translate(-93, -5.8, -40).scale(9, 1, 5), material(0.8, 0.8, 0.8, 0.1)),\n        polygons_transform(\n          cylinder(9),\n          identity.translate(-98, -5.8, -40).scale(3, 8, 3),\n          material(0.7, 0.7, 0.7, 0.2),\n        ),\n      ),\n    );\n\n    newLever(identity.translate(-98, -4.4, -40).rotate(0, 90));\n\n    // SOUL 7 - soul after the second boat\n    newSoul(identity.translate(-115, 0.2, -12), [0, 0, 3.5]);\n\n    // SOUL 8 - soul in the internal pad after the pushing rods\n    newSoul(identity.translate(-93, -3, -28 - 12).rotate(4), [0, -2, 3.5], [0, 2, 3.5]);\n\n    // ******** LEVEL AFTER CENTRAL GATE ********\n\n    // base\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          polygons_transform(\n            cylinder(6, 0, 0, 0.6),\n            identity.translate(-100, 0.7, 105.5).scale(8, 1, 11),\n            material(0.7, 0.7, 0.7, 0.2),\n          ),\n          polygons_transform(\n            cylinder(),\n            identity.translate(-101.5, 0.7, 93.5).scale(10.5, 1, 2),\n            material(0.7, 0.7, 0.7, 0.2),\n          ),\n        ),\n        polygons_transform(\n          cylinder(5),\n          identity.translate(-100, 0.7, 113).scale(4, 3, 4),\n          material(0.7, 0.7, 0.7, 0.2),\n        ),\n      ),\n    );\n\n    // oscillating hex pads\n\n    const hexPadShouldOscillate = () => lerpneg(levers[8]!.$lerpValue2, levers[12]!.$lerpValue2);\n\n    integers_map(4, (i) =>\n      newModel((model) => {\n        model._update = () => {\n          const osc = hexPadShouldOscillate();\n          return identity.translate(\n            (i > 2 ? (1 - osc) * 2 + osc : 0) - 100,\n            osc * Math.sin(gameTime * 1.3 + i * 1.7) * (3 + i / 3) + 0.7,\n            (i & 1 ? -1 : 1) * (1 - levers[8]!.$lerpValue2) * (1 - levers[12]!.$lerpValue2) * -7 +\n              max(0.05, osc) * Math.cos(gameTime * 1.3 + i * 7) * (4 - 2 * (1 - i / 3)) +\n              115,\n          );\n        };\n        meshAdd(\n          cylinder(6),\n          identity.translate(-14.6 - i * 4.8 - (i > 2 ? 2 : 0), -i / 2.3, -21.5).scale(2.6, 1, 2.5),\n          material(0.5 - i / 8, i / 12 + 0.5, 0.7, 0.3),\n        );\n      }),\n    );\n\n    // after the hex pads\n\n    // donut pad\n    newModel((model) => {\n      model._update = () => {\n        const osc = hexPadShouldOscillate();\n        return identity\n          .translate(\n            (1 - osc) * 2.5 - 139.7,\n            (1 - levers[8]!.$lerpValue) * -3 + osc * Math.sin(gameTime * 0.8) * -1 - 1.8,\n            93.5,\n          )\n          .rotateSelf(Math.cos(gameTime * 1.3) * (osc * 3 + 3), 0);\n      };\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(10), identity.scale(6, 2, 6), material(0.1, 0.6, 0.5, 0.3)),\n          polygons_transform(cylinder(10), identity.scale(3.3, 6, 3.3), material(0.1, 0.6, 0.5, 0.5)),\n        ),\n      );\n\n      // second pad\n      meshAdd(cylinder(15, 1), identity.translate(-7.5).rotate(0, 90).scale(3, 2.3, 3), material(0.4, 0.4, 0.4, 0.3));\n      meshAdd(cylinder(10), identity.translate(-7.5).rotate(0, 90).scale(2, 2.5, 2), material(0.3, 0.8, 0.7, 0.3));\n      meshAdd(cylinder(5), identity.translate(-7.5).rotate(0, 90).scale(1, 3), material(0.5, 0.5, 0.5, 0.5));\n      newLever(identity.translate(-7.5).rotate(0, 90).translate(0, 3.4).rotate(0, 180));\n\n      // lateral horns\n      [-1, 1].map((i) =>\n        meshAdd(\n          hornPolygons,\n          identity\n            .rotate(-i * 90, 180, 90) //\n            .translate(0, 5)\n            .rotate(40) //\n            .scale(1.3, 10, 1.3), //\n          material(1, 1, 0.8, 0.2),\n        ),\n      );\n\n      // SOUL 9 - soul after the hex pads, in the hex donut with horns\n      newSoul(identity.translate(-5, 4), [0, -1.2, 1.7], [0, 1.2, 1.7]);\n    });\n\n    // far arc gate\n    [-1, 1].map((x) => {\n      meshAdd(\n        cylinder(12, 1),\n        identity.translate(-7.5 * x - 100, 3.7, 96).scale(0.8, 4, 0.8),\n        material(0.6, 0.24, 0.2, 0.5),\n      );\n\n      [7.2, 1.5].map((y) =>\n        meshAdd(\n          cylinder(15, 1),\n          identity.translate(-7.5 * x - 100, y + 0.7, 96).scale(1.1, 0.5, 1.1),\n          material(0.5, 0.24, 0.2, 0.4),\n        ),\n      );\n\n      meshAdd(\n        hornPolygons,\n        identity\n          .translate(x * -5 - 100, 1.7, 114.5)\n          .scale(1.2, 10, 1.2)\n          .rotate(0, 90 * x - 90),\n        material(1, 1, 0.8),\n      );\n\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(\n            cylinder(),\n            identity.translate(x * -4, 3.5, -0.5).scale(4, 4, 0.7),\n            material(0.5, 0.5, 0.5, 0.4),\n          ),\n          polygons_transform(cylinder(), identity.scale(3, 3, 10), material(0.6, 0.24, 0.2, 0.5)),\n          polygons_transform(\n            cylinder(28, 1),\n            identity.translate(0, 3, -5).scale(3, 4, 10).rotate(90, 0),\n            material(0.6, 0.24, 0.2, 0.5),\n          ),\n          polygons_transform(\n            cylinder(5),\n            identity\n              .translate(x * -5.3, 7)\n              .rotate(90, 0)\n              .scale(1.7, 5, 1.7),\n            material(0.6, 0.24, 0.2, 0.5),\n          ),\n          polygons_transform(\n            cylinder(5),\n            identity\n              .translate(x * -5.3, 3.8)\n              .rotate(90, 0, 35)\n              .scale(0.75, 5, 0.75),\n            material(0.6, 0.24, 0.2, 0.5),\n          ),\n        ),\n        identity.translate(x - 100, 0.7, 97),\n      );\n    });\n\n    // far arc gate door\n\n    // model._update = () => identity.translate(-99.7, -1.9, 63.5).scale(1, clamp01(1.1 - levers[6]!.$lerpValue), 1);\n\n    newModel((model) => {\n      model._update = () => identity.translate(-100, 0.6, 96.5).scale(0.88, 1.2 - levers[12]!.$lerpValue);\n      meshAdd(gateBarsPolygons);\n    });\n\n    // left continuation with hole for rotating corridor\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(\n          cylinder(),\n          identity.translate(-82.07, 0.8, 106).scale(11, 0.9, 2.2),\n          material(0.7, 0.7, 0.7, 0.1),\n        ),\n        polygons_transform(\n          cylinder(45, 1),\n          identity.translate(-81, 0.7, 106).scale3d(7.7),\n          material(0.7, 0.7, 0.7, 0.1),\n        ),\n      ),\n    );\n\n    // rotating platforms\n\n    // First rotating platform (with hole)\n    newModel((model) => {\n      model._update = () => identity.translate(-81, 0.6, 106).rotate(0, 40 + rotatingPlatform1Rotation);\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(45, 1), identity.scale(7.5, 1, 7.5), material(0.45, 0.45, 0.45, 0.2)),\n          polygons_transform(\n            cylinder(),\n            identity.translate(0, 0, -5.5).scale(1.5, 3, 2.7),\n            material(0.45, 0.45, 0.45, 0.2),\n          ),\n        ),\n      );\n      meshAdd(cylinder(8), identity.translate(0, 2).scale(3, 1.5, 3).rotate(0, 22), material(0.7, 0.7, 0.7, 0.1));\n      meshAdd(cylinder(5), identity.translate(0, 2).scale(1, 2), material(0.3, 0.3, 0.3, 0.2));\n\n      // SOUL 10 - soul over the first rotating platform\n      newSoul(identity.translate(0, 3), ...polygon_regular(14).map(({ x, z }) => [x * 5.6, z * 5.6, 2]));\n    });\n\n    // Second rotating platform\n    newModel((model) => {\n      model._update = () => identity.translate(-65.8, 0.8, 106).rotate(0, rotatingPlatform2Rotation);\n\n      // rotating platform horns\n      [-1, 1].map((x) =>\n        meshAdd(\n          hornPolygons,\n          identity\n            .rotate(0, 90)\n            .translate(x * -5, 1, -0.5)\n            .scale(1.2, 10, 1.2)\n            .rotate(0, 90 * x + 90),\n          material(1, 1, 0.8),\n        ),\n      );\n\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(28, 1), identity.translate(0, 2).scale(7.5, 1, 7.5), material(0.35, 0, 0, 0.3)),\n          polygons_transform(cylinder(), identity.scale(9, 5, 2), material(0.3, 0, 0, 0.3)),\n        ),\n      );\n\n      meshAdd(polygons_transform(cylinder(28, 1), identity.scale(7.5, 1, 7.5), material(0.45, 0.45, 0.45, 0.2)));\n      meshAdd(polygons_transform(cylinder(5), identity.translate(0, 1).scale(1, 0.2), material(0.3, 0.3, 0.3, 0.2)));\n    });\n\n    // Third rotating platform\n    newModel((model) => {\n      model._update = () => identity.translate(-50.7, 0.8, 106).rotate(0, 180 - rotatingPlatform2Rotation);\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(28, 1), identity.translate(0, 2).scale(7.5, 1, 7.5), material(0.35, 0, 0, 0.3)),\n          polygons_transform(cylinder(), identity.translate(7).scale(9, 5, 2), material(0.3, 0, 0, 0.3)),\n          polygons_transform(cylinder(), identity.translate(0, 0, 7).scale(2, 5, 9), material(0.3, 0, 0, 0.3)),\n        ),\n      );\n      meshAdd(polygons_transform(cylinder(28, 1), identity.scale(7.5, 1, 7.5), material(0.45, 0.45, 0.45, 0.2)));\n      meshAdd(polygons_transform(cylinder(5), identity.translate(0, 1).scale(1, 0.2), material(0.3, 0.3, 0.3, 0.2)));\n    });\n\n    // Fourth rotating platform\n    newModel((model) => {\n      model._update = () => identity.translate(-50.7, 0.8, 91).rotate(0, 270 + rotatingPlatform2Rotation);\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(28, 1), identity.translate(0, 2).scale(7.5, 1, 7.5), material(0.35, 0, 0, 0.3)),\n          polygons_transform(cylinder(), identity.translate(7).scale(9, 5, 2), material(0.3, 0, 0, 0.3)),\n          polygons_transform(cylinder(), identity.translate(0, 0, -7).scale(2, 5, 9), material(0.3, 0, 0, 0.3)),\n        ),\n      );\n      meshAdd(polygons_transform(cylinder(28, 1), identity.scale(7.5, 1, 7.5), material(0.45, 0.45, 0.45, 0.2)));\n      meshAdd(polygons_transform(cylinder(5), identity.translate(0, 1).scale(1, 0.2), material(0.3, 0.3, 0.3, 0.2)));\n    });\n\n    // rotating platforms connecting pads\n    meshAdd(cylinder(), identity.translate(-58, 1, 106).scale(2, 0.65, 2), material(0.7, 0.7, 0.7, 0.2));\n    meshAdd(cylinder(), identity.translate(-50.7, 1, 99).scale(2, 0.65, 1), material(0.7, 0.7, 0.7, 0.2));\n\n    // exit from the rotating platforms\n    meshAdd(cylinder(), identity.translate(-42, 0.4, 91).scale(5, 1, 2.5), material(0.7, 0.7, 0.7, 0.3));\n    meshAdd(cylinder(), identity.translate(-34.2, 0.4, 91).scale(3, 1, 3), material(0.7, 0.7, 0.7, 0.3));\n\n    newLever(identity.translate(-34, 2.7, 96).rotate(-12, 0));\n\n    // lever pad\n    meshAdd(cylinder(5), identity.translate(-34, 0.2, 96).scale(3, 2, 4).rotate(-20, 0), material(0.2, 0.5, 0.5, 0.6));\n\n    // ******** LEVEL AFTER THE ROTATING PLATFORMS ********\n\n    // jumping pads\n\n    [material(0.1, 0.55, 0.45, 0.2), material(0.2, 0.5, 0.5, 0.3), material(0.3, 0.45, 0.55, 0.4)].map((m, i) =>\n      newModel((model) => {\n        model._update = () => {\n          const v = lerpneg(levers[13]!.$lerpValue2, levers[14]!.$lerpValue2);\n          return identity.translate(\n            0,\n            (1 - levers[13]!.$lerpValue2) * (1 - levers[14]!.$lerpValue2) * (i ? 0 : 3) +\n              v * Math.sin(gameTime * 1.5 + i * 1.5) * 4,\n          );\n        };\n        meshAdd(cylinder(), identity.translate(-23.5, 0.5, 91 + 6.8 * i).scale(i === 1 ? 2 : 3.3, 1, 3.3), m);\n        if (i === 2) {\n          // in connection\n          meshAdd(cylinder(), identity.translate(-29.1, 0.4, 91).scale(2.1, 1, 3), material(0.7, 0.7, 0.7, 0.3));\n        }\n        if (i === 1) {\n          // out connections\n          meshAdd(\n            cylinder(),\n            identity.translate(-16.1, 0.5, 103.5).rotate(-3.5).scale(3.9, 0.8, 2).skewX(-1),\n            material(0.6, 0.6, 0.7, 0.3),\n          );\n        }\n      }),\n    );\n\n    // horns\n    [-1, 1].map((x) =>\n      meshAdd(\n        hornPolygons,\n        identity\n          .translate(x * -8, 1, 85)\n          .scale(1.2, 10, 1.2)\n          .rotate(0, 90 * x + 90),\n        material(1, 1, 0.8),\n      ),\n    );\n\n    integers_map(3, (i) =>\n      meshAdd(\n        makeBigArcPolygons(16 + 8.7 - (i & 1) * 0.7),\n        identity.translate(i * 6 - 6, 4 - (i & 1), 111 - 0.2 * (i & 1)),\n        i & 1 ? material(0.5, 0.5, 0.5, 0.3) : material(0.35, 0.35, 0.35, 0.5),\n      ),\n    );\n\n    // middle base\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(\n          cylinder(6, 0, 0, 0.3),\n          identity.translate(0, -0.92, 95).scale(14, 2, 14),\n          material(0.8, 0.8, 0.8, 0.2),\n        ),\n        polygons_transform(cylinder(5), identity.translate(0, 0, 95).scale3d(6), material(0.3, 0.3, 0.3, 0.5)),\n      ),\n    );\n\n    newLever(identity.translate(0, 1.7, 82).rotate(0, 180));\n\n    // lever pad\n\n    meshAdd(\n      cylinder(5),\n      identity.translate(0, -15.7, 82).scale(2.5, 17, 2.5).rotate(0, 35),\n      material(0.5, 0.3, 0.3, 0.4),\n    );\n\n    meshAdd(cylinder(6), identity.translate(0, 16, 121).scale(2.5, 1, 2.1).rotate(0, 90), material(0.5, 0.6, 0.7, 0.3));\n    meshAdd(cylinder(), identity.translate(0, 16, 129).scale(1.5, 1, 2), material(0.5, 0.6, 0.7, 0.3));\n    meshAdd(cylinder(7), identity.translate(0, 16.2, 133).scale(5, 1, 5), material(0.4, 0.5, 0.6, 0.4));\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          polygons_transform(\n            cylinder(),\n            identity.translate(0, 16, 110.5).scale(12, 1, 3),\n            material(0.5, 0.3, 0.3, 0.4),\n          ),\n          polygons_transform(cylinder(), identity.translate(0, 16, 111).scale(3, 1, 3.8), material(0.5, 0.3, 0.3, 0.4)),\n        ),\n\n        polygons_transform(\n          cylinder(5),\n          identity.translate(0, 16, 103.5).scale(5.5, 5, 5.5),\n          material(0.5, 0.3, 0.3, 0.4),\n        ),\n      ),\n    );\n\n    newModel((model) => {\n      model._update = () => {\n        const k = Math.sin(gameTime);\n        return identity.translate(k * -2).rotate(k * 25);\n      };\n      meshAdd(\n        cylinder(3),\n        identity.translate(0, -3, 118.8).scale(0.8, 0.8, 18).rotate(90, 0, 60),\n        material(0.5, 0.3, 0.3, 0.4),\n      );\n      [22, 30].map((z) => {\n        meshAdd(\n          cylinder(6),\n          identity\n            .translate(0, 16, z + 95)\n            .scale(3, 1, 2.3)\n            .rotate(0, 90),\n          material(0.7, 0.7, 0.7, 0.4),\n        );\n        meshAdd(cylinder(), identity.translate(0, 6.2, z + 95).scale(0.5, 11, 0.5), material(0.5, 0.3, 0.3, 0.4));\n      });\n    });\n\n    // floating elevator pad\n    newModel((model) => {\n      model._update = () => {\n        const v = lerpneg(\n          lerpneg((levers[14]!.$lerpValue + levers[14]!.$lerpValue2) / 2, levers[13]!.$lerpValue2),\n          (levers[15]!.$lerpValue + levers[15]!.$lerpValue2) / 2,\n        );\n        return identity.translate(0, v * 16, clamp01(v * 2 - 1) * 8.5 + 95);\n      };\n      meshAdd(cylinder(5), identity.scale(5, 1.1, 5), material(0.5, 0.3, 0.3, 0.4));\n      meshAdd(cylinder(5), identity.scale(5.5, 0.9, 5.5), material(0.25, 0.25, 0.25, 0.4));\n\n      newLever(identity.translate(0, 1.5, -1).rotate(0, 180));\n    });\n\n    // SOUL 11 - soul in the last platform\n    newSoul(identity.translate(0, 3, 95), ...polygon_regular(9).map(({ x, z }) => [x * 9, z * 9, 4]));\n\n    // SOUL 12 - soul after the pendulums\n    newSoul(identity.translate(0, 19, 134), [0, 0, 3.5]);\n  });\n\n  // ------ End of game models ------\n\n  // ------ player model and legs, must be declared just after level model ------\n\n  newModel(() => {\n    checkModelId(\"PLAYER_BODY\", MODEL_ID_PLAYER_BODY);\n    // horns\n    [0, 180].map((r) =>\n      meshAdd(\n        hornPolygons,\n        identity.rotate(0, r).translate(0.2, 1.32).rotate(-30).scale(0.2, 0.6, 0.2),\n        material(1, 1, 0.8),\n      ),\n    );\n\n    // head\n    meshAdd(sphere(20), identity.translate(0, 1).scale(0.5, 0.5, 0.5), material(1, 0.3, 0.4));\n\n    const eye = polygons_transform(\n      csg_polygons_subtract(\n        cylinder(15, 1),\n        polygons_transform(cylinder(), identity.translate(0, 0, 1).scale(2, 2, 0.5)),\n      ),\n      identity.rotate(-90, 0).scale(0.1, 0.05, 0.1),\n      material(0.3, 0.3, 0.3),\n    );\n\n    [-1, 1].map((i) => meshAdd(eye, identity.translate(i * 0.2, 1.2, 0.4).rotate(0, i * 20, i * 20)));\n\n    // mouth\n    meshAdd(cylinder(), identity.translate(0, 0.9, 0.45).scale(0.15, 0.02, 0.06), material(0.3, 0.3, 0.3));\n\n    // body\n    meshAdd(sphere(20), identity.scale(0.7, 0.8, 0.55), material(1, 0.3, 0.4));\n  });\n\n  [-1, 1].map((x) =>\n    newModel(() => {\n      checkModelId(\"PLAYER_LEG\" + (x + 1), x === -1 ? MODEL_ID_PLAYER_LEG0 : MODEL_ID_PLAYER_LEG1);\n      meshAdd(cylinder(10, 1), identity.translate(x * 0.3, -0.8).scale(0.2, 0.7, 0.24), material(1, 0.3, 0.4));\n    }),\n  );\n\n  newModel(() => {\n    checkModelId(\"LEVER\", MODEL_ID_LEVER);\n    meshAdd(cylinder(6, 1), identity.scale(0.13, 1.4, 0.13), material(0.3, 0.3, 0.5, 0.1));\n    meshAdd(cylinder(10), identity.translate(0, 1).scale(0.21, 0.3, 0.21), material(1, 0.5, 0.2));\n    meshAdd(cylinder(3), identity.translate(0, -1).rotate(90, 90).scale(0.3, 0.4, 0.3), material(0.2, 0.2, 0.2, 0.1));\n  }, MODEL_KIND_MESH);\n\n  newModel(() => {\n    checkModelId(\"SOUL_COLLISION\", MODEL_ID_SOUL_COLLISION);\n    meshAdd(cylinder(6).slice(0, -1), identity.scale(0.77, 1, 0.77), material(1, 0.3, 0.5));\n  }, MODEL_KIND_MESH);\n\n  newModel(() => {\n    checkModelId(\"SOUL\", MODEL_ID_SOUL);\n    const GHOST_SLICES = 30;\n    const GHOST_STACKS = 24;\n\n    // body\n    meshAdd(\n      sphere(GHOST_SLICES, GHOST_STACKS, (a: number, b: number, polygon: Polygon) => {\n        const bm = b / GHOST_STACKS;\n        const theta = a * (Math.PI * (2 / GHOST_SLICES));\n        const phixz = (bm ** 0.6 * Math.PI) / 2;\n        const osc = (bm * bm * Math.sin(a * Math.PI * (14 / GHOST_SLICES))) / 4;\n        if (b === GHOST_STACKS - 1) {\n          polygon.$smooth = 0;\n          return { x: 0, y: -0.5, z: 0 };\n        }\n        return {\n          x: Math.cos(theta) * Math.sin(phixz),\n          y: Math.cos(bm * Math.PI) - bm - osc,\n          z: Math.sin(theta) * Math.sin(phixz) + Math.sin(osc * Math.PI * 2) / 4,\n        };\n      }),\n      identity.scale3d(0.7),\n      material(1, 1, 1),\n    );\n\n    // eyes\n    [-1, 1].map((x) => meshAdd(sphere(12), identity.translate(x * 0.16, 0.4, -0.36).scale3d(0.09)));\n  }, MODEL_KIND_MESH);\n\n  if (DEBUG) {\n    console.timeEnd(\"build_life_the_universe_and_everything\");\n    console.log(souls.length + \" souls, \" + levers.length + \" levers\");\n  }\n};\n","import { constDef_zNear, constDef_zFar } from \"./shaders/main-fragment.frag\";\n\nimport { DEG_TO_RAD, mat_perspectiveXY, type Vec3 } from \"./math\";\n\nexport const zNear = constDef_zNear;\n\nexport const zFar = constDef_zFar;\n\nexport const fieldOfViewDegrees = 60;\n\nexport const fieldOfViewRadians = /* @__PURE__ */ fieldOfViewDegrees * DEG_TO_RAD; // in radians\n\nconst fieldOfViewAmount = 1 / Math.tan(fieldOfViewRadians / 2);\n\nexport const camera_position: Vec3 = { x: 0, y: 0, z: 0 };\n\nexport const camera_rotation: Vec3 = { x: 0, y: 0, z: 0 };\n\nexport const mat_perspective = (near: number, far: number) =>\n  mat_perspectiveXY((hC.clientHeight / hC.clientWidth) * fieldOfViewAmount, fieldOfViewAmount, near, far);\n\nif (DEBUG) {\n  console.log(\"fieldOfViewAmount:\", fieldOfViewAmount);\n}\n","import { integers_map, max, min, identity } from \"./math\";\nimport { polygon_transform } from \"./geometry/geometry\";\nimport { mat_perspective } from \"./camera\";\n\nconst LIGHT_ROT_X = 298;\nconst LIGHT_ROT_Y = 139;\n\nif (DEBUG) {\n  const lightMatrix = /* @__PURE__ */ identity.rotate(LIGHT_ROT_X, LIGHT_ROT_Y);\n  console.log(\"light direction: \", lightMatrix.m13, lightMatrix.m23, lightMatrix.m33);\n}\n\nexport const csm_buildMatrix = /* @__PURE__ */ (\n  camera_view: DOMMatrixReadOnly,\n  nearPlane: number,\n  farPlane: number,\n  zMultiplier: number,\n) => {\n  const roundingRadius = (farPlane - nearPlane) * 1.1;\n\n  const projViewInverse = new DOMMatrix(mat_perspective(nearPlane, farPlane)).multiplySelf(camera_view).invertSelf();\n\n  let tx = 0;\n  let ty = 0;\n  let tz = 0;\n\n  const frustumCorners = integers_map(8, (i) => {\n    const v = projViewInverse.transformPoint({\n      x: 4 & i ? 1 : -1,\n      y: 2 & i ? 1 : -1,\n      z: 1 & i ? 1 : -1,\n    });\n    // Round to reduce shimmering\n    tx -= v.x = ((roundingRadius * v.x) | 0) / (roundingRadius * v.w);\n    ty -= v.y = ((roundingRadius * v.y) | 0) / (roundingRadius * v.w);\n    tz -= v.z = ((roundingRadius * v.z) | 0) / (roundingRadius * v.w);\n    return v;\n  });\n\n  const lightViewTranslated = identity.rotate(LIGHT_ROT_X, LIGHT_ROT_Y).translateSelf(tx / 8, ty / 8, tz / 8);\n\n  let left = Infinity;\n  let right = -Infinity;\n  let bottom = Infinity;\n  let top = -Infinity;\n  let near = Infinity;\n  let far = -Infinity;\n\n  // Compute the frustum bouding box\n  polygon_transform(frustumCorners, lightViewTranslated).map(({ x, y, z }) => {\n    left = min(left, x);\n    right = max(right, x);\n    bottom = min(bottom, y);\n    top = max(top, y);\n    near = min(near, z);\n    far = max(far, z);\n  });\n\n  near *= near < 0 ? zMultiplier : 1 / zMultiplier;\n  far *= far > 0 ? zMultiplier : 1 / zMultiplier;\n\n  // Build the ortographic matrix, multiply it with the light space view matrix.\n  return identity\n    .scale(2 / (right - left), 2 / (top - bottom), 2 / (near - far))\n    .translateSelf((right + left) / -2, (top + bottom) / -2, (near + far) / 2)\n    .multiplySelf(lightViewTranslated);\n};\n","export const audioContext = new AudioContext();\n\nexport const songAudioSource = audioContext.createBufferSource();\n","import type { KEY_CODE } from \"./utils/keycodes\";\nimport { camera_rotation } from \"./camera\";\nimport {\n  absoluteTime,\n  keyboard_downKeys,\n  KEY_BACK,\n  KEY_FRONT,\n  KEY_INTERACT,\n  KEY_LEFT,\n  KEY_RIGHT,\n  LOCAL_STORAGE_SAVED_GAME_KEY,\n  mainMenuVisible,\n  setMainMenuVisible,\n  updateCollectedSoulsCounter,\n} from \"./game/world-state\";\nimport { songAudioSource, audioContext } from \"./music/audio-context\";\nimport { abs, clamp01 } from \"./math\";\n\nexport let player_first_person: 0 | 1 | undefined;\n\nexport let touch_movementX = 0;\n\nexport let touch_movementY = 0;\n\nexport const initPage = () => {\n  let touchStartTime: number | undefined;\n\n  let touchPosStartX: number | undefined;\n  let touchPosStartY: number | undefined;\n  let touchPosIdentifier: number | undefined;\n  let touchPosMoved: number | undefined;\n\n  let touchRotX: number | undefined;\n  let touchRotY: number | undefined;\n  let touchRotIdentifier: number | undefined;\n  let touchRotMoved: number | undefined;\n  let touchStartCameraRotX: number | undefined;\n  let touchStartCameraRotY: number | undefined;\n\n  let pageClicked: undefined | 1;\n\n  let music_on = !DEBUG;\n\n  const updateMusicOnState = () => {\n    if (mainMenuVisible || !music_on) {\n      songAudioSource.disconnect();\n    } else {\n      // connect the AudioBufferSourceNode to the  destination so we can hear the sound\n      songAudioSource.connect(audioContext.destination);\n    }\n    b4.innerHTML = \"Music: \" + music_on;\n  };\n\n  const toggleMusic = () => {\n    music_on = !music_on;\n    updateMusicOnState();\n  };\n\n  const mainMenu = (value: boolean = false) => {\n    if (mainMenuVisible !== value) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      setMainMenuVisible(value);\n      try {\n        if (value) {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          document.exitFullscreen().catch(() => {});\n          document.exitPointerLock();\n        } else {\n          songAudioSource.start();\n        }\n      } catch {}\n      player_first_person = 0;\n      document.body.className = value ? \"l m\" : \"l\";\n      updateMusicOnState();\n      updateCollectedSoulsCounter();\n    }\n  };\n\n  const handleResize = () => {\n    hC.width = innerWidth;\n    hC.height = innerHeight;\n    keyboard_downKeys.length = touch_movementX = touch_movementY = 0;\n    touchPosIdentifier = touchRotIdentifier = undefined;\n    if (document.hidden) {\n      mainMenu(true);\n    }\n  };\n\n  if (!DEBUG) {\n    oncontextmenu = () => false;\n  }\n\n  // \"Restart\" button\n  b3.onclick = () => {\n    // eslint-disable-next-line no-alert\n    if (confirm(\"Restart game?\")) {\n      localStorage[LOCAL_STORAGE_SAVED_GAME_KEY] = \"\";\n      location.reload();\n    }\n  };\n\n  // \"Play\" button\n  b1.onclick = () => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    document.body.requestFullscreen();\n    mainMenu();\n  };\n\n  // \"Play first person\" button\n  b2.onclick = () => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    document.body.requestFullscreen();\n    mainMenu();\n    player_first_person = 1;\n  };\n\n  // \"Music\" button\n  b4.onclick = toggleMusic;\n\n  // Menu hamburger button\n  b5.onclick = () => mainMenu(true);\n\n  onclick = (e) => {\n    pageClicked = 1;\n    if (!mainMenuVisible) {\n      if (e.target === hC) {\n        keyboard_downKeys[KEY_INTERACT] = true;\n      }\n      if (player_first_person) {\n        hC.requestPointerLock();\n      }\n    }\n  };\n\n  onkeyup = onkeydown = ({ code, target, type, repeat }) => {\n    if (!repeat) {\n      const pressed = !!type[5] && target === document.body;\n\n      if (pressed && (code === \"Escape\" || (code === \"Enter\" && mainMenuVisible))) {\n        if (!mainMenuVisible || pageClicked) {\n          mainMenu(!mainMenuVisible);\n        }\n      } else {\n        const mapped = (\n          {\n            [\"KeyA\"]: KEY_LEFT,\n            [\"ArrowLeft\"]: KEY_LEFT,\n\n            [\"KeyW\"]: KEY_FRONT,\n            [\"ArrowUp\"]: KEY_FRONT,\n\n            [\"KeyD\"]: KEY_RIGHT,\n            [\"ArrowRight\"]: KEY_RIGHT,\n\n            [\"KeyS\"]: KEY_BACK,\n            [\"ArrowDown\"]: KEY_BACK,\n\n            [\"KeyE\"]: KEY_INTERACT,\n            [\"Space\"]: KEY_INTERACT,\n            [\"Enter\"]: KEY_INTERACT,\n          } as Partial<Record<KEY_CODE, number>>\n        )[code as KEY_CODE]!;\n        if (mapped === KEY_INTERACT) {\n          if (pressed) {\n            keyboard_downKeys[mapped] = 1;\n          }\n        } else {\n          keyboard_downKeys[mapped] = pressed;\n        }\n      }\n    }\n  };\n\n  onmousemove = ({ movementX, movementY }) => {\n    if (player_first_person && (movementX || movementY)) {\n      camera_rotation.y += movementX * 0.1;\n      camera_rotation.x += movementY * 0.1;\n    }\n  };\n\n  hC.ontouchstart = (e) => {\n    if (!mainMenuVisible) {\n      for (const { pageX, pageY, identifier } of e.changedTouches) {\n        if (player_first_person && pageX > hC.clientWidth / 2) {\n          if (touchRotIdentifier === undefined) {\n            touchRotMoved = 0;\n            touchRotX = pageX;\n            touchRotY = pageY;\n            touchRotIdentifier = identifier;\n            touchStartCameraRotX = camera_rotation.y;\n            touchStartCameraRotY = camera_rotation.x;\n          }\n        } else if (touchPosIdentifier === undefined) {\n          touchPosMoved = 0;\n          touchPosStartX = pageX;\n          touchPosStartY = pageY;\n          touchPosIdentifier = identifier;\n        }\n      }\n      touchStartTime = absoluteTime;\n    }\n  };\n\n  const TOUCH_SIZE = 20;\n  const TOUCH_MOVE_THRESHOLD = 0.5;\n  const TOUCH_MOVE_SNAP = 0.2;\n\n  hC.ontouchmove = (e) => {\n    if (!mainMenuVisible) {\n      for (const { pageX, pageY, identifier } of e.changedTouches) {\n        if (touchRotIdentifier === identifier) {\n          camera_rotation.y = touchStartCameraRotX! + (pageX - touchRotX!) / 2.3;\n          camera_rotation.x = touchStartCameraRotY! + (pageY - touchRotY!) / 2.3;\n          touchRotMoved = 1;\n        }\n        if (touchPosIdentifier === identifier) {\n          const deltaX = (touchPosStartX! - pageX) / TOUCH_SIZE;\n          const deltaY = (touchPosStartY! - pageY) / TOUCH_SIZE;\n          const absDeltaX = abs(deltaX);\n          const absDeltaY = abs(deltaY);\n\n          const angle = Math.atan2(deltaY, deltaX);\n          const speed = clamp01(Math.hypot(deltaY, deltaX) - TOUCH_MOVE_THRESHOLD);\n\n          touch_movementX = absDeltaX > TOUCH_MOVE_SNAP ? Math.cos(angle) * speed : 0;\n          touch_movementY = absDeltaY > TOUCH_MOVE_SNAP ? Math.sin(angle) * speed : 0;\n\n          if (touch_movementX || touch_movementY) {\n            // Moved, disable the click\n            touchPosMoved = 1;\n          }\n\n          // Move the invisible joysticks\n          if (absDeltaX > 2) {\n            touchPosStartX = pageX + Math.sign(deltaX) * TOUCH_SIZE;\n          }\n          if (absDeltaY > 2) {\n            touchPosStartY = pageY + Math.sign(deltaY) * TOUCH_SIZE;\n          }\n        }\n      }\n    }\n  };\n\n  hC.ontouchend = (e) => {\n    e.preventDefault();\n\n    let click: 1 | undefined;\n    for (const touch of e.changedTouches) {\n      if (touch.identifier === touchRotIdentifier) {\n        touchRotIdentifier = undefined;\n        if (!touchRotMoved) {\n          click = 1;\n        }\n        touchRotMoved = 0;\n      } else if (touch.identifier === touchPosIdentifier) {\n        touchPosIdentifier = undefined;\n        touch_movementY = touch_movementX = 0;\n        if (!touchPosMoved) {\n          click = 1;\n        }\n        touchPosMoved = 0;\n      } else {\n        click = 1;\n      }\n    }\n\n    if (click && e.target === hC && touchStartTime) {\n      const diff = absoluteTime - touchStartTime;\n      if (diff > 0.02 && diff < 0.7) {\n        keyboard_downKeys[KEY_INTERACT] = true;\n      }\n    }\n  };\n\n  document.onvisibilitychange = onblur = onresize = handleResize;\n\n  handleResize();\n  mainMenu(!DEBUG);\n};\n","export const gl: WebGL2RenderingContext = hC.getContext(\"webgl2\", { powerPreference: \"high-performance\" })!;\n\nfor (const s in gl) {\n  (gl as any)[s[0] + [...s].reduce((p, c, i) => (p * i + c.charCodeAt(0)) % 434, 0).toString(36)] = (gl as any)[s];\n}\n","import {\n  abs,\n  max,\n  clamp01,\n  DEG_TO_RAD,\n  identity,\n  angle_lerp_degrees,\n  lerp,\n  min,\n  angle_wrap_degrees,\n  threshold,\n} from \"./math\";\nimport {\n  levers,\n  player_position_final,\n  allModels,\n  MODEL_KIND_GAME,\n  MODEL_ID_PLAYER_BODY,\n  MODEL_ID_PLAYER_LEG0,\n  MODEL_ID_PLAYER_LEG1,\n} from \"./game/models\";\nimport {\n  player_last_pulled_lever,\n  lerpDamp,\n  gameTimeDelta,\n  keyboard_downKeys,\n  KEY_LEFT,\n  KEY_RIGHT,\n  KEY_FRONT,\n  KEY_BACK,\n  KEY_INTERACT,\n  gameTime,\n} from \"./game/world-state\";\nimport { camera_rotation, camera_position } from \"./camera\";\nimport {\n  GAMEPAD_BUTTON_A,\n  GAMEPAD_BUTTON_X,\n  GAMEPAD_BUTTON_Y,\n  GAMEPAD_BUTTON_B,\n  GAMEPAD_BUTTON_LEFT,\n  GAMEPAD_BUTTON_RIGHT,\n  GAMEPAD_BUTTON_UP,\n  GAMEPAD_BUTTON_DOWN,\n} from \"./utils/keycodes\";\nimport { touch_movementX, touch_movementY, player_first_person } from \"./page\";\nimport { gl } from \"./gl\";\n\nexport let player_update: () => void;\n\nexport const CAMERA_PLAYER_Y_DIST = 13;\n\nexport const CAMERA_PLAYER_Z_DIST = -18;\n\nexport const PLAYER_LEGS_VELOCITY = 7 * 1.3;\n\nexport const COLLISION_TEXTURE_SIZE = 128;\n\nexport const player_init = () => {\n  let gamepadInteractPressed: 0 | 1 | undefined;\n\n  let oldModelId: number | undefined;\n\n  let currentModelIdTMinus1 = 0;\n\n  let currentModelId = 0;\n\n  let player_has_ground: 0 | 1 | undefined;\n  let player_respawned: 0 | 1 | 2 = 2;\n  let player_look_angle_target = 0;\n\n  let player_look_angle = 0;\n\n  let player_legs_speed = 0;\n\n  let player_gravity: number;\n  let player_speed: number;\n  let player_collision_velocity_x: number;\n  let player_collision_velocity_z: number;\n\n  let player_model_y: number;\n\n  let player_collision_x: number;\n  let player_collision_z: number;\n\n  let camera_lookat_x: number;\n  let camera_lookat_y: number;\n  let camera_lookat_z: number;\n\n  const player_position_global = { x: 0, y: 0, z: 0 };\n\n  const player_collision_modelIdCounter = new Int32Array(256);\n  const collision_buffer = new Uint8Array(COLLISION_TEXTURE_SIZE * COLLISION_TEXTURE_SIZE * 4);\n\n  const interpolate_with_hysteresis = /* @__PURE__ */ (previous: number, desired: number, amount: number) =>\n    lerpDamp(previous, desired, min(4, max(0.4, abs(previous - desired) - amount)));\n\n  const player_respawn = () => {\n    player_respawned = 2;\n    player_speed = 0;\n    player_collision_velocity_x = 0;\n    player_collision_velocity_z = 0;\n    player_gravity = 0;\n    currentModelIdTMinus1 = currentModelId = levers[player_last_pulled_lever]!.$parent.$modelId || 1;\n  };\n\n  const doHorizontalCollisions = () => {\n    for (let y = 32; y < COLLISION_TEXTURE_SIZE; y += 2) {\n      let front = 0;\n      let back = 0;\n      let left = 0;\n      let right = 0;\n      const yindex = y * (COLLISION_TEXTURE_SIZE * 4);\n      for (let x = y & 1; x < COLLISION_TEXTURE_SIZE; x += 2) {\n        const i1 = yindex + x * 4;\n        const i2 = yindex + (COLLISION_TEXTURE_SIZE - 1 - x) * 4;\n        const dist1 = collision_buffer[i1]! / 255;\n        const dist2 = collision_buffer[i2 + 1]! / 255;\n        const t = 1 - abs(2 * (x / (COLLISION_TEXTURE_SIZE - 1)) - 1);\n\n        if (x > 10 && x < COLLISION_TEXTURE_SIZE - 10) {\n          front = max(front, max(dist1 * t, (dist1 * collision_buffer[i2]!) / 255));\n          back = max(back, max(dist2 * t, (dist2 * collision_buffer[i1 + 1]!) / 255));\n        }\n\n        if (x < COLLISION_TEXTURE_SIZE / 2 - 10 || x > COLLISION_TEXTURE_SIZE / 2 + 10) {\n          const xdist = ((1 - t) * max(dist1, dist2)) / 3;\n          if (xdist > 0.001) {\n            if (x < COLLISION_TEXTURE_SIZE / 2 && left < xdist) {\n              left = xdist;\n            } else if (x > COLLISION_TEXTURE_SIZE / 2 && right < xdist) {\n              right = xdist;\n            }\n          }\n        }\n      }\n\n      if (abs(right - left) > abs(player_collision_x)) {\n        player_collision_x = right - left;\n      }\n      if (abs(back - front) > abs(player_collision_z)) {\n        player_collision_z = back - front;\n      }\n    }\n  };\n\n  const doVerticalCollisions = () => {\n    let maxModelIdCount = 0;\n    let nextModelId = 0;\n    let lines = 0;\n    let grav = 0;\n    player_collision_modelIdCounter.fill(0);\n    for (let y = 0; y < 31; ++y) {\n      let up = 0;\n      const yindex = y * (COLLISION_TEXTURE_SIZE * 4);\n      for (let x = 0; x < COLLISION_TEXTURE_SIZE - 0; x++) {\n        let i = yindex + x * 4;\n        const a = (collision_buffer[i]! + collision_buffer[i + 1]!) / 255;\n        i = collision_buffer[i + 2]!;\n        if (x > 14 && x < COLLISION_TEXTURE_SIZE - 14) {\n          up += a;\n        }\n        if (i && a) {\n          const count = player_collision_modelIdCounter[i]! + 1;\n          player_collision_modelIdCounter[i] = count;\n          if (count >= maxModelIdCount) {\n            maxModelIdCount = count;\n            nextModelId = i;\n          }\n        }\n      }\n      if (up < 3 && y > 5) {\n        grav += y / 32;\n      }\n      if (up > 3) {\n        if (y > 7) {\n          lines += y / 15;\n        }\n        player_has_ground = 1;\n      }\n    }\n\n    if (nextModelId) {\n      player_has_ground = 1;\n    }\n\n    if (player_respawned) {\n      // keep the previous modelId until the player touch ground\n      if (nextModelId) {\n        player_respawned = 0;\n        currentModelId = nextModelId;\n      }\n    } else {\n      currentModelId = nextModelId || currentModelIdTMinus1;\n    }\n    currentModelIdTMinus1 = nextModelId;\n\n    player_gravity = lerpDamp(player_gravity, player_has_ground ? 6.5 : 8, 4);\n\n    // push up and gravity\n    player_position_global.y +=\n      lines / 41 - (player_has_ground ? 1 : player_gravity) * (grav / 41) * player_gravity * gameTimeDelta;\n  };\n\n  const player_move = () => {\n    const referenceMatrix =\n      (allModels[currentModelId]!.$kind === MODEL_KIND_GAME && allModels[currentModelId]!.$matrix) || identity;\n\n    if (player_respawned) {\n      const { x, y, z } = levers[player_last_pulled_lever]!.$locMatrix!.transformPoint({ x: 0, y: 12, z: -2.5 });\n      if (player_respawned > 1) {\n        player_respawned = 1;\n        player_model_y = player_position_final.y = y;\n      }\n      player_position_final.x = x;\n      player_position_final.z = z;\n    } else {\n      const inverseReferenceRotationMatrix = referenceMatrix.inverse();\n      inverseReferenceRotationMatrix.m41 = 0;\n      inverseReferenceRotationMatrix.m42 = 0;\n      inverseReferenceRotationMatrix.m43 = 0;\n      const { x: tx, z: tz } = inverseReferenceRotationMatrix.transformPoint({\n        x: player_collision_x,\n        z: player_collision_z,\n        w: 0,\n      });\n      player_position_global.x += tx;\n      player_position_global.z += tz;\n    }\n\n    if (currentModelId !== oldModelId) {\n      if (DEBUG) {\n        console.log(\"modelId: \" + oldModelId + \" -> \" + currentModelId);\n      }\n\n      oldModelId = currentModelId;\n\n      const { x, y, z } = referenceMatrix.inverse().transformPoint(player_position_final);\n      player_position_global.x = x;\n      player_position_global.y = y;\n      player_position_global.z = z;\n    }\n\n    const { x, y, z } = referenceMatrix.transformPoint(player_position_global);\n\n    const dx = x - player_position_final.x;\n    const dz = z - player_position_final.z;\n\n    player_position_final.x = x;\n    player_position_final.y = y;\n    player_position_final.z = z;\n\n    if (y < (x < -25 || z < 109 ? -25 : -9)) {\n      // Player fell in lava\n      player_respawn();\n    }\n\n    if (currentModelId) {\n      player_collision_velocity_x = dx / gameTimeDelta;\n      player_collision_velocity_z = dz / gameTimeDelta;\n    }\n\n    player_model_y = lerp(lerpDamp(player_model_y, y, 2), y, abs(player_model_y - y) * 8);\n\n    if (!DEBUG_CAMERA) {\n      if (camera_lookat_x === undefined) {\n        camera_position.x = camera_lookat_x = x;\n        camera_position.y = (camera_lookat_y = player_model_y = y) + CAMERA_PLAYER_Y_DIST;\n        camera_position.z = (camera_lookat_z = z) + CAMERA_PLAYER_Z_DIST * 2;\n      }\n\n      camera_lookat_x = interpolate_with_hysteresis(camera_lookat_x, x, 1.5);\n      camera_lookat_y = interpolate_with_hysteresis(camera_lookat_y, y, 2.2);\n      camera_lookat_z = interpolate_with_hysteresis(camera_lookat_z, z, 1.5);\n\n      if (player_first_person) {\n        camera_position.x = lerpDamp(camera_position.x, x, player_respawned * 666 + 18);\n        camera_position.y = lerpDamp(camera_position.y, player_model_y + 1.5, player_respawned * 666 + 18);\n        camera_position.z = lerpDamp(camera_position.z, z, player_respawned * 666 + 18);\n      } else {\n        camera_position.x = lerpDamp(camera_position.x, camera_lookat_x, 2);\n        camera_position.y = lerpDamp(camera_position.y, max(camera_lookat_y + CAMERA_PLAYER_Y_DIST, 6), 2);\n        camera_position.z = lerpDamp(camera_position.z, camera_lookat_z + CAMERA_PLAYER_Z_DIST, 2);\n\n        const viewDirDiffx = camera_position.x - camera_lookat_x;\n        const viewDirDiffz = camera_position.z - camera_lookat_z;\n        const viewDirDiffAmount = threshold(Math.hypot(viewDirDiffz, viewDirDiffx), 0.1);\n        if (viewDirDiffAmount) {\n          camera_rotation.x = 90 - Math.atan2(viewDirDiffAmount, camera_position.y - camera_lookat_y) / DEG_TO_RAD;\n          camera_rotation.y = 270 + Math.atan2(viewDirDiffz, viewDirDiffx) / DEG_TO_RAD;\n        }\n      }\n\n      camera_rotation.x = max(min(camera_rotation.x, 87), -87);\n      camera_rotation.y = angle_wrap_degrees(camera_rotation.y);\n    }\n\n    // Special handling for the second boat (lever 7) - the boat must be on the side of the map the player is\n    if (currentModelId === 1) {\n      levers[9]!.$value = x < -15 && z < 0 ? 1 : 0;\n    }\n\n    const playerMatrix = (allModels[MODEL_ID_PLAYER_BODY]!.$matrix = identity\n      .translate(x, player_model_y, z)\n      .rotateSelf(\n        0,\n        (player_look_angle = angle_lerp_degrees(player_look_angle, player_look_angle_target, gameTimeDelta * 8)),\n      ));\n\n    [MODEL_ID_PLAYER_LEG0, MODEL_ID_PLAYER_LEG1].map((modelId, i) => {\n      allModels[modelId]!.$matrix = playerMatrix\n        .translate(\n          0,\n          player_legs_speed *\n            clamp01(Math.sin(gameTime * PLAYER_LEGS_VELOCITY + Math.PI * (i - 1) - Math.PI / 2) * 0.45),\n        )\n        .rotateSelf(\n          player_legs_speed * Math.sin(gameTime * PLAYER_LEGS_VELOCITY + Math.PI * (i - 1)) * (0.25 / DEG_TO_RAD),\n          0,\n        );\n    });\n  };\n\n  player_update = () => {\n    let strafe = touch_movementX + (keyboard_downKeys[KEY_LEFT] ? 1 : 0) - (keyboard_downKeys[KEY_RIGHT] ? 1 : 0);\n    let forward = touch_movementY + (keyboard_downKeys[KEY_FRONT] ? 1 : 0) - (keyboard_downKeys[KEY_BACK] ? 1 : 0);\n\n    const gamepad = navigator.getGamepads()[0];\n    if (gamepad) {\n      const { buttons, axes } = gamepad;\n      const getGamepadButtonState = (index: number) =>\n        buttons[index]?.pressed || (buttons[index]?.value as any) > 0 ? 1 : 0;\n\n      const interactButtonPressed =\n        getGamepadButtonState(GAMEPAD_BUTTON_X) ||\n        getGamepadButtonState(GAMEPAD_BUTTON_Y) ||\n        getGamepadButtonState(GAMEPAD_BUTTON_A) ||\n        getGamepadButtonState(GAMEPAD_BUTTON_B);\n\n      strafe +=\n        getGamepadButtonState(GAMEPAD_BUTTON_LEFT) -\n        getGamepadButtonState(GAMEPAD_BUTTON_RIGHT) -\n        threshold(axes[0], 0.2);\n\n      forward +=\n        getGamepadButtonState(GAMEPAD_BUTTON_UP) - getGamepadButtonState(GAMEPAD_BUTTON_DOWN) - threshold(axes[1], 0.2);\n\n      if (player_first_person) {\n        camera_rotation.x += threshold(axes[3], 0.3) * 80 * gameTimeDelta;\n        camera_rotation.y += threshold(axes[2], 0.3) * 80 * gameTimeDelta;\n      }\n\n      if (interactButtonPressed && !gamepadInteractPressed) {\n        keyboard_downKeys[KEY_INTERACT] = 1;\n      }\n      gamepadInteractPressed = interactButtonPressed;\n    }\n\n    const movAngle = Math.atan2(forward, strafe);\n    const movAmount = threshold(clamp01(Math.hypot(forward, strafe)), 0.05);\n\n    strafe = movAmount * Math.cos(movAngle);\n    forward = movAmount * Math.sin(movAngle);\n\n    player_legs_speed = lerpDamp(player_legs_speed, movAmount, 10);\n    if (movAmount) {\n      player_look_angle_target = 90 - movAngle / DEG_TO_RAD;\n    }\n\n    player_collision_x = 0;\n    player_collision_z = 0;\n    player_has_ground = 0;\n\n    // ------- read collision renderBuffer -------\n\n    gl.finish();\n    gl.readPixels(0, 0, COLLISION_TEXTURE_SIZE, COLLISION_TEXTURE_SIZE, gl.RGBA, gl.UNSIGNED_BYTE, collision_buffer);\n    gl.invalidateFramebuffer(gl.READ_FRAMEBUFFER, [gl.COLOR_ATTACHMENT0, gl.DEPTH_ATTACHMENT]);\n    gl.invalidateFramebuffer(gl.DRAW_FRAMEBUFFER, [gl.COLOR_ATTACHMENT0, gl.DEPTH_ATTACHMENT]);\n\n    // ------- process collision renderBuffer -------\n\n    NO_INLINE(doHorizontalCollisions)();\n    NO_INLINE(doVerticalCollisions)();\n\n    const playerSpeedCollision = clamp01(1 - max(abs(player_collision_x), abs(player_collision_z)) * 5);\n\n    if (!currentModelId) {\n      player_collision_x += player_collision_velocity_x * playerSpeedCollision * gameTimeDelta;\n      player_collision_z += player_collision_velocity_z * playerSpeedCollision * gameTimeDelta;\n    }\n    player_collision_velocity_x = lerpDamp(player_collision_velocity_x, 0, player_has_ground ? 8 : 4);\n    player_collision_velocity_z = lerpDamp(player_collision_velocity_z, 0, player_has_ground ? 8 : 4);\n\n    player_speed = lerpDamp(\n      player_speed,\n      player_has_ground ? (movAmount ? (player_has_ground ? 7 : 4) : 0) * playerSpeedCollision : 0,\n      player_has_ground ? (playerSpeedCollision > 0.1 ? 10 : movAmount ? 5 : 7) : 1,\n    );\n\n    const movementRadians = player_first_person ? camera_rotation.y * DEG_TO_RAD : Math.PI;\n    const s = Math.sin(movementRadians) * player_speed * gameTimeDelta;\n    const c = Math.cos(movementRadians) * player_speed * gameTimeDelta;\n    player_collision_x -= strafe * c - forward * s;\n    player_collision_z -= strafe * s + forward * c;\n\n    NO_INLINE(player_move)();\n  };\n\n  player_respawn();\n};\n","export const GAMEPAD_BUTTON_UP = 12;\n\nexport const GAMEPAD_BUTTON_DOWN = 13;\n\nexport const GAMEPAD_BUTTON_LEFT = 14;\n\nexport const GAMEPAD_BUTTON_RIGHT = 15;\n\nexport const GAMEPAD_BUTTON_START = 9;\n\nexport const GAMEPAD_BUTTON_B = 0;\n\nexport const GAMEPAD_BUTTON_A = 1;\n\nexport const GAMEPAD_BUTTON_Y = 2;\n\nexport const GAMEPAD_BUTTON_X = 3;\n\nexport const GAMEPAD_BUTTON_LB = 4;\n\nexport const GAMEPAD_BUTTON_RB = 5;\n\nexport const KEY_CODE_EMPTY = \"\";\n\nexport const KEY_CODE_AGAIN = \"Again\";\n\nexport const KEY_CODE_ALT_LEFT = \"AltLeft\";\n\nexport const KEY_CODE_ALT_RIGHT = \"AltRight\";\n\nexport const KEY_CODE_ARROW_DOWN = \"ArrowDown\";\n\nexport const KEY_CODE_ARROW_LEFT = \"ArrowLeft\";\n\nexport const KEY_CODE_ARROW_RIGHT = \"ArrowRight\";\n\nexport const KEY_CODE_ARROW_UP = \"ArrowUp\";\n\nexport const KEY_CODE_AUDIO_VOLUME_DOWN = \"AudioVolumeDown\";\n\nexport const KEY_CODE_AUDIO_VOLUME_MUTE = \"AudioVolumeMute\";\n\nexport const KEY_CODE_AUDIO_VOLUME_UP = \"AudioVolumeUp\";\n\nexport const KEY_CODE_BACKQUOTE = \"Backquote\";\n\nexport const KEY_CODE_BACKSLASH = \"Backslash\";\n\nexport const KEY_CODE_BACKSPACE = \"Backspace\";\n\nexport const KEY_CODE_BRACKET_LEFT = \"BracketLeft\";\n\nexport const KEY_CODE_BRACKET_RIGHT = \"BracketRight\";\n\nexport const KEY_CODE_BROWSER_BACK = \"BrowserBack\";\n\nexport const KEY_CODE_BROWSER_FAVORITES = \"BrowserFavorites\";\n\nexport const KEY_CODE_BROWSER_FORWARD = \"BrowserForward\";\n\nexport const KEY_CODE_BROWSER_HOME = \"BrowserHome\";\n\nexport const KEY_CODE_BROWSER_REFRESH = \"BrowserRefresh\";\n\nexport const KEY_CODE_BROWSER_SEARCH = \"BrowserSearch\";\n\nexport const KEY_CODE_BROWSER_STOP = \"BrowserStop\";\n\nexport const KEY_CODE_CANCEL = \"Cancel\";\n\nexport const KEY_CODE_CAPS_LOCK = \"CapsLock\";\n\nexport const KEY_CODE_COMMA = \"Comma\";\n\nexport const KEY_CODE_CONTEXT_MENU = \"ContextMenu\";\n\nexport const KEY_CODE_CONTROL_LEFT = \"ControlLeft\";\n\nexport const KEY_CODE_CONTROL_RIGHT = \"ControlRight\";\n\nexport const KEY_CODE_CONVERT = \"Convert\";\n\nexport const KEY_CODE_COPY = \"Copy\";\n\nexport const KEY_CODE_CUT = \"Cut\";\n\nexport const KEY_CODE_DELETE = \"Delete\";\n\nexport const KEY_CODE_DIGIT_0 = \"Digit0\";\n\nexport const KEY_CODE_DIGIT_1 = \"Digit1\";\n\nexport const KEY_CODE_DIGIT_2 = \"Digit2\";\n\nexport const KEY_CODE_DIGIT_3 = \"Digit3\";\n\nexport const KEY_CODE_DIGIT_4 = \"Digit4\";\n\nexport const KEY_CODE_DIGIT_5 = \"Digit5\";\n\nexport const KEY_CODE_DIGIT_6 = \"Digit6\";\n\nexport const KEY_CODE_DIGIT_7 = \"Digit7\";\n\nexport const KEY_CODE_DIGIT_8 = \"Digit8\";\n\nexport const KEY_CODE_DIGIT_9 = \"Digit9\";\n\nexport const KEY_CODE_EJECT = \"Eject\";\n\nexport const KEY_CODE_END = \"End\";\n\nexport const KEY_CODE_ENTER = \"Enter\";\n\nexport const KEY_CODE_EQUAL = \"Equal\";\n\nexport const KEY_CODE_ESCAPE = \"Escape\";\n\nexport const KEY_CODE_F1 = \"F1\";\n\nexport const KEY_CODE_F2 = \"F2\";\n\nexport const KEY_CODE_F3 = \"F3\";\n\nexport const KEY_CODE_F4 = \"F4\";\n\nexport const KEY_CODE_F5 = \"F5\";\n\nexport const KEY_CODE_F6 = \"F6\";\n\nexport const KEY_CODE_F7 = \"F7\";\n\nexport const KEY_CODE_F8 = \"F8\";\n\nexport const KEY_CODE_F9 = \"F9\";\n\nexport const KEY_CODE_F10 = \"F10\";\n\nexport const KEY_CODE_F11 = \"F11\";\n\nexport const KEY_CODE_F12 = \"F12\";\n\nexport const KEY_CODE_F13 = \"F13\";\n\nexport const KEY_CODE_F14 = \"F14\";\n\nexport const KEY_CODE_F15 = \"F15\";\n\nexport const KEY_CODE_F16 = \"F16\";\n\nexport const KEY_CODE_F17 = \"F17\";\n\nexport const KEY_CODE_F18 = \"F18\";\n\nexport const KEY_CODE_F19 = \"F19\";\n\nexport const KEY_CODE_F20 = \"F20\";\n\nexport const KEY_CODE_F21 = \"F21\";\n\nexport const KEY_CODE_F22 = \"F22\";\n\nexport const KEY_CODE_F23 = \"F23\";\n\nexport const KEY_CODE_F24 = \"F24\";\n\nexport const KEY_CODE_FIND = \"Find\";\n\nexport const KEY_CODE_FN = \"Fn\";\n\nexport const KEY_CODE_HANGUL_MODE = \"HangulMode\";\n\nexport const KEY_CODE_HANJA = \"Hanja\";\n\nexport const KEY_CODE_HELP = \"Help\";\n\nexport const KEY_CODE_HOME = \"Home\";\n\nexport const KEY_CODE_INSERT = \"Insert\";\n\nexport const KEY_CODE_INTL_BACKSLASH = \"IntlBackslash\";\n\nexport const KEY_CODE_INTL_RO = \"IntlRo\";\n\nexport const KEY_CODE_INTL_YEN = \"IntlYen\";\n\nexport const KEY_CODE_KANA_MODE = \"KanaMode\";\n\nexport const KEY_CODE_KEY_A = \"KeyA\";\n\nexport const KEY_CODE_KEY_B = \"KeyB\";\n\nexport const KEY_CODE_KEY_C = \"KeyC\";\n\nexport const KEY_CODE_KEY_D = \"KeyD\";\n\nexport const KEY_CODE_KEY_E = \"KeyE\";\n\nexport const KEY_CODE_KEY_F = \"KeyF\";\n\nexport const KEY_CODE_KEY_G = \"KeyG\";\n\nexport const KEY_CODE_KEY_H = \"KeyH\";\n\nexport const KEY_CODE_KEY_I = \"KeyI\";\n\nexport const KEY_CODE_KEY_J = \"KeyJ\";\n\nexport const KEY_CODE_KEY_K = \"KeyK\";\n\nexport const KEY_CODE_KEY_L = \"KeyL\";\n\nexport const KEY_CODE_KEY_M = \"KeyM\";\n\nexport const KEY_CODE_KEY_N = \"KeyN\";\n\nexport const KEY_CODE_KEY_O = \"KeyO\";\n\nexport const KEY_CODE_KEY_P = \"KeyP\";\n\nexport const KEY_CODE_KEY_Q = \"KeyQ\";\n\nexport const KEY_CODE_KEY_R = \"KeyR\";\n\nexport const KEY_CODE_KEY_S = \"KeyS\";\n\nexport const KEY_CODE_KEY_T = \"KeyT\";\n\nexport const KEY_CODE_KEY_U = \"KeyU\";\n\nexport const KEY_CODE_KEY_V = \"KeyV\";\n\nexport const KEY_CODE_KEY_W = \"KeyW\";\n\nexport const KEY_CODE_KEY_X = \"KeyX\";\n\nexport const KEY_CODE_KEY_Y = \"KeyY\";\n\nexport const KEY_CODE_KEY_Z = \"KeyZ\";\n\nexport const KEY_CODE_LANG_1 = \"Lang1\";\n\nexport const KEY_CODE_LANG_2 = \"Lang2\";\n\nexport const KEY_CODE_LAUNCH_APP_1 = \"LaunchApp1\";\n\nexport const KEY_CODE_LAUNCH_APP_2 = \"LaunchApp2\";\n\nexport const KEY_CODE_LAUNCH_MAIL = \"LaunchMail\";\n\nexport const KEY_CODE_LAUNCH_MEDIA_PLAYER = \"LaunchMediaPlayer\";\n\nexport const KEY_CODE_MEDIA_PLAY_PAUSE = \"MediaPlayPause\";\n\nexport const KEY_CODE_MEDIA_SELECT = \"MediaSelect\";\n\nexport const KEY_CODE_MEDIA_STOP = \"MediaStop\";\n\nexport const KEY_CODE_MEDIA_TRACK_NEXT = \"MediaTrackNext\";\n\nexport const KEY_CODE_MEDIA_TRACK_PREVIOUS = \"MediaTrackPrevious\";\n\nexport const KEY_CODE_META_LEFT = \"MetaLeft\";\n\nexport const KEY_CODE_META_RIGHT = \"MetaRight\";\n\nexport const KEY_CODE_MINUS = \"Minus\";\n\nexport const KEY_CODE_NON_CONVERT = \"NonConvert\";\n\nexport const KEY_CODE_NUM_LOCK = \"NumLock\";\n\nexport const KEY_CODE_NUMPAD_0 = \"Numpad0\";\n\nexport const KEY_CODE_NUMPAD_1 = \"Numpad1\";\n\nexport const KEY_CODE_NUMPAD_2 = \"Numpad2\";\n\nexport const KEY_CODE_NUMPAD_3 = \"Numpad3\";\n\nexport const KEY_CODE_NUMPAD_4 = \"Numpad4\";\n\nexport const KEY_CODE_NUMPAD_5 = \"Numpad5\";\n\nexport const KEY_CODE_NUMPAD_6 = \"Numpad6\";\n\nexport const KEY_CODE_NUMPAD_7 = \"Numpad7\";\n\nexport const KEY_CODE_NUMPAD_8 = \"Numpad8\";\n\nexport const KEY_CODE_NUMPAD_9 = \"Numpad9\";\n\nexport const KEY_CODE_NUMPAD_ADD = \"NumpadAdd\";\n\nexport const KEY_CODE_NUMPAD_CHANGE_SIGN = \"NumpadChangeSign\";\n\nexport const KEY_CODE_NUMPAD_COMMA = \"NumpadComma\";\n\nexport const KEY_CODE_NUMPAD_DECIMAL = \"NumpadDecimal\";\n\nexport const KEY_CODE_NUMPAD_DIVIDE = \"NumpadDivide\";\n\nexport const KEY_CODE_NUMPAD_ENTER = \"NumpadEnter\";\n\nexport const KEY_CODE_NUMPAD_EQUAL = \"NumpadEqual\";\n\nexport const KEY_CODE_NUMPAD_MULTIPLY = \"NumpadMultiply\";\n\nexport const KEY_CODE_NUMPAD_PAREN_LEFT = \"NumpadParenLeft\";\n\nexport const KEY_CODE_NUMPAD_PAREN_RIGHT = \"NumpadParenRight\";\n\nexport const KEY_CODE_NUMPAD_SUBTRACT = \"NumpadSubtract\";\n\nexport const KEY_CODE_OPEN = \"Open\";\n\nexport const KEY_CODE_OSLEFT = \"OSLeft\";\n\nexport const KEY_CODE_OSRIGHT = \"OSRight\";\n\nexport const KEY_CODE_PAGE_DOWN = \"PageDown\";\n\nexport const KEY_CODE_PAGE_UP = \"PageUp\";\n\nexport const KEY_CODE_PASTE = \"Paste\";\n\nexport const KEY_CODE_PAUSE = \"Pause\";\n\nexport const KEY_CODE_PERIOD = \"Period\";\n\nexport const KEY_CODE_POWER = \"Power\";\n\nexport const KEY_CODE_PRINT_SCREEN = \"PrintScreen\";\n\nexport const KEY_CODE_PROPS = \"Props\";\n\nexport const KEY_CODE_QUOTE = \"Quote\";\n\nexport const KEY_CODE_SCROLL_LOCK = \"ScrollLock\";\n\nexport const KEY_CODE_SELECT = \"Select\";\n\nexport const KEY_CODE_SEMICOLON = \"Semicolon\";\n\nexport const KEY_CODE_SHIFT_LEFT = \"ShiftLeft\";\n\nexport const KEY_CODE_SHIFT_RIGHT = \"ShiftRight\";\n\nexport const KEY_CODE_SLASH = \"Slash\";\n\nexport const KEY_CODE_SLEEP = \"Sleep\";\n\nexport const KEY_CODE_SPACE = \"Space\";\n\nexport const KEY_CODE_TAB = \"Tab\";\n\nexport const KEY_CODE_UNDO = \"Undo\";\n\nexport const KEY_CODE_UNIDENTIFIED = \"Unidentified\";\n\nexport const KEY_CODE_VOLUME_DOWN = \"VolumeDown\";\n\nexport const KEY_CODE_VOLUME_MUTE = \"VolumeMute\";\n\nexport const KEY_CODE_VOLUME_UP = \"VolumeUp\";\n\nexport const KEY_CODE_WAKE_UP = \"WakeUp\";\n\nexport type KEY_CODE =\n  | \"\"\n  | \"Again\"\n  | \"AltLeft\"\n  | \"AltRight\"\n  | \"ArrowDown\"\n  | \"ArrowLeft\"\n  | \"ArrowRight\"\n  | \"ArrowUp\"\n  | \"AudioVolumeDown\"\n  | \"AudioVolumeMute\"\n  | \"AudioVolumeUp\"\n  | \"Backquote\"\n  | \"Backslash\"\n  | \"Backspace\"\n  | \"BracketLeft\"\n  | \"BracketRight\"\n  | \"BrowserBack\"\n  | \"BrowserFavorites\"\n  | \"BrowserForward\"\n  | \"BrowserHome\"\n  | \"BrowserRefresh\"\n  | \"BrowserSearch\"\n  | \"BrowserStop\"\n  | \"Cancel\"\n  | \"CapsLock\"\n  | \"Comma\"\n  | \"ContextMenu\"\n  | \"ControlLeft\"\n  | \"ControlRight\"\n  | \"Convert\"\n  | \"Copy\"\n  | \"Cut\"\n  | \"Delete\"\n  | \"Digit0\"\n  | \"Digit1\"\n  | \"Digit2\"\n  | \"Digit3\"\n  | \"Digit4\"\n  | \"Digit5\"\n  | \"Digit6\"\n  | \"Digit7\"\n  | \"Digit8\"\n  | \"Digit9\"\n  | \"Eject\"\n  | \"End\"\n  | \"Enter\"\n  | \"Equal\"\n  | \"Escape\"\n  | \"F1\"\n  | \"F2\"\n  | \"F3\"\n  | \"F4\"\n  | \"F5\"\n  | \"F6\"\n  | \"F7\"\n  | \"F8\"\n  | \"F9\"\n  | \"F10\"\n  | \"F11\"\n  | \"F12\"\n  | \"F13\"\n  | \"F14\"\n  | \"F15\"\n  | \"F16\"\n  | \"F17\"\n  | \"F18\"\n  | \"F19\"\n  | \"F20\"\n  | \"F21\"\n  | \"F22\"\n  | \"F23\"\n  | \"F24\"\n  | \"Find\"\n  | \"Fn\"\n  | \"HangulMode\"\n  | \"Hanja\"\n  | \"Help\"\n  | \"Home\"\n  | \"Insert\"\n  | \"IntlBackslash\"\n  | \"IntlRo\"\n  | \"IntlYen\"\n  | \"KanaMode\"\n  | \"KeyA\"\n  | \"KeyB\"\n  | \"KeyC\"\n  | \"KeyD\"\n  | \"KeyE\"\n  | \"KeyF\"\n  | \"KeyG\"\n  | \"KeyH\"\n  | \"KeyI\"\n  | \"KeyJ\"\n  | \"KeyK\"\n  | \"KeyL\"\n  | \"KeyM\"\n  | \"KeyN\"\n  | \"KeyO\"\n  | \"KeyP\"\n  | \"KeyQ\"\n  | \"KeyR\"\n  | \"KeyS\"\n  | \"KeyT\"\n  | \"KeyU\"\n  | \"KeyV\"\n  | \"KeyW\"\n  | \"KeyX\"\n  | \"KeyY\"\n  | \"KeyZ\"\n  | \"Lang1\"\n  | \"Lang2\"\n  | \"LaunchApp1\"\n  | \"LaunchApp2\"\n  | \"LaunchMail\"\n  | \"LaunchMediaPlayer\"\n  | \"MediaPlayPause\"\n  | \"MediaSelect\"\n  | \"MediaStop\"\n  | \"MediaTrackNext\"\n  | \"MediaTrackPrevious\"\n  | \"MetaLeft\"\n  | \"MetaRight\"\n  | \"Minus\"\n  | \"NonConvert\"\n  | \"NumLock\"\n  | \"Numpad0\"\n  | \"Numpad1\"\n  | \"Numpad2\"\n  | \"Numpad3\"\n  | \"Numpad4\"\n  | \"Numpad5\"\n  | \"Numpad6\"\n  | \"Numpad7\"\n  | \"Numpad8\"\n  | \"Numpad9\"\n  | \"NumpadAdd\"\n  | \"NumpadChangeSign\"\n  | \"NumpadComma\"\n  | \"NumpadDecimal\"\n  | \"NumpadDivide\"\n  | \"NumpadEnter\"\n  | \"NumpadEqual\"\n  | \"NumpadMultiply\"\n  | \"NumpadParenLeft\"\n  | \"NumpadParenRight\"\n  | \"NumpadSubtract\"\n  | \"Open\"\n  | \"OSLeft\"\n  | \"OSRight\"\n  | \"PageDown\"\n  | \"PageUp\"\n  | \"Paste\"\n  | \"Pause\"\n  | \"Period\"\n  | \"Power\"\n  | \"PrintScreen\"\n  | \"Props\"\n  | \"Quote\"\n  | \"ScrollLock\"\n  | \"Select\"\n  | \"Semicolon\"\n  | \"ShiftLeft\"\n  | \"ShiftRight\"\n  | \"Slash\"\n  | \"Sleep\"\n  | \"Space\"\n  | \"Tab\"\n  | \"Undo\"\n  | \"Unidentified\"\n  | \"VolumeDown\"\n  | \"VolumeMute\"\n  | \"VolumeUp\"\n  | \"WakeUp\";\n","import { gl } from \"./gl\";\n\nexport interface WebglProgramAbstraction {\n  (name: string): WebGLUniformLocation;\n  (): void;\n}\n\nexport const loadShader = (source: string, type: number = gl.VERTEX_SHADER): WebGLShader => {\n  const shader = gl.createShader(type)!;\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n\n  if (DEBUG && !gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    throw new Error(\"An error occurred compiling the shaders: \" + gl.getShaderInfoLog(shader));\n  }\n\n  return shader;\n};\n\nexport const initShaderProgram = (vertexShader: WebGLShader, sfsSource: string): WebglProgramAbstraction => {\n  const uniforms: Record<string, WebGLUniformLocation> = {};\n  const program = gl.createProgram()!;\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, loadShader(sfsSource, gl.FRAGMENT_SHADER));\n  gl.linkProgram(program);\n\n  if (DEBUG && !gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    throw new Error(\"Unable to initialize the shader program: \" + gl.getProgramInfoLog(program));\n  }\n\n  return (name?: string): any =>\n    name ? uniforms[name] || (uniforms[name] = gl.getUniformLocation(program, name)!) : gl.useProgram(program);\n};\n","import { identity, matrixToArray } from \"../math\";\nimport { absoluteTime, mainMenuVisible } from \"./world-state\";\nimport type { MODEL_ID_SOUL } from \"./models\";\nimport {\n  allModels,\n  levers,\n  MODEL_ID_LEVER,\n  MODEL_ID_PLAYER_BODY,\n  MODEL_ID_PLAYER_LEG0,\n  MODEL_ID_PLAYER_LEG1,\n  souls,\n  SOULS_COUNT,\n  type MODEL_ID_SOUL_COLLISION,\n} from \"./models\";\nimport { gl } from \"../gl\";\n\nconst worldMatricesBuffer = new Float32Array(39 * 16);\n\nexport const renderModels = (\n  worldMatrixLoc: WebGLUniformLocation,\n  renderPlayer: 0 | 1 | boolean,\n  soulModelId: typeof MODEL_ID_SOUL | typeof MODEL_ID_SOUL_COLLISION,\n  isShadowRender: 0 | 1,\n) => {\n  if (mainMenuVisible) {\n    const matrix = identity.rotate(0, Math.sin(absoluteTime) * 40 - 70);\n    for (const modelId of [MODEL_ID_PLAYER_BODY, MODEL_ID_PLAYER_LEG0, MODEL_ID_PLAYER_LEG1]) {\n      matrixToArray(matrix, worldMatricesBuffer, modelId - 1);\n    }\n\n    gl.uniformMatrix4fv(worldMatrixLoc, false, worldMatricesBuffer);\n    gl.drawElements(\n      gl.TRIANGLES,\n      allModels[MODEL_ID_PLAYER_LEG1]!.$vertexEnd! - allModels[MODEL_ID_PLAYER_BODY]!.$vertexBegin!,\n      gl.UNSIGNED_SHORT,\n      allModels[MODEL_ID_PLAYER_BODY]!.$vertexBegin! * 2,\n    );\n    return;\n  }\n\n  // Setup world matrices\n\n  for (let i = 0; i < allModels.length; ++i) {\n    if (allModels[i]!.$kind) {\n      matrixToArray(allModels[i]!.$matrix, worldMatricesBuffer, i - 1);\n    }\n  }\n  gl.uniformMatrix4fv(worldMatrixLoc, false, worldMatricesBuffer);\n\n  // Render world\n\n  gl.drawElements(\n    gl.TRIANGLES,\n    (renderPlayer ? allModels[MODEL_ID_PLAYER_LEG1]!.$vertexEnd! : allModels[MODEL_ID_PLAYER_BODY]!.$vertexBegin!) - 3,\n    gl.UNSIGNED_SHORT,\n    3 * 2,\n  );\n\n  // Setup souls and levers matrices\n\n  for (let i = 0; i < SOULS_COUNT; ++i) {\n    matrixToArray(souls[i]!.$matrix!, worldMatricesBuffer, i);\n  }\n\n  for (let i = 0; i < levers.length; ++i) {\n    matrixToArray(levers[i]!.$matrix!, worldMatricesBuffer, i + SOULS_COUNT);\n    // Encode lerp value in matrix m44 so fragmemt shader can change the lever handle color\n    if (!isShadowRender) {\n      worldMatricesBuffer[(i + SOULS_COUNT) * 16 + 15] = 1 - levers[i]!.$lerpValue;\n    }\n  }\n\n  gl.uniformMatrix4fv(worldMatrixLoc, false, worldMatricesBuffer);\n\n  // Render souls\n\n  gl.drawElementsInstanced(\n    gl.TRIANGLES,\n    allModels[soulModelId]!.$vertexEnd! - allModels[soulModelId]!.$vertexBegin!,\n    gl.UNSIGNED_SHORT,\n    allModels[soulModelId]!.$vertexBegin! * 2,\n    13,\n  );\n\n  // Render levers\n\n  gl.drawElementsInstanced(\n    gl.TRIANGLES,\n    allModels[MODEL_ID_LEVER]!.$vertexEnd! - allModels[MODEL_ID_LEVER]!.$vertexBegin!,\n    gl.UNSIGNED_SHORT,\n    allModels[MODEL_ID_LEVER]!.$vertexBegin! * 2,\n    levers.length,\n  );\n};\n","// shaders\nimport csm_vsSource from \"./shaders/csm-vertex.vert\";\nimport main_vsSource, {\n  uniformName_projectionMatrix,\n  uniformName_viewMatrix,\n  uniformName_worldMatrices,\n} from \"./shaders/main-vertex.vert\";\nimport main_fsSource, {\n  uniformName_viewPos,\n  uniformName_csm_matrix0,\n  uniformName_csm_matrix1,\n  uniformName_csm_texture0,\n  uniformName_csm_texture1,\n  uniformName_groundTexture,\n  constDef_CSM_TEXTURE_SIZE as CSM_TEXTURE_SIZE,\n  constDef_CSM_PLANE_DISTANCE as CSM_PLANE_DISTANCE,\n} from \"./shaders/main-fragment.frag\";\nimport collider_fsSource from \"./shaders/collider-fragment.frag\";\nimport void_fsSource from \"./shaders/void-fragment.frag\";\nimport sky_vsSource from \"./shaders/sky-vertex.vert\";\nimport sky_fsSource, { uniformName_iResolution } from \"./shaders/sky-fragment.frag\";\n\nimport { clamp01, integers_map, identity, mat_perspectiveXY, matrixToArray } from \"./math\";\nimport {\n  absoluteTime,\n  gameTimeDelta,\n  gameTimeUpdate,\n  keyboard_downKeys,\n  KEY_INTERACT,\n  loadGame,\n  mainMenuVisible,\n  worldStateUpdate,\n} from \"./game/world-state\";\nimport { MODEL_ID_SOUL, MODEL_ID_SOUL_COLLISION, player_position_final } from \"./game/models\";\nimport { mat_perspective, zFar, zNear, camera_position, camera_rotation } from \"./camera\";\nimport { csm_buildMatrix } from \"./csm\";\nimport { player_first_person } from \"./page\";\nimport { gl } from \"./gl\";\nimport { player_update, COLLISION_TEXTURE_SIZE, player_init } from \"./player\";\nimport { loadShader, initShaderProgram } from \"./shaders-utils\";\nimport { renderModels } from \"./game/models-render\";\n\nexport const startMainLoop = (groundTextureImage: HTMLImageElement) => {\n  const csm_framebuffer = gl.createFramebuffer();\n  const collision_frameBuffer = gl.createFramebuffer()!;\n  const collision_renderBuffer = gl.createRenderbuffer();\n  const collision_texture = gl.createTexture()!;\n\n  const mainVertexShader = loadShader(main_vsSource);\n  const csmShader = initShaderProgram(loadShader(csm_vsSource), void_fsSource);\n  const skyShader = initShaderProgram(loadShader(sky_vsSource), sky_fsSource);\n  const collisionShader = initShaderProgram(mainVertexShader, collider_fsSource);\n  const mainShader = initShaderProgram(mainVertexShader, main_fsSource);\n\n  collisionShader();\n  gl.uniformMatrix4fv(collisionShader(uniformName_projectionMatrix), false, mat_perspectiveXY(1.4, 0.59, 0.0001, 1));\n\n  skyShader();\n  gl.uniform1i(skyShader(uniformName_groundTexture), 3); // TEXTURE3\n\n  mainShader();\n  gl.uniform1i(mainShader(uniformName_groundTexture), 3); // TEXTURE3\n\n  const csm_render = integers_map(2, (csmSplit: number) => {\n    const texture = gl.createTexture()!;\n    const lightSpaceMatrixLoc = mainShader(csmSplit ? uniformName_csm_matrix1 : uniformName_csm_matrix0);\n    gl.uniform1i(mainShader(csmSplit ? uniformName_csm_texture1 : uniformName_csm_texture0), csmSplit);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, csm_framebuffer);\n\n    // Disable rendering to the csm color buffer, we just need the depth buffer\n    gl.drawBuffers([gl.NONE]);\n    gl.readBuffer(gl.NONE);\n\n    gl.activeTexture(gl.TEXTURE0 + csmSplit);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.DEPTH_COMPONENT24,\n      CSM_TEXTURE_SIZE,\n      CSM_TEXTURE_SIZE,\n      0,\n      gl.DEPTH_COMPONENT,\n      gl.UNSIGNED_INT,\n      null,\n    );\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, gl.LEQUAL); // Can be LESS or LEQUAL\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\n    const lightSpaceMatrix: Float32Array = new Float32Array(16);\n    return (matrix?: DOMMatrix) => {\n      if (matrix) {\n        matrixToArray(matrix, lightSpaceMatrix);\n        gl.uniformMatrix4fv(csmShader(uniformName_viewMatrix), false, lightSpaceMatrix);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, texture, 0);\n        gl.clear(gl.DEPTH_BUFFER_BIT);\n        renderModels(csmShader(uniformName_worldMatrices), !player_first_person, MODEL_ID_SOUL, 1);\n      } else {\n        gl.uniformMatrix4fv(lightSpaceMatrixLoc, false, lightSpaceMatrix);\n      }\n    };\n  });\n\n  gl.enable(gl.DEPTH_TEST); // Enable depth testing\n  gl.enable(gl.CULL_FACE); // Don't render triangle backs\n\n  gl.clearDepth(1); // Clear everything. Default value is 1\n  gl.cullFace(gl.BACK); // Default value is already BACK\n  gl.depthFunc(gl.LEQUAL); // LEQUAL to make sky works\n  gl.clearColor(0, 0, 0, 1);\n\n  // Collision framebuffer\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, collision_frameBuffer);\n  gl.bindRenderbuffer(gl.RENDERBUFFER, collision_renderBuffer);\n\n  gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, COLLISION_TEXTURE_SIZE, COLLISION_TEXTURE_SIZE);\n  gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, collision_renderBuffer);\n\n  gl.activeTexture(gl.TEXTURE3);\n  gl.bindTexture(gl.TEXTURE_2D, collision_texture);\n  gl.texImage2D(\n    gl.TEXTURE_2D,\n    0,\n    gl.RGB,\n    COLLISION_TEXTURE_SIZE,\n    COLLISION_TEXTURE_SIZE,\n    0,\n    gl.RGB,\n    gl.UNSIGNED_BYTE,\n    null,\n  );\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, collision_texture, 0);\n\n  // Ground texture\n\n  gl.activeTexture(gl.TEXTURE3);\n  gl.bindTexture(gl.TEXTURE_2D, gl.createTexture());\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1024, 1024, 0, gl.RGBA, gl.UNSIGNED_BYTE, groundTextureImage);\n  gl.generateMipmap(gl.TEXTURE_2D);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n  const mainLoop = (globalTime: number) => {\n    gl.flush();\n\n    requestAnimationFrame(mainLoop);\n\n    gameTimeUpdate(globalTime);\n\n    if (gameTimeDelta > 0) {\n      // read collision shader output\n\n      worldStateUpdate();\n\n      player_update();\n\n      keyboard_downKeys[KEY_INTERACT] = 0;\n    }\n\n    const camera_view = mainMenuVisible\n      ? identity\n          .rotate(-20, -90)\n          .invertSelf()\n          .translateSelf(4.5, -2, -3.2 + clamp01(hC.clientWidth / 1000))\n      : identity\n          .rotate(-camera_rotation.x, -camera_rotation.y, -camera_rotation.z)\n          .invertSelf()\n          .translateSelf(-camera_position.x, -camera_position.y, -camera_position.z);\n\n    if (gameTimeDelta > 0) {\n      const { x, y, z } = player_position_final;\n      // *** COLLISION RENDERER ***\n\n      collisionShader();\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, collision_frameBuffer);\n      gl.viewport(0, 0, COLLISION_TEXTURE_SIZE, COLLISION_TEXTURE_SIZE);\n\n      // first collision render\n\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n      gl.colorMask(true, false, true, false);\n      gl.uniformMatrix4fv(\n        collisionShader(uniformName_viewMatrix),\n        false,\n        matrixToArray(\n          identity\n            .rotate(0, 180)\n            .invertSelf()\n            .translateSelf(-x, -y, 0.3 - z),\n        ),\n      );\n      renderModels(collisionShader(uniformName_worldMatrices), 0, MODEL_ID_SOUL_COLLISION, 0);\n\n      // second collision render\n\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n      gl.colorMask(false, true, true, false);\n      gl.uniformMatrix4fv(\n        collisionShader(uniformName_viewMatrix),\n        false,\n        matrixToArray(identity.translate(-x, -y, -z - 0.3)),\n      );\n      renderModels(collisionShader(uniformName_worldMatrices), 0, MODEL_ID_SOUL_COLLISION, 0);\n\n      // Flushing collision render\n      gl.flush();\n    }\n\n    // *** CASCADED SHADOWMAPS ***\n\n    csmShader();\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, csm_framebuffer);\n    gl.viewport(0, 0, CSM_TEXTURE_SIZE, CSM_TEXTURE_SIZE);\n\n    csm_render[0]!(csm_buildMatrix(camera_view, zNear, CSM_PLANE_DISTANCE, 10));\n    csm_render[1]!(csm_buildMatrix(camera_view, CSM_PLANE_DISTANCE, zFar, 11));\n\n    // *** MAIN RENDER ***\n\n    mainShader();\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n    gl.colorMask(true, true, true, true);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    csm_render[0]!();\n    csm_render[1]!();\n\n    gl.uniformMatrix4fv(mainShader(uniformName_projectionMatrix), false, mat_perspective(zNear, zFar));\n    gl.uniformMatrix4fv(mainShader(uniformName_viewMatrix), false, matrixToArray(camera_view));\n    gl.uniform3f(mainShader(uniformName_viewPos), camera_position.x, camera_position.y, camera_position.z);\n\n    renderModels(mainShader(uniformName_worldMatrices), !player_first_person, MODEL_ID_SOUL, 0);\n\n    // *** SKY RENDER ***\n\n    skyShader();\n\n    gl.uniform3f(skyShader(uniformName_iResolution), gl.drawingBufferWidth, gl.drawingBufferHeight, absoluteTime);\n    if (mainMenuVisible) {\n      gl.uniform3f(skyShader(uniformName_viewPos), 0, 0, 0);\n    } else {\n      gl.uniform3f(skyShader(uniformName_viewPos), camera_position.x, camera_position.y, camera_position.z);\n    }\n    gl.uniformMatrix4fv(skyShader(uniformName_viewMatrix), false, matrixToArray(camera_view.inverse()));\n\n    gl.drawElements(gl.TRIANGLES, 3, gl.UNSIGNED_SHORT, 0);\n\n    // Prepare for collision reading on next frame.\n    // Flushing here increase the chance of the GPU finishing the rendering before we read the texture.\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, collision_frameBuffer);\n    gl.flush();\n  };\n\n  loadGame();\n\n  worldStateUpdate();\n\n  NO_INLINE(player_init)();\n\n  // gl.bindFramebuffer(gl.FRAMEBUFFER, collision_frameBuffer);\n  requestAnimationFrame(mainLoop);\n};\n","#version 300 es\n\nlayout(location = 0) in vec4 aPosition;\nlayout(location = 1) in vec3 aNormal;\nlayout(location = 2) in vec4 aColor;\n\nout vec4 VNormal;\nout vec4 FragPos;\nout vec4 UntransformedFragPos;\nout lowp vec4 Color;\n\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 worldMatrices[39];\n\n#define modelId aPosition.w\n\nvoid main() {\n  mat4 worldMatrix = worldMatrices[max(0, abs(int(modelId)) - 1) + gl_InstanceID];\n  // trick - use worldMatrix[3][3] that normally is 1 as a way to color the handle of pulled levers\n  Color = mix(aColor, vec4(0.7, 1, 0.2, 0), aColor.w > 0. ? 0. : 1. - worldMatrix[3][3]);\n  worldMatrix[3][3] = 1.;\n  UntransformedFragPos = aPosition;\n  FragPos = worldMatrix * vec4(aPosition.xyz, 1);\n  gl_Position = projectionMatrix * (viewMatrix * FragPos);\n  FragPos.w = modelId;\n  VNormal = (worldMatrix * vec4(aNormal, 0));\n}\n","#version 300 es\nprecision highp float;\n\n// as printed by the console.log on csm.ts\nconst vec3 lightDir = vec3(-0.6560590289905073, 0.6663690071652679, -0.3543146860766681);\n\n#define CSM_TEXTURE_SIZE 2048.\n\n#define zNear 0.3\n#define CSM_PLANE_DISTANCE 55.\n#define zFar 177.\n\nin highp vec4 VNormal;\nin highp vec4 FragPos;\nin highp vec4 UntransformedFragPos;\nin lowp vec4 Color;\n\nuniform vec3 viewPos;\nuniform mat4 viewMatrix;\nuniform mat4 csm_matrix0;\nuniform mat4 csm_matrix1;\n\nuniform highp sampler2DShadow csm_texture0;\nuniform highp sampler2DShadow csm_texture1;\nuniform highp sampler2D groundTexture;\n\nout vec4 O;\n\nvoid main() {\n  vec4 fragPosVec4 = vec4(FragPos.xyz, 1);\n  vec3 normal = normalize(VNormal.xyz);\n\n  vec3 tex = Color.w *\n    (texture(groundTexture, UntransformedFragPos.yz * .035) * normal.x +\n     texture(groundTexture, UntransformedFragPos.xz * .035) * normal.y +\n     texture(groundTexture, UntransformedFragPos.xy * .035) * normal.z)\n      .xyz;\n\n  // Displacement map\n  normal = normalize(normal.xyz + tex * .5);\n\n  float lambert = dot(normal, lightDir);\n  float shadow = 1.;\n  float depthValue = abs((viewMatrix * fragPosVec4).z);\n\n  // Gets the fragment position in light space\n  vec4 csmCoords = (depthValue < CSM_PLANE_DISTANCE ? csm_matrix0 : csm_matrix1) * fragPosVec4;\n\n  // perform perspective divide and transform to [0,1] range\n  csmCoords = (csmCoords / csmCoords.w) * .5 + .5;\n\n  if (csmCoords.z < 1.) { // Only if inside far plane\n    shadow = 0.;\n\n    // Shadow bias could be computed based on normal and light, something like\n    // 0.0003 * (1. - clamp(dot(normal, lightDir), 0., 1.))\n\n    for (float x = -1.; x <= 1.; ++x) {\n      for (float y = -1.; y <= 1.; ++y) {\n        vec3 c = vec3(\n          csmCoords.xy + vec2(x, y) / CSM_TEXTURE_SIZE,\n          csmCoords.z -\n            // shadow bias\n            (1. / CSM_TEXTURE_SIZE / 2.8)\n        );\n        shadow += depthValue < CSM_PLANE_DISTANCE ? texture(csm_texture0, c) : texture(csm_texture1, c);\n      }\n    }\n    shadow /= 9.;\n  }\n\n  vec3 rgbColor = Color.xyz * (1. - tex.x);\n\n  float lavaLight = max(max(abs(normal.x), abs(normal.z)) * .3 - normal.y, 0.) * pow(max(0., (8. - FragPos.y) / 48.), 1.6);\n\n  O = vec4(\n    // lava light\n    vec3(lavaLight, lavaLight * lavaLight * .5, 0) +\n      // ambient\n      vec3(.09, .05, .11) * rgbColor +\n      // diffuse\n      (rgbColor * (max(0., lambert) * .5 + (rgbColor * lambert * lambert * vec3(.5, .45, .3))) * (shadow * .75 + .25)) +\n      // specular\n      vec3(.6, .6, .5) * pow(max(0., dot(normalize(FragPos.xyz - viewPos), reflect(lightDir, normal))), 35.) * shadow,\n    1\n  );\n}\n","#version 300 es\nprecision highp float;\n\nuniform vec3 iResolution;\nuniform vec3 viewPos;\nuniform mat4 viewMatrix;\n\nuniform highp sampler2D groundTexture;\n\nout vec4 O;\n\n#define gameTime iResolution.z\n\n/* 1 / Math.tan(fieldOfViewRadians / 2) */\nconst float fieldOfViewAmount = 1.73205;\n\nvoid main() {\n  vec2 fragCoord = (gl_FragCoord.xy / iResolution.xy) * 2. - 1.;\n  vec3 ray =\n    normalize(viewMatrix * vec4(fragCoord.x * -(iResolution.x / iResolution.y), -fragCoord.y, fieldOfViewAmount, 0.)).xyz;\n  float rayTracedLavalDistance = (-32. - viewPos.y) / ray.y;\n  float multiplier = (1. - clamp(abs(rayTracedLavalDistance / 9999.), 0., 1.));\n\n  O = vec4(0, 0, 0, 1);\n\n  if (multiplier > 0.01) {\n    if (rayTracedLavalDistance > 0.) {\n      // Render sky\n      float c = cos(gameTime / 30.), s = sin(gameTime / 30.);\n      ray.xz *= mat2(c, s, -s, c);\n      vec3 absRay = abs(ray);\n      O.xyz = vec3(dot(vec2(texture(groundTexture, ray.xy).z, texture(groundTexture, ray.yz * 2.).z), absRay.zx) * absRay.y);\n\n    } else {\n      // Render raytraced lava\n      ray = viewPos + ray * rayTracedLavalDistance;\n      O.x = multiplier *=\n        0.9 - texture(groundTexture, ray.xz / 150. + vec2(sin(ray.z / 35. + gameTime), cos(ray.x / 25. + gameTime)) / 80.).y;\n      O.y = multiplier * multiplier * multiplier;\n    }\n  }\n}\n","#version 300 es\n\nin vec4 aPosition;\n\nuniform mat4 viewMatrix;\nuniform mat4 worldMatrices[39];\n\n#define modelId aPosition.w\n\nvoid main() {\n  gl_Position = viewMatrix * (worldMatrices[max(0, abs(int(modelId)) - 1) + gl_InstanceID] * vec4(aPosition.xyz, 1));\n}\n","#version 300 es\n// Do nothing.\nvoid main() {}\n","#version 300 es\n\nin vec4 aPosition;\n\nvoid main() { gl_Position = vec4(aPosition.xy, 1, 1); }\n","#version 300 es\nprecision highp float;\n\nin highp vec4 VNormal;\nin highp vec4 FragPos;\n\nuniform mat4 viewMatrix;\n\nout vec4 O;\n\n#define modelId FragPos.w\n\nvoid main() {\n  vec4 v = viewMatrix * vec4(FragPos.xyz, 1);\n  float z = 1. - min(abs(v.z / v.w), 1.);\n  O = vec4(vec2(z * (gl_FragCoord.y > 31. ? 1. : abs(VNormal.y))), z > 0. ? modelId / 255. : 0., 1);\n}\n","export const loadStep = (fn: () => void) => {\n  // loading dots ...\n  h4.innerHTML += \".\";\n  setTimeout(fn);\n};\n","// This music has been exported by SoundBox and modified manually to minify better.\n\n// Beethoven's Piano Sonata No. 14, 3rd movement, readapted by Ryan Malm for this game\n\nexport const song_patterns = '000001234556112341234556011111111112011111111112000001111112'\n\nexport const song_instruments = [\n  [ // instrument 0\n    69, // OSC1_VOL\n    128, // OSC1_SEMI\n    0, // OSC1_XENV\n    143, // OSC2_VOL\n    128, // OSC2_SEMI\n    0, // OSC2_XENV\n    0, // NOISE_VOL\n    196, // ENV_ATTACK ** 2 * 4\n    100, // ENV_SUSTAIN ** 2 * 4\n    36, // ENV_RELEASE\n    0, // ENV_EXP_DECAY\n    0, // LFO_FREQ\n    149, // FX_FREQ\n    110, // FX_RESONANCE\n    31, // FX_DRIVE\n    47, // FX_PAN_AMT\n    3, // FX_PAN_FREQ\n    56, // FX_DELAY_AMT\n    2, // FX_DELAY_TIME\n    0, // LFO_AMT\n    [ // Columns 0\n      \"(.15:15:=5:=A:=AF=AFIFIMRMRUY(Y(((((((((((((((((((((((((((((M(M(((((((((((((((((((((((((((((R(R(((((((((((((((((((((((((((((U(U\",\n      \"(059<59<A9<AE<AEHAEHMEHMQMQTY(Y\",\n      \"(5:>A:>AF>AFJAFJMFJMRJMRVMRVY(Y\",\n      \"(:?BFFKNRRWZ^(^((:=@FFILRRUX^(^\",\n      \"Q(M(M(O(Q(R(T(Q(T(R(W(U(T(R(Q(N(W((Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(X]\",\n      \"QN(M(N(M(N(M(N(M((((((((((((((((W(Y(Y(Y(Y(Y(Y(Y(Y(((((((((((((((]\",\n    ]\n  ],\n  [ // Instrument 1\n    100, // OSC1_VOL\n    128, // OSC1_SEMI\n    0, // OSC1_XENV\n    201, // OSC2_VOL\n    128, // OSC2_SEMI\n    0, // OSC2_XENV\n    0, // NOISE_VOL\n    100, // ENV_ATTACK ** 2 * 4\n    144, // ENV_SUSTAIN ** 2 * 4\n    35, // ENV_RELEASE\n    0, // ENV_EXP_DECAY\n    6, // LFO_FREQ\n    135, // FX_FREQ\n    0, // FX_RESONANCE\n    32, // FX_DRIVE\n    147, // FX_PAN_AMT\n    6, // FX_PAN_FREQ\n    0, // FX_DELAY_AMT\n    6, // FX_DELAY_TIME\n    195, // LFO_AMT\n    [ // Columns 1\n      \".(5(.(5(.(5(.(5(.(5(.(5(.(5(.(5\",\n      \"-(5(-(5(-(5(-(5(-(5(-(5(-(5(-(5\",\n      \",(5(,(5(,(5(,(5(,(5(,(5(,(5(,(5\",\n      \"*(6(*(6(*(6(*(6(*(6(*(6(*(6(*(6\",\n      \"5(E(E(F(H(I(K(H(K(I(N(M(K(I(H(F(A(((((((((((((((((((((((((((((((5(((5(((5(((5(((5(((5(((5(((5\",\n      \"5(6(5(6(5(6(5(6(5((()(((((((((((A(B(A(B(A(B(A(B(A(((5\",\n    ]\n  ],\n  [ // Instrument 2\n    255, // OSC1_VOL\n    116, // OSC1_SEMI\n    85, // OSC1_XENV\n    255, // OSC2_VOL\n    116, // OSC2_SEMI\n    37, // OSC2_XENV\n    14, // NOISE_VOL\n    64, // ENV_ATTACK ** 2 * 4\n    144, // ENV_SUSTAIN ** 2 * 4\n    73, // ENV_RELEASE\n    99, // ENV_EXP_DECAY\n    0, // LFO_FREQ\n    136, // FX_FREQ\n    15, // FX_RESONANCE\n    32, // FX_DRIVE\n    0, // FX_PAN_AMT\n    0, // FX_PAN_FREQ\n    66, // FX_DELAY_AMT\n    6, // FX_DELAY_TIME\n    0, // LFO_AMT\n    [ // Columns 2\n      \"9(((9(((9(((9(((9(((9(((9(((9\",\n      \"9(((Q(((Q(((Q\",\n    ]\n  ],\n  [ // Instrument 3\n    0, // OSC1_VOL\n    140, // OSC1_SEMI\n    0, // OSC1_XENV\n    0, // OSC2_VOL\n    140, // OSC2_SEMI\n    0, // OSC2_XENV\n    81, // NOISE_VOL\n    64, // ENV_ATTACK ** 2 * 4\n    400, // ENV_SUSTAIN ** 2 * 4\n    47, // ENV_RELEASE\n    55, // ENV_EXP_DECAY\n    5, // LFO_FREQ\n    239, // FX_FREQ\n    135, // FX_RESONANCE\n    13, // FX_DRIVE\n    176, // FX_PAN_AMT\n    5, // FX_PAN_FREQ\n    16, // FX_DELAY_AMT\n    4, // FX_DELAY_TIME\n    187, // LFO_AMT\n    [ // Columns 3\n      \"9(9(9(9(9(9(9(999(9(9(9(999(9(9\",\n      \"9(9(9(9(9(999(9(((((Q\",\n    ]\n  ],\n  [ // Instrument 4\n    221, // OSC1_VOL\n    128, // OSC1_SEMI\n    64, // OSC1_XENV\n    210, // OSC2_VOL\n    128, // OSC2_SEMI\n    64, // OSC2_XENV\n    255, // NOISE_VOL\n    64, // ENV_ATTACK ** 2 * 4\n    144, // ENV_SUSTAIN ** 2 * 4\n    73, // ENV_RELEASE\n    79, // ENV_EXP_DECAY\n    7, // LFO_FREQ\n    195, // FX_FREQ\n    15, // FX_RESONANCE\n    21, // FX_DRIVE\n    20, // FX_PAN_AMT\n    0, // FX_PAN_FREQ\n    9, // FX_DELAY_AMT\n    3, // FX_DELAY_TIME\n    64, // LFO_AMT\n    [ // Columns 4\n      \"((((Q(((((((Q(((((((Q(((((((Q\",\n      \"Q((Q((Q((Q((Q((Q((((Q\",\n    ]\n  ],\n] as const\n\nexport const song_rowLen0 = 5513\n\nexport const song_rowLen1 = 4562\n\nexport const song_rowLen2 = 3891\n\n// Rows per pattern\nexport const song_patternLen = 32\n\n// End pattern\nexport const song_endPattern = 11\n\n// Number of channels\nexport const song_numChannels = 5\n\n","/* -*- mode: javascript; tab-width: 4; indent-tabs-mode: nil; -*-\n *\n * Copyright (c) 2011-2013 Marcus Geelnard\n *\n * This software is provided 'as-is', without any express or implied\n * warranty. In no event will the authors be held liable for any damages\n * arising from the use of this software.\n *\n * Permission is granted to anyone to use this software for any purpose,\n * including commercial applications, and to alter it and redistribute it\n * freely, subject to the following restrictions:\n *\n * 1. The origin of this software must not be misrepresented; you must not\n *    claim that you wrote the original software. If you use this software\n *    in a product, an acknowledgment in the product documentation would be\n *    appreciated but is not required.\n *\n * 2. Altered source versions must be plainly marked as such, and must not be\n *    misrepresented as being the original software.\n *\n * 3. This notice may not be removed or altered from any source\n *    distribution.\n *\n */\n\n// WARNING: Source code of the original player was heavily manually modified to reduce bundle size.\n// This player plays only the game song and is modified.\n// This makes this version not compatible with default soundbox songs.\n\nimport { audioContext, songAudioSource } from \"./audio-context\";\nimport {\n  song_endPattern,\n  song_patternLen,\n  song_patterns,\n  song_instruments,\n  song_rowLen0,\n  song_rowLen1,\n  song_rowLen2,\n  song_numChannels,\n} from \"./song\";\nimport { loadStep } from \"../load-step\";\n\nconst getnotefreq = (n: number) => 0.003959503758 * 2 ** ((n - 256) / 12);\n\n/** oscillator 0 */\nconst osc_sin = (value: number) => Math.sin(value * Math.PI * 2);\n\n/** oscillator 1 */\nconst osc_square = (value: number) => (value % 1 < 0.5 ? 1 : -1);\n\n/** oscillator 2 */\nconst osc_saw = (value: number) => 2 * (value % 1) - 1;\n\n/** oscillator 3 */\nconst osc_tri = (value: number) => {\n  const v2 = (value % 1) * 4;\n  return v2 < 2 ? v2 - 1 : 3 - v2;\n};\n\nconst getSegmentNumWords = (song_rowLen: number) => song_rowLen * song_patternLen * (song_endPattern + 1) * 2;\n\nexport const loadSong = (done: () => void) => {\n  let channelIndex = 0;\n\n  const song_numWords =\n    getSegmentNumWords(song_rowLen0) + getSegmentNumWords(song_rowLen1) + getSegmentNumWords(song_rowLen2);\n\n  const mixBuffer = new Int32Array(song_numWords);\n\n  const finish = () => {\n    const audioBuffer = audioContext.createBuffer(2, song_numWords / 2, 44100);\n    for (let i = 0; i < 2; i++) {\n      for (let j = i, data = audioBuffer.getChannelData(i); j < song_numWords; j += 2) {\n        data[j >> 1] = mixBuffer[j]! / 65536;\n      }\n    }\n\n    // Load the buffer into the audio source\n    songAudioSource.buffer = audioBuffer;\n\n    // Loop forever\n    songAudioSource.loop = true;\n\n    loadStep(done);\n  };\n\n  const next = () => {\n    // Generate audio data for a single track/channel.\n    let mixIndex = 0;\n    let [\n      OSC1_VOL,\n      OSC1_SEMI,\n      OSC1_XENV,\n      OSC2_VOL,\n      OSC2_SEMI,\n      OSC2_XENV,\n      NOISE_VOL,\n      ENV_ATTACK,\n      ENV_SUSTAIN,\n      ENV_RELEASE,\n      ENV_EXP_DECAY,\n      LFO_FREQ,\n      FX_FREQ,\n      FX_RESONANCE,\n      FX_DRIVE,\n      FX_PAN_AMT,\n      FX_PAN_FREQ,\n      FX_DELAY_AMT,\n      FX_DELAY_TIME,\n      LFO_AMT,\n      COLUMNS,\n    ] = song_instruments[channelIndex]!;\n\n    ENV_RELEASE = (ENV_RELEASE * ENV_RELEASE * 4) as any;\n\n    const createNote = (song_rowLen: number, note: number) => {\n      const OSC1_WAVEFORM = channelIndex < 2 ? osc_saw : osc_sin;\n      const OSC2_WAVEFORM = channelIndex < 2 ? (channelIndex < 1 ? osc_square : osc_tri) : osc_sin;\n\n      // Re-trig oscillators\n      let c1 = 0;\n      let c2 = 0;\n\n      // Local variables.\n      let o1t: number;\n      let o2t: number;\n\n      const noteBuf = new Int32Array(ENV_ATTACK + ENV_SUSTAIN + ENV_RELEASE);\n\n      // Generate one note (attack + sustain + release)\n      for (let j1 = 0, j2 = 0; j1 < ENV_ATTACK + ENV_SUSTAIN + ENV_RELEASE; ++j1, ++j2) {\n        let e = 1;\n        // Envelope\n        if (j1 < ENV_ATTACK) {\n          e = j1 / ENV_ATTACK;\n        } else if (j1 >= ENV_ATTACK + ENV_SUSTAIN) {\n          e = (j1 - ENV_ATTACK - ENV_SUSTAIN) / ENV_RELEASE;\n          e = (1 - e) * 3 ** ((-ENV_EXP_DECAY / 16) * e);\n        }\n\n        if (j2 >= 0) {\n          // Switch arpeggio note.\n          j2 -= song_rowLen * 4;\n\n          // Calculate note frequencies for the oscillators\n          o1t = getnotefreq(note + OSC1_SEMI);\n          o2t = getnotefreq(note + OSC2_SEMI) * (1 + (channelIndex ? 0 : 0.0008 * 9));\n        }\n\n        // Add to (mono) channel buffer\n        noteBuf[j1] =\n          (80 * // Oscillator 1\n            (OSC1_WAVEFORM((c1 += o1t! * e ** (OSC1_XENV / 32))) * OSC1_VOL +\n              // Oscillator 2\n              OSC2_WAVEFORM((c2 += o2t! * e ** (OSC2_XENV / 32))) * OSC2_VOL +\n              // Noise oscillator\n              (NOISE_VOL ? (Math.random() * 2 - 1) * NOISE_VOL : 0)) *\n            e) |\n          0;\n      }\n      return noteBuf;\n    };\n\n    for (const song_rowLen of [song_rowLen0, song_rowLen1, song_rowLen2]) {\n      // Local variables\n      let n;\n      let t;\n      let f;\n\n      const chnBuf = new Int32Array(getSegmentNumWords(song_rowLen));\n\n      // Clear effect state\n      let low = 0;\n      let band = 0;\n      let high;\n      let filterActive: boolean | undefined;\n\n      // Clear note cache.\n      const noteCache = [];\n\n      // Put performance critical instrument properties in local variables\n      const lfoFreq = 2 ** (LFO_FREQ - 9) / song_rowLen;\n      const panFreq = (Math.PI * 2 ** (FX_PAN_FREQ - 8)) / song_rowLen;\n      const dly = (FX_DELAY_TIME * song_rowLen) & ~1; // Must be an even number\n\n      // Patterns\n      for (let p = 0; p <= song_endPattern; ++p) {\n        // Pattern rows\n        for (let row = 0, cp = +song_patterns[channelIndex * 12 + p]!; row < song_patternLen; ++row) {\n          // Calculate start sample number for this row in the pattern\n          const rowStartSample = (p * song_patternLen + row) * song_rowLen;\n\n          // Generate notes for this pattern row\n          for (let col = 0; col < 4; ++col) {\n            n = 0;\n            if (cp) {\n              n = COLUMNS[cp - 1]!.charCodeAt(row + col * song_patternLen) - 40;\n              n += n > 0 ? 106 : 0;\n            }\n            if (n) {\n              const noteBuf = noteCache[n] || (noteCache[n] = createNote(song_rowLen, n));\n              for (let j = 0, i = rowStartSample * 2; j < noteBuf.length; ++j, i += 2) {\n                chnBuf[i] += noteBuf[j]!;\n              }\n            }\n          }\n\n          // Perform effects for this pattern row\n          for (let j = 0, rsample; j < song_rowLen; ++j) {\n            // Dry mono-sample\n            let k = (rowStartSample + j) * 2;\n            let lsample = 0;\n            rsample = chnBuf[k]!;\n\n            // We only do effects if we have some sound input\n            if (rsample || filterActive) {\n              // State variable filter\n              f = FX_FREQ * ((43.23529 * 3.141592) / 44100);\n              if (channelIndex === 1 || channelIndex === 4) {\n                f *= (osc_sin(lfoFreq * k) * LFO_AMT) / 512 + 0.5;\n              }\n              f = 1.5 * Math.sin(f);\n              low += f * band;\n              high = (1 - FX_RESONANCE / 255) * (rsample - band) - low;\n              band += f * high;\n              rsample = channelIndex === 4 ? band : channelIndex === 3 ? high : low;\n\n              // Distortion\n              if (!channelIndex) {\n                rsample *= 22 * 1e-5;\n                rsample = rsample < 1 ? (rsample > -1 ? osc_sin(rsample / 4) : -1) : 1;\n                rsample /= 22 * 1e-5;\n              }\n\n              // Drive\n              rsample *= FX_DRIVE / 32;\n\n              // Is the filter active (i.e. still audiable)?\n              filterActive = rsample * rsample > 1e-5;\n\n              // Panning\n              t = (Math.sin(panFreq * k) * FX_PAN_AMT) / 512 + 0.5;\n              lsample = rsample * (1 - t);\n              rsample *= t;\n            }\n\n            // Delay is always done, since it does not need sound input\n            if (k >= dly) {\n              // Left channel = left + right[-p] * t\n              lsample += (chnBuf[k - dly + 1]! * FX_DELAY_AMT) / 255;\n\n              // Right channel = right + left[-p] * t\n              rsample += (chnBuf[k - dly]! * FX_DELAY_AMT) / 255;\n            }\n\n            mixBuffer[mixIndex + k] += chnBuf[k] = lsample;\n            ++k;\n            mixBuffer[mixIndex + k] += chnBuf[k] = rsample;\n          }\n        }\n      }\n\n      mixIndex += chnBuf.length;\n    }\n\n    loadStep(++channelIndex < song_numChannels ? next : finish);\n  };\n\n  loadStep(next);\n};\n","import \"./index.css\";\n\nimport \"./dev-tools/dev-main\";\n\nif (DEBUG) {\n  console.time(\"boot\");\n}\n\nimport groundTextureSvg from \"./groundTexture.svg\";\n\nimport { build_life_the_universe_and_everything } from \"./game/level\";\nimport { startMainLoop } from \"./main-loop\";\nimport { initTriangleBuffers } from \"./game/triangle-buffers\";\nimport { loadStep } from \"./load-step\";\nimport { loadSong } from \"./music/music-player\";\nimport { initPage } from \"./page\";\n\nloadStep(() => {\n  let loadStatus = 0;\n  const image = new Image();\n\n  if (DEBUG) {\n    console.time(\"load\");\n  }\n\n  const end = () => {\n    if (++loadStatus === 2) {\n      if (DEBUG) {\n        console.timeEnd(\"load\");\n      }\n\n      if (DEBUG) {\n        console.time(\"startMainLoop\");\n      }\n\n      startMainLoop(image);\n\n      if (DEBUG) {\n        console.timeEnd(\"startMainLoop\");\n      }\n\n      NO_INLINE(initPage)();\n    }\n  };\n\n  image.onload = image.onerror = end;\n  image.src = groundTextureSvg;\n\n  const songLoaded = () => {\n    loadStep(() => {\n      initTriangleBuffers();\n      loadStep(end);\n    });\n    build_life_the_universe_and_everything();\n  };\n\n  if (DEBUG && DEBUG_FLAG1) {\n    songLoaded();\n  } else {\n    NO_INLINE(loadSong)(songLoaded);\n  }\n\n  if (DEBUG) {\n    console.timeEnd(\"boot\");\n  }\n});\n","import { plane_fromPolygon } from \"../math\";\nimport type { Polygon } from \"../geometry/geometry\";\nimport { allModels, MODEL_ID_LEVER, souls, SOULS_COUNT } from \"./models\";\nimport { gl } from \"../gl\";\n\nexport const initTriangleBuffers = () => {\n  if (DEBUG) {\n    console.time(\"initTriangleBuffers\");\n  }\n\n  const _vertexMap = new Map<string, number>();\n  const _vertexInts = new Int32Array(8);\n  const _vertexIntsSmooth = new Int32Array(_vertexInts.buffer, 0, 5);\n  const _vertexFloats = new Float32Array(_vertexInts.buffer);\n\n  const _triangleIndices: number[] = [];\n  const _vertexPositions: number[] = [];\n  const _vertexColors: number[] = [];\n  const _vertexNormals: number[] = [];\n\n  let polygon: Polygon | undefined;\n  let meshFirstIndex: number = 0;\n\n  const getVertex = (i: number): number => {\n    let { x, y, z } = polygon![i]!;\n    _vertexFloats[0] = x;\n    _vertexFloats[1] = y;\n    _vertexFloats[2] = z;\n    const key = \"\" + (polygon!.$smooth ? _vertexIntsSmooth : _vertexInts);\n    let index = _vertexMap.get(key);\n    if (index !== undefined) {\n      x = index * 3;\n      _vertexNormals[x] = (_vertexNormals[x++]! + _vertexInts[5]!) / 2;\n      _vertexNormals[x] = (_vertexNormals[x++]! + _vertexInts[6]!) / 2;\n      _vertexNormals[x] = (_vertexNormals[x]! + _vertexInts[7]!) / 2;\n    } else {\n      _vertexMap.set(key, (index = _vertexMap.size));\n      _vertexPositions.push(x, y, z, _vertexFloats[3]!);\n      _vertexColors.push(_vertexInts[4]!);\n      _vertexNormals.push(_vertexInts[5]!, _vertexInts[6]!, _vertexInts[7]!);\n    }\n    return index;\n  };\n\n  for (const model of allModels) {\n    _vertexFloats[3] = model.$modelId === MODEL_ID_LEVER ? -SOULS_COUNT - 1 : model.$kind && model.$modelId;\n    for (polygon of model.$polygons!) {\n      const { x, y, z } = plane_fromPolygon(polygon);\n      _vertexInts[4] = polygon.$color! | 0;\n      _vertexInts[5] = x * 32767;\n      _vertexInts[6] = y * 32767;\n      _vertexInts[7] = z * 32767;\n      for (let i = 2, a = getVertex(0), b = getVertex(1); i < polygon.length; ++i) {\n        _triangleIndices.push(a, b, (b = getVertex(i)));\n      }\n    }\n\n    // free memory\n    model.$polygons = null;\n\n    // write the indices offset and count\n    model.$vertexBegin = meshFirstIndex;\n    model.$vertexEnd = meshFirstIndex = _triangleIndices.length;\n  }\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(_vertexPositions), gl.STATIC_DRAW);\n  gl.vertexAttribPointer(0, 4, gl.FLOAT, false, 0, 0);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ARRAY_BUFFER, new Int16Array(_vertexNormals), gl.STATIC_DRAW);\n  gl.vertexAttribPointer(1, 3, gl.SHORT, true, 0, 0);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ARRAY_BUFFER, new Uint32Array(_vertexColors), gl.STATIC_DRAW);\n  gl.vertexAttribPointer(2, 4, gl.UNSIGNED_BYTE, true, 0, 0);\n\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(_triangleIndices), gl.STATIC_DRAW);\n\n  gl.enableVertexAttribArray(0);\n  gl.enableVertexAttribArray(1);\n  gl.enableVertexAttribArray(2);\n\n  if (DEBUG) {\n    console.timeEnd(\"initTriangleBuffers\");\n    console.table({\n      \"game models\": allModels.filter((m) => !!m.$kind).length,\n      \"all models\": allModels.length,\n      \"vertices\": _vertexMap.size,\n      \"triangles\": _triangleIndices.length / 3,\n      \"indices\": _triangleIndices.length,\n    });\n\n    if (souls.length !== SOULS_COUNT) {\n      throw new Error(\"Souls must be \" + SOULS_COUNT + \" but is \" + souls.length);\n    }\n  }\n};\n"],"names":["groundTextureSvg","btoa","DEG_TO_RAD","Math","PI","identity","float32Array16Temp","Float32Array","integers_map","n","fn","Array","from","_","i","min","a","b","max","abs","threshold","value","amount","clamp01","t","lerp","lerpneg","v","angle_wrap_degrees","degrees","angle_wrap_radians","radians","atan2","sin","cos","angle_lerp_degrees","a0","a1","da","angle_lerp","vec3_distance","x","y","z","hypot","vec3_dot","plane_fromPolygon","polygon","at","w","matrixToArray","$matrix","output","index","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","mat_perspectiveXY","mx","my","near","far","GQuad","polygon_color","color","smooth","$smooth","$color","polygon_transform","m","map","p","transformPoint","vec3_transform","polygons_transform","polygons","polygon_regular","segments","elongate","cylinder_sides","btm","top","btmi","length","cylinder","topSize","points","translate","scale3d","bottom","reverse","sphere","slices","stacks","vertexFunc","CSGPolygon_splitSpanning","plane","jd","fpoints","$flipped","iv","$polygon","id","jv","bpoints","push","$front","$parent","$back","CSGPolygon_split","d","csg_tree_addPolygon","node","$polygons","csg_tree_clipNode","anode","bnode","polygonPlaneFlipped","result","recursion","csg_tree_each","csg_tree","reduce","prev","csg_tree_flip","root","csg_union","inputs","polygonsToAdd","pp","csg_polygons_subtract","input","tree","Map","add","found","byParent","get","allPolygons","delete","set","flipped","csg_polygons","csg_subtract","MODEL_ID_PLAYER_LEG0","MODEL_ID_PLAYER_LEG1","allModels","levers","souls","player_position_final","souls_collected_count","absoluteTime","gameTime","player_last_pulled_lever","rotatingPlatform1Rotation","rotatingPlatform2Rotation","rotatingHexCorridorRotation","game_completed","firstBoatLerp","secondBoatLerp","_messageEndTime","mainMenuVisible","_globalTime","keyboard_downKeys","lerpDamp","to","speed","exp","gameTimeDelta","showMessage","message","duration","Infinity","h4","innerHTML","worldStateUpdate","shouldRotatePlatforms","$lerpValue","$lerpValue2","$value","model","_update","lever","soul","updateCollectedSoulsCounter","h3","acc","saveGame","localStorage","JSON","stringify","currentEditModel","newModel","$kind","previousModel","$modelId","meshAdd","transform","newLever","locMatrix","multiply","$locMatrix","leverIndex","onPlayerPullLever","rotate","translateSelf","scale","material","newSoul","walkingPath","dirX","randAngle","lookAngle","prevX","prevZ","wasInside","velocity","contextualVelocity","isInside","mindist","c","circles","distance","targetX","targetZ","circleSDF","circle","x1","z1","w1","ax","az","magnitude","angle","random","dirZ","soulX","soulZ","soulPos","parentModel","rotateSelf","NO_INLINE","r","g","build_life_the_universe_and_everything","hornsMatrices","HORN_STACKS","hornPolygons","flat","slice","getBoatAnimationMatrix","makeBigArcPolygons","height","blackPlatform","freq","amplitude","pz","level2Oscillation","level3Oscillation","shouldOscillate","shouldPushRods","hexPadShouldOscillate","boatPolygons","gateBarsPolygons","skewX","j","hexCorridorPolygons","scaleSelf","skewY","pushingRod","osc","k","eye","bm","theta","phixz","GHOST_STACKS","camera_position","camera_rotation","mat_perspective","hC","clientHeight","clientWidth","fieldOfViewAmount","csm_buildMatrix","camera_view","nearPlane","farPlane","zMultiplier","tx","ty","tz","roundingRadius","projViewInverse","DOMMatrix","invertSelf","frustumCorners","lightViewTranslated","left","right","multiplySelf","audioContext","AudioContext","songAudioSource","createBufferSource","touch_movementX","touch_movementY","player_first_person","initPage","music_on","touchStartTime","touchPosStartX","touchPosStartY","touchPosIdentifier","touchPosMoved","touchRotX","touchRotY","touchRotIdentifier","touchRotMoved","touchStartCameraRotX","touchStartCameraRotY","pageClicked","updateMusicOnState","disconnect","connect","destination","b4","mainMenu","visible","document","exitFullscreen","catch","exitPointerLock","start","body","className","handleResize","width","innerWidth","hidden","oncontextmenu","b3","onclick","confirm","location","reload","b1","requestFullscreen","b2","b5","e","target","requestPointerLock","code","type","repeat","pressed","mapped","onmousemove","movementX","movementY","ontouchstart","pageX","pageY","identifier","changedTouches","ontouchmove","deltaX","deltaY","absDeltaX","absDeltaY","sign","ontouchend","click","preventDefault","touch","diff","onvisibilitychange","onblur","onresize","gl","getContext","powerPreference","s","player_update","player_init","currentModelIdTMinus1","currentModelId","player_look_angle_target","player_look_angle","player_legs_speed","player_respawned","gamepadInteractPressed","oldModelId","player_has_ground","player_gravity","player_speed","player_collision_velocity_x","player_collision_velocity_z","player_model_y","player_collision_x","player_collision_z","camera_lookat_x","camera_lookat_y","camera_lookat_z","player_position_global","player_collision_modelIdCounter","Int32Array","interpolate_with_hysteresis","previous","desired","player_respawn","doHorizontalCollisions","front","back","yindex","i1","COLLISION_TEXTURE_SIZE","dist1","collision_buffer","dist2","i2","xdist","doVerticalCollisions","maxModelIdCount","lines","grav","fill","up","count","nextModelId","player_move","referenceMatrix","x2","y2","z2","inverseReferenceRotationMatrix","inverse","x21","y21","z21","dx","dz","CAMERA_PLAYER_Z_DIST","viewDirDiffx","viewDirDiffz","viewDirDiffAmount","playerMatrix","modelId","Uint8Array","forward","gamepad","navigator","getGamepads","getGamepadButtonState","buttons","axes","interactButtonPressed","strafe","movAngle","movAmount","playerSpeedCollision","movementRadians","loadShader","source","shader","initShaderProgram","vertexShader","sfsSource","uniforms","program","name","worldMatricesBuffer","renderModels","renderPlayer","soulModelId","isShadowRender","matrix","worldMatrixLoc","$vertexEnd","$vertexBegin","startMainLoop","groundTextureImage","mainLoop","globalTime","requestAnimationFrame","time","dt","gameTimeUpdate","collision_frameBuffer","collisionShader","csm_framebuffer","csm_render","drawingBufferWidth","drawingBufferHeight","mainShader","skyShader","collision_renderBuffer","collision_texture","mainVertexShader","csmShader","csmSplit","lightSpaceMatrix","texture","lightSpaceMatrixLoc","savedLevers","savedSouls","savedLastPulledLever","savedGameTime","savedSecondBoatLerp","parse","loadStep","setTimeout","song_instruments","getnotefreq","osc_sin","osc_square","osc_saw","osc_tri","v2","getSegmentNumWords","song_rowLen","loadSong","done","channelIndex","finish","createBuffer","song_numWords","audioBuffer","data","mixBuffer","buffer","loop","next","mixIndex","note","c1","c2","o1t","o2t","OSC1_WAVEFORM","noteBuf","ENV_ATTACK","ENV_SUSTAIN","ENV_RELEASE","j1","j2","ENV_EXP_DECAY","OSC1_SEMI","OSC2_SEMI","OSC1_XENV","OSC1_VOL","OSC2_WAVEFORM","OSC2_XENV","OSC2_VOL","NOISE_VOL","LFO_FREQ","FX_FREQ","FX_RESONANCE","FX_DRIVE","FX_PAN_AMT","FX_PAN_FREQ","FX_DELAY_AMT","FX_DELAY_TIME","LFO_AMT","COLUMNS","low","band","f","high","filterActive","noteCache","chnBuf","lfoFreq","panFreq","dly","row","cp","col","charCodeAt","createNote","rowStartSample","lsample","rsample","loadStatus","end","image","Image","onload","onerror","src","meshFirstIndex","_vertexPositions","_vertexColors","_vertexNormals","_vertexMap","_vertexInts","_vertexFloats","_vertexIntsSmooth","key","size","getVertex","_triangleIndices","Int16Array","Uint32Array","Uint16Array"],"mappings":"AAAA,MAAAA,mBAAe,+CAA6BC,KAAK;;ACA1C,MAAMC,aAAeC,KAAeC,KAAA;;AAGpC,MAAMC,WAAA;;AAEN,MAAMC,yBAA6DC,aAAA;;AAEnE,MAAMC,eAAiD,CAAAC,GAAAC,OAAQC,MAAIC,qBAAAD,MAAAF,KAAA,CAAAI,GAAAC,MAAAJ,GAAAI;;AAEnE,MAAMC,MAAsB,CAACC,GAAAC,MAAmBA,IAAAD,IAAKA,IAAIC;;AAEzD,MAAMC,MAAA,CAAAF,GAAAC,MAAwCD,IAAAC,IAAAD,IAAAC;;AAE9C,MAAME,MAAAV,KAA0C,IAAfA,KAAeA;;AAGhD,MAAMW,YAAmC,CAAAC,OAAyBC,WAASH,IAAKE,SAAQC,SAACD,QAAA;;AAEzF,MAAME,UAA2BC,KAAyB,IAAAA,IAAA,IAAAA,IAAA,IAAA,IAAAA;;AAC/D,MAAIC,QAAQT,GAACC,GAAAO,MAAAR,KAAAC,IAAAD,KAAAO,QAAAC;;AACb,MAAAE,UAAY,CAAGC,GAAIH;IACrBG,IAAAJ,QAAAI;IAOO,OAA2CF,KAAAE,GAAA,IAAAA,GAAAH;AAAA;;AAOhD,MAAAI,qBAAwBC;IAAUC,QAD+BC,UAC/BF,UAAA3B,4BAD6CC,KAAA6B,sBAAA7B,KAAA8B,IAAAF,0BAAA5B,KAAA+B,IAAAH,aAC7C7B;IADmB,IAAY6B;AAC/B;;AA+C7B,MAAMI,qBAAsC,CAAAC,IAAiCC,IAAAb,MA9C/D,EAAOY,IAAAC,IAAAb;IAC5B,MAAAc,MAAAD,KAAAD,OAAA,IAAAjC,KAAAC;IAEa,OAAAgC,MAAA,IAAAE,MAA8D,IAAzBnC,KAAaC,MAC7DkC,MAAWf,QAAAC;AAAA,EA0CuEe,CAAcH,KAAElC,YAAUmC,KAAAnC,YAAAsB,KAAAtB;;AAOvG,MAAMsC,gBAAA,EAAAC,GAA2EC,GAAAC,IAAA1B,sBAAAd,KAAAyC,MAAAH,IAAAxB,EAAAwB,GAAAC,IAAAzB,EAAAyB,GAAAC,IAAA1B,EAAA0B;;AAEtF,MAAIE,WAAI,EAAAJ,GAAAC,GAAAC,IAAA1B,MAAAwB,IAAAxB,EAAAwB,IAAAC,IAAAzB,EAAAyB,IAAAC,IAAA1B,EAAA0B;;AACR,MAAIG,oBAAIC;IACR,IAAQN,IAAA;IACJ,IAAAC,IAAY;IACZ,IAAAC,IAAA;;IAEF,IAAA3B,IAAQ+B,QAAYC,IAAA;IACpB,KAAA/B,KAAY8B,SAAQ;QACpBN,MAAYzB,EAAA0B,IAAQzB,EAAAyB,QAAMC,IAAE1B,EAAA0B;QACxBD,MAAA1B,EAAA2B,IAAA1B,EAAA0B,MAAA3B,EAAAyB,IAAAxB,EAAAwB;QACNE,MAAA3B,EAAAyB,IAAAxB,EAAAwB,MAAAzB,EAAA0B,IAAAzB,EAAAyB;QACS1B,IAAAC;AACJ;IACAA,oBAAAd,KAAAyC,MAAAH,GAAAC,GAAAC;IACAF,KAAAxB;IACEyB,KAAAzB;IACT0B,KAAA1B;IAGa,OAAA;QAEAwB;;QAOFE;QACTM,aAA0BP,IAAA1B,EAAA0B,IAAAC,IAAA3B,EAAA2B;;AAC1B;;AAEA,MAAAO,gBAA0B,CAAAC,SAAAC,SAAA9C,oBAAA+C,SAAA;IAC1BA;IACAD,mBAA0BD,QAAAG;IAC1BF,mBAA0BD,QAAAI;IAC1BH,mBAA0BD,QAAAK;IAC1BJ,mBAA0BD,QAAAM;IAC1BL,mBAA0BD,QAAAO;IAC1BN,mBAA0BD,QAAAQ;IAC1BP,mBAA0BD,QAAAS;IAC1BR,mBAA0BD,QAAAU;IAC1BT,mBAA0BD,QAAAW;IAC1BV,mBAA0BD,QAAAY;IAC1BX,mBAAwBD,QAAAa;IACjBZ,OAAAC,YAAAF,QAAAc;IACTb,OAAAC,YAAAF,QAAAe;IAEOd,OAA0CC,YAAAF,QAAagB;IAC5Df,OAAAC,YAAAF,QAAAiB;IACAhB,OAAAC,UAAAF,QAAAkB;IACA,OAAAjB;AAAA;;AACA,MACAkB,oBAAA,CAAAC,IAAAC,IAAAC,MAAAC,QAAA,EACAH,IACA,GACA,GACA,GACA,GACCC,IACD,GACA,GACA,GACW,IACXE,MAAAD,SAAAA,OAAAC,OACF;;AC5JA,MAASC,QAAK,EAEP;IACIlC,IAAA;IACDE,GAAA;GAEN;IACJF,GAAA;IAU6BE,GAAA;GAE3B;IACOF,GAAA;IACTE,IAAA;GAGG;IACMF,IAAE;IACXE,IAAA;;;AAQ2C,MACvCiC,gBAAA,CAAA7B,SAAA8B,OAAAC;IACQ/B,QAAAgC,UAAAD;IACV/B,QAAAiC,SAAAH;IAEgD,OAAA9B;AAAA;;AA8B5C,MACFkC,oBAAA,CAAAlC,SAAAmC,GAAAL,QAAA9B,QAAAiC,WAAAJ,cAAA7B,QAAAoC,KAAAC,KAnBe,GAAA3C,GAAAC,GAAAC;MACRF,GAAAC,GAAAC,KAAAuC,EAAAG,eAAA;QACG5C;QACLC;QACIC;;IAEV,OAAA;QAO2CF;QACnCC;QAEJC;;AAAyF,EAG5F2C,CAAAF,GAAAF,MAAAL,OAAA9B,QAAAgC;;AACF,MAAAQ,qBAAA,CAAAC,UAAAN,GAAAL,UAAAW,SAAAL,KAAApC,WAAAkC,kBAAAlC,SAAAmC,GAAAL;;AAGK,MAAMY,kBACX,CAAAC,UAEAC,WAAkB,MAEJnF,aAAAkF,WAAA5E;IACR,MAAS6B,oBAAAxC,KAAA+B,IAA2B,IAA3B/B,KAA2BC,MAAAU,IAAA4E;IAC9B,OAAA;2BACqBvF,KAAA8B,IAAA,IAAA9B,KAAAC,MAAAU,IAAQ4E;WACf;QAC5B/C,GAAA,MAAAxB,IAAAwB,KAAAA,IAAA,IAAAA,IAAAA,IAAAgD,WAAAhD,IAAAgD;;AAEO;;AAKH,MAAMC,iBAAe,CAAAC,KAAAC,KAAAhB,WAAAe,IAAAV,KAAA,CAAAY,MAAAjF,IAAAkF,YAAApB,cAAA,QAGTkB,IAAAE,SAAAlF,IAAA,kBACeA,IAAA,KAAAkF,SAAA,IAChBH,KAAA/E,IAAO,KAAAkF,WAClBH,IAAab,QAAOF;;AAClB,MAAAmB,WAAgB,CAAAP,UAAAZ,QAAcoB,UAAQ,GAAAP;IAChC,MAAAQ,SAAAT,WAAmCD,gBAAwBC,UAAAC,YAAahB;IAC9E,MAAAmB,wBAAqBK,QAAA9F,SAAA+F,UAAA,GAAA,GAAAC,QAAAH,UAAA,IAAAA,UAAA;IACrB,MAAAI,SAAWrB,kBAAAkB,QAAA9F,SAAA+F,UAAA,IAAA,GAAAC,QAAA,IAAAH,WAAAA,UAAA,IAAAK;IACJ,OAAA,KACGX,eAASU,QAASR,KAAAhB,SAC5BgB,KACIQ;AACF;;AAEF,MAAOE,SAAA,CAAGC,QAASC,SAAOD,QAAAE,aAAA,EAAAlE,GAAAC;IAC5BA,KAAAvC,KAAAC,KAAAsG;IACFjE,KAAA,IAAAtC,KAAAC,KAAAqG;IACO,OAAA;QACThE,mBAAAtC,KAAA+B,IAAAO,qBAAAtC,KAAA8B,IAAAS;;;;;;;;;;;;;;;;;;AC/GA,MAAAkE,2BAA4C,CAAAC,OAAA9D;IAEf,IAAA+D;IA+BvB,MAAAC,UAAA;IACJ,gBAAyB;qBACAC,YAAAjE;IACnB,IAAAkE,KAAYC,SAAAlE,IAAA;IACd,IAAAmE,KAAAtE,SAAAgE,OAAAI,MAAAJ,MAAA5D;IACA,KAAA,MAAsBmE,MAAAF,UAAK;QACdJ,KAAAjE,SAAgBgE,OAAEO,MAAUP,MAAA5D;eAC7CkE,MAA2BE,QAAAC,KAAAL;QACXE,cAAmBJ,QAAAO,KAAAL;iCACTH,cAAAK,MAAAL,WAAA;YACtBK,WAAeA;YACjBF,KAAA;gBACyBxE,GAAAwE,GAAAxE,KAAAwE,GAAAxE,IAAA2E,GAAA3E,KAAA0E;mBACVF,GAAEvE,KAAAuE,GAAAvE,IAAA0E,GAAA1E,KAAAyE;gBACjBxE,GAAAsE,GAAAtE,KAAAsE,GAAAtE,IAAAyE,GAAAzE,KAAAwE;;YAEQJ,QAAKO,KAAAL;YACNI,QAAAC,KAAAL;;QAEGA,KAAAG;QACAD,KAAAL;AACR;IACA,OAAA;QACAS,gBAAevB,SAAA,KAAA;YACjBkB,UAAAtC,cAAAmC,SAAAG,SAAAlC,QAAAkC,SAAAnC;YACKiC;YACAQ,SAAAzE;;QAEA0E,OAAAJ,QAAArB,SAAA,KAAA;YACGkB,UAAQtC,cAAcyC,SAAAH,SAAAlC,QAAAkC,SAAAnC;;YAE5ByC,SAAAzE;;;AACS;;AAEkB,MAC3B2E,mBAAwB,CAAAb,OAAA9D;IACxB,IAAAwE;IACS,IAAAE;IACX,IAAAE;IACF,OAAAT,YAAAnE;IACF,KAAA,IAAAjC,IAAA,GAAAoG,SAAAlB,SAAAlF,KAAAA,GAAA;QAEM6G,IAAA9E,SAAAgE,OAAoCK,SAA0DpG,MAAA+F,MAAA5D;oBAC7EwE,QAAA1E,UACjB4E,aAAAJ,SAAAxE;QACA,IAAA0E,SAAAF,QAAA,OAAAX,yBAAAC,OAAA9D;AACA;IACK,OAAA;QACHwE;QACAE;;AACF;;AAEA,MAASG,sBAAA,CAAAC,MAAA9E,SAAA8D,QAAA/D,kBAAAC,QAAAmE;IACX,IAAAW,MAAA;QACI,eAAiBJ,SAAAC,iBAAAG,MAAA9E;QACZwE,UAAAE,SAAAI,KAAAC,UAAuCR,KAAAvE;QAChDwE,WAAAM,KAAAN,SAAAK,oBAAAC,KAAAN,QAAAA,QAAAV;QACFY,UAAAI,KAAAJ,QAAAG,oBAAAC,KAAAJ,OAAAA,OAAAZ;AACA,WAAS;QACX,OAAApE,GAAAC,GAAAC,GAAAM,KAAA4D;QAEMgB,OAAA;YAKMpF;YACAC;YACOC;YACRM;YACP6E,WAAA,EACY/E;YAEZwE,QAAA;YACWE,OAAA;;AAEX;IACK,OAAAI;AAAA;;AAEL,MAAAE,oBAAqB,CAAAC,OAAAC,OAAYC;IACnC,MAAAC,SAAA;IACO,MAAAC,YAAA,CAAAP,MAAA9E;QACT,KAAAwE,QAAAE,SAAAC,iBAAAG,MAAA9E;QAE0CwE,UAAAE,gCAKV5E,SAAAgF,MAAAI,SAAA,IAAAV,SAAAxE,UACX0E,QAAA1E;QAEFwE,WACaM,KAAAN,SAAAa,UAAAP,KAAeN,QAAKA,UACnCY,OAAAb,KAAAC;QAEDE,SAAAI,KAAAJ,SAAAW,UAAAP,KAAAJ,OAAAA;AAAA;IAEZ,KAAA,MAAA1E,WAAAkF,MAAAH,WAAAM,UAAAJ,OAAAjF;IACY,OAAAoF;AAAA;;AAER,MAAUE,gBAAA,CAAKR,aAAcA,SAAAnH,GAAAmH,OAAAQ,cAAAR,KAAAN,QAAA7G;AAAA2H,cAAAR,KAAAJ,OAAA/G;;AAAA,MAC/B4H,WAAO7H,KAAAA,EAAAuF,SAAAvF,EAAA8H,QAAA,CAAAC,MAAAtB,aAAAU,oBAAAY,MAAA;IACLtB;IACFF,UAAA;IACFQ,SAAA;KACI,KAAS/G;;AACX,MAAUgI;IACZJ,cAAAK,OAAAb;QACF,OAAAN,QAAAE,SAAAI;QAEWA,KAAAJ,QAAAF;QACTM,KAAAN,SAAwBE;QAC1BI,KAAApF,MAAA;QACOoF,KAAAnF,MAAA;QACTmF,KAAAlF,MAAA;;QAWwC,KAAA,MACrCI,gBAEK+E,WAAgB/E,QAAAiE,YAAAjE,QAAAiE;AAAA;IAEhB,OAAA0B;AAAA;;AAMD,MAAMC,YAAA,IAAgBC,WAAmDA,OAAAL,QAAA,CAAAvH,GAAAC;IAChE,MAAA4H,gBAAgB;IACtB7H,IAAEsH,SAAQtH;IAChB,IAAaC,GAAA;QACCA,IAAAqH,SAAArH;QACJoH,cAAArH,IAAA6G,QAAAA,KAAAC,YAAAC,kBAAA9G,GAAA4G,MAAA;QACAQ,cAAApH,IAAA4G,QAAAgB,cAAAvB,KAAA,EACAO,MACAE,kBAAA/G,GAAA6G,OAAA;QAEA,KAAA,OAAAhB,OAAoBrB,aAAAqD,eAAA,KAAA,MAAAC,MAAAtD,UAAAoC,oBAAA5G,GAAA8H,IAAAjC;AAC9B;IACD,OAAA7F;AAAA;;AAmDkC,MAC/B+H,wBAAO,IAAAC,UA7CgC,CAAAC;yCAEOC;4CAClCA;IACP,MAAAC,MAAApG;QACD,YAAUyE,SAAA;YAGA,MAAA4B,QAAcC,SAAAC;YAG5B,IAAAF,OAA2B;gBAGfG,YAAeC,OAAAJ;gBACErG,UAAAoG,IAAApG,QAAAyE;AACL,mBAAA6B,SAAAI,YAAYjC,SAAAzE;AAClC;QACF,OAAAA;AAAA;IAEKsF,cAAAY,OAAApB;QACR,KAAA,MAAA9E,WAAA8E,KAAAC,WAAAyB,YAAAE,IAAAN,IAAApG,UAAAA,QAAAiE;AAAA;IAaU,OAAArG,MAAAC,KAAgC2I,cAA6B,GAAArC,WAAAwC;QAClE,MAAA3G,0BAA2CN,GAAAC,GAAAC,QAAA;YAC3CF;YAG2CC;YACnCC;;QAEC,OAAAiC,cAAA8E,UAAA3G,QAAAwD,YAAAxD,SAAAmE,SAAAlC,QAAAkC,SAAAnC;AAAA;AACT,EAEK4E,CAlDb,EAAA3I,MAAAC,MAAAwH,cAAAE,UAAAF,cAAAH,SAAAtH,QAAAC,IAkDa2I,IAAAZ;;AC/LR,MACAa,uBAAA;;AACL,MAAAC,uBAAA;;AAUO,MAAMC,YAAwB;;AAE9B,MAAMC,SAAsB;;AAE5B,MAAMC,QAAuB;;AAE7B,MAAMC,wBAAuB;IAE7BzH,GAA6B;IAE7BC,GAAuB;IAEvBC,GAAgC;;;ACpEvC,IAAAwH,wBAAe;;AACf,IAASC,eAAA;;AAEF,IAAAC,WAAiB;;AAEjB,IAAAC,2BAAkB;;AAElB,IAAAC,4BAAkB;;AAElB,IAAAC,4BAAiB;;AAEjB,IAAAC,8BAAqB;;AAErB,IAAAC;;AAEA,IAAIC,gBAAwB;;AAG5B,IAAAC,iBAAiC;;AAEjC,IAAIC,kBAAe;;AAEnB,IAAIC;;AAEJ,IAAIC;;AAeJ,MAAMC,oBAAmC;;AAI5C,MAAAC,WAAA,CAAArK,MAAkCsK,IAAAC,UAAA1J,KAAAb,MAAAsK,IAAA,oBAAA/K,KAAAiL,KAAAD,QAAAE;;AAiC/B,MAAgCC,cAAA,CAAAC,SAAAC;IAE5B,IAA8BC,WAAAZ,iBAAA;QAENA,kBAAAR,WAAAmB;QAERE,GAAAC,YAAAJ;AAEC;AAAA;;AAG1B,MAAIK,mBAA4B;IAC9B,MAAAC,wBAA6BnK,QAAAsI,OAAA,IAAA8B,YAAA9B,OAAA,IAAA8B;IAC7BrB,8BAAehJ,KAAAwJ,SAAAR,6BAAA,GAAA,IAAA7I,mBAAA6I,8BAAA,KAAAY,gBAAArB,OAAA,GAAA8B,aAAA9B,OAAA,GAAA+B;IACjBxB,4BAAA9I,KAAAwJ,SAAAV,2BAAA,GAAA,IAAA3I,mBAAA2I,4BAAA,KAAAc,gBAAAQ;IACFrB,4BAAA/I,KAAAwJ,SAAAT,2BAAA,GAAA,IAAA5I,mBAAA4I,4BAAA,KAAAa,gBAAAQ;IAEOjB,0BAA+BA,gBAAAZ,OAAA,GAAA+B,aAAA,KAAA,KAAA5K,IAAA,IAAA6I,OAAA,GAAA+B,cAAA;IACpCpB,wCAAsCD,iBAAwBjJ,KAAAkJ,gBAAsB,GAAA,MAAAU,iBAAA9J,QAAA8I,WAAA,IAAA;IAEtD,IAAAQ,mBAAAR,WAAAQ,iBAAA;QACUA,kBAAA;QACtCa,GAAAC,YAAmB;AACZ;IACT,IAAA3B,OAAA,GAAAgC,UAAAhC,OAAA,GAAA8B,aAAA,IAE4B,ID3DzB,KC2DyB3B,uBAAA;QAC1BmB,YAAoC,8CAAI;QACxCtB,OAAA,GAAAgC,SAA+C;AAAkB,WAAA,KACjEtB,gBAAA;QACFY,YAAA,2DAAAG;QAE4Bf,iBAAA;AAC1B;IAEA,KAAA,MAAAuB,SAAAlC,WAAAkC,MAAAC,YAAAD,MAAA9I,UAAA8I,MAAAC;IACF,KAAA,MAAAC,SAAAnC,QAAAmC,MAAAD;IAEA,KAAA,MAAAE,QAA0BnC,OAAAmC,KAAAF;AAAA;;AAEV,MACdG,8BAAA,MAAAC,GAAAX,YAAA,EACA,KACA,KACF,MAEI,OACgB,MACH,KACjB,aAGM,QACF,MACA,KACF,MACE,OACiB,SACnBxB,wBAAAF,MAAA1B,QAAA,CAAAgE,MAAAP,YAAAO,MAAAP,SAAA;;AAca,MACfQ,WAAA;IACFC,4BAAAC,KAAAC,UAAA,EAE2C3C,OAAA7E,KAAA,EAAA6G,YAAAA,qBAKb,EAAAA,YAAAA,UACxB1B,0BACFD,UACeO;AACf;;AA8BE,IACAS,gBApKkD;;AC5BxD,IAAAuB;;AAEA,MACEC,WAAA,CAAAnM,IAAAoM,QFgC8B;IE/B9B,MAAAC,gBAAAH;IACA,MAAAX,QAAA;QACA9I,SAAA9C;QACA2M,UAAAjD,UAAA/D;QAMA8G;QACKhF,WAAA;;IAELiC,UAAAzC,KAAAsF,mBAAAX;IACAvL,GAAAuL;IACAW,mBAAAG;IACA,OAAAd;AAAA;;AACA,MACAgB,UAAA,CAAAzH,UAAA0H,YAAA7M,UAAAwE,UAAA+H,iBAAA9E,UAAAR,QAAA/B,mBAAAC,UAAA0H,WAAArI;;AAAA,MACAsI,WAAAD;IACK,MAAA1F,UAAAoF;IAEP,MAAiCvJ,SAAA2G,OAAAhE;IACjC,MAAgCmG,QAAA;QAERH,QAAA;QACCF,YACnB;QACNC,aAAA;QAEWvE;QAEa0E,SAAA;YACA,OAAAF,QAAAF,YAAAC,eAAAI;YACD,MAAAiB,YAAA5F,QAAArE,QAAAkK,SAAAH;YACVf,MAAAmB,aAAAF;YACW,IArCxB,IAqCwB5K,cAAA4K,UAAA/H,kBAAA6E,0BAAAc,kBDLF,OCMlB,KAAAc,cAAAA,aAAA,KAAA;gBACYK,MAAAH,SAAAA,SAAA,IAAA;gBD+IZ,CAAAuB;oBACDA,cAAAjC,YAAA,aAAA;oBACHhB,2BAAAiD;;kBChJEC,CAAAnK;AACgB;YAEG8I,MAAAL,aAAAb,SAAAa,YAAAE,QAAA;YACZG,MAAAJ,cAAAd,SAAAc,aAAAC,QAAA;YACTG,MAAAhJ,UAAAiK,UAAAK,OAAA,KAAAtB,MAAAL,aAAA,IAAA,GAAA4B,cAAA,GAAA;AAAA;;IASE1D,OAAgB1C,KAAA6E;qBACK,IAAAe,UAAA9G,WAAA,IAAAqH,OAAA,IAAA,IAAAE,MAAA,IAAA,IAAA,KAAAC,SAAA,IAAA,IAAA;IACAX,QAAAhH,SAAA,IAAAiH,UAAA9G,UAAA,IAAAqH,OAAA,IAAA,IAAAE,MAAA,IAAA,IAAA,KAAAC,SAAA,IAAA,IAAA;IACnBX,QAAQhH,YAAAiH,UAAA9G,UAAA,QAAAuH,MAAA,IAAA,IAAA,KAAAC,SAAA,IAAA,IAAA;AAAA;;AACI,MACCC,UAAA,CAAAX,cAAAY;IACb,IAAAC,QAAA;IACA,WAAe;IACb,IAAAC,YAAQ;IACR,IAAAC,YAAkB;IAClB,IAAAC,QAAmB;IAGjB,IAAAC,QAAA;IAGI,IAAAC,YAAA;IACI,IAAAC,WAAA;IACN,MAAAjC,OAAA;QACFJ,QAAA;QACFE,SAAA;YAEmB,KAAAE,KAAAJ,QAAA;gBACC,IAAAsC,qBAAsB;gBACpC,IAAAC;gBACR,IAAAC,UAAA/C;gBACF,KAAA,MAAAgD,KAAAC,SAAA;oBACiB,OAAAjM,GAAAE,GAAAM,KAAAwL;oBAEC,MAAGE,sCAAwBC,UAAanM,GAAAoM,UAAUlM;oBAClD,MAAGmM;oBACDP,aAAoBtL,IAAA0L;oBAC1C,IAAAG,YAAA,KAAAN,UAAAM,WAAA;wBAEqFN,UAAAM;wBAC/DC,SAAAN;AACA;oBACkCH,qBAAAvN,IAAQuN,oBAAYK,WAAA1L;AACrD;gBACH,KAAAsL,UAAW;oBACjB,OAAA9L,GAAAuM,IAAArM,GAAAsM,IAAAhM,GAAAiM,MAAAH;oBACA,MAAAI,KAAAP,UAAAI;oBACD,MAAAI,KAAAP,UAAAI;oBACA,IAAAI,4BAAAlP,KAAAyC,MAAAuM,IAAAC;oBACK,IAAAE,wBAAAnP,KAAA6B,OAAAoN,IAAAD;oBACA,IAAAf,WAAA;wBACJJ,6BAAA7N,KAAAoP,WAAA,MAAApP,KAAAC,KAAA;wBACAiO,WAAAnN,IAAA,GAAAmN,YAAA,oBAAAlO,KAAAoP;AACG;oBAC0BD,SAAAtB;oBAEtBD,wBAAA5N,KAAA+B,IAAAoN;oBACTE,uBAAArP,KAAA8B,IAAAqN;oBACO,IAAAD,YAAA,IAAA;wBACKA,YAAAtO,IAAAsO,WAAAH,OAAAG,aAAA;wBACZT,UAAAO,KAAAE,YAAAL;wBACqBH,UAAAO,KAAAC,YAAAJ;AACX;AAEd;gBACsBb,YAAAG;gBACdF,WAAWpD,SAAKoD,UAAA,IAA6B,KAA7B,IAAgBC,qBAAc,IAAAA;iCACvBmB,OAAAb,UAAA3D,SAAA2D,SAAAA,UAAAb,MAAAM,WAAAA;gBACLqB,QAAAzE,SAAAyE,OAAAb,UAAA5D,SAAA4D,SAAAA,UAAAW,MAAAnB,WAAAA;gBACpBJ,YAAiB9L,mBAAqB8L,2BAAA9N,KAAA6B,MAAAyN,QAAAvB,OAAAwB,QAAAvB,SAAAjO,aAAA,KAAA,IAAAmL;gBAC9B6C,QAAAuB;gBACDtB,QAAAuB;gBACX,MAAAC,WAAAvD,KAAAjJ,UAAAyM,YAAAzM,QAAAkK,SAAAH,UAAA9G,UAAAqJ,OAAA,GAAAC,OAAAG,WAAA,GAAA5B,2BAAA,IAAA9N,KAAA8B,IAAA,MAAAoI,aAAAhF;gBACqB,IA3H4B,OA2H5B7C,cAAAmN,SAAwBzF,wBAAY;oBAC3DkC,KAAAJ,SAAA;oBDuCC;wBACLV,YAAA,EACA,EAC2B,2CAC3B,EACiB,sEAEb,qDACF,mDACF,wBAAA,EAEF,8BACF,4BAEO,EACQ,wGACsB,iEAAAnB,yBAAA,KAAAA,wBAAA,IAAA;;;;ACpDnB;AACR;YACMiC,KAAKJ,WAAUI,KAAAjJ,UAAA4G,UFxFY,GEwFZ5G,QAAAiD,UAAA/C,SAAA,IAAA,MAAA,sBAAAlD,KAAA8B,IAAAoI,WAAAhH,UAAA,IAAA,GAAA,OAAAA,SAAA,IAAA,KAAAA,MAAAlC,IAAAkC,SAAA,IAAA,qBAAAlD,KAAA+B,IAAAmI,WAAA,MAAAhH,UAAA;AAAA;;IAGrB,MAAAuM,cAAehD;IACb,MAAAvJ,SAAA4G,MAAAjE;IACA,MAAA0I,UAAAZ,YAAkB3I,KAAA,EAAA1C,GAAAE,GAAgBM,QAAA;QACpCR;QACSE;QACFM;;IAEP,IAAA8L;IAEE,KAAAtM,GAAAmM,SAAAjM,GAAgBkM,WAAWE;IAC3B,IAAAU,QAAAb;IACA,IAAAc,QAAAb;IACF5E,MAAA3C,KAAA8E;AAAA;;AASF,MAAYwB,WAAAkC,WAAA,CAAAC,GAAAC,GAAA/O,GAAAD,IAAA,MAAA,MAAAA,KAAA,KAAA,MAAAC,KAAA,KAAA,MAAA+O,KAAA,IAAA,MAAAD;;AC1JpB,MAAAE,yCAA8C;IAE5C,MAAAC,gBAAA1P,aAAA2P,KAAArP,KAAAT,SAAA+F,0BAAAjG,KAAA8B,IAAAnB,IADF,KACEX,KAAAC,KAAAU,IADF,IACE2M,OAAA3M,IADF,KACE,IAAA6M,MAAA,SAAA7M,IADF,IACE,GAAA,IAAAA,IADF;IAEE,MAAAsP,eAAA5P,aAFF,KAEEM,KAAA8E,eAAAX,kBAAAQ,gBAAA,KAAAyK,cAAApP,IAAAyF,WAAAtB,kBAAAQ,gBAAA,KAAAyK,cAAApP,IAAA,KAAA,KAAAuP;IACAxD,UAAA,MAAAI,QAAA,EACAtI,MAAA2L,MAAA,MACAjQ,SAAA+F,WAAA,GAAAC,QAAA,GAAAoH,OAAA,IAAA,MHyBiC;IGxBjCZ,UAAA;QACA,MAAA0D,yBAAA,CAAA9N,GAAAC,GAAAC,MAAAtC,SAAA+F,UAAA3D,oBAAAtC,KAAA8B,IAAAoI,WAAA,KAAA,GAAA3H,oBAAAvC,KAAA8B,IAAA,KAAAoI,YAAA,GAAA1H,GAAAkN,2BAAA,IAAA1P,KAAA8B,IAAAoI,2BAAAlK,KAAA8B,IAAA,KAAAoI,gCAAApI,IAAA,KAAAoI;QAEK,MAAAmG,qBAAAC,UAAA1H,sBAAAxD,mBAAAU,YAAA5F,SAAA+F,UAAA,IAAAqK,SAAA,GAAA9C,MAAA,GAAA8C,SAAA,GAAA,OAAAlL,mBAAAU,YAAA5F,SAAA+F,UAAA,IAAAqK,SAAA,IAAA,GAAA9C,MAAA,GAAA8C,SAAA,GAAA,KAAAlL,mBAAAU,SAAA,IAAA,IAAA5F,SAAA+F,UAAA,GAAAqK,SAAA,IAAA,GAAAhD,OAAA,IAAA,GAAA,IAAApH,QAAA;kCAC0C,MAAAtF,IAAAiJ,OAAA,GAAA+B,aAAA,IAAA/B,OAAA,GAAA+B;QACjD,MAAA2E,gBAAA,CAAAC,MAAAC,WAAAC,OAAAhE,UAAAZ;YACEA,MAAAC,UAAA,MAAA7L,SAAA+F,UAAA0K,sCAAA3Q,KAAA8B,IAAA,IAAA0O,OAAAtG,WAAAsG,QAAAC;YACAjM,MAAAQ,KAAA,EAAA1C,GAAAE;gBACAsK,QAAAhH,SAAA,IAAA,IAAA5F,SAAA+F,UAAA,IAAA3D,GAAA,GAAAoO,KAAA,IAAAlO,GAAAgL,MAAA,IAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;gBACAX,QAAAhH,YAAA5F,SAAA+F,UAAA,IAAA3D,GAAA,GAAAoO,KAAA,IAAAlO,GAAAgL,MAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;YAEAX,QAAAlE,sBAAAxD,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAA,GAAAyK,IAAAlD,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,SAAA,GACA,GACA,IACAzI,KAAArE,KAAAyE,mBAAAU,YAAA5F,SAAA+F,UAAA,IAAAtF,GAAA,IAAA+P,IAAApD,QAAA,KAAA3M,GAAA6M,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YACAX,QAAAhH,YAAA5F,SAAA+F,UAAA,IAAA,GAAAyK,IAAAlD,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;QAGF,MAAAmD,oBAAA,MAAAxP,QAAA,IAAA,IAAAuP,uBAAApP,QAAAsI,OAAA,GAAA8B,YAAA9B,OAAA,GAAA8B;QACE,MAAAkF,kBAAA,MAAAtP,QAAAsI,OAAA,GAAA+B,aAAA/B,OAAA,GAAA+B;QACA,MAAAkF,iBAAA,MAAAvP,QAAAsI,OAAA,IAAA8B,YAAA9B,OAAA,IAAA8B;QAEA,MAAAoF,wBAAA,MAAAxP,QAAAsI,OAAA,GAAA+B,aAAA/B,OAAA,IAAA+B;QACA,MAAAoF,eAAApI,sBAAAxD,mBAAAU,SAAA,IAAA,GAAA,MAAA,IAAA5F,SAAA+F,UAAA,OAAAuH,MAAA,KAAA,GAAA,MAAAC,SAAA,IAAA,IAAA,KAAA,MAAArI,mBAAAU,SAAA,IAAA,GAAA,KAAA,IAAA5F,SAAA+F,UAAA,IAAA,KAAAuH,MAAA,KAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,KAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,IAAA,KAAAC,QAAA,IAAAuH,SAAA,IAAA,IAAA,KAAA;QACA,MAAAwD,mBAAA5Q,aAAA,IAAAM,KAAAyE,mBAAAU,SAAA,GAAA,IAAA5F,SAAA+F,UAAA,KAAAtF,IAAA,IAAA,KAAA,GAAA6M,MAAA,IAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,QAAAyC;QACKxD,UAAAZ;YAGcA,MAAAC,UAAA,MAChBqE,4BAAqC,KAAA,KAAA5F,gBAAA;YACxBsC,QAAAkE;YACRhE,SAAA9M,mBAA0C,IAAA,GAAA;AAAA;QAE9C8M,SAAA9M,SAAA+F,WAAA,KAAA,UAAAqH,OAAA,IAAA;QAEII,QAAAxN,SAAA+F,WAAA,IAAA,WAAA,EAAC,MAGE,OACT,EACF,IACoB,GAEE;QACpByH,QAAAxN,SACa+F,UAAA,GAAA,MAAA,EAGf,GAEqB,IAAa,KAChC,UAGE,QACFX,gBAAA,IAAAN,KAAA,EAAA1C,GAAAE,OAAA,EACK,IAAAF,QAIEE,GAEM,MAAA,IAAAxB,IAAAsB;QAMPwK,QAAAhH,YAAA5F,SACJ+F,eAAA,KAAA,IAAAuH,MAAA,KAAA,GAAA,KAAA0D,MAAA,IAAAzD,SAAA,IAAA,IAAA,IAAA;QACqBjJ,MAAAQ,KAAA,EAAA1C,GAAAE,OAAAsK,QAAYhH,sBAAgCG,UAAS,IAAN3D,GAAM,GAAY,KAAAE,GAAAgL,MAAM,IAAC,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;WAE3F,IACE,KAEGzI,KAAAxC,KAAAsK,QAAUhH,YAAY5F,SACtB+F,UAAW,GAAK,GAChBzD,SAAS,GAAA,GAAA,IAAAiL,SAAA,IAAA,IAAA,IAAA;QACd,GACF,IAEmB,KACnBzI,KAAA,CAAAxC,GAAA7B;YACWmM,QAAAhH,YAAc5F,SAAA+F,UAAA,GAAA,KAAAzD,GAAAgL,MAAA,GAAA,IAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YACvBX,oBAAwB5M,SAAQ+F,UAAW,GAAA,GAAAzD,GAAAgL,MAAA,GAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;YAClCf,UAAKZ;gBAChBA,MAAAC,UAAA,MAAA7L,SAAA+F,UAAA,GAAA,GAAAzD,GAAAgL,MAAA,GAAApM,QAAA,OAAAyI,OAAAlJ,IAAA,GAAAgL,aAAA;gBACAmB,QAAAmE;AAAA;AACW;QAET5Q,aAAS,IAAUM,KAAAN,aAAS,IAAA8Q,KAAArE,QAAAmD,cAAA/P,SAAA+F,UAAA,QAAAkL,IAAA,KAAA,GAAA,MAAAxQ,IAAA,KAAA2M,OAAA,GAAA,MAAA,MAAA6D,GAAA3D,MAAA,KAAA,IAAA,MAAAC,SAAA,GAAA,GAAA,IAAA;QAC9BX,QAAAhH,YAAA5F,SAAA+F,UAAA,GAAA,UAAAuH,MAAA,IAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;4BAC4BvN,SAAG+F,iBAAsB,KAAA,IAAIuH,MAAU,GAAA,QAAaF,OAAA,IAAU,KAAAG,SAAU,KAAA,KAAA,KAAA;QACtGX,QAAAhH,SAAA,IAAA5F,SAAA+F,WAAA,KAAA,IAAA,IAAAuH,MAAA,GAAA,GAAA,GAAAF,OAAA,IAAA,KAAAG,SAAA,IAAA,IAAA,IAAA;QAEyBX,QAAAhH,YAAA5F,SAAAoN,OAAA,GAAA,IAAArH,UAAA,OAAA,OAAA,GAAAqH,QAAA,IAAAE,MAAA,GAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QAAaX,QAAAlE,sBAAAJ,UAAApD,mBAAAU,SAAA,GAAA,GAAA,GAAA,KAAA5F,SAAA+F,UAAA,IAAA,IAAA,GAAAuH,MAAA,IAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,IAAA,GAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,GAAA,GAAA,GAAA,KAAA5F,SAAA+F,UAAA,IAAA,KAAAuH,MAAA,IAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA,OAAArI,mBAAAU,SAAA,IAAA5F,SAAAsN,MAAA,GAAA,IAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,GAAA,GAAA,MAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,KAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAAoN,OAAA,GAAA,IAAArH,UAAA,IAAA,KAAA,GAAAqH,QAAA,IAAAE,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,KAAA,KAAA,GAAAuH,MAAA,KAAA,GAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QACpCf,UAAAZ;YACEA,gBAAa,MAAA5L,SAAA+F,UAAA,GAAA4D,OAAA,GAAA8B,aAAA,uBAAA,IAAA3L,KAAA+B,IAAA,MAAAmI,YAAA,KAAAL,OAAA,GAAA+B,eAAA,IAAA/B,OAAA,GAAA8B,eAAA,MAAA,IAAA9B,OAAA,GAAA8B,oBAAA;YACbmB,QAAmBhH,SAAA,IAAS5F,SAAU+F,UAAG,QAAWuH,MAAM,GAAA,GAAA,IAAAC,SAAA,IAAA,KAAA,IAAA;YAC1DT,SAAc9M,SAAS+F,UAAA,GAAA;AAAA;QAEpB+G,SAAA9M,SAAA+F,UAAA,KAAA,GAAA;QAIasK,cAAA,IAAA,IAAA;;QAElB7D;YACAZ,MAAoBC,UAAA,MAAA7L,SAAA+F,UAAA0K,sCAAA3Q,KAAA8B,IAAAoI,WAAA,MAAA,KAAA;YAGF4C,QAAAlE,sBAAkBJ,UAACpD,mBAAAU,YAAA5F,SAAAsN,MAAA,KAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAAsN,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,IAAA,GAAAuH,MAAA,GAAA,KAAA,MAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA,GAAA,GAAA,IAAA5F,SAAAsN,MAAA,GAAA,GAAA,KAAAF,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA,OAAArI,mBAAAU,YAAA5F,SAAAsN,MAAA,KAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA,OAAAvN,SAAA+F,UAAA,GAAA,GAAA;YACtCyH,QAAAxN,SAAA+F,UAAA,GAAA,KAAA,KAAA,EAGQ,GAKQ,GAGjB;AACE;QAEK6G,QAAKhH,YAAA5F,SAAA+F,UAAA,OAAA,UAAA,IAAAuH,MAAA,MAAA,KAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QACVf;YACFZ,MAAAC,UAAA,MAAA7L,SAAA+F,UAAA,OAAA,IAAA0K;YAIQ7D,QAAAhH,SAAqB,IAAA5F,SAAA+F,WAAoB,UAAW,MAAKuH,MAAM,OAAQ,eAAkB,IAAA,IAAU,IAAA;YAGrGV,QAAAhH,SAAA,IAAA5F,SAAA+F,WAAA,UAAA,MAAAuH,MAAA,KAAA,KAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;YAAUX,QACdhH,YAAQ5F,SAAa+F,WAAS,KAAA,GAAU,IAAIuH,MAAM,KAAM,KAAQ,IAAAC,SAAQ,IAAM,IAAA,IAAc;YAC9FX,QAAAhH,YAAA5F,SAAA+F,WAAA,KAAA,KAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YAGQT,SAAa9M,SAAA+F,WAAoB,KAAA,IAAS;AAAA;QAIhDyG;YAEAZ,gBAAoB,MAAA5L,mBAAyB,GAAG0Q,sCAAqB5Q,KAAA8B,IAAmB,mBAAS;YAEjGgL,QAAoBhH,YAAA5F,SAAA+F,WAAA,QAAA,GAAA,IAAAuH,MAAA,MAAA,KAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;YAClBX,8BAAyC1H,mBAAeU,qBAAkB0H,MAAA,QAAe,OAAApI,mBAAcU,YAAA5F,SAAAsN,MAAA,KAAA,GAAA,QAAAtN,SAAA+F,WAAA,KAAA,GAAA,KAAAwH,SAAA,IAAA,IAAA,IAAA;AAAA;QAExGf,UAAAZ;YACFA,MAAAC,UAAA,MAAA7L,SAAA+F,UAAA,GAAA,GAAA2K,sCAAA5Q,KAAA8B,IAAA,KAAAoI,YAAA;YAID4C,QAAAlE,sBAAAxD,mBAAAU,YAAA5F,SAAA+F,gBAAA,GAAA,IAAAuH,MAAA,GAAA,KAAA,MAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,WAAA,KAAA,GAAA,IAAAuH,MAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YAAaX,QAAAhH,YAAA5F,SAAA+F,WAAA,KAAA,GAAA,IAAAuH,MAAA,GAAA,KAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;QACEf,UAAAZ;YACXA,MAAAC,UAAA,MAAA7L,SAAA+F,UAAA,IAAA,MAAA4D,OAAA,GAAA+B;YACEkB,QAAAhH,SAAA,IAAA5F,SAAA+F,WAAA,MAAA,GAAA,IAAAqH,OAAA,IAAA,IAAAA,OAAA,GAAA,IAAAE,MAAA,KAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;QAKST,SAAA9M,SAAM+F,WAAQ,KAAA,KAAA,IAAAqH,OAAA,GAAA;QACzBR,QAAAhH,SAAA,IAAA5F,SAAA+F,WAAA,YAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QACFX,QAAAhH,SAAA,IAAA5F,SAAA+F,WAAA,UAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QACF,MAAA2D,sBAAA,oCAE0ClR,SAAU+F,UAAW,IAAG,GAAIuH,MAAA,IAAA,SAAmBC,aAAS,IAAA,IAAA,SAGlG7E,sBAAAxD,mBAAAU,SAAA,IAAA5F,SAAAoN,OAAA,IAAAE,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,GAAA,GAAA,MAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,IAAA,GAAA,KAAAF,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAAoN,OAAA,IAAAE,MAAA,GAAA,IAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,SAAA,EACW,GACA,IACA,IACXzI,KAAA1C,KAAA8C,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA3D,GAAA,KAAAgL,OAAA,IAAA,GAAA,IAAAE,MAAA,KAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QAKAX,QAAAsE,qBAAAlR,SAAA+F,WAAA,IAAA,GAAA;QACWyG,UAAAZ;kBACOC,UAAK,MACF7L,SAAQ+F,WAAA,KAAA,IAAA4D,OAAA,GAAA+B,gBAAA,IAAA/B,OAAA,GAAA8B,cAAA,GAAA,IAAA2B,OAAA,OAAA,IAAAzD,OAAA,GAAA+B,eAAAtB,6BAAA;YAK7BwC,QAAAsE;AAAA,YH5J0B;QG8JtBtE,QAAAhH,YAAA5F,SAAA+F,kBAAA,KAAA,IAAAqH,QAAA,IAAAE,MAAA,GAAA,MAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QAEEX,QAAAhH,SAAA,GAAA,IAAA,KAAA5F,SAAA+F,WAAA,OAAA,KAAA,IAAAqH,OAAA,QAAA,IAAAE,MAAA,GAAA,MAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QACWX,QAAAlE,sBAAYJ,UAAApD,mBAAAU,YAAA5F,SAAA+F,WAAA,MAAA,KAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,WAAA,MAAA,KAAA,IAAAuH,MAAA,KAAA,KAAA,GAAA0D,MAAA,IAAAzD,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,WAAA,MAAA,KAAA,IAAAuH,MAAA,GAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,WAAA,KAAA,KAAA,IAAAqH,OAAA,GAAA,IAAAE,MAAA,GAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,WAAA,QAAA,KAAA,OAAAuH,MAAA,GAAA,KAAA,GAAAF,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,WAAA,MAAA,KAAA,OAAAqH,QAAA,IAAA,GAAAE,MAAA,GAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,WAAA,KAAA,KAAA,IAAAuH,MAAA,GAAA,KAAA,MAAAC,SAAA,IAAA,IAAA,IAAA,OAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,WAAA,MAAA,GAAA,IAAAuH,MAAA,GAAA,IAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,WAAA,MAAA,GAAA,IAAAuH,MAAA,GAAA,IAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,WAAA,MAAA,GAAA,IAAAuH,MAAA,IAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;QACrBC,QAAAxN,oBAA8B,KAAA,IAAA,KAAU,EACxC,GACF,UAMA,GACE,GACA,GACA,OACF,GACF,IAEmB,GAGnB,OACE,GACA,IACS,GACX;QAGAwN,QACWxN,SAAA+F,WAAA,IAAA,IAAA,KAAA,KAEA,GACX;QAGA6G,8BACY1H,mBAAAU,YAAA5F,SAAA+F,WAAA,KAAA,GAAA,IAAAuH,MAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,WAAA,KAAA,GAAA,IAAAuH,MAAA,GAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA,IAAA5F,SAAA+F,gBAAA,GAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAF,OAAA,IAAA,IAAAG,SAAA,IAAA,IAAA,IAAA;QACVf,UAAAZ;YACSA,MAAAC,UAAU,MAAA7L,SAAQ+F,WAAA,YAAA,MAAAuH,MAAA,GAAApM,QAAA,MAAAyI,OAAA,GAAA8B,aAAA;YAC7BmB,QAAAmE;AAAA;QAEJzM,MAAAQ,KAAA,EAAA1C,GAAAE;YAIoBsK,QAAAhH,SAAA,IAAA5F,SAAA+F,UAAA,IAAA3D,IAAA,MAAA,GAAA,IAAAE,IAAA,IAAAgL,MAAA,GAAA,MAAAC,SAAA,IAAA,KAAA,KAAA;YACZ,EAEF,SAMAzI,KAAArE,KAAAmM,QAAAhH,SAAA,IAAA5F,SAAA+F,UAAA,IAAA3D,IAAA,KAAA3B,GAAA,IAAA6B,IAAA,IAAAgL,MAAA,KAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;yBAEc9M;YAGAmM,QAAAhH,UAAU,KAAVnF,IAAa,KAAI,IAAA,GAAA,GAAA,MAAAT,SAAA+F,0BAAA,IAAAjG,KAAA8B,IAAAnB,KAAA,MAAAA,IAAA,MAAAA,GAAA,OAAA,MAAAA,GAAA0Q,UAAA,IAAA1Q,IAAA,GAAA,IAAAA,IAAA,GAAA,IAAAA,IAAA,IAAA8M,SAAA,KAAA9M,IAAA,IAAA,MAAA,IAAAA,KAAA,GAAA,IAAA;AAAA;QAIrCmM,QAAkBhH,YAAA5F,SAAc+F,WAAM,KAAA,KAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QAIhCX,QAAAhH,SAAA,IAAA5F,SAA8B+F,qBAAwB,IAAAuH,MAAW,GAAA,GAAA,IAAeC,SAAA,IAAA,IAAA,IAAA;6BAE/D,IAAcvN,oBACnC,QAAU,IAAUsN,MAAA,KAAA,GAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QAClBT,SAAgB9M,SAAA+F,WACL,KAAA,KAAU;QACrByG,UAAaZ;YAEXA,MAAAC,UAAA,MAAA7L,SAAA+F,UAAA,GAAA,OAAA,IAAAlF,IAAA8I,OAAA,GAAA8B,YAAA9B,OAAA,GAAA8B,eAAAkF,oCAAA7Q,KAAA8B,IAAAoI,YAAA;YACE,EACS,GACA,IACX,KAEQlF,KAAA1C,KAAAwK,QAAqBhH,YAAA5F,SAAiB+F,UAAQ3D,IAAI,MAASA,KAAA,KAAS,IAAA,IAAAkL,WAAmB,KAAA,aAAS,IAAA,IAAA,IAAA;AAAA;QAG1Gd,UAAAZ;YACEA,MAAAC,UAAA,MAAA7L,SAAA+F,UAAA,GAAA4K,yCAAA/O,IAAAoI,WAAA,KAAA,mBAAA,SAAApI,IAAA,KAAAoI,WAAA,KAAA2G;cAEU,GACN,KACE7L,KAAS1C,KAAAwK,QAAAhH,YAAA5F,SAAA+F,UAAA3D,IAAA,MAAAA,KAAA,KAAA,IAAA,IAAAkL,MAAA,KAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;QAIOX,QACPlE,sBAAeJ,UAAGpD,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,OAAAuH,MAAA,GAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAAsN,MAAA,GAAA,KAAA,IAAAC,SAAA,GAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAAsN,MAAA,IAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA,OAAArI,mBAAAU,SAAA,IAAA5F,SAAAsN,MAAA,KAAA,GAAA,MAAAC,SAAA,GAAA,IAAA,IAAA,OAAAvN,SAAA+F,WAAA,OAAA,MAAA;QAC7B+G,SAAA9M,SAAA+F,WAAA,OAAA,KAAA;QACFyG,UAAAZ;YACFA,MAAAC,UAAA,MAAA7L,SAAA+F,UAAA,IAAA,MAAA4D,OAAA,GAAA+B;YACFkB,QAAAlE,sBAAAJ,UAAApD,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,GAAA,GAAA,GAAA8D,MAAA,IAAA7D,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,KAAA,GAAA,KAAA8D,OAAA,IAAA7D,SAAA,KAAA,KAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,IAAA,GAAA,IAAA8D,MAAA,IAAA7D,SAAA,KAAA,IAAA,IAAA,OAAArI,mBAAAU,SAAA,IAAA5F,SAAAsN,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,KAAA,KAAA,GAAAF,OAAA,IAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA,OAAAvN,SAAA+F,WAAA,OAAA,MAAA;YAEAyH,iBAAoBzH,sBAA0B,IAAIqH,OAAS,QAAOhI,gBAAmB,IAAAN,KAAA,KAASxC,OAAA,EAC/F,IAAAF,OAEWE,GACA;AAGM;QAElBgC,MAAAQ,KAAA,EAAA1C,GAAAE;YACEsK,QAAAhH,SAAA,IAAA,IAAA5F,SAAA+F,UAAA,IAAA3D,IAAA,OAAA,KAAA,KAAAE,IAAA,IAAAgL,MAAA,GAAA,IAAAC,SAAA,KAAA,KAAA,KAAA;YACE,EACqB,KACA,sBACA3H,SAAS,iBAAsBG,UAAO,IAAF3D,IAAQ,YAAc,KAAAE,IAAA,cAAmB,GAAKD,IAAI,GAAAiL,MAAA,KAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;QAE9FX,QAAAlE,sBAAWJ,UAAApD,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,IAAA,IAAAuH,MAAA,IAAA,KAAA,KAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAA,IAAA,IAAAuH,MAAA,GAAA,KAAA,IAAAC,SAAA,KAAA,IAAA,IAAA,UAAApN,aAAA,IAAAmC,KAAAnC,aAAA,IAAAiC,KAAA8C,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,MAAA3D,IAAA,KAAA,KAAA,IAAAE,IAAA,GAAA,MAAAA,IAAA,qBAAA,IAAAxC,KAAA8B,IAAA,IAAAQ,IAAAkL,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,SAAAyC,SAAAhQ,SAAA+F,WAAA,OAAA,MAAA;QACpByH,QAAAxN,oBAA0B,OAAA,WAAY,GAAA,IAExC,KACF,KACmB,EACrB,IACS,GACX,KAGQ,EACT,IAEyB,GAKlB;yBAKgB,IAAAA,oBAAwB,KAAA,GAAA,IAAAsN,MAAA,GAAkB,IAAK,GAAGF,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,KAAA;0BAEtDxH,WAAsB,KAAA,IAAA,IAAKqH,OAAU,GAAA;QACvDZ;YACAZ,gBAAoB,MAAAsE,6BAAgC,KAAW,WAAA3F;YAC/DqC;YAEkBE,SAAA9M,SAAA+F,UAAe,IAAA,OAAWqH,OAAA,GAAA;AAAA;QAKpC,MAAAiE,aAAU3I,sBAAAxD,mBAAAU,YAAA5F,SAAA+F,UAAA,IAAA,IAAA,GAAAuH,MAAA,MAAA,KAAA,MAAAC,SAAA,KAAA,KAAA,KAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,SAAAuH,MAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,SAAA,GACZ,KAEN,MAEAzI,KAAArE,KAAAyE,mBAAAU,YAAA5F,SAAA+F,UAAAtF,IAAA,IAAA,GAAA6M,MAAA,KAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,GAAA;QACEf,UAAAZ;YACEA,MAAAC,UAAA,eAA+B9F,iBAAkB6K,mBAAS9P,oBAAAhB,KAAA8B,IAAA,MAAAoI,oBAAA;YAC1D7J,aAAA,IAAmBiC,aAAYiP,qBAAoBtL,UAAO,IAAA3D,IAAA,OAAA,IAAAA,IAAA,MAAA;AAAA;QAE5DoK,UAASZ;YACAA,MAAAC,UAAU,MAAK7L,SAAG+F,UAAA,OAAA6K,mBAAA9P,oBAAAhB,KAAA8B,IAAA,MAAAoI,oBAAA;YAC7B7J,aAAA,IAAAiC,KAAAwK,QAAAyE,YAAArR,SAAA+F,UAAA,KAAA3D,IAAA,KAAA,OAAA,IAAAA,IAAA,MAAA;AAAA;QAKFoK,UAAoBZ;YACFA,MAAAC,UAAM,MAAS7L,SAAA+F,UAAa,IAAqB,UAAAlF,KArVrE,IAAA8I,OAAA,IAAA8B,eAAA,IAAAmF,mBAqV8EA,mBAAI9P,oBAAWhB,KAAA8B,IAAQ,MAARoI,cAAQ;YACjG7J,aAAA,IAAAiC,KAAAwK,QAAAyE,YAAArR,SAAA+F,UAAA,IAAA3D,IAAA,KAAA,MAAA;AAAA;QAEIwK,QAAAlE,sBAAAJ,UAAApD,mBAAAU,YAAA5F,SAAA+F,UAAA,OAAA,KAAA,IAAAuH,MAAA,IAAA,MAAA,KAAApI,mBAAAU,YAAA5F,SAAA+F,UAAA,OAAA,IAAA,IAAAuH,MAAA,IAAA,GAAA,UAAAnN,aAAA,IAAAiC,KAAA8C,mBAAAU,YAAA5F,SAAA+F,UAAA,KAAA,IAAA3D,KAAA,IAAAA,KAAA,IAAA,GAAAkL,MAAA,MAAA,MAAA,UAAAnN,aAAA,IAAAiC,KAAA8C,mBAAAU,YAAA5F,SAAA+F,UAAA,KAAA,IAAA3D,IAAA,IAAA,GAAAkL,MAAA,MAAA,MAAA,QAAAtN,SAAA+F,WAAA,KAAA,IAAA,KAAAwH,SAAA,IAAA,IAAA,IAAA;QACWT,SAAA9M,SAAA+F,WAAA,MAAA,UAAAqH,OAAA,GAAA;QACTR,QAAAhH,qBAAwBG,iBAAyB,MAAA,IAAAuH,MAAA,KAAA,KAAA,GAAA0D,MAAA,IAAAzD,SAAA,IAAA,IAAA,IAAA;QAAAX,QACxChH,SAAA,IAAU5F,SAAQ+F,WAAA,YAAA,MAAAuH,MAAA,KAAA,IAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QAC7BX,QAAAhH,YAAA5F,SAAA+F,WAAA,QAAA,SAAAuH,MAAA,IAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QAAAX,qBACmB5M,SAAS+F,sBAAsB,GAAAuH,MAAS,GAAE,IAAQ,IAAAC,SAAO,IAAA,QAAmB;QACjGX,QAAAhH,SAAA,IAAA5F,SAAA+F,WAAA,UAAA,GAAAuH,MAAA,GAAA,IAAA,IAAAC,SAAA,GAAA,GAAA,GAAA;QACFX,QAAAhH,YAAA5F,SAAA+F,WAAA,KAAA,WAAAuH,MAAA,KAAA,IAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;yBAEoB9M;YACrBmM,QAAAuD,mBAAA,KAAAnQ,SAAA+F,UAAA,KAAAtF,IAAA,MAAA,IAAA,KAAA8M,SAAA,IAAA,IAAA,IAAA;YAImBX,QAAAuD,mBAAA,KAAAnQ,SAAA+F,WAAA,KAAA,IAAA,KAAAtF,IAAA,IAAA,IAAA2M,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA;AAAA;QAElBX,QAAAlE,sBAAAxD,mBAAAU,SAAA,KAAA5F,SAAA+F,WAAA,KAAA,OAAA,IAAAuH,MAAA,GAAA,MAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,eAAA,KAAA,IAAAuH,MAAA,KAAA,GAAA,MAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,WAAA,IAAA,SAAAuH,MAAA,KAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,KAAA5F,SAAA+F,eAAA,MAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;4BACYvN,SAAA+F,kBAAA,MAAA,IAAAqH,OAAA,IAAAE,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QACVX,iBAAmB,IAAA5M,SAAU+F,WAAW,YAAe,IAAGuH,MAAU,KAAA,YAAaC,SAAA,IAAA,IAAA,IAAA;QACxEX,QAAAlE,sBAAkBxD,mBAAAU,YAAA5F,SAAA+F,WAAA,WAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,gBAAA,MAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QAC7BT,SAAA9M,SAAA+F,WAAA,KAAA,UAAAqH,OAAA,GAAA;QACDI,QAAAxN,SAAA+F,WAAA,KAAA,UAAA,EAEQ,GAED,GACA;QAKgByH,QAAAxN,SAAA+F,WAAY,KAAA,QAASqH,OAAA,MACxC,OAED,OACE,EACS,GACA,GACX;QAEAR,QAAOlE,sBAAOJ,UAAApD,mBAAAU,SAAA,GAAA,GAAA,GAAA,KAAA5F,SAAA+F,WAAA,KAAA,IAAA,OAAAuH,MAAA,GAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,kBAAA,IAAA,MAAAuH,MAAA,MAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,OAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,WAAA,KAAA,IAAA,KAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QAAApN,aACZ,IAAAM,KAAA+L,UAAAZ;kBACYC,UAAA;gBACD,MAAAyF,MAAaT;gBACH,OAAA7Q,SAAK+F,WAAGtF,IAAA,IAAA,KAAA,IAAA6Q,OAAAA,MAAA,KAAA,KAAAA,2BAAA1P,IAAA,MAAAoI,WAAA,MAAAvJ,MAAA,IAAAA,IAAA,KAAA,KAAA,IAAAA,KAAA,IAAA,MAAA,IAAAkJ,OAAA,GAAA+B,gBAAA,IAAA/B,OAAA,IAAA+B,gBAAA,IAAA7K,IAAA,KAAAyQ,4BAAAzP,IAAA,MAAAmI,WAAA,IAAAvJ,MAAA,IAAA,KAAA,IAAAA,IAAA,MAAA;AAAA;YAE/BmM,QAAAhH,SAAA,IAAA5F,SAAA+F,WAAA,OAAA,MAAAtF,KAAAA,IAAA,IAAA,IAAA,KAAAA,IAAA,MAAA,MAAA6M,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA9M,IAAA,GAAAA,IAAA,KAAA,IAAA,IAAA;AAAA;QAEJ+L,UAAAZ;YAEQA;gBAIY,MAAA0F,MAAAT;uBACI7Q,SAAA+F,UAAA,OAAA,IAAAuL,OAAA,QAAA,KAAA,IAAA3H,OAAA,GAAA8B,cAAA6F,2BAAA1P,IAAA,KAAAoI,aAAA,IAAA,KAAA,MAAAwF,2BAAA1P,KAAA+B,IAAA,MAAAmI,aAAA,IAAAsH,MAAA,IAAA;AAAA;YAItB1E,QAAAlE,sBAAAxD,mBAAAU,SAAA,KAAA5F,SAAAsN,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,KAAA5F,SAAAsN,MAAA,KAAA,GAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;YAC2BX,QAAAhH,SAAA,IAAA,IAAA5F,SAAA+F,WAAA,KAAAqH,OAAA,GAAA,IAAAE,MAAA,GAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YACMX,QAAAhH,SAAA,KAAA5F,SAAA+F,WAAA,KAAAqH,OAAA,GAAA,IAAAE,MAAA,GAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YAInCX,QAAAhH,SAAA,IAAA5F,SAAA+F,WAAA,KAAAqH,OAAA,GAAA,IAAAE,MAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YACWT,SAAA9M,SAAA+F,WAAA,KAAAqH,OAAA,GAAA,IAAArH,UAAA,GAAA,KAAAqH,OAAA,GAAA;YACA,GACA,GACX,IAEAtI,KAAArE,KAAAmM,QAAAmD,cAAA/P,SAAAoN,OAAA,MAAA3M,GAAA,KAAA,IAAAsF,UAAA,GAAA,GAAAqH,OAAA,IAAAE,MAAA,KAAA,IAAA,MAAAC,SAAA,GAAA,GAAA,IAAA;YACEC,QAAYxN,SAAO+F,WAAA,GAAA,IAAA,EACV,IACA,KACX,OAIA,EACE,GACE,KAEE;AACW;QACuC,GAElD,GAEA,IAAAjB,KACW1C;YACAwK,QAAAhH,SAAA,IAAgB,IAAA5F,SAAQ+F,WAAQ,MAAU3D,IAAG,KAAM,KAAC,IAAAkL,MAAA,IAAA,GAAA,KAAAC,SAAA,IAAA,KAAA,IAAA;YAC7D,EACF,KAEA,MACWzI,KAAAzC,KAAAuK,QAAAhH,SAAA,IAAA,IAAA5F,SAAA+F,WAAA,MAAA3D,IAAA,KAAAC,IAAA,IAAA,IAAAiL,MAAA,KAAA,IAAA,MAAAC,SAAA,IAAA,KAAA,IAAA;YACTX,QAAAmD,cAAyB/P,SAAM+F,WAAa,IAAH3D,IAAS,KAAA,KAAA,OAAAkL,MAAA,KAAA,IAAA,KAAAF,OAAA,GAAA,KAAAhL,IAAA,KAAAmL,SAAA,GAAA,GAAA;YAClDX,QAASlE,sBAAkBxD,mBAAAU,YAAA5F,SAAA+F,WAAA,IAAA3D,GAAA,MAAA,IAAAkL,MAAA,GAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAAsN,MAAA,GAAA,GAAA,KAAAC,SAAA,IAAA,KAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA,IAAA5F,SAAA+F,UAAA,GAAA,IAAA,GAAAuH,MAAA,GAAA,GAAA,IAAAF,OAAA,IAAA,IAAAG,SAAA,IAAA,KAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,WAAA,MAAA3D,GAAA,GAAAgL,OAAA,IAAA,GAAAE,MAAA,KAAA,GAAA,MAAAC,SAAA,IAAA,KAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,WAAA,MAAA3D,GAAA,KAAAgL,OAAA,IAAA,GAAA,IAAAE,MAAA,KAAA,GAAA,MAAAC,SAAA,IAAA,KAAA,IAAA,OAAAvN,SAAA+F,UAAA3D,IAAA,KAAA,IAAA;AAAA;QAG7BoK,UAAAZ;YACEA,MAASC,UAAA,MAAA7L,SAAA+F,WAAA,KAAA,IAAA,MAAAuH,MAAA,KAAA,MAAA3D,OAAA,IAAA8B;YACTmB,QAASmE;AAAe;QAE1BnE,QAAAlE,sBAAAxD,mBAAAU,YAAA5F,SAAA+F,kBAAA,IAAA,KAAAuH,MAAA,IAAA,IAAA,MAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA,IAAA5F,SAAA+F,WAAA,IAAA,IAAA,KAAAC,QAAA,MAAAuH,SAAA,IAAA,IAAA,IAAA;QAEAf,UAAAZ;4BACY,MAAA5L,SAAA+F,WAAA,IAAA,IAAA,KAAAqH,OAAA,GAAA,KAAAlD;YACV0C,QAASlE,sBAAkBxD,mBAAsBU,SAAQ,IAAA,aAAY0H,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA,KAAA,KAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAA,IAAA,KAAAuH,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA,KAAA,KAAA;YAC5DX,QAAAhH,SAAU,IAAA5F,SAAQ+F,UAAA,GAAA,GAAAuH,MAAA,GAAA,KAAA,GAAAF,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA;YAC7BX,QAAAhH,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YAGAC,QAAAxN,SAAA+F,UAAA,GAAA,OAAAX,gBAAA,IAAAN,KAAA,EAAA1C,GAAAE,OAAA,EACW,MAAAF,GACA,MAAAE,GACA;AACX;QAEAkK,UACWZ;YACTA,MAAAC,gBAAyB7L,SAAA+F,WAAU,MAAS,IAAQ,KAAAqH,OAAA,GAAAjD;YACpD,GACF,GACF,IAGArF,KAAA1C,KAAAwK,QAAAmD,cAAA/P,SAAAoN,OAAA,GAAA,IAAArH,eAAA3D,GAAA,IAAA,IAAAkL,MAAA,KAAA,IAAA,KAAAF,OAAA,GAAA,KAAAhL,IAAA,KAAAmL,SAAA,GAAA,GAAA;oBACY7E,sBAAAxD,mBAAAU,SAAA,IAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA,GAAA,GAAA,MAAArI,mBAAAU,YAAA5F,SAAAsN,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,GAAA,GAAA;YACVX,2BAA6BhH,SAAI,IAAS,IAAA5F,SAAMsN,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA,KAAA,KAAA;YACvCX,QAAA1H,mBAAkBU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;QAE7Bf,UAAAZ;4BACY,MAAA5L,SAAA+F,WAAA,MAAA,IAAA,KAAAqH,OAAA,GAAA,MAAAjD;YACVyC,8BAAiC1H,mBAAeU,SAAA,IAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA,GAAA,GAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,GAAA,GAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAA,GAAA,GAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,GAAA,GAAA;YACvCX,QAAA1H,mBAAkBU,SAAA,IAAA,IAAA5F,SAAAsN,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA,KAAA,KAAA;YAC7BX,QAAA1H,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;QACAf;YAEEZ,MAAAC,gBAAyB7L,SAAM+F,WAAa,MAAM,IAAA,IAAAqH,OAAA,GAAA,MAAAjD;YACzCyC,QAAAlE,sBAAkBxD,mBAAAU,SAAA,IAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA,GAAA,GAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,GAAA,GAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAA,IAAA,GAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,GAAA,GAAA;YAC7BX,QAAA1H,mBAAAU,SAAA,IAAA,IAAA5F,SAAAsN,MAAA,KAAA,GAAA,MAAAC,SAAA,KAAA,KAAA,KAAA;YACFX,QAAA1H,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;QAIMX,QAAAhH,YAAmB5F,SAAM+F,WAAiB,IAAA,GAAA,KAAMuH,MAAQ,GAAA,KAAO,IAAKC,SAAM,IAAI,IAAQ,IAAI;QAG1FX,QAAAhH,YAAmB5F,SAAU+F,WAAa,MAAA,GAAC,IAAAuH,MAAA,GAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QAInDX,QAAAhH,YAAA5F,SAAA+F,WAAA,IAAA,IAAA,IAAAuH,MAAA,GAAA,GAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QACEX,QAAAhH,YAAA5F,SAAA+F,WAAA,MAAA,IAAA,IAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;kDACoDH,QAAA,IAAA;6BACtBpN,SAAA+F,WAAsB,IAAA,IAAA,IAAAuH,MAAW,GAAE,MAAMF,YAAW,IAAAG,SAAc,IAAK,IAAK,IAAI;QAC5G,EACEA,aAAc,KAAA,KAAA,KACLA,SAAA,IAAA,IAAgB,IAAA,KAChBA,SAAA,IAAU,KAAA,KAAQ,MAC7BzI,KAAA,CAAAD,GAAApE,MAAA+L,UAAAZ;YACFA,MAAAC,UAAA;gBACF,MAAAvK,IAAAD,QAAAsI,OAAA,IAAA+B,aAAA/B,OAAA,IAAA+B;gBAGoB,OAAA1L,SAAA+F,UAAA,IAAA,IAAA4D,OAAA,IAAA+B,gBAAA,IAAA/B,OAAA,IAAA+B,gBAAAjL,IAAA,IAAA,KAAAa,oBAAAxB,KAAA8B,IAAA,MAAAoI,WAAA,MAAAvJ,KAAA;AAAA;YAEMmM,QAAAhH,YAAA5F,SAAA+F,WAAA,MAAA,IAAA,KAAA,MAAAtF,GAAA6M,MAAA,MAAA7M,IAAA,IAAA,KAAA,GAAA,MAAAoE;YACzB,MAAApE,KAAAmM,QAAAhH,YAAA5F,SAAA+F,WAAA,MAAA,IAAA,IAAAuH,MAAA,KAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YAIuB,MAAR9M,KAAQmM,QAAAhH,YAAA5F,SAAA+F,WAAA,MAAA,IAAA,OAAAqH,QAAA,KAAAE,MAAA,KAAA,IAAA,GAAA0D,OAAA,IAAAzD,SAAA,IAAA,IAAA,IAAA;AAAA;QAEpB,GACS,GACA,IACXzI,KAAA1C,KAAAwK,QAAAmD,cAAA/P,SAAA+F,WAAA,IAAA3D,GAAA,GAAA,IAAAkL,MAAA,KAAA,IAAA,KAAAF,OAAA,GAAA,KAAAhL,IAAA,KAAAmL,SAAA,GAAA,GAAA;QACCpN,aAAS,IAAAM,KAAAmM,QAAAuD,mBAAA,OAAA,MAAA,IAAA1P,KAAAT,SAAA+F,UAAA,IAAAtF,IAAA,GAAA,KAAA,IAAAA,IAAA,MAAA,MAAA,IAAAA,KAAA,IAAAA,IAAA8M,SAAA,IAAA,IAAA,IAAA,MAAAA,SAAA,KAAA,KAAA,KAAA;QACRX,QAAAlE,sBAAAxD,mBAAAU,SAAA,GAAA,GAAA,GAAA,KAAA5F,SAAA+F,UAAA,IAAA,KAAA,IAAAuH,MAAA,IAAA,GAAA,KAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,GAAA,IAAAC,QAAA,IAAAuH,SAAA,IAAA,IAAA,IAAA;0BACYxH,UAAA,GAAA,KAAA,IAAAqH,OAAA,GAAA;QACDR,QAAAhH,SAAA,IAAU5F,SAAO+F,UAAc,IAAA,MAAQ,IAAMuH,MAAA,SAAa,KAAAF,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA;QAC1DX,QAAAhH,SAAU,IAAA5F,SAAQ+F,UAAA,GAAA,IAAA,KAAAuH,MAAA,KAAA,GAAA,KAAAF,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA;QAC7BX,QAAAhH,YAAA5F,SAAA+F,UAAA,GAAA,IAAA,KAAAuH,MAAA,KAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QACFX,QAAAhH,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,MAAA,KAAAuH,MAAA,GAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;QACDX,QAAAlE,sBAAAJ,UAAApD,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAA,IAAA,OAAAuH,MAAA,IAAA,GAAA,IAAAC,SAAA,IAAA,IAAA,IAAA,MAAArI,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAA,IAAA,KAAAuH,MAAA,GAAA,GAAA,MAAAC,SAAA,IAAA,IAAA,IAAA,OAAArI,mBAAAU,SAAA,IAAA5F,SAAA+F,UAAA,GAAA,IAAA,OAAAuH,MAAA,KAAA,GAAA,MAAAC,SAAA,IAAA,IAAA,IAAA;QAIYf,UAAAZ;YACXA,MAAAC,UAAA;gBACiB,MAAA0F,6BAAevH;gBAC9B,OACahK,SAAA+F,eAAYwL,GAAAnE,OAAS,KAATmE;AAAS;YAGpC3E,QAAAhH,SAAA,IAAA5F,SAAA+F,UAAA,IAAA,GAAA,OAAAuH,MAAA,IAAA,IAAA,IAAAF,OAAA,IAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA;YACD,WAUOzI,KAAAxC;gBAEUsK,QAAAhH,SAAe,IAAA5F,SAAS+F,UAAA,GAAA,IAAAzD,IAAA,IAAAgL,MAAA,GAAA,GAAA,KAAAF,OAAA,GAAA,KAAAG,SAAA,IAAA,IAAA,IAAA;gBAIpCX,QAAAhH,YAAgC5F,SAAA+F,UAAwB,GAAA,KAAAzD,IAAA,IAAAgL,MAAsB,IAAA,IAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;AAAA;AAE3E;QAGHf,UAAAZ;YACKA,MAAWC;gBAClB,MAAAvK,IAAAD,QAAAA,SAAAsI,OAAA,IAAA8B,aAAA9B,OAAA,IAAA+B,eAAA,GAAA/B,OAAA,IAAA+B,eAAA/B,OAAA,IAAA8B,aAAA9B,OAAA,IAAA+B,eAAA;gBACU,OAAA1L,SAAA+F,UAAA,GAAA,KAAAzE,GAAA,MAAAJ,QAAA,IAAAI,IAAA,KAAA;AAAA;YAECsL,QAAAhH,SAAA,IAAA5F,SAAAsN,MAAA,GAAA,KAAA,IAAAC,SAAA,IAAA,IAAA,IAAA;YACAX,QAAAhH,SAAU,IAAI5F,SAAUsN,MAAA,KAAU,IAAI,MAAWC,SAAK,KAAC,KAAA,KAAA;YACvDT,SAAA9M,SAAU+F,UAAQ,GAAA,SAAAqH,OAAA,GAAA;AAAA;QAE/BI,QAAAxN,SAAA+F,UAAA,GAAA,GAAA,QAAAX,gBAAA,GAAAN,KAAA,EAAA1C,GAAAE,OAAA,EACD,IAAAF,GAEmB,IAAAE,GACZ;QAGFkL,iBAAoBzH,UAAA,GAAA,IAAA,MAAA,KAEtB,GACI;AAAO;IAEAyG,UACA;QAEX,EACF,GACD,MAID1H,KAAA4K,KAAA9C,QAAAmD,cAAA/P,SAAAoN,OAAA,GAAAsC,GAAA3J,UAAA,IAAA,MAAAqH,QAAA,IAAAE,MAAA,IAAA,IAAA,KAAAC,SAAA,GAAA,GAAA;QACEX,QAAAzG,OAAA,KAAAnG,SAAA+F,UAAA,GAAA,GAAAuH,MAAA,IAAA,IAAA,KAAAC,SAAA,GAAA,IAAA;QACE,MAAAiE,MAAAtM,mBAAAwD,sBAAA9C,SAAA,IAAA,IAAAV,mBAAAU,YAAA5F,SAAA+F,UAAA,GAAA,GAAA,GAAAuH,MAAA,GAAA,GAAA,OAAAtN,SAAAoN,YAAA,GAAAE,MAAA,IAAA,KAAA,KAAAC,SAAA,IAAA,IAAA;QAEE,GAEmB,GAEA,IACrBzI,KAAArE,KAAAmM,QAAA4E,KAAAxR,SAAA+F,UAAA,KAAAtF,GAAA,KAAA,IAAA2M,OAAA,GAAA,KAAA3M,GAAA,KAAAA;QACAmM,QAAmBhH,YAAA5F,SAAU+F,aAAkB,IAAA,KAAQuH,WAAe,KAAA,MAAQC,SAAS,IAAA,IAAA;QACzFX,QAAAzG,OAAA,KAAAnG,SAAAsN,MAAA,IAAA,IAAA,MAAAC,SAAA,GAAA,IAAA;AAAA;IAEF,GAEA,GAIA,IACQzI,KAAA1C,KAAAoK;QAGJI,QAAAhH,SAAA,IAAA,IAAA5F,SAAA+F,UAAA,KAAA3D,IAAA,IAAAkL,MAAA,IAAA,IAAA,MAAAC,SAAA,GAAA,IAAA;AAAA;IAEIf,UAAA;QAEEI,QAAAhH,SAAmB,GAAA,IAAA5F,SAAYsN,MAAA,KAAS,KAAA,MAAOC,SAAA,IAAA,IAAA,IAAA;QAAAX,QACtChH,SAAA,KAAU5F,SAAQ+F,UAAA,GAAA,GAAAuH,MAAA,KAAA,IAAA,MAAAC,SAAA,GAAA,IAAA;QAC7BX,QAAAhH,SAAA,IAAA5F,SAAA+F,UAAA,IAAA,GAAAqH,OAAA,IAAA,IAAAE,MAAA,IAAA,IAAA,KAAAC,SAAA,IAAA,IAAA,IAAA;AAAA,QH5mBuB;IG6mBvBf,UAAA;QAEsDI,QAC3ChH,SAAA,GAAAqK,MAAY,QAAQjQ,SAAAsN,MAAA,KAAA,GAAA,MAAAC,SAAA,GAAA,IAAA;AAAA,QHhnBR;IGknBvBf,UAAA;QAIAI,QAAAzG,OAFqB,IADT,KAGZ,CAAAxF,GAAAC,GAAA8B;YACF,MAAA+O,KAAA7Q,IAJc;YAKK,MAAA8Q,QAAA/Q,IAAAb,KAAAC,MAAa,IAJT;YAKvB,MAAA4R,QAAAF,MAAA,KAAA3R,KAAAC,KAAA;wBACY0R,KAAAA,qBAAA3R,KAAA8B,IAAAjB,IAAAb,KAAAC,MAAA,KANW,OAMX;YACD,IAAA6R,OAAAhR,GAAgB;gBAChB8B,QAAAgC,UAAU;gBACrB,OAAA;oBACFtC,GAAA;oBACSC,IAAA;oBACXC,GAAA;;;YAKqB,OAAA;gBACrBF,mBAAAtC,KAAA+B,IAAA6P,yBAAA5R,KAAA8B,IAAA+P;gBACDtP,mBAAAvC,KAAA+B,IAAA4P,KAAA3R,KAAAC,MAAA0R,KAAAH;gBAIYhP,mBAAAxC,KAAW8B,IAAA8P,yBAAA5R,KAAA8B,IAAA+P,8BAAA/P,IAAA0P,MAAAxR,KAAAC,KAAA,KAAA;;AACtB,aACEC,SAAagG,QAAC,KAAAuH,SAAA,GAAA,GAAA;QACd,GACS,GACX,IACCzI,KAAQ1C,KAAAwK,QAAAzG,OAAA,KAAAnG,SAAA+F,UAAA,MAAA3D,GAAA,KAAA,KAAA4D,QAAA;AAAA,QHjpBoB;AGkpB3B;;AC/qBR,MAAA6L,kBAAyD;IAElDzP,GAAc;IAEdC,GAAa;IAEbC,GAA2B;;;AAIlC,MAAMwP,kBAAoB;IAEnB1P;IAEAC;IAEAC,GAAwB;;;AAI7B,MAAQyP,iCAA2C9N,kBAAA+N,GAAAC,eAAAD,GAAAE,cAAAC,mBAAAA,mBAAA/N,MAAAC;;;;ACpBrD,MAAA+N,kBAAgC,CAAAC,aAAAC,WAAAC,UAAAC;IAEhC,IAAoBC,KAAA;IACpB,IAAoBC,KAAA;IAEhB,IAAOC,KAAA;IAC2B,MAAAC,iBAAgB,OAAhBL,WAAAD;IAC5B,MAAAO,kBAAyB,IAAAC,UAAAf,gBAA6BO,WAAKC,wBAAeF,aAAAU;IACpF,MAAAC,iBAAA7S,aAAA,IAAAM;QAE+C,MAAAa,IAAAuR,gBAE7C7N,eACA;YAGM5C,GAAA,IAAA3B,IAAA;YAEA4B,GAAA,IAAA5B,IAAA,KAAsB;YAEnB6B,GAAA,IAAA7B,IAAA,KAAA;;QAEAgS,MAAAnR,EAAAc,KAAAwQ,iBAAAtR,EAAAc,IAAA,MAAAwQ,iBAAAtR,EAAAsB;QAEH8P,MAAiBpR,EAAAe,KAAAuQ,iBAAatR,EAAGe,IAAO,MAAAuQ,iBAAAtR,EAAAsB;QACtC+P,MAAIrR,wBAA+BA,EAAAgB,IAAA,MAAAsQ,iBAAAtR,EAAAsB;QAChC,OAAAtB;AAAA;IAEP,MAAO2R,sBAAQjT,SAAAoN,OA7Ba,KADzB,KA8BYC,cAAAoF,KAAA,GAAAC,KAAA,GAAAC,KAAA;IACjB,IAACO,OAAA9H;IAED,IAAA+H,SAAc/H;IACd,IAAAnF,SAAcmF;IACd,IAAA3F,OAAc2F;IACP,IAAAhH,OAAAgH;IACR,IAAA/G,OAAA+G;IAE2BxG,kBAAAoO,gBAAAC,qBAA6BnO,KAAW,EAAA1C,GAAAC,GAAgBC;QAEzE4Q,OAAAxS,IAAAwS,MAAA9Q;QACC+Q,QAAAtS,IAAAsS,OAAA/Q;QACC6D,SAAAvF,IAAAuF,QAAA5D;QACHoD,MAAA5E,IAAA4E,KAAApD;QACC+B,OAAA1D,IAAA0D,MAAA9B;QACD+B,MAAAxD,IAAAwD,KAAA/B;AAAA;IAID8B,YAAAA,OAAWoO,cAAA,IAAAA;IACVnO,OAAAA,wBAAY,IAAAmO;IACX,OAAAxS,eAAa,KAAAmT,QAAAD,OAAA,KAAAzN,MAAAQ,SAAA,KAAA7B,OAAAC,MAAAgJ,eAAA8F,QAAAD,SAAA,IAAAzN,MAAAQ,WAAA,IAAA7B,OAAAC,OAAA,GAAA+O,aAAAH;AAAA;;ACpDnB,MAAMI,eAAe,IAAIC;;AAEzB,MAAMC,kBAAkBF,aAAaG;;ACD5C,IAAAC,kBAAgC;;AAChC,IAAAC,kBAAA;;AAAA,IACEC;;AAAA,MACAC,WAAA;IACA,IAAAC,YAAA;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACK,IAAAC;IACP,IAAAC;IACA,IAAAC;IAEW,IAAAC;IAOL,MAAAC,qBAAA;QAEAjK,oBAAAoJ,WAAAN,gBAAAoB,eACApB,gBAAAqB,QAAAvB,aAAAwB;QACAC,GAAAxJ,YAAA,YAAAuI;AAAA;IAOA,MAAAkB,WAAA,CAAA/T,SAAA;QACA,IAAAyJ,oBAAAzJ,OAAA;YNGgBgU,UMDhBhU,ONEiByJ,kBAAAuK;YMAN;;oBAGqBC,SAAAC,iBAAAC,OAAA;oBAChCF,SAA2BG;AAAA,uBACtB7B,gBAAA8B;AAEW,cAAA,OAAA;YAClB1B,sBAAA;YAC2BsB,SAAAK,KAAAC,YAAAvU,QAAA,QAAA;;;AAI3B;QNdkB,IAAAgU;AMclB;IAEF,MAAAQ,eAAA;QAEMxD,GAAAyD,QAAWC;QACX1D;QAEsBrH,kBAAAhF,SAAA8N,kBAAAC,kBAAA;QACpBO,qBAAAI,0BAAA;QACEY,SAAOU,UAAAZ,UAAA;AAAA;IAE6Ba,gBAAE,OAAA;IACxCC,GAAAC,UAAA;QACK,IAAAC,QAAA,kBAAA;YACL3J,4BAAsB;YACxB4J,SAAAC;AACA;AAAA;IACoBC,GAAAJ,UAAA;QACbb,SAAAK,KAAiBa;;;IAG5BC,GAAAN,UAAA;QACFb,SAAAK,KAAAa;;QAGaxC,sBAAA;AAAA;IAEOmB,GAAAgB,UAjDhB;QACAjC,YAAAA;;;IAiDFwC,GAAAP,UAAA,MAAAf,UAA0C;IAC1Ce;QACerB,cAAA;QACf,KAAAhK,iBAAA;YACF6L,EAAAC,WAAAvE,OAAArH,kBNpDoB,MMoDpB;YAEYgJ,uBAAA3B,GAAAwE;AACV;AAAA;0BAIiB,EAAAC,MAAAA,OAAAF,QAAAG,MAAAC;QAEb,KAAAA;YACF,MAAAC,YAA6CF,KAAA,MAAAH,WAAAtB,SAAAK;YAC7C,IAAgBsB,YAAA,aAAAH,SAAA,YAAAA,SAAAhM,kBAClBA,oBAAAgK,eAAAM,UAAAtK,uBACF;gBAGmB,MAAAoM,SAAA;oBAEe,CAAA,SN9EzB;oBM+EE,CAAA,cN/EF;oBMgFT,CAAA,SN7EkB;oBMgFC,CAAA,YNhFD;oBMkFgB,CAAA,SNjFpC;oBMkFa,CAAA,eNlFb;oBMmF0B,CAAA,SNjFtB;oBMkFF,CAAA,cNlFE;oBMqFW,CAAA,SNnFO;oBMsFD,CAAA,UNtFC;oBMwFH,CAAA,UNxFG;kBMyFJJ;gBNzFI,MM0FII,SACCD,YAAAjM,kBAAAkM,UAAA,KACnBlM,kBAAkCkM,UAAAD;AACpC;AACA;AAAA;IAEAE,cAAA,EAAAC,WAAAC;QACF,IAAArD,wBAAAoD,aAAAC,YAAA;YACFlF,gBAAAzP,KAAA,KAAA0U;YAEUjF,qBAA6B,KAARkF;AACxB;AAAA;IAGHhF,GAAAiF,eAAgBX;QACV,KAAC7L;YACH,KAAA,OAAyByM,OAAAC,OAAAC,eAAAd,EAAAe,gBAC3B,IAAA1D,uBAAAuD,QAAAlF,GAAAE,cAAA;gBACK,SAAA,MAAAmC,oBAAA;oBAEHC,gBAAA;oBACYH,YAAA+C;oBACK9C,YAAA+C;oBAEL9C,qBAAA+C;oBACG7C,uBAAAzC,gBAAAzP;oBAEHmS,uBAAA1C,gBAAA1P;AACM;mBAAA,SAEN,MAAA6R,oBAAA;gBACKC,gBAAA;gBAELH,iBAAAmD;gBACClD,iBAAAmD;gBACAlD,qBAAAmD;AAEb;YAEatD,iBAAA/J;AACX;AAAA;IACFiI,GAAAsF,cACKhB;QACL,KAAA7L,iBAA4B,KAAA,OAAAyM,OAAAC,OAAAC,eAAAd,EAAAe,gBAAA;YAC9B,IAAAhD,uBAAA+C,YAAA;gBACFtF,gBAAAzP,IAAAkS,wBAAA2C,QAAA/C,aAAA;gBACFrC,gBAAA1P,IAAAoS,wBAAA2C,QAAA/C,aAAA;gBACFE,gBAAA;AAEA;YACM,IAAAL,mCAAiD;gBACnC,MAAAsD,UAAiBxD,iBAAAmD,SAvJT;gBAwJR,MAAAM,UAAiBxD,iBAAAmD,SAxJT;gBAyJ1B,MAAAM,YAAA3W,IAAAyW;gBACF,MAAAG,YAAA5W,IAAA0W;gBAEG,MAAsBvI,wBAAAnP,KAAA6B,MAAA6V,QAAAD;gBACD,MAAAzM,QAAA5J,wBAAApB,KAAAyC,MAAAiV,QAAAD,UA/JG;gBAgKvB9D,kBAAsCgE,YAlKf,qBAkKsC3X,KAAA+B,IAAAoN,SAAAnE,QAAA;gBAChC4I,kBAAAgE,YAnKN,qBAmKkC5X,KAAA8B,IAAAqN,SAAAnE,QAAA;oCACf4I,qBAAAQ,gBAAA;gBACpBuD,YAAA,MAAA1D,iBAAAmD,wBAjKE,KAiKFpX,KAAA6X,KAAAJ;gBACJG,YAAA,MAAA1D,iBAAAmD,wBAlKM,KAkKNrX,KAAA6X,KAAAH;AACA;AACS;AAAA;IAErBxF,GAAA4F,aAAAtB;QACF,IAAAuB;QACFvB,EAAAwB;QACkB,KAAA,MAAAC,SAAAzB,EAAAe,gBACC,IAAAU,MAAAX,eAAA/C,oBAAA;YACAA,0BAAA;YACIC,kBAAAuD,QAAA;YACvBvD,gBAAA;AAAA,eAAA,IACFyD,MAAAX,eAAAnD,oBAAA;YACiBA,0BAAA;YACnBP,kBAAAD,kBAAA;YACFS,kBAAA2D,QAAA;YAEmB3D,gBAAA;AACnB,eAA6B2D,QAAA;QAG1B,IAAAA,SAAqBvB,EAAAC,WAAAvE,MAAA8B,gBAAA;YACA,MAAAkE,OAAAjO,eAAA+J;YACpBkE,OAAoB,OAAkB,KAAlBA,SAAkBrN,kBN/KtB,MM+K6C;AAC3D;AAAA;IAEkBsK,SAAAgD,qBAA6BC,SAAAC,WAAA3C;;IAE/CT,UAAA;AAAA;;ACtND,MAAMqD,KAA6BpG,GAAGqG,WAAW,UAAU;IAElEC,iBAAoB;;;AAEpB,KAAA,MAAAC,KAAAH,IAAAA,GAAAG,EAAA,KAAA;;ACJA,IAAAC;;AAIE,MACAC,cAAA;IACA,IAAAC,wBAAA;IACA,IAAAC,iBAAA;IACA,IAAAC,2BAAA;IACA,IAAAC,oBAAA;IACA,IAAAC,oBAAA;IACK,IAAAC,mBAAA;IACP,IAAAC;IACE,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,IAAAC;IACK,IAAAC;IACP,IAAAC;IACE,IAAAC;IACA,IAAAC;IACA,IAAAC;IACA,MAAAC,yBAAA;QACAzX,GAAA;QACAC,GAAA;QACAC,GAAA;;IAEA,MAAAwX,kCAAA,IAAAC,WAAA;IACA,MAAAC,8BAAA,CAAAC,UAAAC,SAAAjZ,WAAA2J,SAAAqP,UAAAC,SAAAxZ,IAAA,GAAAG,IAAA,IAAAC,IAAAmZ,WAAAC,WAAAjZ;IACK,MAAAkZ,iBAAA;QAC0CpB,mBAAA;QACjDK,eAAA;QACEC,8BAAA;QACAC,8BAAA;QACAH,iBAAA;QACAT,wBAAAC,iBAAAhP,OAAAM,0BAAA9C,QAAAwF,YAAA;AAAA;IAEA,MAAAyN,yBAAA;QACA,KAAA,IAAA/X,IAAA,IArCA,MAqCAA,GAAAA,KAAA,GAAA;YACA,IAAAgY,QAAA;YACK,IAAAC,OAAA;YACE,IAAApH,OAAA;YACU,IAAAC,QAAA;YAER,MAAAoH,eAAAlY;YAEyB,KAAA,IAAAD,IAAA,IAAAC,GA7ClC,MA6CkCD,GAAAA,KAAA,GAAA;gBAEA,MAAAoY,KAAAD,SAAA,IAAAnY;oCAEI,KAAAqY,MAAArY;gBAEF,MAAAsY,QAAAC,iBAAAH,MAAA;gBAEL,MAAAI,QAAAD,iBAAAE,KAAA,KAAA;gBAC3B,MAAA1Z,IAAA,IAAAL,IAAAsB,IAAA,MAAA,IAAA;gBAEA,IAAAA,IAAA,MAAAqY,MAAArY,GAAA;oBAEwBiY,QAAAxZ,IAAAwZ,OAAAxZ,IAAA6Z,QAAAvZ,GAAAuZ,QAAAC,iBAAAE,MAAA;oBAEPP,OAAAzZ,IAAAyZ,MAAAzZ,IAAA+Z,QAAAzZ,GAAAyZ,QAAAD,iBAAAH,KAAA,KAAA;AAEjB;gBAC8B,IAAAC,KAAArY,KAAAA,IAAAqY,IAAA;oBACH,MAAAK,SAAA,IAAA3Z,KAAAN,IAAA6Z,OAAAE,SAAA;oBAEPE,QAAA,SAEAL,KAAArY,KAAA0Y,QAAA5H,OAAAA,OAAA4H,QAEpB1Y,IAAAqY,MAAAK,QAAA3H,UAAAA,QAAA2H;AAEA;AACA;YAEAha,IAAAqS,QAAAD,QAAApS,IAAA0Y,wBAAAA,qBAAArG,QAAAD;YAEApS,IAAAwZ,OAAAD,SAAAvZ,IAAA2Y,wBAAAA,qBAAAa,OAAAD;AACA;AAAA;IAGA,MAAAU,uBAAA;QACA,IAAAC,kBAAA;QAEE;QAEA,IAAAC,QAAA;QACA,IAAmBC,OAAA;QAEnBpB,gCAA+CqB,KAAA;QAG/C,KAAA,WAAuB,UAAA9Y,GAAA;YACR,IAAA+Y,KAAA;YACJ,MAAAb,eAAAlY;YACe,KAAA,IAAAD,IAAA,GAAAqY,MAAArY,GAAAA,KAAA;gBACA,IAAA3B,IAAA8Z,SAAA,IAAAnY;gBACb,MAAAzB,KAAAga,iBAAAla,KAAAka,iBAAAla,IAAA,MAAA;gBACjBA,IAAAka,iBAAyCla,IAAA;gBAC3C2B,IAAA,MAAAqY,MAAArY,MAAAgZ,MAAAza;;oBAGuB,MAAA0a,QAAAvB,gCAAgCrZ,KAAA;oBACvCqZ,gCAAArZ,KAAA4a;oBACD,IAAAA,SAAAL,iBAAA;wBACAA,kBAAAK;wBACCC,cAAA7a;AACG;;AAEP;YACK,IAAA2a,MAAA/Y,IAAmC,MAAA6Y,QAAA7Y,IAAA;YACxC,IAAA+Y,KAAA;gBACA/Y,IAAyB,MAAA4Y,SAAA5Y,IAAA;gBACH6W,oBAAA;AAEpB;AACE;QACDoC;QACT,IAAAvC;YAEI,IAAIuC,aAAyB;gBACFvC,mBAAA;gBACVJ,iBAAA2C;AACjB;eACS3C,iBAAA2C,eAAA5C;QAC+BA,wBAAA4C;QAC9BnC,iBAAAvO,SAAAuO,gBAAAD,oBAAA,MAAA,GAAA;QACVW,uBAAAxX,KAAA4Y,QAAA,MAAA/B,oBAAA,IAAAC,mBAAA+B,OAAA,MAAA/B,iBAAAnO;AAAA;IAEJ,MAAAuQ,cAAA;QACF,MAAAC,kBTnG0B,MSmG1B9R,UAAAiP,gBAAAlM,SAAA/C,UAAAiP,gBAAA7V,WAAA9C;QAEA,sBAAwB;YACtB,OAAAoC,GAAAqZ,IAAApZ,GAA6BqZ,IAAApZ,GAAAqZ,MAAAhS,OAAAM,0BAAAgD,WAAAjI,eAAA;gBAC/B5C,GAAA;gBACeC,GAAA;gBACbC,IAAA;;YAEJ,IAAAyW,mBAAA,GAAA;gBACFA,mBAAA;iCAEmClP,sBAAAxH,IAAAqZ;AACX;YACJ7R,sBAAAzH,IAAAqZ;YACN5R,sBAAAvH,IAAAqZ;AACZ,eAAW;YACX,MAAAC,iCAAsCJ,gBAAAK;YACtCD,+BAA6B/X,MAAA;YAClB+X,+BAAA9X,MAAA;YACH8X,+BAAuC7X,MAAA;YAC7C,OAAa3B,GAAOqQ,IAAAnQ,GAAAqQ,MAAAiJ,+BAAiC5W,eAAA;gBAC3C5C;gBACGE,GAAAmX;;;YAGHI,uBAAAzX,KAAAqQ;YACRoH,uBAAAvX,KAAAqQ;AACA;QACQ,IAAAgG;YACNM,aAAAN;YACA,UAAamD,KAAiBzZ,GAAA0Z,KAAAzZ,GAAA0Z,OAAAR,gBAAAK,UAAA7W,eAAA6E;YACVgQ,uBAAAzX,IAAA0Z;YACJjC,uBAAAxX,IAAA0Z;YAChBlC,uBAAAvX,IAAA0Z;AACF;QACF,OAAA5Z,GAAAC,GAAAC,KAAAkZ,gBAAAxW,eAAA6U;QACI,MAAAoC,KAAU7Z,IAAAyH,sBAAOzH;QACnB,MAAA8Z,KAAY5Z,IAAAuH,sBAAAvH;QACduH,sBAAAzH,IAAAA;QACAyH,sBAAYxH,IAAAA;QACVwH,sBAAWvH,IAAAA;UACI,KAAbF,KAAa,MAAAE,KAAA,MAAA,KAAbD,KAAa8X;QACf,IAAAxB,gBAAA;YACoBU,8BAAA4C,KAAAjR;YACtBsO,8BAAA4C,KAAAlR;AACF;QAEiBuO,iBAAAnY,KAAAwJ,SAAA2O,gBAAAlX,GAAA,IAAAA,GAAA,IAAAvB,IAAAyY,iBAAAlX;QACK,SAAA,MAAAqX,iBAAA;YACtB7H,gBAAAzP,IAAAsX,kBAAAtX;YAEsByP,gBAAAxP,KAAAsX,kBAAAJ,iBAAAlX,KAxLxB;YA0LqBwP,gBAAAvP,KAAAsX,kBAAAtX,MAAA6Z;AACI;QACFzC,kBAAAM,4BAAAN,iBAAAtX,GAAA;QACnBuX,kBAAAK,4BAAAL,iBAAAtX,GAAA;QACKuX,kBAAAI,4BAAAJ,iBAAAtX,GAAA;QACL,IAAAqR,qBAAgC;YAClC9B,gBAAAzP,IAAAwI,SAAAiH,gBAAAzP,GAAAA,GAAA,MAAA2W,mBAAA;YACwBlH,gBAAAxP,IAAAuI,SAAAiH,gBAAAxP,GAAAkX,iBAAA,KAAA,MAAAR,mBAAA;YAExBlH,gBAA0BvP,IAAAsI,SAAAiH,gBAAoCvP,GAAAA,GAAU,MAAVyW,mBAAU;AAGxE,eAAuB;YAEzBlH,gBAAAzP,IAAAwI,SAAAiH,gBAAAzP,GAAAsX,iBAAA;YAE0B7H,gBAAAxP,IAAAuI,SAAAiH,gBAAAxP,GAAAxB,IAAA8Y,kBA1M1B,IA0M0B,IAAA;4BAErBrX,IAAUsI,SAAAiH,sCA3Mf;YA6MwB,MAAAuK,eAAAvK,gBAAAzP,IAAAsX;YACZtX,MAAAA;sCACkBrB,0BAAAjB,KAAAyC,MAAA8Z,cAAAD,eAAA;YACL,IAAAE,mBAAA;oEACwBja,mBAAAA,gBAAAA,IAAAA,mBAAAA;gBAC7CyP,gBAAAzP,IAAA,sBAAAvC,KAAA6B,MAAA0a,cAAAD,gBAAAvc;AACA;AACA;QACKiS,gBAAA1P,IAAAvB,IAAAH,IAAAoR,gBAAA1P,GAAA,MAAA;QACC0P,gBAAAzP,IAAAd,mCAAyDc;QAC/D,MAAAsW,mBAAAhP,OAAqC,GAAAgC,UAAA,KAAAvJ,KAAA,IAAAE,IAAA,IAAA;QACrC,MAAAia,eAAA7S,UT9KD,IS8KsC5G,UAAA9C,SAAA+F,UAAA3D,GAAAmX,gBAAAjX,GAAAkN,WAAA,GAAAqJ,oBAAA/W,mBAAA+W,mBAAAD,0BAAA,IAAA5N;QACrC,EACMxB,sBACDC,uBACA3E,KAAA,CAAA0X,SAAA/b;YACAiJ,UAAA8S,SAAA1Z,UAAAyZ,aAAAxW,UAAA,GAAA+S,oBAAA5X,wBAAA,MAAApB,KAAA8B,IA5NT,MA4NSoI,WAAAlK,KAAAC,MAAAU,IAAA,KAAAX,KAAAC,KAAA,KAAAyP,WAAAsJ,yCAAAlX,IA5NT,MA4NSoI,WAAAlK,KAAAC,MAAAU,IAAA,OAAA,MAAAZ,aAAA;AAAA;AACJ;IAED,MAAA8a,mBAAuB,IAAK8B,WAAAhC;IAC9BjC,gBAAA;wCAEmC7N,kBR3M5B,KQ2M4B,IAAA,MAAAA,kBRvMvC,KQuMuC,IAAA;QACtB,IAAA+R,UAAAhJ,mBAAA/I,kBRzMG,KQyMH,IAAA,MAAAA,kBRtMb,KQsMa,IAAA;QACT,MAAAgS,UAAYC,UAAcC,cAAa;QACzC,IAAAF,SAAA;YAEa,MAAAG,wBAAA9Z,UAAA+Z,QAAA/Z,SAAA4T,WAAAmG,QAAA/Z,SAAAhC,QAAA,IAAA,IAAA;YAEF,OAAA+b,SAAGC,QAAsBL;YACpC,MAAAM,wBAA2B7a,sBCvOG,MDuOHA,sBCzOE,MDyOFA,sBC3OE,MD2OFA,sBC7OA;YD8O3B8a,UAAAJ,sBC5N2B,MD4NAza,sBC1NA,MD0NAA,UAAAA,KAAAA,IAAAA;YAC3Bqa,WAAAI,sBCjO0B,MDiOCxa,sBC/ND,MD+NCA,UAAAA,KAAAA,IAAAA;YAC7B,IAAAqR,qBAAA;gBAEW7B,gBAAS1P,KAAqD,KAArDrB,mBAAqD,MAAAiK;gCAEpC3I,KAAA,KAAAtB,UAAAic,KAAA,IAAA,MAAAhS;AAC/B;YAENiS,0BAA0BjE,2BAAArO,kBRrNR,KQqNQ;YACAqO,yBAAAiE;AAC1B;QAEI,MAASE,2BAAWrd,KAAA6B,eAAiBub;QAExB,MAAAE,YAAArc,UAAAG,wBAAApB,KAAAyC,MAAAma,SAAAQ,UAAA;QACjBA,SAAAE,4BAAAtd,KAAA+B,IAAAsb;QAEoBT,UAAAU,4BAAAtd,KAAA8B,IAAAub;QAClBrE,oBAAAlO,SAAmCkO,mBAAAsE,WAAA;QACnCA,cAAAxE,2BAAmC,KAAAuE,WAAAtd;QACrC2Z,qBAAA;QAE+BC,qBAAA;QAEZP,oBAAA;QACjBd;QACEA,GAAA,OAAA,GAAA,GArQN,UAqQ4C,MAAA,MAAAuC;QACtBvC,GAAA,OAAA,OAAA,EACA,OAClB;QAGkBA,GAAA,OAAA,OAAA,EACA,OAEO;QAEP3I,UAAA2K,uBAAA3K;QAChBA,UAAAsL,qBAAAtL;QACK,MAAA4N,uBAAAnc,QAAA,IAAA,IAAAL,IAAAC,IAAA0Y,qBAAA1Y,IAAA2Y;QACL,KAAAd,gBAAoB;YACJa,oDAAsD6D,uBAAArS;YACtEyO,sBAA6BH,8BAAmB+D;AAE1C;QACAhE,uCAAmCA,6BAAA,GAAAH,oBAAA,IAAA;QACzCI,8BAAoC1O,SAAA0O,6BAAyB,GAAAJ,wBAAkB;QAC/EE,eAAuBxO,SAAAwO,cAAAF,qBAAAkE,YAAAlE,oBAAA,IAAA,IAAA,KAAAmE,uBAAA,GAAAnE,oBAAAmE,uBAAA,KAAA,KAAAD,YAAA,IAAA,IAAA;QACL,MAAAE,wCAAcxL,iCAAyChS,KAAAC;QACvE,MAAAwY,oBAAAzY,KAAA8B,uBAA0BwX,eAAWpO;QACvC,MAAAoD,oBAAAtO,KAAA+B,IAAAyb,mBAAAlE,eAAApO;QACFwO,sBAAA0D,SAAA9O,IAAAsO,UAAAnE;QAEwBkB,sBAAAyD,uBAAuB9O;QAC/BqB,UAAA8L,YAAA9L;;;;;AErStB,MAAA8N,aAAmB,CAAAC,QAAA9G,OAAA;IAOO,MAAA+G,SAAArF,GAAiB,OAAA1B;IACnC0B,GAAA,OAAAqF,QAAYD;IACfpF,GAAA,OAAAqF;;;;AAID,MAAAC,oBAAgB,CAAAC,cAAAC;IAClB,MAAAC,WAAA,CAAA;IAEO,MAAAC,UAAA1F,GAAA;IACTA,GAAA,OAAA0F,SAAAH;IAEavF,GAAA,OAAA0F,SAAAP,WAAqBK,WAA0E;IAC1GxF,GAAA;IACM,OAAA2F,eAA2BF,SAAAE,UAAAF,SAAAE,QAAA3F,GAAA,OAAA0F,SAAAC,SAAA3F,GAAA,OAAA0F;AAAA;;ACrBnC,MAAAE,sBAAwC,IAAA9d,aAAA;;AACxC,MAAA+d,gCAA8CC,cAAAC,aAAAC;IAE9C,IAAA3T,iBAAA;QACE,MAAA4T,SAAAre,SAAAoN,OAAA,mBAAA,UAAAxL,IAAAmI,gBAAA;QACA,KAAA,MAAAyS,WAAA,EZuCG,IYrCHhT,sBACAC,wBACA5G,cAAAwb,QAAAL,qBAAAxB,UAAA;QACApE,GAAA,OAAAkG,iBAAA,GAAAN;QACA5F,GAAA,OAAA,GAAA1O,UAAAD,sBAAA8U,aAAA7U,UZiCG,IYjCH8U,cAAA,MAAA,IAAA9U,UZiCG,IYjCH8U;AAGF,WAXA;QAaA,KAAA,IAA4B/d,IAAA,GAAAiJ,UAAiB/D,SAAjBlF,KAAiBA,GAAAiJ,UAAOjJ,GAAAgM,SAAA5J,cAAA6G,UAAAjJ,GAAAqC,SAAAkb,qBAAAvd,IAAA;QAExB2X,GAAA,OAAAkG,iBAE1B,GAAAN;QAIqB5F,GAAA,OAAA,IAAA8F,eAAAxU,UAAAD,sBAAA8U,aAAA7U,UZoBlB,IYpBkB8U,gBAAA,GAAA,MAAA;QACb,KAAA,IAAAhE,KAAA,GZkBL,mCYlB0CA,IAAA1X,SAAgBkb,qBAAOxD;QAClE,KAAA,IAAAK,KAAsB,GAAAlR,OAAuBhE,SAAvBkV,MAAuBA,IAAA;YAC7BhY,cAAA8G,OAA6BkR,IAAA/X,SAAAkb,qBAAWnD,KZgBvD;YYfDuD,mBAAAJ,oBAAA,MAAAnD,KZeC,MYfD,MAAA,IAAAlR,OAAAkR,IAAApP;AAEG;QACA2M,GAAA,OAAAkG,iBAAA,GAAAN;QAAA5F,GACE,OAAA,GAAA1O,UAAAyU,aAAAI,aAAA7U,UAAAyU,aAAAK,cAAA,MAAA,IAAA9U,UAAAyU,aAAAK,cAAA;QAAApG,GACO,OAAA,GAAA1O,UZee,IYfsB6U,aAAA7U,UZetB,IYfuD8U,cAAA,MAAA,IAAA9U,UZevD,IYfuD8U,cAAA7U,OAAAhE;AAnBtF;AAmBsF;;AChCtF,MAAA8Y,gBAAyBC;IAClB,MAAAC,WAAAC;QACLxG,GAAA;QACAyG,sBAAAF;QZwCO,CAAAG;YACW,MAAAC,MAAAD,QAAIpU;YACtB,IAAAD,iBAAA;gBACYO,gBAAA;gBACIL,kBAdI,KAcJ;AACF,mBAAAK,gBAAAtK,IArBwC,MAqBxCqe;YAChB/U,YAAAgB;YAoB4CjB,gBAAAgV;YAENrU,cAAAoU;AAAA,UYnEpCE,CAAAJ;QACK,IAAA5T,gBAAA,GAAA;;;YAGLL,kBZyBoB,KYzBpB;AACA;QACA,MAAA0H,cAAA5H,kBAAAzK,SAAAoN,QAAA,KAAA,IAAA2F,aAAA1F,cAAA,MAAA,UAAAnM,QAAA8Q,GAAAE,cAAA,QAAAlS,SAAAoN,QAAA0E,gBAAA1P,IAAA0P,gBAAAzP,IAAAyP,gBAAAxP,GAAAyQ,aAAA1F,eAAAwE,gBAAAzP,IAAAyP,gBAAAxP,IAAAwP,gBAAAvP;QACA,IAAA0I,gBAAA,GAAA;YACA,OAAA5I,GAAAC,GAAAC,KAAAuH;;YAE+BuO,GAAA,OAAA,OAAA6G;YAC1B7G,GAAA,OAAA,GAAA,GJZL;YIa4BA,GAAA,OAAA;YACJA,GAAA,QAAA,IAAA,IAAA,IAAA;YACDA,GAAA,OAAA8G,gBCdW,ODcX,GAAArc,cAAA7C,SAAAoN,OAAA,GAAA,KAAA2F,aAAA1F,eAAAjL,IAAAC,GAAA,KAAAC;yBAC6B4c,gBCdf,MDce,Gb8BvB,Ia9BuB;YAEpC9G,GAAA,OAAA;YAClBA,GAAA,QAAA,IAAA,IAAA,IAAA;YACEA,GAAA,OAAA8G,gBCnBkC,ODmBlC,GAAArc,cAAA7C,SAAA+F,WAAA3D,IAAAC,IAAAC,IAAA;YACA2b,aAAAiB,gBCnBqC,MDmBrC,GbyB6B,IazB7B;YACA9G,GAAA;AACA;;QAEAA,GAAA,OAAA,OAAA+G;QACA/G,GAAA,OAAA,GAAA,GEVqC;QFWrCgH,WAAA,GAAAhN,gBAAAC,aEV0B,IACa,IFSvC;QACK+M,WAAA,GAAAhN,gBAAAC,aEVkC,IACd,KFSpB;;QAEmB+F,GAAA,OAAA,OAAA;QAC1BA,GAAgC,OAAA,GAAA,GAAAA,GAAAiH,oBAAAjH,GAAAkH;QAChClH,GAAoC,QAAA,IAAA,IAAA,IAAA;QACpCA,GAAmB,OAAA;QACVgH,WAAA;QACTA;QAC6BhH,GAAA,OAAAmH,WCpCa,ODoCb,GAAAxN,gBEnBD,IAED;QFmBdqG,GAAA,OAAAmH,WCrCuB,ODqCmC,GAAA1c,cAAAwP;QAC/D+F,GAAA,OAAAmH,WEjCyB,MFiCc1N,gBAAAzP,GAAAyP,gBAAAxP,GAAAwP,gBAAAvP;QACvC2b,aAAAsB,WCtC+B,ODsCc5L,qBbQL,IaRK;;QAE7CyE,GAAA,OAAAoH,UGzC6B,MHyCQpH,GAAAiH,oBAAAjH,GAAAkH,qBAAAvV;QAErCU,4BAA2C+U,UEtClB,MFsCkB,GAAA,GAAA,KAC/BpH,GAAA,OAAAoH,UEvCa,MFuCgB3N,gBAA4BzP,GAAAyP,gBAAAxP,GAAAwP,gBAAAvP;QACzD8V,GAAA,OAAAoH,UC7CgB,OD6Ca,GAAA3c,cAA2BwP,YAAAwJ;QACpEzD,GAAA,OAAA,GAAA,GAAA,MAAoC;QACpCA,GAAA,OAAA,OAA+B6G;QAErB7G,GAAA;;IAGN,MAAA+G,kBAAA/G,GAAA;IACG,MAAA6G,wBAAmC7G,GAAA;IAErC,MAAAqH,yBAAArH,GAAA;IACE,MAAAsH,oBAAoCtH,GAAA;IAE9B,MAAAuH,mBAAApC,WC/DH;IDgER,MAAAqC,8BAA2BrC,WIhEnB,sICAA;ILiEd,MAAMiC,YAAsB9B,kBAAAH,WMjEd,wEHAA;4BHkEUG,kBAAsCiC,kBOlEhD;IPoEX,MAAAJ,aAAgB7B,kBAA+BiC,kBEpEpC;;IFwEXvH,GAAA,OAAA8G,gBCpEmC,ODoEjB,GAAAjb,kBAAA,KAAA,KAAA,MAAA;;IAGlBmU,GAAA,OAAAoH,UEnEgC,MFmEE;;IAClCpH,GACE,OAAAmH,WErE8B,MFqE9B;IACH,MAAAH,aAAAjf,aAAA,IAAA0f;QACG,MAAAC,mBAAA,IAAA5f,aAAA;QACH,MAAA6f,UAAA3H,GAAA;QACA,MAAA4H,sBAAAT,WAAAM,WE5E+B,MADA;QF8E/BzH,GAAA,OAAAmH,WAAAM,WE3EgC,MADA,MF4EhCA;QACGzH,GAAA,OAAA,OAAA+G;QACA/G,GAAA,OAAA,EACH;;0BAGkByH;wBACAE;wBACA,GAAA,OEtEe,YFsE+C,GAAA,MAAA,MAAA;wBAC9D,OAAA;wBACA,OAAA;QAEd3H,GAAA,OAAA,MAAA,OAAqC;QACpCA,GAAA,OAAwB,MAAA,OAAA;QACjBA,GAAA,OAAA,MAAA,OAAA;QACVA,GAAA,OAAA,aAAsC;QACtC,OAAoBiG;YACjB,IAAAA,QAAA;gBACAxb,cAAyBwb,QAAAyB;gBAC5B1H,GAAA,iBChG4B,ODgGwB,GAAA0H;gBAC/C1H,GAAA,OAAA,OAAA,OAAA,MAAA2H,SAAA;gBACF3H,GAAA,OAAA;gBACL6F,aAAA2B,UClGiC,ODkGjCjM,qBbpD0C,IaoD1C;AAAA,mBACFyE,GAAA,OAAA4H,sBAAA,GAAAF;AAAA;AAAA;IAIC1H,GAAA;IAEHA;IACGA,GAAA,OAAS;IACTA,GAAA,OAAA;IACHA,GAAc,OAAA;IAIXA,GAAA,OAAA,GAAA,GAAA,GAAmB;IACnBA,GAAA,OAAA,OAAA6G;;IAGH7G,wBJtHA;IIwHGA,GAAA,OAAA,cAAyB,OAAAqH;IACzBrH,GAAA,OAAA;IACAA,GAAA,OAAA,MAAAsH;IACEtH,GAAA,OAAA,MAAA,GAAA,MJ3HL,UI2HK,GAAA,MAAA,MAAA;IACHA,GAAA,OAAA,OAAA,OAAA,MAAAsH,mBAAA;IACAtH,GAAG,OAAA;IACHA,GAAA,OAAA,MAAAA,GAAA;IACAA,GAAA,OAAA,MAAA,GAAA,MAAA,MAAA,MAAA,GAAA,MAAA,MAAAsG;IACAtG,GAAA,OAAA;IACGA,GAAA,OAAA,MAAA,OAAA;IACAA,GAAA,OAAA,MAAA,OAAA;IZCL;QAEA;YACY,OAAS6H,aAAAC,YAAAC,sBAAAC,eAAAC,uBAAAhU,KAAAiU,MAAAlU;YACXzC,OAAA7E,KAAA,CAAAgH,kBAAwBA,MAAAL,aAAAK,MAAAJ,cAAAI,MAAAH,SAAA3I,SAAA,IAAAid,YAAAjd,UAAA;YAChC4G,MAAA9E,KAAA,CAAAiH,MAAA/I,WAAA+I,KAAAJ,SAAA,IAAAuU,WAAAld;YACFiH,2BAAAkW;;YAGgB5V,iBAAA8V;AAChB,iBAAA/J,IAAA;QAEAhM,wBAA0BL;AAAA;;IYVvBwF,UAAAgJ,YAAAhJ;IAIAoP,sBAAyBF;AAAA;;AQ7IvB,MAAM4B,WAAYlgB;IAEvBgL,GAAgBC,aAAA;IAChBkV,WAAangB;AAAA;;ACQX,MACAogB,mBAAA,EACA,EACA,IACA,KACA,GACA,KACA,KACA,GACA,GACA,KACA,KACA,IACA,GACA,GACA,KACA,KACA,IACE,IACA,GACA,IACA,GACA,GACA,EACF,mIACF,mCACA,mCACE,mCACA,qEACA,yEAGA,EACA,KACA,KACA,GACA,KACA,KACA,GACA,GACA,KACA,KACA,IACA,GACA,GACA,KACA,GACA,IACE,KACA,GACA,GACA,GACA,KACA,EACF,mCACF,mCACA,mCACE,mCACA,iGACA,6DAGA,EACA,KACA,KACA,IACA,KACA,KACA,IACA,IACA,IACA,KACA,IACA,IACA,GACA,KACA,IACA,IACE,GACA,GACF,IACF,GACA,GACE,EACA,iCACA,qBAGA,EACA,GACA,KACA,GACA,GACA,KACA,GACA,IACA,IACA,KACA,IACA,IACA,GACA,KACA,KACA,IACE,KACA,GACF,IACF,GACA,KACE,EACA,mCACA,6BAGA,EACA,KACA,KACA,IACA,KACA,KACA,IACA,KACA,IACA,KACA,IACA,IACA,GACA,KACA,I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"}