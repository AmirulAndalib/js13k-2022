{"version":3,"file":"index.js","sources":["../../app/groundTexture.svg","../../app/game/models.ts","../../app/math/math.ts","../../app/math/matrix.ts","../../app/math/matrix-transforms.ts","../../app/math/integers-map.ts","../../app/geometry/polygon.ts","../../app/geometry/geometry.ts","../../app/game/game-time.ts","../../app/game/world-state.ts","../../app/geometry/material.ts","../../app/utils/keycodes.ts","../../app/music/audio-context.ts","../../app/shaders/main-fragment.frag","../../app/math/matrix-perspective.ts","../../app/page.ts","../../app/game/models-factory.ts","../../app/math/vectors.ts","../../app/geometry/csg.ts","../../app/game/level.ts","../../app/shaders/csm-vertex.vert","../../app/shaders/main-vertex.vert","../../app/shaders/collider-fragment.frag","../../app/shaders/void-fragment.frag","../../app/shaders/sky-vertex.vert","../../app/shaders/sky-fragment.frag","../../app/game/models-matrices.ts","../../app/gl.ts","../../app/game/player.ts","../../app/game/level-update.ts","../../app/game/models-render.ts","../../app/shaders-utils.ts","../../app/main-loop.ts","../../app/load-step.ts","../../app/music/song.ts","../../app/music/music-player.ts","../../app/game/triangle-buffers.ts","../../app/index.ts"],"sourcesContent":["export default \"__VITE_ASSET__b9f78ae4__\"","import type { Polygon } from \"../geometry/polygon\";\n\nexport interface Model {\n  readonly $matrix: DOMMatrix;\n  readonly $kind: MODEL_KIND;\n  $polygons: Polygon[] | null;\n  $vertexBegin?: number;\n  $vertexEnd?: number;\n}\n\nexport interface Lever {\n  readonly $matrix: DOMMatrixReadOnly;\n  readonly $transform: DOMMatrixReadOnly;\n  $value: 0 | 1;\n  $lerpValue: number;\n  $lerpValue2: number;\n  _update: () => void;\n}\n\nexport interface Soul {\n  $value: 0 | 1;\n  readonly _update: () => void;\n}\n\nexport type Circle = [number, number, number];\n\n/** Fixed number of souls */\nexport const SOULS_COUNT = 13;\n\n/** Fixed number of levers */\nexport const LEVERS_COUNT = 16;\n\nexport const souls: Soul[] = [];\n\nexport const levers: Lever[] = [];\n\nexport const allModels: Model[] = [];\n\nexport const MODEL_KIND_MESH = 0;\n\nexport const MODEL_KIND_GAME = 1;\n\nexport const MODEL_KIND_GAME_NO_ATTACH_PLAYER = 2;\n\nexport type MODEL_KIND = typeof MODEL_KIND_MESH | typeof MODEL_KIND_GAME | typeof MODEL_KIND_GAME_NO_ATTACH_PLAYER;\n\nexport const MODEL_ID_STATIC_WORLD = 1;\n\nexport const MODEL_ID_FIRST_BOAT = 2;\n\nexport const MODEL_ID_ROTATING_PLATFORM = 28;\n\nexport const MODEL_ID_PLAYER_BODY = 37;\n\nexport const MODEL_ID_PLAYER_LEG0 = 38;\n\nexport const MODEL_ID_PLAYER_LEG1 = 39;\n\nexport const MODEL_ID_SOUL_COLLISION = 40;\n\nexport const MODEL_ID_SOUL = 41;\n\nexport const MODEL_ID_LEVER = 42;\n","if (DEBUG) {\n  window.NO_INLINE = (fn) => fn;\n}\n\n/** Amount to be multiplied to an angle in degrees to obtain an angle in radians, approximately 0.017453292519943295 */\nexport const DEG_TO_RAD = /* @__PURE__ */ Math.PI / 180;\n\nexport const abs = /* @__PURE__ */ NO_INLINE((a: number) => (a < 0 ? -a : a));\n\nexport const min = /* @__PURE__ */ NO_INLINE((a: number, b: number) => (a < b ? a : b));\n\nexport const max = /* @__PURE__ */ NO_INLINE((a: number, b: number) => (a > b ? a : b));\n\nexport const threshold = /* @__PURE__ */ (value: number | undefined, amount: number) =>\n  abs(value!) > amount ? value! : 0;\n\nexport const clamp = /* @__PURE__ */ (value: number, minValue: number = 0, maxValue: number = 1) =>\n  value < minValue ? minValue : value > maxValue ? maxValue : value;\n\nexport const angle_wrap_degrees = /* @__PURE__ */ (degrees: number): number =>\n  Math.atan2(Math.sin(degrees * DEG_TO_RAD), Math.cos(degrees * DEG_TO_RAD)) / DEG_TO_RAD;\n\nexport const angle_lerp_degrees = /* @__PURE__ */ (a0: number, a1: number, t: number) => {\n  const da = (a1 - a0) % 360;\n  return a0 + (((2 * da) % 360) - da) * clamp(t) || 0;\n};\n\n/** Linear interpolation */\nexport const lerp =\n  /* @__PURE__ */\n  (a: number, b: number, t: number) => (t <= 0 ? a : t >= 1 ? b : a + (b - a) * t) || 0;\n\nexport const lerpneg = (v: number, t: number) => /* @__PURE__ */ {\n  v = clamp(v);\n  return lerp(v, 1 - v, t);\n};\n\nexport const hypot = /* @__PURE__ */ (a: number, b: number, c: number = 0) => Math.sqrt(a * a + b * b + c * c);\n","import type { Vec4 } from \"./vectors\";\n\nexport const float32Array16Temp = new Float32Array(16);\n\nexport const tempMatrix = new DOMMatrix();\n\nexport const identity: DOMMatrixReadOnly = new DOMMatrix();\n\nexport const matrixTransformPoint: Vec4 & ((x?: number, y?: number, z?: number, w?: number) => void) = ((\n  x: number = 0,\n  y: number = 0,\n  z: number = 0,\n  w: number = 1,\n) => {\n  matrixTransformPoint.x = tempMatrix.m11 * x + tempMatrix.m21 * y + tempMatrix.m31 * z + tempMatrix.m41 * w;\n  matrixTransformPoint.y = tempMatrix.m12 * x + tempMatrix.m22 * y + tempMatrix.m32 * z + tempMatrix.m42 * w;\n  matrixTransformPoint.z = tempMatrix.m13 * x + tempMatrix.m23 * y + tempMatrix.m33 * z + tempMatrix.m43 * w;\n  matrixTransformPoint.w = tempMatrix.m14 * x + tempMatrix.m24 * y + tempMatrix.m34 * z + tempMatrix.m44 * w;\n}) as any;\n\nexport const matrixToArray = (\n  $matrix: DOMMatrixReadOnly,\n  output: Float32Array | number[] = float32Array16Temp,\n  index: number = 0,\n) => {\n  index *= 16;\n  output[index++] = $matrix.m11;\n  output[index++] = $matrix.m12;\n  output[index++] = $matrix.m13;\n  output[index++] = $matrix.m14;\n  output[index++] = $matrix.m21;\n  output[index++] = $matrix.m22;\n  output[index++] = $matrix.m23;\n  output[index++] = $matrix.m24;\n  output[index++] = $matrix.m31;\n  output[index++] = $matrix.m32;\n  output[index++] = $matrix.m33;\n  output[index++] = $matrix.m34;\n  output[index++] = $matrix.m41;\n  output[index++] = $matrix.m42;\n  output[index++] = $matrix.m43;\n  output[index] = $matrix.m44;\n  return output;\n};\n\nexport const matrixCopy = (source: DOMMatrixReadOnly = identity, target: DOMMatrix = tempMatrix) => {\n  target.m11 = source.m11;\n  target.m12 = source.m12;\n  target.m13 = source.m13;\n  target.m14 = source.m14;\n  target.m21 = source.m21;\n  target.m22 = source.m22;\n  target.m23 = source.m23;\n  target.m24 = source.m24;\n  target.m31 = source.m31;\n  target.m32 = source.m32;\n  target.m33 = source.m33;\n  target.m34 = source.m34;\n  target.m41 = source.m41;\n  target.m42 = source.m42;\n  target.m43 = source.m43;\n  target.m44 = source.m44;\n  return target;\n};\n","import { identity } from \"./matrix\";\n\nexport const translation = NO_INLINE((x: number, y?: number, z?: number) => identity.translate(x, y, z));\n\nexport const rotation = NO_INLINE((x: number, y?: number, z?: number) => identity.rotate(x, y, z));\n\nexport const scaling = NO_INLINE((x: number, y?: number, z?: number) => identity.scale(x, y, z));\n","export const integers_map = <T>(n: number, fn: (i: number) => T) => Array.from(Array(n), (_, i) => fn(i));\n","import { matrixCopy, matrixTransformPoint } from \"../math/matrix\";\nimport type { Vec3, Vec3Optional } from \"../math/vectors\";\n\nexport interface Polygon<TVec3 = Vec3> extends Array<TVec3> {\n  /** Polygon material */\n  $color?: number | undefined;\n\n  /** Smooth normals? */\n  $smooth?: 0 | 1 | undefined;\n}\n\nexport const polygon_color = (polygon: Polygon, color: number | undefined, smooth?: 0 | 1 | undefined): Polygon => {\n  polygon.$smooth = smooth;\n  polygon.$color = color;\n  return polygon;\n};\n\nexport const polygon_transform = /* @__PURE__ */ (\n  polygon: Polygon<Readonly<Vec3Optional>>,\n  m: DOMMatrixReadOnly,\n  color: number | undefined = polygon.$color,\n): Polygon => {\n  matrixCopy(m);\n\n  return polygon_color(\n    polygon.map(({ x, y, z }) => {\n      matrixTransformPoint(x, y, z);\n      return { x: matrixTransformPoint.x, y: matrixTransformPoint.y, z: matrixTransformPoint.z };\n    }),\n    color,\n    polygon.$smooth,\n  );\n};\n\nexport const polygons_transform = /* @__PURE__ */ (\n  polygons: Polygon<Readonly<Vec3Optional>>[],\n  m: DOMMatrixReadOnly,\n  color?: number | undefined,\n) => polygons.map((polygon) => polygon_transform(polygon, m, color));\n","import { abs } from \"../math/math\";\nimport { translation } from \"../math/matrix-transforms\";\nimport { integers_map } from \"../math/integers-map\";\nimport { polygon_color, polygon_transform, type Polygon } from \"./polygon\";\nimport type { Vec3 } from \"../math/vectors\";\n\nexport const GQuad = /* @__PURE__ */ [\n  { x: -1, z: 1 },\n  { x: 1, z: 1 },\n  { x: 1, z: -1 },\n  { x: -1, z: -1 },\n];\n\n/**\n * Creates a regular polygon\n * The polygon will face up (normal 0, -1, 0).\n */\nexport const polygon_regular = /* @__PURE__ */ (segments: number, elongate: number = 0): Polygon =>\n  integers_map(segments, (i) => {\n    const z = Math.cos(Math.PI * 2 * (i / segments));\n    return {\n      x: Math.sin(Math.PI * 2 * (i / segments)),\n      y: 0,\n      z: abs(z) < 0.01 ? z : z < 0 ? z - elongate : z + elongate,\n    };\n  });\n\n/**\n * Connects a top and a bottom polygon with side polygons.\n * Top and bottom polygons must have the same length.\n * Top polygon is supposed to be flipped.\n */\nexport const cylinder_sides = /* @__PURE__ */ (btm: Polygon, top: Polygon, smooth?: 0 | 1 | undefined): Polygon[] =>\n  btm.map((btmi, i, { length }) =>\n    polygon_color(\n      [btmi, top[length - i - 1]!, top[length - ((i + 1) % length) - 1]!, btm[(i + 1) % length]!],\n      btm.$color,\n      smooth,\n    ),\n  );\n\n/** Simplest composition of polygon functions. */\nexport const cylinder = /* @__PURE__ */ (\n  segments?: number,\n  smooth?: 0 | 1,\n  topSize: number = 0,\n  elongate?: number,\n): Polygon[] => {\n  const points = segments ? polygon_regular(segments, elongate) : GQuad;\n  const top = polygon_transform(points, translation(0, 1).scale3d(topSize > 0 ? topSize : 1));\n  const bottom = polygon_transform(points, translation(0, -1).scale3d(topSize < 0 ? -topSize : 1)).reverse();\n  return [...cylinder_sides(bottom as Polygon, top, smooth), top, bottom];\n};\n\nexport const sphere = /* @__PURE__ */ (\n  slices: number,\n  stacks = slices,\n  vertexFunc: (slice: number, stack: number, polygon: Polygon) => Vec3 = (x: number, y: number) => {\n    y *= Math.PI / stacks;\n    x *= (Math.PI * 2) / slices;\n    return { x: Math.cos(x) * Math.sin(y), y: Math.cos(y), z: Math.sin(x) * Math.sin(y) };\n  },\n): Polygon[] => {\n  const polygons: Polygon[] = [];\n  for (let i = 0; i < slices; i++) {\n    for (let j = 0; j < stacks; j++) {\n      const polygon = polygon_color([], 0, 1);\n      const vertex = (x: number, y: number) => polygon.push(vertexFunc(x, y, polygon));\n      polygons.push(polygon);\n      vertex(i, j);\n      if (j) {\n        vertex((i + 1) % slices, j);\n      }\n      if (j < stacks - 1) {\n        vertex((i + 1) % slices, j + (1 % stacks));\n      }\n      vertex(i, j + (1 % stacks));\n    }\n  }\n  return polygons;\n};\n","import { lerp, min } from \"../math/math\";\n\nlet _globalTime: number | undefined;\n\nexport let mainMenuVisible: boolean | undefined;\n\n/** Minimum 15.3 frames per second */\nexport const GAME_TIME_MAX_DELTA_TIME = 0.066;\n\nexport let gameTime = 0;\n\nexport let absoluteTime = 0;\n\nexport let gameTimeDelta: number = GAME_TIME_MAX_DELTA_TIME;\n\nexport const gameTimeUpdate = (time: number) => {\n  const dt = (time - (_globalTime || time)) / 1000;\n  absoluteTime += dt;\n  gameTime += gameTimeDelta = mainMenuVisible ? 0 : min(GAME_TIME_MAX_DELTA_TIME, dt);\n  _globalTime = time;\n};\n\nexport const resetGameTime = (value: number) => {\n  gameTime = value;\n  gameTimeDelta = 0;\n};\n\nexport const damp = /* @__PURE__ */ (speed: number) => 1 - Math.exp(-speed * gameTimeDelta);\n\nexport const lerpDamp = NO_INLINE((from: number, to: number, speed: number) => lerp(from, to, damp(speed)));\n\nexport const setMainMenuVisible = (visible: boolean) => {\n  mainMenuVisible = visible;\n};\n\n// export const gameTimeUpdate = (time: number) => {\n//   const dt = (time - (_globalTime || time)) / 1000;\n//   absoluteTime += dt;\n//   if (dt >= 0.04 + Math.random() * 0.02) {\n//     gameTimeDelta = mainMenuVisible ? 0 : Math.min(GAME_TIME_MAX_DELTA_TIME, (time - (_globalTime || time)) / 1000);\n//     gameTime += gameTimeDelta;\n//     _globalTime = time;\n//   } else {\n//     gameTimeDelta = 0;\n//   }\n//   if (!_globalTime) {\n//     _globalTime = time;\n//   }\n// };\n","import { abs, clamp } from \"../math/math\";\nimport type { Vec2, Vec3 } from \"../math/vectors\";\nimport { levers, souls, SOULS_COUNT } from \"./models\";\nimport { gameTime, lerpDamp, resetGameTime } from \"./game-time\";\n\nexport const camera_rotation: Vec2 = { x: 0, y: 180 } as Vec2;\n\nexport const player_position_final: Vec3 = { x: 0, y: 0, z: 0 };\n\nexport let souls_collected_count = 0;\n\nlet _messageEndTime = 1;\n\nexport const LOCAL_STORAGE_SAVED_GAME_KEY = \"DanteSP22\";\n\nexport let game_completed: 0 | 1 = 0;\n\nexport let player_last_pulled_lever = 0;\n\nexport let firstBoatLerp: number;\n\nexport let secondBoatLerp: number;\n\nexport const worldStateUpdate = () => {\n  if (_messageEndTime && gameTime > _messageEndTime) {\n    _messageEndTime = 0;\n    h4.innerHTML = \"\";\n  }\n\n  secondBoatLerp = lerpDamp(secondBoatLerp, levers[9]!.$lerpValue2, 0.2 + 0.3 * abs(levers[9]!.$lerpValue2 * 2 - 1));\n  firstBoatLerp = lerpDamp(firstBoatLerp, game_completed ? lerpDamp(firstBoatLerp, -9, 1.5) : clamp(gameTime / 3), 1);\n};\n\nconst updateCollectedSoulsCounter = () => {\n  h3.innerHTML =\n    \"Souls: \" +\n    [0, \"I\", \"II\", \"III\", \"IV\", \"V\", \"VI\", \"VII\", \"VIII\", \"IX\", \"X\", \"XI\", \"XII\", \"XIII\"][\n      (souls_collected_count = souls.reduce((acc, { $value }) => acc + $value, 0))\n    ]! +\n    \" / XIII\";\n};\n\nexport const loadGame = () => {\n  try {\n    const [savedLevers, savedSouls, savedLastPulledLever, savedGameTime, savedSecondBoatLerp] = JSON.parse(\n      localStorage[LOCAL_STORAGE_SAVED_GAME_KEY]!,\n    );\n    levers.map(\n      (lever, index) =>\n        (lever.$lerpValue = lever.$lerpValue2 = lever.$value = index ? ((savedLevers[index] | 0) as 0 | 1) : 0),\n    );\n    souls.map((soul, index) => (soul.$value = (savedSouls[index] | 0) as 0 | 1));\n    player_last_pulled_lever = savedLastPulledLever;\n    secondBoatLerp = savedSecondBoatLerp;\n    resetGameTime(savedGameTime);\n  } catch (e) {\n    if (DEBUG) {\n      console.log(e);\n    }\n  }\n  updateCollectedSoulsCounter();\n  firstBoatLerp = clamp(player_last_pulled_lever);\n};\n\nexport const saveGame = () => {\n  localStorage[LOCAL_STORAGE_SAVED_GAME_KEY] = JSON.stringify([\n    levers.map(({ $value }) => $value),\n    souls.map(({ $value }) => $value),\n    player_last_pulled_lever,\n    gameTime,\n    secondBoatLerp,\n  ]);\n};\n\nexport const resetGame = () => {\n  localStorage[LOCAL_STORAGE_SAVED_GAME_KEY] = \"\";\n  location.reload();\n};\n\nexport const showMessage = (message: string, duration: number) => {\n  if (_messageEndTime < Infinity) {\n    _messageEndTime = gameTime + duration;\n    h4.innerHTML = message;\n  }\n};\n\nexport const onPlayerPullLever = (leverIndex: number) => {\n  if (DEBUG) {\n    console.log(\"switch lever \" + leverIndex + \" = \" + levers[leverIndex]?.$value);\n  }\n\n  if (leverIndex) {\n    showMessage(\"* click *\", 1);\n  }\n  player_last_pulled_lever = leverIndex;\n  saveGame();\n};\n\nexport const onLever0Pulled = () => {\n  if (souls_collected_count < SOULS_COUNT) {\n    showMessage(\"Not leaving now, there are souls to catch!\", 3);\n  } else if (!game_completed) {\n    showMessage(\"Well done. They will be punished.<br>Thanks for playing\", Infinity);\n    game_completed = 1;\n  }\n};\n\nexport const onSoulCollected = () => {\n  showMessage(\n    [\n      ,\n      \"Mark Zuckemberg<br>made the world worse\",\n      \"Giorgia Meloni<br>fascist\",\n      \"Andrzej Mazur<br>for the js13k competition\",\n      \"Donald Trump<br>lies\",\n      \"Kim Jong-un<br>Dictator, liked pineapple on pizza\",\n      \"Maxime Euziere<br>forced me to finish this game\",\n      \"She traded NFTs apes\",\n      ,\n      \"Vladimir Putin<br>evil war\",\n      \"He was not a good person\",\n      ,\n      \"Salvatore Previti<br>made this evil game<br><br>Done. Go back to the boat\",\n    ][souls_collected_count] || 'Catched a \"crypto bro\".<br>\"Web3\" is all scam, lies and grift',\n    souls_collected_count && souls_collected_count < 12 ? 5 : 7,\n  );\n\n  updateCollectedSoulsCounter();\n  saveGame();\n};\n","export const material = NO_INLINE(\n  (r: number, g: number, b: number, a: number = 0): number =>\n    ((a * 255) << 24) | ((b * 255) << 16) | ((g * 255) << 8) | (r * 255),\n);\n","export const GAMEPAD_BUTTON_UP = 12;\n\nexport const GAMEPAD_BUTTON_DOWN = 13;\n\nexport const GAMEPAD_BUTTON_LEFT = 14;\n\nexport const GAMEPAD_BUTTON_RIGHT = 15;\n\nexport const GAMEPAD_BUTTON_START = 9;\n\nexport const GAMEPAD_BUTTON_B = 0;\n\nexport const GAMEPAD_BUTTON_A = 1;\n\nexport const GAMEPAD_BUTTON_Y = 2;\n\nexport const GAMEPAD_BUTTON_X = 3;\n\nexport const GAMEPAD_BUTTON_LB = 4;\n\nexport const GAMEPAD_BUTTON_RB = 5;\n\nexport const KEY_CODE_EMPTY = \"\";\n\nexport const KEY_CODE_AGAIN = \"Again\";\n\nexport const KEY_CODE_ALT_LEFT = \"AltLeft\";\n\nexport const KEY_CODE_ALT_RIGHT = \"AltRight\";\n\nexport const KEY_CODE_ARROW_DOWN = \"ArrowDown\";\n\nexport const KEY_CODE_ARROW_LEFT = \"ArrowLeft\";\n\nexport const KEY_CODE_ARROW_RIGHT = \"ArrowRight\";\n\nexport const KEY_CODE_ARROW_UP = \"ArrowUp\";\n\nexport const KEY_CODE_AUDIO_VOLUME_DOWN = \"AudioVolumeDown\";\n\nexport const KEY_CODE_AUDIO_VOLUME_MUTE = \"AudioVolumeMute\";\n\nexport const KEY_CODE_AUDIO_VOLUME_UP = \"AudioVolumeUp\";\n\nexport const KEY_CODE_BACKQUOTE = \"Backquote\";\n\nexport const KEY_CODE_BACKSLASH = \"Backslash\";\n\nexport const KEY_CODE_BACKSPACE = \"Backspace\";\n\nexport const KEY_CODE_BRACKET_LEFT = \"BracketLeft\";\n\nexport const KEY_CODE_BRACKET_RIGHT = \"BracketRight\";\n\nexport const KEY_CODE_BROWSER_BACK = \"BrowserBack\";\n\nexport const KEY_CODE_BROWSER_FAVORITES = \"BrowserFavorites\";\n\nexport const KEY_CODE_BROWSER_FORWARD = \"BrowserForward\";\n\nexport const KEY_CODE_BROWSER_HOME = \"BrowserHome\";\n\nexport const KEY_CODE_BROWSER_REFRESH = \"BrowserRefresh\";\n\nexport const KEY_CODE_BROWSER_SEARCH = \"BrowserSearch\";\n\nexport const KEY_CODE_BROWSER_STOP = \"BrowserStop\";\n\nexport const KEY_CODE_CANCEL = \"Cancel\";\n\nexport const KEY_CODE_CAPS_LOCK = \"CapsLock\";\n\nexport const KEY_CODE_COMMA = \"Comma\";\n\nexport const KEY_CODE_CONTEXT_MENU = \"ContextMenu\";\n\nexport const KEY_CODE_CONTROL_LEFT = \"ControlLeft\";\n\nexport const KEY_CODE_CONTROL_RIGHT = \"ControlRight\";\n\nexport const KEY_CODE_CONVERT = \"Convert\";\n\nexport const KEY_CODE_COPY = \"Copy\";\n\nexport const KEY_CODE_CUT = \"Cut\";\n\nexport const KEY_CODE_DELETE = \"Delete\";\n\nexport const KEY_CODE_DIGIT_0 = \"Digit0\";\n\nexport const KEY_CODE_DIGIT_1 = \"Digit1\";\n\nexport const KEY_CODE_DIGIT_2 = \"Digit2\";\n\nexport const KEY_CODE_DIGIT_3 = \"Digit3\";\n\nexport const KEY_CODE_DIGIT_4 = \"Digit4\";\n\nexport const KEY_CODE_DIGIT_5 = \"Digit5\";\n\nexport const KEY_CODE_DIGIT_6 = \"Digit6\";\n\nexport const KEY_CODE_DIGIT_7 = \"Digit7\";\n\nexport const KEY_CODE_DIGIT_8 = \"Digit8\";\n\nexport const KEY_CODE_DIGIT_9 = \"Digit9\";\n\nexport const KEY_CODE_EJECT = \"Eject\";\n\nexport const KEY_CODE_END = \"End\";\n\nexport const KEY_CODE_ENTER = \"Enter\";\n\nexport const KEY_CODE_EQUAL = \"Equal\";\n\nexport const KEY_CODE_ESCAPE = \"Escape\";\n\nexport const KEY_CODE_F1 = \"F1\";\n\nexport const KEY_CODE_F2 = \"F2\";\n\nexport const KEY_CODE_F3 = \"F3\";\n\nexport const KEY_CODE_F4 = \"F4\";\n\nexport const KEY_CODE_F5 = \"F5\";\n\nexport const KEY_CODE_F6 = \"F6\";\n\nexport const KEY_CODE_F7 = \"F7\";\n\nexport const KEY_CODE_F8 = \"F8\";\n\nexport const KEY_CODE_F9 = \"F9\";\n\nexport const KEY_CODE_F10 = \"F10\";\n\nexport const KEY_CODE_F11 = \"F11\";\n\nexport const KEY_CODE_F12 = \"F12\";\n\nexport const KEY_CODE_F13 = \"F13\";\n\nexport const KEY_CODE_F14 = \"F14\";\n\nexport const KEY_CODE_F15 = \"F15\";\n\nexport const KEY_CODE_F16 = \"F16\";\n\nexport const KEY_CODE_F17 = \"F17\";\n\nexport const KEY_CODE_F18 = \"F18\";\n\nexport const KEY_CODE_F19 = \"F19\";\n\nexport const KEY_CODE_F20 = \"F20\";\n\nexport const KEY_CODE_F21 = \"F21\";\n\nexport const KEY_CODE_F22 = \"F22\";\n\nexport const KEY_CODE_F23 = \"F23\";\n\nexport const KEY_CODE_F24 = \"F24\";\n\nexport const KEY_CODE_FIND = \"Find\";\n\nexport const KEY_CODE_FN = \"Fn\";\n\nexport const KEY_CODE_HANGUL_MODE = \"HangulMode\";\n\nexport const KEY_CODE_HANJA = \"Hanja\";\n\nexport const KEY_CODE_HELP = \"Help\";\n\nexport const KEY_CODE_HOME = \"Home\";\n\nexport const KEY_CODE_INSERT = \"Insert\";\n\nexport const KEY_CODE_INTL_BACKSLASH = \"IntlBackslash\";\n\nexport const KEY_CODE_INTL_RO = \"IntlRo\";\n\nexport const KEY_CODE_INTL_YEN = \"IntlYen\";\n\nexport const KEY_CODE_KANA_MODE = \"KanaMode\";\n\nexport const KEY_CODE_KEY_A = \"KeyA\";\n\nexport const KEY_CODE_KEY_B = \"KeyB\";\n\nexport const KEY_CODE_KEY_C = \"KeyC\";\n\nexport const KEY_CODE_KEY_D = \"KeyD\";\n\nexport const KEY_CODE_KEY_E = \"KeyE\";\n\nexport const KEY_CODE_KEY_F = \"KeyF\";\n\nexport const KEY_CODE_KEY_G = \"KeyG\";\n\nexport const KEY_CODE_KEY_H = \"KeyH\";\n\nexport const KEY_CODE_KEY_I = \"KeyI\";\n\nexport const KEY_CODE_KEY_J = \"KeyJ\";\n\nexport const KEY_CODE_KEY_K = \"KeyK\";\n\nexport const KEY_CODE_KEY_L = \"KeyL\";\n\nexport const KEY_CODE_KEY_M = \"KeyM\";\n\nexport const KEY_CODE_KEY_N = \"KeyN\";\n\nexport const KEY_CODE_KEY_O = \"KeyO\";\n\nexport const KEY_CODE_KEY_P = \"KeyP\";\n\nexport const KEY_CODE_KEY_Q = \"KeyQ\";\n\nexport const KEY_CODE_KEY_R = \"KeyR\";\n\nexport const KEY_CODE_KEY_S = \"KeyS\";\n\nexport const KEY_CODE_KEY_T = \"KeyT\";\n\nexport const KEY_CODE_KEY_U = \"KeyU\";\n\nexport const KEY_CODE_KEY_V = \"KeyV\";\n\nexport const KEY_CODE_KEY_W = \"KeyW\";\n\nexport const KEY_CODE_KEY_X = \"KeyX\";\n\nexport const KEY_CODE_KEY_Y = \"KeyY\";\n\nexport const KEY_CODE_KEY_Z = \"KeyZ\";\n\nexport const KEY_CODE_LANG_1 = \"Lang1\";\n\nexport const KEY_CODE_LANG_2 = \"Lang2\";\n\nexport const KEY_CODE_LAUNCH_APP_1 = \"LaunchApp1\";\n\nexport const KEY_CODE_LAUNCH_APP_2 = \"LaunchApp2\";\n\nexport const KEY_CODE_LAUNCH_MAIL = \"LaunchMail\";\n\nexport const KEY_CODE_LAUNCH_MEDIA_PLAYER = \"LaunchMediaPlayer\";\n\nexport const KEY_CODE_MEDIA_PLAY_PAUSE = \"MediaPlayPause\";\n\nexport const KEY_CODE_MEDIA_SELECT = \"MediaSelect\";\n\nexport const KEY_CODE_MEDIA_STOP = \"MediaStop\";\n\nexport const KEY_CODE_MEDIA_TRACK_NEXT = \"MediaTrackNext\";\n\nexport const KEY_CODE_MEDIA_TRACK_PREVIOUS = \"MediaTrackPrevious\";\n\nexport const KEY_CODE_META_LEFT = \"MetaLeft\";\n\nexport const KEY_CODE_META_RIGHT = \"MetaRight\";\n\nexport const KEY_CODE_MINUS = \"Minus\";\n\nexport const KEY_CODE_NON_CONVERT = \"NonConvert\";\n\nexport const KEY_CODE_NUM_LOCK = \"NumLock\";\n\nexport const KEY_CODE_NUMPAD_0 = \"Numpad0\";\n\nexport const KEY_CODE_NUMPAD_1 = \"Numpad1\";\n\nexport const KEY_CODE_NUMPAD_2 = \"Numpad2\";\n\nexport const KEY_CODE_NUMPAD_3 = \"Numpad3\";\n\nexport const KEY_CODE_NUMPAD_4 = \"Numpad4\";\n\nexport const KEY_CODE_NUMPAD_5 = \"Numpad5\";\n\nexport const KEY_CODE_NUMPAD_6 = \"Numpad6\";\n\nexport const KEY_CODE_NUMPAD_7 = \"Numpad7\";\n\nexport const KEY_CODE_NUMPAD_8 = \"Numpad8\";\n\nexport const KEY_CODE_NUMPAD_9 = \"Numpad9\";\n\nexport const KEY_CODE_NUMPAD_ADD = \"NumpadAdd\";\n\nexport const KEY_CODE_NUMPAD_CHANGE_SIGN = \"NumpadChangeSign\";\n\nexport const KEY_CODE_NUMPAD_COMMA = \"NumpadComma\";\n\nexport const KEY_CODE_NUMPAD_DECIMAL = \"NumpadDecimal\";\n\nexport const KEY_CODE_NUMPAD_DIVIDE = \"NumpadDivide\";\n\nexport const KEY_CODE_NUMPAD_ENTER = \"NumpadEnter\";\n\nexport const KEY_CODE_NUMPAD_EQUAL = \"NumpadEqual\";\n\nexport const KEY_CODE_NUMPAD_MULTIPLY = \"NumpadMultiply\";\n\nexport const KEY_CODE_NUMPAD_PAREN_LEFT = \"NumpadParenLeft\";\n\nexport const KEY_CODE_NUMPAD_PAREN_RIGHT = \"NumpadParenRight\";\n\nexport const KEY_CODE_NUMPAD_SUBTRACT = \"NumpadSubtract\";\n\nexport const KEY_CODE_OPEN = \"Open\";\n\nexport const KEY_CODE_OSLEFT = \"OSLeft\";\n\nexport const KEY_CODE_OSRIGHT = \"OSRight\";\n\nexport const KEY_CODE_PAGE_DOWN = \"PageDown\";\n\nexport const KEY_CODE_PAGE_UP = \"PageUp\";\n\nexport const KEY_CODE_PASTE = \"Paste\";\n\nexport const KEY_CODE_PAUSE = \"Pause\";\n\nexport const KEY_CODE_PERIOD = \"Period\";\n\nexport const KEY_CODE_POWER = \"Power\";\n\nexport const KEY_CODE_PRINT_SCREEN = \"PrintScreen\";\n\nexport const KEY_CODE_PROPS = \"Props\";\n\nexport const KEY_CODE_QUOTE = \"Quote\";\n\nexport const KEY_CODE_SCROLL_LOCK = \"ScrollLock\";\n\nexport const KEY_CODE_SELECT = \"Select\";\n\nexport const KEY_CODE_SEMICOLON = \"Semicolon\";\n\nexport const KEY_CODE_SHIFT_LEFT = \"ShiftLeft\";\n\nexport const KEY_CODE_SHIFT_RIGHT = \"ShiftRight\";\n\nexport const KEY_CODE_SLASH = \"Slash\";\n\nexport const KEY_CODE_SLEEP = \"Sleep\";\n\nexport const KEY_CODE_SPACE = \"Space\";\n\nexport const KEY_CODE_TAB = \"Tab\";\n\nexport const KEY_CODE_UNDO = \"Undo\";\n\nexport const KEY_CODE_UNIDENTIFIED = \"Unidentified\";\n\nexport const KEY_CODE_VOLUME_DOWN = \"VolumeDown\";\n\nexport const KEY_CODE_VOLUME_MUTE = \"VolumeMute\";\n\nexport const KEY_CODE_VOLUME_UP = \"VolumeUp\";\n\nexport const KEY_CODE_WAKE_UP = \"WakeUp\";\n\nexport type KEY_CODE =\n  | \"\"\n  | \"Again\"\n  | \"AltLeft\"\n  | \"AltRight\"\n  | \"ArrowDown\"\n  | \"ArrowLeft\"\n  | \"ArrowRight\"\n  | \"ArrowUp\"\n  | \"AudioVolumeDown\"\n  | \"AudioVolumeMute\"\n  | \"AudioVolumeUp\"\n  | \"Backquote\"\n  | \"Backslash\"\n  | \"Backspace\"\n  | \"BracketLeft\"\n  | \"BracketRight\"\n  | \"BrowserBack\"\n  | \"BrowserFavorites\"\n  | \"BrowserForward\"\n  | \"BrowserHome\"\n  | \"BrowserRefresh\"\n  | \"BrowserSearch\"\n  | \"BrowserStop\"\n  | \"Cancel\"\n  | \"CapsLock\"\n  | \"Comma\"\n  | \"ContextMenu\"\n  | \"ControlLeft\"\n  | \"ControlRight\"\n  | \"Convert\"\n  | \"Copy\"\n  | \"Cut\"\n  | \"Delete\"\n  | \"Digit0\"\n  | \"Digit1\"\n  | \"Digit2\"\n  | \"Digit3\"\n  | \"Digit4\"\n  | \"Digit5\"\n  | \"Digit6\"\n  | \"Digit7\"\n  | \"Digit8\"\n  | \"Digit9\"\n  | \"Eject\"\n  | \"End\"\n  | \"Enter\"\n  | \"Equal\"\n  | \"Escape\"\n  | \"F1\"\n  | \"F2\"\n  | \"F3\"\n  | \"F4\"\n  | \"F5\"\n  | \"F6\"\n  | \"F7\"\n  | \"F8\"\n  | \"F9\"\n  | \"F10\"\n  | \"F11\"\n  | \"F12\"\n  | \"F13\"\n  | \"F14\"\n  | \"F15\"\n  | \"F16\"\n  | \"F17\"\n  | \"F18\"\n  | \"F19\"\n  | \"F20\"\n  | \"F21\"\n  | \"F22\"\n  | \"F23\"\n  | \"F24\"\n  | \"Find\"\n  | \"Fn\"\n  | \"HangulMode\"\n  | \"Hanja\"\n  | \"Help\"\n  | \"Home\"\n  | \"Insert\"\n  | \"IntlBackslash\"\n  | \"IntlRo\"\n  | \"IntlYen\"\n  | \"KanaMode\"\n  | \"KeyA\"\n  | \"KeyB\"\n  | \"KeyC\"\n  | \"KeyD\"\n  | \"KeyE\"\n  | \"KeyF\"\n  | \"KeyG\"\n  | \"KeyH\"\n  | \"KeyI\"\n  | \"KeyJ\"\n  | \"KeyK\"\n  | \"KeyL\"\n  | \"KeyM\"\n  | \"KeyN\"\n  | \"KeyO\"\n  | \"KeyP\"\n  | \"KeyQ\"\n  | \"KeyR\"\n  | \"KeyS\"\n  | \"KeyT\"\n  | \"KeyU\"\n  | \"KeyV\"\n  | \"KeyW\"\n  | \"KeyX\"\n  | \"KeyY\"\n  | \"KeyZ\"\n  | \"Lang1\"\n  | \"Lang2\"\n  | \"LaunchApp1\"\n  | \"LaunchApp2\"\n  | \"LaunchMail\"\n  | \"LaunchMediaPlayer\"\n  | \"MediaPlayPause\"\n  | \"MediaSelect\"\n  | \"MediaStop\"\n  | \"MediaTrackNext\"\n  | \"MediaTrackPrevious\"\n  | \"MetaLeft\"\n  | \"MetaRight\"\n  | \"Minus\"\n  | \"NonConvert\"\n  | \"NumLock\"\n  | \"Numpad0\"\n  | \"Numpad1\"\n  | \"Numpad2\"\n  | \"Numpad3\"\n  | \"Numpad4\"\n  | \"Numpad5\"\n  | \"Numpad6\"\n  | \"Numpad7\"\n  | \"Numpad8\"\n  | \"Numpad9\"\n  | \"NumpadAdd\"\n  | \"NumpadChangeSign\"\n  | \"NumpadComma\"\n  | \"NumpadDecimal\"\n  | \"NumpadDivide\"\n  | \"NumpadEnter\"\n  | \"NumpadEqual\"\n  | \"NumpadMultiply\"\n  | \"NumpadParenLeft\"\n  | \"NumpadParenRight\"\n  | \"NumpadSubtract\"\n  | \"Open\"\n  | \"OSLeft\"\n  | \"OSRight\"\n  | \"PageDown\"\n  | \"PageUp\"\n  | \"Paste\"\n  | \"Pause\"\n  | \"Period\"\n  | \"Power\"\n  | \"PrintScreen\"\n  | \"Props\"\n  | \"Quote\"\n  | \"ScrollLock\"\n  | \"Select\"\n  | \"Semicolon\"\n  | \"ShiftLeft\"\n  | \"ShiftRight\"\n  | \"Slash\"\n  | \"Sleep\"\n  | \"Space\"\n  | \"Tab\"\n  | \"Undo\"\n  | \"Unidentified\"\n  | \"VolumeDown\"\n  | \"VolumeMute\"\n  | \"VolumeUp\"\n  | \"WakeUp\";\n","export const audioContext = new AudioContext();\n\nexport const songAudioSource = audioContext.createBufferSource();\n","#version 300 es\nprecision highp float;\n\n// as printed by the console.log on csm.ts\nconst vec3 lightDir = vec3(-0.6560590289905073, 0.6663690071652679, -0.3543146860766681);\n\n#define CSM_TEXTURE_SIZE 2048.\n\n#define zNear 0.3\n#define CSM_PLANE_DISTANCE 55.\n#define zFar 181.\n\nin highp vec4 VNormal;\nin highp vec4 FragPos;\nin highp vec4 UntransformedFragPos;\nin lowp vec4 Color;\n\nuniform vec3 viewPos;\nuniform mat4 viewMatrix;\nuniform mat4 csm_matrix0;\nuniform mat4 csm_matrix1;\n\nuniform highp sampler2DShadow csm_texture0;\nuniform highp sampler2DShadow csm_texture1;\nuniform highp sampler2D groundTexture;\n\nout vec4 O;\n\nvoid main() {\n  vec4 fragPosVec4 = vec4(FragPos.xyz, 1);\n  vec3 normal = normalize(VNormal.xyz);\n\n  vec3 tex = Color.w *\n    (texture(groundTexture, UntransformedFragPos.yz * .035) * normal.x +\n     texture(groundTexture, UntransformedFragPos.xz * .035) * normal.y +\n     texture(groundTexture, UntransformedFragPos.xy * .035) * normal.z)\n      .xyz;\n\n  // Displacement map\n  normal = normalize(normal.xyz + tex * .5);\n\n  float lambert = dot(normal, lightDir);\n  float shadow = 1.;\n  float depthValue = abs((viewMatrix * fragPosVec4).z);\n\n  // Gets the fragment position in light space\n  vec4 csmCoords = (depthValue < CSM_PLANE_DISTANCE ? csm_matrix0 : csm_matrix1) * fragPosVec4;\n\n  // perform perspective divide and transform to [0,1] range\n  csmCoords = (csmCoords / csmCoords.w) * .5 + .5;\n\n  if (csmCoords.z < 1.) { // Only if inside far plane\n    shadow = 0.;\n\n    // Shadow bias could be computed based on normal and light, something like\n    // 0.0003 * (1. - clamp(dot(normal, lightDir), 0., 1.))\n\n    for (float x = -1.; x <= 1.; ++x) {\n      for (float y = -1.; y <= 1.; ++y) {\n        vec3 c = vec3(\n          csmCoords.xy + vec2(x, y) / CSM_TEXTURE_SIZE,\n          csmCoords.z -\n            // shadow bias\n            (1. / CSM_TEXTURE_SIZE / 2.8)\n        );\n        shadow += depthValue < CSM_PLANE_DISTANCE ? texture(csm_texture0, c) : texture(csm_texture1, c);\n      }\n    }\n    shadow /= 9.;\n  }\n\n  vec3 rgbColor = Color.xyz * (1. - tex.x);\n\n  float lavaLight = max(max(abs(normal.x), abs(normal.z)) * .3 - normal.y, 0.) * pow(max(0., (8. - FragPos.y) / 48.), 1.6);\n\n  O = vec4(\n    // lava light\n    vec3(lavaLight, lavaLight * lavaLight * .5, 0) +\n      // ambient\n      vec3(.09, .05, .11) * rgbColor +\n      // diffuse\n      (rgbColor * (max(0., lambert) * .5 + (rgbColor * lambert * lambert * vec3(.5, .45, .3))) * (shadow * .75 + .25)) +\n      // specular\n      vec3(.6, .6, .5) * pow(max(0., dot(normalize(FragPos.xyz - viewPos), reflect(lightDir, normal))), 35.) * shadow,\n    1\n  );\n}\n","import { DEG_TO_RAD } from \"./math\";\nimport {\n  constDef_zNear,\n  constDef_CSM_PLANE_DISTANCE as CSM_PLANE_DISTANCE,\n  constDef_zFar,\n} from \"../shaders/main-fragment.frag\";\n\nexport const zNear = constDef_zNear;\n\nexport { CSM_PLANE_DISTANCE };\n\nexport const zFar = constDef_zFar;\n\nexport const fieldOfViewDegrees = 60;\n\nexport const fieldOfViewRadians = fieldOfViewDegrees * DEG_TO_RAD; // in radians\n\nexport const fieldOfViewAmount = 1 / Math.tan(fieldOfViewRadians / 2);\n\nexport const mat_perspective = (near: number, far: number, mx: number, my: number) =>\n  new DOMMatrix([\n    mx,\n    0,\n    0,\n    0,\n    0,\n    my,\n    0,\n    0,\n    0,\n    0,\n    (far + near) / (near - far),\n    -1,\n    0,\n    0,\n    (2 * far * near) / (near - far),\n    0,\n  ]);\n","import {\n  GAMEPAD_BUTTON_A,\n  GAMEPAD_BUTTON_B,\n  GAMEPAD_BUTTON_DOWN,\n  GAMEPAD_BUTTON_LEFT,\n  GAMEPAD_BUTTON_RIGHT,\n  GAMEPAD_BUTTON_UP,\n  GAMEPAD_BUTTON_X,\n  GAMEPAD_BUTTON_Y,\n  GAMEPAD_BUTTON_START,\n  type KEY_CODE,\n} from \"./utils/keycodes\";\nimport { abs, clamp, max, threshold } from \"./math/math\";\nimport { camera_rotation, resetGame } from \"./game/world-state\";\nimport { songAudioSource, audioContext } from \"./music/audio-context\";\nimport { CSM_PLANE_DISTANCE, fieldOfViewAmount, mat_perspective, zFar, zNear } from \"./math/matrix-perspective\";\nimport { mainMenuVisible, setMainMenuVisible, absoluteTime, gameTimeDelta } from \"./game/game-time\";\n\nexport let interact_pressed: 0 | 1;\n\nexport const resetInteractPressed = () => {\n  interact_pressed = 0;\n};\n\nexport let player_first_person: 0 | 1 | undefined;\n\nexport let input_forward = 0;\n\nexport let input_strafe = 0;\n\nexport let projection: DOMMatrix;\n\nexport let csm_projections: DOMMatrix[];\n\nexport let updateInput: () => void;\n\nexport const initPage = () => {\n  let touchStartTime: number | undefined;\n\n  let touchPosStartX: number | undefined;\n  let touchPosStartY: number | undefined;\n  let touchPosIdentifier: number | undefined;\n  let touchPosMoved: number | undefined;\n\n  let touchRotX: number | undefined;\n  let touchRotY: number | undefined;\n  let touchRotIdentifier: number | undefined;\n  let touchRotMoved: number | undefined;\n  let touchStartCameraRotX: number | undefined;\n  let touchStartCameraRotY: number | undefined;\n  let touch_movementX: number;\n  let touch_movementY: number;\n\n  let gamepadInteractPressed: 0 | 1 | undefined;\n\n  let music_on = !DEBUG || !DEBUG_FLAG1;\n\n  const keyboard_downKeys: (boolean | 0 | 1 | undefined)[] = [];\n\n  const KEY_INTERACT = 0;\n  const KEY_MENU = 1;\n  const KEY_LEFT = 2;\n  const KEY_RIGHT = 3;\n  const KEY_FRONT = 4;\n  const KEY_BACK = 5;\n\n  const updateMusicOnState = () => {\n    b4.innerHTML = \"Music: \" + music_on;\n    if (mainMenuVisible || !music_on) {\n      songAudioSource.disconnect();\n    } else {\n      // connect the AudioBufferSourceNode to the  destination so we can hear the sound\n      songAudioSource.connect(audioContext.destination);\n    }\n  };\n\n  const handleResize = () => {\n    const mx = ((hC.height = innerHeight) / (hC.width = innerWidth)) * fieldOfViewAmount;\n    csm_projections = [\n      mat_perspective(zNear, CSM_PLANE_DISTANCE, mx, fieldOfViewAmount),\n      mat_perspective(CSM_PLANE_DISTANCE, zFar, mx, fieldOfViewAmount),\n    ];\n    projection = mat_perspective(zNear, zFar, mx, fieldOfViewAmount);\n\n    touchPosIdentifier = touchRotIdentifier = undefined;\n    keyboard_downKeys.length =\n      interact_pressed =\n      gamepadInteractPressed =\n      touch_movementX =\n      touch_movementY =\n      input_forward =\n      input_strafe =\n        0;\n\n    if (document.hidden) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      // mainMenu(true);\n    }\n  };\n\n  const mainMenu = (value: boolean, firstPerson: 0 | 1 = 0) => {\n    if (mainMenuVisible !== value) {\n      setMainMenuVisible(value);\n      player_first_person = firstPerson;\n      handleResize();\n      document.body.className = value ? \"l m\" : \"l\";\n      try {\n        if (value) {\n          document.exitFullscreen().catch(() => 0);\n          document.exitPointerLock();\n        } else {\n          document.body.requestFullscreen().catch(() => 0);\n          songAudioSource.start();\n        }\n      } catch {}\n      updateMusicOnState();\n    }\n  };\n\n  if (!DEBUG) {\n    oncontextmenu = () => false;\n  }\n\n  // \"Play\" button\n  b1.onclick = () => mainMenu(false);\n\n  // \"Play first person\" button\n  b2.onclick = () => mainMenu(false, 1);\n\n  // Menu hamburger button\n  b5.onclick = () => mainMenu(true);\n\n  // \"Music\" button\n  b4.onclick = () => {\n    music_on = !music_on;\n    updateMusicOnState();\n  };\n\n  // \"Restart\" button\n  b3.onclick = () => {\n    // eslint-disable-next-line no-alert\n    if (confirm(\"Restart game?\")) {\n      resetGame();\n    }\n  };\n\n  onclick = (e) => {\n    if (!mainMenuVisible) {\n      if (e.target === hC) {\n        interact_pressed = 1;\n      }\n      if (player_first_person) {\n        try {\n          hC.requestPointerLock();\n        } catch {}\n      }\n    }\n  };\n\n  onkeyup = onkeydown = (e) => {\n    if (!e.repeat) {\n      const pressed = !!e.type[5] && (!DEBUG || e.target === document.body);\n\n      const mapped = (\n        {\n          [\"KeyE\"]: KEY_INTERACT,\n          [\"Space\"]: KEY_INTERACT,\n          [\"Enter\"]: KEY_INTERACT,\n\n          [\"Escape\"]: KEY_MENU,\n\n          [\"KeyA\"]: KEY_LEFT,\n          [\"ArrowLeft\"]: KEY_LEFT,\n\n          [\"KeyD\"]: KEY_RIGHT,\n          [\"ArrowRight\"]: KEY_RIGHT,\n\n          [\"KeyW\"]: KEY_FRONT,\n          [\"ArrowUp\"]: KEY_FRONT,\n\n          [\"KeyS\"]: KEY_BACK,\n          [\"ArrowDown\"]: KEY_BACK,\n        } as Partial<Record<KEY_CODE, number>>\n      )[e.code as KEY_CODE]!;\n\n      keyboard_downKeys[mapped] = pressed;\n\n      if (pressed) {\n        if (mapped === KEY_INTERACT) {\n          interact_pressed = 1;\n        }\n        if (mapped === KEY_MENU) {\n          mainMenu(true);\n        }\n      }\n    }\n  };\n\n  onmousemove = ({ movementX, movementY }) => {\n    if (player_first_person && (movementX || movementY)) {\n      camera_rotation.y += movementX * 0.1;\n      camera_rotation.x += movementY * 0.1;\n    }\n  };\n\n  hC.ontouchstart = (e) => {\n    if (!mainMenuVisible) {\n      for (const { pageX, pageY, identifier } of e.changedTouches) {\n        if (player_first_person && pageX > hC.clientWidth / 2) {\n          if (touchRotIdentifier === undefined) {\n            touchRotMoved = 0;\n            touchRotX = pageX;\n            touchRotY = pageY;\n            touchRotIdentifier = identifier;\n            touchStartCameraRotX = camera_rotation.y;\n            touchStartCameraRotY = camera_rotation.x;\n          }\n        } else if (touchPosIdentifier === undefined) {\n          touchPosMoved = 0;\n          touchPosStartX = pageX;\n          touchPosStartY = pageY;\n          touchPosIdentifier = identifier;\n        }\n      }\n      touchStartTime = absoluteTime;\n    }\n  };\n\n  const TOUCH_SIZE = 20;\n  const TOUCH_MOVE_THRESHOLD = 0.5;\n  const TOUCH_MOVE_SNAP = 0.2;\n\n  hC.ontouchmove = (e) => {\n    if (!mainMenuVisible) {\n      for (const { pageX, pageY, identifier } of e.changedTouches) {\n        if (touchRotIdentifier === identifier) {\n          camera_rotation.y = touchStartCameraRotX! + (pageX - touchRotX!) / 2.3;\n          camera_rotation.x = touchStartCameraRotY! + (pageY - touchRotY!) / 2.3;\n          touchRotMoved = 1;\n        }\n        if (touchPosIdentifier === identifier) {\n          const deltaX = (touchPosStartX! - pageX) / TOUCH_SIZE;\n          const absDeltaX = abs(deltaX);\n          const deltaY = (touchPosStartY! - pageY) / TOUCH_SIZE;\n          const absDeltaY = abs(deltaY);\n\n          const m = max(absDeltaX, absDeltaY) > TOUCH_MOVE_THRESHOLD;\n          if (m) {\n            // Moved, disable the click\n            touchPosMoved = 1;\n          }\n\n          touch_movementX = +(m && absDeltaX > TOUCH_MOVE_SNAP) * clamp(deltaX, -1);\n          touch_movementY = +(m && absDeltaY > TOUCH_MOVE_SNAP) * clamp(deltaY, -1);\n\n          // Move the invisible joysticks\n          if (absDeltaX > 2) {\n            touchPosStartX = pageX + (deltaX < 0 ? -1 : 1) * TOUCH_SIZE;\n          }\n          if (absDeltaY > 2) {\n            touchPosStartY = pageY + (deltaY < 0 ? -1 : 1) * TOUCH_SIZE;\n          }\n        }\n      }\n    }\n  };\n\n  hC.ontouchend = (e) => {\n    if (document.activeElement === document.body) {\n      e.preventDefault();\n    }\n\n    let click: 1 | undefined;\n    for (const touch of e.changedTouches) {\n      if (touch.identifier === touchRotIdentifier) {\n        touchRotIdentifier = undefined;\n        if (!touchRotMoved) {\n          click = 1;\n        }\n        touchRotMoved = 0;\n      } else if (touch.identifier === touchPosIdentifier) {\n        touchPosIdentifier = undefined;\n        touch_movementY = touch_movementX = 0;\n        if (!touchPosMoved) {\n          click = 1;\n        }\n        touchPosMoved = 0;\n      } else {\n        click = 1;\n      }\n    }\n\n    if (e.target === hC && click && touchStartTime) {\n      const diff = absoluteTime - touchStartTime;\n      if (diff > 0.02 && diff < 0.7) {\n        interact_pressed = 1;\n      }\n    }\n  };\n\n  updateInput = () => {\n    input_forward = touch_movementY + (keyboard_downKeys[KEY_FRONT] ? 1 : 0) - (keyboard_downKeys[KEY_BACK] ? 1 : 0);\n    input_strafe = touch_movementX + (keyboard_downKeys[KEY_LEFT] ? 1 : 0) - (keyboard_downKeys[KEY_RIGHT] ? 1 : 0);\n\n    const gamepad = navigator.getGamepads()[0];\n    if (gamepad) {\n      const { buttons, axes } = gamepad;\n      const getGamepadButtonState = (index: number) =>\n        buttons[index]?.pressed || (buttons[index]?.value as any) > 0 ? 1 : 0;\n\n      if (player_first_person) {\n        camera_rotation.x += gameTimeDelta * threshold(axes[3], 0.3) * 80;\n        camera_rotation.y += gameTimeDelta * threshold(axes[2], 0.3) * 80;\n      }\n\n      input_forward +=\n        getGamepadButtonState(GAMEPAD_BUTTON_UP) - getGamepadButtonState(GAMEPAD_BUTTON_DOWN) - threshold(axes[1], 0.2);\n\n      input_strafe +=\n        getGamepadButtonState(GAMEPAD_BUTTON_LEFT) -\n        getGamepadButtonState(GAMEPAD_BUTTON_RIGHT) -\n        threshold(axes[0], 0.2);\n\n      if (getGamepadButtonState(GAMEPAD_BUTTON_START)) {\n        mainMenu(true);\n      }\n\n      const interactButtonPressed =\n        getGamepadButtonState(GAMEPAD_BUTTON_X) ||\n        getGamepadButtonState(GAMEPAD_BUTTON_Y) ||\n        getGamepadButtonState(GAMEPAD_BUTTON_A) ||\n        getGamepadButtonState(GAMEPAD_BUTTON_B);\n\n      if (interactButtonPressed && !gamepadInteractPressed) {\n        interact_pressed = 1;\n      }\n      gamepadInteractPressed = interactButtonPressed;\n    }\n  };\n\n  document.onvisibilitychange = onblur = onresize = handleResize;\n\n  mainMenu(!DEBUG || !!DEBUG_FLAG2);\n\n  if (DEBUG) {\n    console.log(\"fieldOfViewAmount:\", fieldOfViewAmount);\n  }\n};\n","import {\n  levers,\n  souls,\n  allModels,\n  MODEL_ID_FIRST_BOAT,\n  MODEL_KIND_GAME,\n  type MODEL_KIND,\n  type Model,\n  type Circle,\n  type Lever,\n  type Soul,\n} from \"./models\";\nimport { player_position_final, onLever0Pulled, onPlayerPullLever, onSoulCollected } from \"./world-state\";\nimport type { Vec3Optional } from \"../math/vectors\";\nimport { min, angle_lerp_degrees, DEG_TO_RAD, clamp, abs, hypot } from \"../math/math\";\nimport { matrixCopy, matrixTransformPoint, tempMatrix } from \"../math/matrix\";\nimport { lerpDamp, damp, gameTime } from \"./game-time\";\nimport { polygons_transform, type Polygon } from \"../geometry/polygon\";\nimport { cylinder } from \"../geometry/geometry\";\nimport { material } from \"../geometry/material\";\nimport { interact_pressed } from \"../page\";\n\nexport let currentEditModel: Model;\n\nexport const meshAdd = (\n  polygons: Polygon<Readonly<Vec3Optional>>[],\n  transform: DOMMatrixReadOnly = new DOMMatrix(),\n  color?: number | undefined,\n) => currentEditModel.$polygons!.push(...polygons_transform(polygons, transform, color));\n\nexport const newModel = (fn: () => void, $kind: MODEL_KIND = MODEL_KIND_GAME): void => {\n  const previousModel = currentEditModel;\n  allModels.push((currentEditModel = { $matrix: new DOMMatrix(), $kind, $polygons: [] }));\n  fn();\n  currentEditModel = previousModel;\n};\n\nconst LEVER_SENSITIVITY_RADIUS = 3;\nconst SOUL_SENSITIVITY_RADIUS = 1.6;\n\nconst distanceToPlayer = (): number => {\n  matrixTransformPoint();\n  return hypot(\n    player_position_final.x - matrixTransformPoint.x,\n    player_position_final.y - matrixTransformPoint.y,\n    player_position_final.z - matrixTransformPoint.z,\n  );\n};\n\nexport const newLever = ($transform: DOMMatrixReadOnly): void => {\n  const parentModel = currentEditModel;\n  const index = levers.length;\n  const lever: Lever = {\n    $value: 0,\n    $lerpValue: 0,\n    $lerpValue2: 0,\n    $matrix: parentModel.$matrix,\n    $transform,\n    _update: () => {\n      lever.$lerpValue = lerpDamp(lever.$lerpValue, lever.$value, 4);\n      lever.$lerpValue2 = lerpDamp(lever.$lerpValue2, lever.$value, 1);\n\n      matrixCopy(parentModel.$matrix).multiplySelf($transform);\n\n      if (interact_pressed && distanceToPlayer() < LEVER_SENSITIVITY_RADIUS) {\n        if (lever.$lerpValue < 0.3 || lever.$lerpValue > 0.7) {\n          lever.$value = lever.$value ? 0 : 1;\n          onPlayerPullLever(index);\n        }\n      }\n\n      if (!index && lever.$value && lever.$lerpValue > 0.8) {\n        lever.$value = 0;\n        onLever0Pulled();\n      }\n\n      tempMatrix.rotateSelf(lever.$lerpValue * 60 - 30, 0).translateSelf(0, 1);\n    },\n  };\n  levers.push(lever);\n\n  meshAdd(cylinder(5), $transform.translate(-0.2).rotate(90, 90).scale(0.4, 0.1, 0.5), material(0.4, 0.5, 0.5));\n  meshAdd(cylinder(5), $transform.translate(0.2).rotate(90, 90).scale(0.4, 0.1, 0.5), material(0.4, 0.5, 0.5));\n  meshAdd(cylinder(), $transform.translate(0, -0.4).scale(0.5, 0.1, 0.5), material(0.5, 0.5, 0.4));\n};\n\nexport const newSoul = (transform: DOMMatrixReadOnly, ...walkingPath: number[][]) => {\n  let dirX = -1;\n  let dirZ = 0;\n  let randAngle = 0;\n  let lookAngle: number;\n  let prevX: number;\n  let prevZ: number;\n  let velocity = 3;\n  let wasInside: boolean | undefined | 1 = 1;\n\n  const circles = (walkingPath as Circle[]).map(([x, z, w]) => ({ x, z, w }));\n  let circle = circles[0]!;\n  let { x: targetX, z: targetZ } = circle;\n  let soulX = targetX;\n  let soulZ = targetZ;\n\n  const parentModelMatrix = currentEditModel.$matrix;\n  const index = souls.length;\n  const soul: Soul = {\n    $value: 0,\n    _update: () => {\n      if (!soul.$value) {\n        let isInside: boolean | undefined;\n        let contextualVelocity = 1;\n        let mindist = Infinity;\n\n        for (const c of circles) {\n          const { x, z, w } = c;\n          const distance = hypot(targetX - x, targetZ - z);\n          const circleSDF = distance - w;\n          isInside ||= circleSDF < 0;\n          if (circleSDF > 0 && circleSDF < mindist) {\n            mindist = circleSDF;\n            circle = c;\n          }\n          contextualVelocity = min(contextualVelocity, distance / w);\n        }\n\n        if (!isInside) {\n          const { x, z, w } = circle;\n          const ax = targetX - x;\n          const az = targetZ - z;\n          let magnitude = hypot(ax, az);\n          let angle = Math.atan2(-az, ax);\n          if (wasInside) {\n            randAngle = ((Math.random() - 0.5) * Math.PI) / 2;\n            velocity = clamp(velocity / (1 + Math.random()));\n          }\n          angle += randAngle;\n          dirX = -Math.cos(angle);\n          dirZ = Math.sin(angle);\n          if (magnitude > 0.1) {\n            // limit the vector length to the circle radius, as a security measure\n            magnitude = min(magnitude, w) / (magnitude || 1);\n            targetX = ax * magnitude + x;\n            targetZ = az * magnitude + z;\n          }\n        }\n\n        wasInside = isInside;\n\n        velocity = lerpDamp(velocity, (1 - contextualVelocity) * 6 + 3, contextualVelocity + 3);\n        soulX = lerpDamp(soulX, (targetX = lerpDamp(targetX, targetX + dirX, velocity)), velocity);\n        soulZ = lerpDamp(soulZ, (targetZ = lerpDamp(targetZ, targetZ + dirZ, velocity)), velocity);\n\n        lookAngle = angle_lerp_degrees(lookAngle, Math.atan2(soulX - prevX, soulZ - prevZ) / DEG_TO_RAD - 180, damp(3));\n\n        matrixCopy(parentModelMatrix)\n          .multiplySelf(transform)\n          .translateSelf((prevX = soulX), 0, (prevZ = soulZ))\n          .rotateSelf(0, lookAngle, Math.sin(gameTime * 1.7) * 7);\n\n        if (distanceToPlayer() < SOUL_SENSITIVITY_RADIUS) {\n          soul.$value = 1;\n          onSoulCollected();\n        }\n      }\n\n      if (soul.$value) {\n        matrixCopy(allModels[MODEL_ID_FIRST_BOAT]!.$matrix).translateSelf(\n          (index % 4) * 1.2 - 1.7 + Math.sin(gameTime + index) / 7,\n          -2,\n          -5.5 + ((index / 4) | 0) * 1.7 + abs((index % 4) - 2) + Math.cos(gameTime / 1.5 + index) / 6,\n        );\n      }\n    },\n  };\n  souls.push(soul);\n\n  if (DEBUG_FLAG0) {\n    for (const c of circles) {\n      meshAdd(cylinder(12), transform.translate(c.x, -1.7, c.z).scale(c.w, 0.01, c.w), material(0.3, 0.3, 0.38));\n    }\n  }\n};\n\nexport const checkModelId = DEBUG\n  ? (name: string, expectedId: number) => {\n      const modelId = allModels.length - 1;\n      console.log(`model ${name} id: ${modelId}`);\n      if (modelId !== expectedId) {\n        throw new Error(`Model ${name} id should be ${expectedId} but is ${modelId}`);\n      }\n    }\n  : () => {};\n","import { hypot } from \"./math\";\n\nexport interface Vec2 {\n  x: number;\n  y: number;\n}\n\nexport interface Vec3 {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport interface Vec4 {\n  x: number;\n  y: number;\n  z: number;\n  w: number;\n}\n\nexport interface Vec3Optional {\n  x?: number | undefined;\n  y?: number | undefined;\n  z?: number | undefined;\n}\n\nexport interface Plane {\n  x: number;\n  y: number;\n  z: number;\n  w: number;\n}\n\nexport type Vec2In = Readonly<Vec2>;\n\nexport type Vec3In = Readonly<Vec3>;\n\nexport type Vec4In = Readonly<Vec4>;\n\nexport const vec3_dot = /* @__PURE__ */ ({ x, y, z }: Vec3In, b: Vec3In): number => x * b.x + y * b.y + z * b.z;\n\n/**\n * Computes a polygon plane using the Newell's method.\n * We are not using plane from 3 points algorithm,\n * because this can handle coplanar points and has precision problems.\n */\nexport const plane_fromPolygon = /* @__PURE__ */ (polygon: readonly Vec3In[]): Plane => {\n  // Newell's method\n  let x = 0;\n  let y = 0;\n  let z = 0;\n  let a = polygon.at(-1)!;\n  let b: Vec3In | number;\n  for (b of polygon) {\n    x += (a.y - b.y) * (a.z + b.z);\n    y += (a.z - b.z) * (a.x + b.x);\n    z += (a.x - b.x) * (a.y + b.y);\n    a = b;\n  }\n  b = hypot(x, y, z);\n  x /= b;\n  y /= b;\n  z /= b;\n  return { x, y, z, w: x * a.x + y * a.y + z * a.z };\n};\n","import type { Plane, Vec3, Vec3In } from \"../math/vectors\";\nimport { vec3_dot, plane_fromPolygon } from \"../math/vectors\";\nimport { polygon_color, type Polygon } from \"./polygon\";\n\nexport const PLANE_EPSILON = 0.00008;\n\nexport interface CSGPolygon {\n  $polygon: Polygon;\n\n  $flipped: 0 | boolean;\n\n  /**\n   * When a polygon is splitted, this will contain the polygon from which this polygon was splitted.\n   * This is then used by csg_polygons to merge back splitted polygons if they are both present,\n   * to reduce the number of vertices and triangles.\n   */\n  $parent: CSGPolygon | 0;\n}\n\nexport interface CSGNode extends Plane {\n  /** Coplanar polygons */\n  $polygons: CSGPolygon[];\n  /** Front child */\n  $front: CSGNode | 0;\n  /** Back child */\n  $back: CSGNode | 0;\n}\n\nexport type CSGInput = CSGNode | readonly Polygon[];\n\ninterface SplitPolygonResult {\n  $front: CSGPolygon | undefined | false;\n  $back: CSGPolygon | undefined | false;\n}\n\nconst CSGPolygon_splitSpanning = /* @__PURE__ */ (plane: Plane, polygon: CSGPolygon): SplitPolygonResult => {\n  const fpoints: Vec3[] = [];\n  const bpoints: Vec3[] = [];\n  const { $polygon, $flipped } = polygon;\n  let jd: number;\n  let iv: Vec3In = $polygon.at(-1)!;\n  let id: number = vec3_dot(plane, iv) - plane.w;\n  for (const jv of $polygon) {\n    jd = vec3_dot(plane, jv) - plane.w;\n    if (id < PLANE_EPSILON) {\n      bpoints.push(iv);\n    }\n    if (id > -PLANE_EPSILON) {\n      fpoints.push(iv);\n    }\n    if ((id > PLANE_EPSILON && jd < -PLANE_EPSILON) || (id < -PLANE_EPSILON && jd > PLANE_EPSILON)) {\n      id /= jd - id;\n      iv = {\n        x: iv.x + (iv.x - jv.x) * id,\n        y: iv.y + (iv.y - jv.y) * id,\n        z: iv.z + (iv.z - jv.z) * id,\n      };\n      fpoints.push(iv);\n      bpoints.push(iv);\n    }\n    iv = jv;\n    id = jd;\n  }\n  return {\n    $front: fpoints.length > 2 && {\n      $polygon: polygon_color(fpoints, $polygon.$color, $polygon.$smooth),\n      $flipped,\n      $parent: polygon,\n    },\n    $back: bpoints.length > 2 && {\n      $polygon: polygon_color(bpoints, $polygon.$color, $polygon.$smooth),\n      $flipped,\n      $parent: polygon,\n    },\n  };\n};\n\nconst CSGPolygon_split = /* @__PURE__ */ (plane: Plane, polygon: CSGPolygon): SplitPolygonResult => {\n  const { $polygon } = polygon;\n  let $front: CSGPolygon | undefined;\n  let $back: CSGPolygon | undefined;\n  let d: number;\n  for (let i = 0; i < $polygon.length; ++i) {\n    d = vec3_dot(plane, $polygon[i]!) - plane.w;\n    if (d < -PLANE_EPSILON) {\n      $back = polygon;\n    } else if (d > PLANE_EPSILON) {\n      $front = polygon;\n    }\n    if ($back && $front) {\n      return CSGPolygon_splitSpanning(plane, polygon);\n    }\n  }\n  return { $front, $back };\n};\n\nconst csg_tree_addPolygon = /* @__PURE__ */ (\n  node: CSGNode | 0 | undefined,\n  polygon: CSGPolygon,\n  plane: Plane = plane_fromPolygon(polygon.$polygon),\n): CSGNode => {\n  if (node) {\n    const { $front, $back } = CSGPolygon_split(node, polygon);\n    if (!$front && !$back) {\n      node.$polygons.push(polygon); // Coplanar\n    }\n    if ($front) {\n      node.$front = csg_tree_addPolygon(node.$front, $front, plane);\n    }\n    if ($back) {\n      node.$back = csg_tree_addPolygon(node.$back, $back, plane);\n    }\n  } else {\n    const { x, y, z, w } = plane;\n    node = { x, y, z, w, $polygons: [polygon], $front: 0, $back: 0 };\n  }\n  return node;\n};\n\nconst csg_tree_clipNode = /* @__PURE__ */ (\n  anode: CSGNode,\n  bnode: CSGNode,\n  polygonPlaneFlipped: -1 | 1,\n): CSGPolygon[] => {\n  const result: CSGPolygon[] = [];\n  const recursion = (node: CSGNode, polygon: CSGPolygon) => {\n    let { $front, $back } = CSGPolygon_split(node, polygon);\n    if (!$front && !$back) {\n      if (polygonPlaneFlipped * vec3_dot(node, bnode) > 0) {\n        $front = polygon; // Coplanar front\n      } else {\n        $back = polygon; // Coplanar back\n      }\n    }\n    if ($front) {\n      if (node.$front) {\n        recursion(node.$front, $front);\n      } else {\n        result.push($front);\n      }\n    }\n    if ($back && node.$back) {\n      recursion(node.$back, $back);\n    }\n  };\n\n  for (const polygon of bnode.$polygons) {\n    recursion(anode, polygon);\n  }\n  return result;\n};\n\n/** Loop through all nodes in a tree */\nconst csg_tree_each = (node: CSGNode | 0 | undefined, fn: (node: CSGNode) => void): unknown =>\n  node && (fn(node), csg_tree_each(node.$front, fn), csg_tree_each(node.$back, fn));\n\n/** Convert solid space to empty space and empty space to solid space. */\nexport const csg_tree_flip = <T extends CSGNode | 0 | undefined>(root: T): T => {\n  csg_tree_each(root, (node) => {\n    const back = node.$back;\n    node.$back = node.$front;\n    node.$front = back;\n    node.x *= -1;\n    node.y *= -1;\n    node.z *= -1;\n    node.w *= -1;\n    for (const polygon of node.$polygons) {\n      polygon.$flipped = !polygon.$flipped;\n    }\n  });\n  return root;\n};\n\n/**\n * Extracts all the polygons from a BSP tree.\n * Some polygons will be merged, to reduce the number of triangles.\n */\nexport const csg_polygons = /* @__PURE__ */ (tree: CSGNode): Polygon[] => {\n  const byParent = new Map<CSGPolygon, CSGPolygon>();\n  const allPolygons = new Map<CSGPolygon, 0 | boolean>();\n\n  /** Adds a polygon, and replaces two splitted polygons that have the same parent with the parent */\n  const add = (polygon: CSGPolygon): CSGPolygon => {\n    if (polygon.$parent) {\n      const found = byParent.get(polygon.$parent);\n      if (found) {\n        allPolygons.delete(found);\n        polygon = add(polygon.$parent);\n      } else {\n        byParent.set(polygon.$parent, polygon);\n      }\n    }\n    return polygon;\n  };\n\n  csg_tree_each(tree, (node) => {\n    for (const polygon of node.$polygons) {\n      allPolygons.set(add(polygon), polygon.$flipped);\n    }\n  });\n\n  return Array.from(allPolygons, ([{ $polygon }, flipped]) => {\n    const polygon = $polygon.map(({ x, y, z }) => ({ x, y, z }));\n    return polygon_color(flipped ? polygon.reverse() : polygon, $polygon.$color, $polygon.$smooth);\n  });\n};\n\n/**\n * If the given argument is a list of polygons, a new BSP tree built from the list of polygons is returned.\n * If the given argument is already a BSP tree, return it as is.\n * Note that array cannot be empty.\n */\nexport const csg_tree = /* @__PURE__ */ (n: CSGInput): CSGNode =>\n  (n as Polygon[]).length\n    ? // Build a BSP tree from a list of polygons\n      ((n as Polygon[]).reduce<CSGNode | 0>(\n        (prev, $polygon) => csg_tree_addPolygon(prev, { $polygon, $flipped: 0, $parent: 0 }),\n        0,\n      ) as CSGNode)\n    : // An object? We assume is a BSP tree.\n      (n as CSGNode);\n\n/**\n * Union a[0] = a[0] U a[1] U a[2] U ...\n */\nexport const csg_union = /* @__PURE__ */ (...inputs: CSGInput[]): CSGNode =>\n  inputs.reduce((a: CSGInput, b: CSGInput | undefined): CSGNode => {\n    const polygonsToAdd: [Plane, CSGPolygon[]][] = [];\n    a = csg_tree(a);\n    if (b) {\n      b = csg_tree(b);\n\n      // clip to a, b\n      csg_tree_each(a, (node) => (node.$polygons = csg_tree_clipNode(b as CSGNode, node, 1)));\n\n      // get the list of polygons to be added from b clipped to a\n      csg_tree_each(b, (node) => polygonsToAdd.push([node, csg_tree_clipNode(a as CSGNode, node, -1)]));\n\n      // add the polygons to a\n      for (const [plane, polygons] of polygonsToAdd) {\n        for (const pp of polygons) {\n          csg_tree_addPolygon(a, pp, plane);\n        }\n      }\n    }\n    return a;\n  }) as CSGNode;\n\n/**\n * Subtraction a = a - (b[0] U b[1] U ...)\n * Note that a will be modified if is a tree.\n */\nexport const csg_subtract = /* @__PURE__ */ (a: CSGInput, ...b: CSGInput[]): CSGNode =>\n  csg_tree_flip(csg_union(csg_tree_flip(csg_tree(a)), ...b));\n\n/**\n * Subtraction a - (b[0] U b[1] U ...)\n * Note that a will be modified if is a tree.\n */\nexport const csg_polygons_subtract = (a: CSGInput, ...b: CSGInput[]) =>\n  csg_polygons(csg_tree_flip(csg_union(csg_tree_flip(csg_tree(a)), ...b)));\n","import {\n  levers,\n  souls,\n  MODEL_KIND_MESH,\n  MODEL_KIND_GAME_NO_ATTACH_PLAYER,\n  MODEL_ID_FIRST_BOAT,\n  MODEL_ID_PLAYER_BODY,\n  MODEL_ID_PLAYER_LEG0,\n  MODEL_ID_PLAYER_LEG1,\n  MODEL_ID_LEVER,\n  MODEL_ID_SOUL_COLLISION,\n  MODEL_ID_SOUL,\n  MODEL_ID_ROTATING_PLATFORM,\n} from \"./models\";\nimport { abs } from \"../math/math\";\nimport { GQuad, cylinder, polygon_regular, sphere, cylinder_sides } from \"../geometry/geometry\";\nimport { polygon_transform, polygons_transform, type Polygon } from \"../geometry/polygon\";\nimport { translation, rotation, scaling } from \"../math/matrix-transforms\";\nimport { integers_map } from \"../math/integers-map\";\nimport { checkModelId, meshAdd, newLever, newModel, newSoul } from \"./models-factory\";\nimport { material } from \"../geometry/material\";\nimport { csg_union, csg_polygons_subtract } from \"../geometry/csg\";\n\nexport const build_life_the_universe_and_everything = (): 42 | void => {\n  const HORN_STACKS = 10;\n\n  if (DEBUG) {\n    console.time(\"build_life_the_universe_and_everything\");\n  }\n\n  const hornsMatrices = integers_map(HORN_STACKS + 1, (i: number) =>\n    translation(Math.sin((i / HORN_STACKS) * Math.PI), i / HORN_STACKS)\n      .rotate(10 * (i / HORN_STACKS))\n      .scale(1.0001 - i / HORN_STACKS, 0, 1 - i / HORN_STACKS),\n  );\n\n  const hornPolygons = integers_map(HORN_STACKS, (i) =>\n    cylinder_sides(\n      polygon_transform(polygon_regular(18), hornsMatrices[i]!).reverse(),\n      polygon_transform(polygon_regular(18), hornsMatrices[i + 1]!),\n      1,\n    ),\n  ).flat();\n\n  // Initialize the full screen triangle for the sky. Must be the first model.\n\n  newModel(() => meshAdd([GQuad.slice(1)], translation(-2).scale3d(3).rotate(90, 0)), MODEL_KIND_MESH);\n\n  newModel(() => {\n    const makeBigArcPolygons = (height: number) =>\n      csg_polygons_subtract(\n        polygons_transform(cylinder(), translation(0, -height / 2).scale(6, height - 1, 2.2)),\n        polygons_transform(cylinder(), translation(0, -height / 2 - 6).scale(4, height - 3, 4)),\n        polygons_transform(\n          cylinder(32, 1),\n          translation(0, height / 2 - 9)\n            .rotate(90, 0, 90)\n            .scale3d(4),\n        ),\n      );\n\n    const boatPolygons = csg_polygons_subtract(\n      polygons_transform(\n        cylinder(30, 1, 1.15, 1),\n        translation(0, -3).scale(3.5, 1, 3.5),\n        material(0.7, 0.4, 0.25, 0.7),\n      ),\n      polygons_transform(cylinder(30, 1, 1.3, 1), translation(0, -2.5).scale(2.6, 1, 3), material(0.7, 0.4, 0.25, 0.2)),\n      polygons_transform(cylinder(), translation(4, -1.2).scale3d(2), material(0.7, 0.4, 0.25, 0.3)),\n    );\n\n    const gateBarsModel = () =>\n      newModel(() =>\n        integers_map(7, (i) =>\n          meshAdd(\n            polygons_transform(\n              cylinder(6, 1),\n              translation(4 * (i / 6 - 0.5), 3).scale(0.2, 3, 0.2),\n              material(0.3, 0.3, 0.38),\n            ),\n          ),\n        ),\n      );\n\n    // ========= FIRST BOAT (modelId:2) ========= //\n\n    newModel(() => {\n      checkModelId(\"FIRST_BOAT\", MODEL_ID_FIRST_BOAT);\n      meshAdd(boatPolygons);\n\n      // LEVER 0 - lever over the first boat\n      newLever(translation(0, -3, 4));\n    });\n\n    // LEVER 1 - lever for the first gate, after the first boat\n    newLever(translation(-5.4, 1.5, -19).rotate(0, -90));\n\n    // ========= WORLD! ========= //\n\n    // SOUL 0 - soul after first boat\n    newSoul(translation(-0.5, 2.8, -20), [0, 0, 2.5], [0, -3, 2.5]);\n\n    // SOUL 1 - soul after first gate\n    newSoul(\n      translation(0, 2.8),\n      [5, 10, 3],\n      [-5, 10, 3],\n      ...polygon_regular(18).map(({ x, z }) => [x * 7, z * 10, 4.5 - abs(x) * 2]),\n    );\n\n    // gate columns\n    GQuad.map(({ x, z }) =>\n      meshAdd(cylinder(6), translation(x * 3, 3, z * 15).scale(0.7, 4, 0.7), material(0.6, 0.3, 0.3, 0.4)),\n    );\n\n    [-15, 15].map((z, j) => {\n      // all 4 gate bars\n      gateBarsModel();\n      gateBarsModel();\n\n      //  gate top\n      meshAdd(cylinder(), translation(0, 6.3, z).scale(4, 0.3, 1), material(0.3, 0.3, 0.3, 0.4));\n      //  gate bottom\n      meshAdd(cylinder(), translation(0, 1, z).scale(3, 0.2, 0.35), material(0.5, 0.5, 0.5, 0.3));\n\n      // in and out\n      meshAdd(cylinder(), translation(0, 0, j ? 22 : -23).scale(3, 1, 8), material(0.9, 0.9, 0.9, 0.2));\n\n      // horns\n      integers_map(5, (i) =>\n        meshAdd(\n          hornPolygons,\n          translation((j - 0.5) * 18.5, 0, i * 4.8 - 9.5)\n            .rotate(0, 180 - j * 180)\n            .scale(1.2, 10, 1.2),\n          material(1, 1, 0.8, 0.2),\n        ),\n      );\n    });\n\n    // first boat attachment\n    meshAdd(cylinder(), translation(-5, -0.2, -26).scale(3.2, 1, 2.5).skewX(3), material(0.8, 0.8, 0.8, 0.2));\n\n    // small entrance wall\n    meshAdd(cylinder(), translation(3, 1.5, -20).scale(0.5, 2, 5), material(0.7, 0.7, 0.7, 0.2));\n\n    // first lever pad\n    meshAdd(cylinder(), translation(-3.4, -0.2, -19).scale(2, 1, 1.5).rotate(0, -90), material(0.75, 0.75, 0.75, 0.2));\n    meshAdd(cylinder(5), translation(-5.4, 0, -19).scale(2, 1, 2).rotate(0, -90), material(0.6, 0.3, 0.3, 0.4));\n\n    // descent\n\n    meshAdd(\n      cylinder(),\n      rotation(0, 60).translate(14.8, -1.46, -1).rotate(-30).scale(4, 0.6, 4.5),\n      material(0.8, 0.2, 0.2, 0.5),\n    );\n\n    // base\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          // lower base\n          polygons_transform(\n            cylinder(6, 0, 0, 0.3),\n            translation(8, -3, -4).scale(13, 1, 13),\n            material(0.7, 0.7, 0.7, 0.2),\n          ),\n\n          // hole extension\n          polygons_transform(cylinder(6), translation(0, -8).scale(9, 8, 8), material(0.4, 0.2, 0.5, 0.5)),\n\n          // middle base\n          polygons_transform(\n            cylinder(6, 0, 0, 0.3),\n            translation(0, -0.92).scale(13, 2, 13),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n        ),\n        // hole\n        polygons_transform(cylinder(5), scaling(5, 30, 5), material(0.4, 0.2, 0.6, 0.5)),\n\n        // smooth hole\n        polygons_transform(cylinder(5, 0, 1.5), translation(0, 1).scale(4.5, 0.3, 4.5), material(0.7, 0.5, 0.9, 0.2)),\n\n        // descent cut\n        polygons_transform(\n          cylinder(),\n          rotation(0, 60).translate(14, 0.7, -1).rotate(-35).scale(2, 2, 2),\n          material(0.5, 0.5, 0.5, 0.5),\n        ),\n\n        // lower lever pad\n        polygons_transform(cylinder(6), translation(15, -1.5, 4).scale(3.5, 1, 3.5), material(0.5, 0.5, 0.5, 0.5)),\n      ),\n    );\n\n    // moving central platform in the first level\n\n    newModel(() => {\n      meshAdd(cylinder(5), translation(0, -0.2).scale(5, 1, 5), material(0.6, 0.65, 0.7, 0.3));\n\n      // LEVER 2 - lever over the central moving platform\n      newLever(translation(0, 1.2));\n    });\n\n    // LEVER 3, lever in the descent of the first level\n    newLever(translation(15, -2, 4));\n\n    // ******** LEVEL 2 ********\n\n    // central oscillating platform\n    newModel(() => {\n      meshAdd(\n        csg_polygons_subtract(\n          csg_union(\n            polygons_transform(cylinder(), scaling(1.5, 1, 5), material(0.9, 0.9, 0.9, 0.2)),\n            polygons_transform(cylinder(6), scaling(4, 1, 5), material(0.9, 0.9, 0.9, 0.2)),\n            polygons_transform(cylinder(), translation(0, -2).scale(2, 3.2, 1.9), material(0.3, 0.8, 0.5, 0.5)),\n            polygons_transform(cylinder(16, 1, 0, 4), scaling(1, 1, 1.5).rotate(0, 90), material(0.9, 0.9, 0.9, 0.2)),\n          ),\n          polygons_transform(cylinder(), scaling(1.3, 10, 1.3), material(0.2, 0.7, 0.4, 0.6)),\n        ),\n        translation(0, 0, 45),\n      );\n\n      // SOUL 2 - soul over the central oscillating platform in the second level\n      newSoul(translation(0, 2.8, 45), [0, 0, 4.5]);\n    });\n\n    // black platforms in the second level\n\n    const blackPlatform = (pz: number) =>\n      newModel(() => {\n        GQuad.map(({ x, z }) => {\n          // column body\n          meshAdd(cylinder(11, 1), translation(x * 4, 4, pz + z * 4).scale(0.8, 3, 0.8), material(0.5, 0.3, 0.7, 0.6));\n          // column top\n          meshAdd(cylinder(), translation(x * 4, 7, pz + z * 4).scale(1, 0.3), material(0.5, 0.5, 0.5, 0.3));\n        });\n\n        meshAdd(\n          csg_polygons_subtract(\n            polygons_transform(cylinder(), translation(0, 0, pz).scale(5, 1, 5), material(0.8, 0.8, 0.8, 0.3)),\n            ...[-1, 1].map((i) =>\n              polygons_transform(\n                cylinder(),\n                translation(5 * i, 0.2, pz)\n                  .rotate(i * -30)\n                  .scale(4, 1, 2),\n                material(0.8, 0.8, 0.8, 0.3),\n              ),\n            ),\n          ),\n        );\n        // bottom\n        meshAdd(cylinder(), translation(0, -3, pz).scale(8, 2, 8), material(0.4, 0.4, 0.4, 0.3));\n      });\n\n    blackPlatform(35);\n    blackPlatform(55);\n\n    // ******** LEVEL 3 ********\n\n    meshAdd(cylinder(), translation(-21.1 + 2.45, -3, 55).scale(2.45, 1.4, 2.7), material(0.9, 0.9, 0.9, 0.2));\n\n    // triangle platform\n\n    newModel(() => {\n      meshAdd(cylinder(3), translation(-23, -1.7, 55.8).scale(5, 0.7, 8.3), material(0.3, 0.6, 0.6, 0.2));\n      meshAdd(cylinder(8), translation(-23, -2.2, 66.5).scale(1.5, 1.2, 1.5), material(0.8, 0.8, 0.8, 0.2));\n      meshAdd(cylinder(), translation(-23, -3, 55).scale(5.2, 1.7, 3), material(0.5, 0.5, 0.5, 0.3));\n      meshAdd(cylinder(), translation(-23, -2.2, 62).scale(3, 1, 4), material(0.5, 0.5, 0.5, 0.3));\n\n      newLever(translation(-23, -0.5, 66.5));\n    });\n\n    // vertically oscillating mini platforms\n\n    newModel(() => {\n      meshAdd(cylinder(), translation(-21.1 - 1.45, -3, 55).scale(1.45, 1.4, 2.7), material(0.7, 0.7, 0.7, 0.2));\n\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(), scaling(3, 1.4, 2.7)),\n          polygons_transform(cylinder(), scaling(1.2, 8, 1.2)),\n        ),\n        translation(-33, -3, 55),\n        material(0.7, 0.7, 0.7, 0.2),\n      );\n    });\n\n    // horizontaly oscillating mini platforms\n\n    newModel(() => {\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(), translation(-27, -3, 55).scale(3, 1.4, 2.7), material(0.9, 0.9, 0.9, 0.2)),\n          polygons_transform(cylinder(), translation(-27, -3, 55).scale(1, 3), material(0.9, 0.9, 0.9, 0.2)),\n        ),\n      );\n\n      meshAdd(cylinder(), translation(-39, -3, 55).scale(3, 1.4, 2.7), material(0.9, 0.9, 0.9, 0.2));\n    });\n\n    // hex corridor door\n\n    newModel(() => {\n      meshAdd(\n        cylinder(6),\n        translation(-44.5, 0, 55).rotate(90, 90).rotate(0, 90).scale(5.9, 0.5, 5.9),\n        material(0.7, 0.7, 0.7, 0.4),\n      );\n    });\n\n    newLever(translation(-55, -1.1, 46).rotate(0, 90));\n\n    meshAdd(cylinder(6), translation(-61.3, -2.4, 49).scale(3, 1, 5), material(0.4, 0.6, 0.6, 0.3));\n    meshAdd(cylinder(7), translation(-57, -2.6, 46).scale(4, 1, 4), material(0.8, 0.8, 0.8, 0.3));\n\n    // hex corridor\n\n    const hexCorridorPolygons = [\n      ...polygons_transform(cylinder(), translation(0, -3).scale(11, 1.4, 3), material(0.9, 0.9, 0.9, 0.2)),\n      ...polygons_transform(cylinder(), translation(0, -2.2).scale(7.7, 0.5, 4), material(0.5, 0.5, 0.5, 0.2)),\n      ...csg_polygons_subtract(\n        polygons_transform(cylinder(6), rotation(90).scale(6, 8, 6), material(0.3, 0.6, 0.6, 0.3)),\n        polygons_transform(\n          cylinder(4, 0, 0.01),\n          translation(0, 6).scale(12, 2, 0.75).rotate(0, 45),\n          material(0.3, 0.6, 0.6, 0.3),\n        ),\n        polygons_transform(cylinder(6), rotation(90).scale(5, 12, 5), material(0.3, 0.6, 0.6, 0.3)),\n        ...[5, 0, -5].map((x) =>\n          polygons_transform(\n            cylinder(5),\n            translation(x, 2.5).rotate(90, 0, 36).scale(1.8, 10, 1.8),\n            material(0.3, 0.6, 0.6, 0.3),\n          ),\n        ),\n      ),\n    ];\n\n    meshAdd(hexCorridorPolygons, translation(-53, 0, 55));\n\n    // rotating hex corridor\n\n    newModel(() => meshAdd(hexCorridorPolygons), MODEL_KIND_GAME_NO_ATTACH_PLAYER);\n\n    // connection from rotating hex corridor to platforms\n\n    meshAdd(cylinder(), translation(-88.3, -5.1, 55).rotate(-30).scale(5, 1.25, 4.5), material(0.7, 0.7, 0.7, 0.2));\n\n    meshAdd(\n      cylinder(3, 0, -0.5),\n      translation(-88.4, -3.9, 55).rotate(0, -90, 17).scale(3, 1.45, 5.9),\n      material(0.8, 0.8, 0.8, 0.2),\n    );\n\n    // platform after the rotating hex corridor\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          // base\n          polygons_transform(cylinder(), translation(-100, -2.4, 55).scale(8, 0.9, 8), material(0.8, 0.8, 0.8, 0.2)),\n          // right path to the boat\n          polygons_transform(\n            cylinder(),\n            translation(-113, -2.6, 55).scale(6.2, 1.1, 3).skewX(3),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n          // straiht line\n          polygons_transform(cylinder(), translation(-100, -2.6, 70).scale(3, 1.1, 7), material(0.8, 0.8, 0.8, 0.2)),\n          // 45 degrees detour\n          polygons_transform(\n            cylinder(),\n            translation(-96, -2.6, 73).rotate(0, 45).scale(3, 1.1, 5),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n          // 45 degrees detour hexagon\n          polygons_transform(\n            cylinder(6),\n            translation(-88.79, -2.6, 80.21).scale(6, 1.1, 6).rotate(0, 15),\n            material(0.6, 0.6, 0.6, 0.3),\n          ),\n\n          // ascension\n          polygons_transform(\n            cylinder(),\n            translation(-100, -1.1, 82.39).rotate(-15, 0).scale(3, 1.1, 6),\n            material(0.8, 0.8, 0.8, 0.2),\n          ),\n          // ascension continuation\n          polygons_transform(cylinder(), translation(-100, 0.42, 92).scale(3, 1.1, 4.1), material(0.8, 0.8, 0.8, 0.2)),\n        ),\n\n        // decorative octagon\n        polygons_transform(cylinder(8), translation(-100, -1, 55).scale(7, 0.9, 7), material(0.3, 0.3, 0.3, 0.4)),\n        polygons_transform(cylinder(8), translation(-100, -2, 55).scale(4, 0.3, 4), material(0.4, 0.4, 0.4, 0.5)),\n        polygons_transform(\n          cylinder(8, 0, -3.1),\n          translation(-100, -3, 55).scale(0.4, 1, 0.4),\n          material(0.4, 0.4, 0.4, 0.5),\n        ),\n      ),\n    );\n\n    // SOUL 3 - soul in the central area, after the rotating hex corridor\n    newSoul(translation(-100, 0.2, 55), [0, 0, 7.5], [-8, 0, 3.5], [-12, 0, 3.5], [-15, 0, 3.5]);\n\n    // SOUL 4 - soul after the central gate\n    newSoul(translation(-89, 0.2, 80), [0, 0, 6]);\n\n    // first arc door\n\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(cylinder(), translation(-100, 1, 63).scale(7.5, 4), material(0.5, 0.5, 0.5, 0.4)),\n        polygons_transform(cylinder(), translation(-100, 0, 70).scale(2, 2, 10), material(0.5, 0.5, 0.5, 0.4)),\n        polygons_transform(\n          cylinder(20, 1),\n          translation(-100, 2, 70).scale(2, 2, 10).rotate(90, 0),\n          material(0.5, 0.5, 0.5, 0.4),\n        ),\n      ),\n    );\n\n    // hex columns\n\n    GQuad.map(({ x, z }) => {\n      meshAdd(cylinder(6), translation(-100 + x * 7, -3, z * 7 + 55).scale(1, 8.1), material(0.6, 0.15, 0.15, 0.8));\n      [4, -0.4].map((i) =>\n        meshAdd(\n          cylinder(6),\n          translation(-100 + x * 7, i, z * 7 + 55).scale(1.3, 0.5, 1.3),\n          material(0.4, 0.2, 0.2, 0.8),\n        ),\n      );\n    });\n\n    // crystals\n\n    integers_map(7, (i) => {\n      meshAdd(\n        cylinder(((i * 23 + 1) % 5) + 5, 0, 0.5),\n        translation(-101 + Math.sin(i) * 5 + i, -2.3 - i, 44.9 - i * 2.8).scaleSelf(5 + i / 2, 1 + i / 6, 5 + i / 3),\n        material(0.5 - i / 17, 0.5 - (i & 1) / 9, 0.6, 0.3),\n      );\n    });\n\n    // crystals continuation pad\n\n    meshAdd(cylinder(), translation(-87, -9.5, 24).scale(7, 1, 3), material(0.4, 0.5, 0.6, 0.4));\n\n    // lever pad\n\n    meshAdd(cylinder(4), translation(-86, -9.2, 27).scale(5, 1, 5), material(0.5, 0.6, 0.7, 0.3));\n\n    meshAdd(cylinder(12, 1), translation(-86, -9, 31).scale(1.5, 1, 1.5), material(0.3, 0.3, 0.4, 0.1));\n\n    newLever(translation(-86, -7.5, 31));\n\n    // elevators\n\n    // TODO: this can be looped with 2 materials\n\n    newModel(() => {\n      [0, 12, 24].map((x) =>\n        meshAdd(\n          cylinder(),\n          translation(x - 76.9, x / -16 - 10, 24)\n            .rotate(0, 0, -2)\n            .skewX(-2)\n            .scale(2.8, 1.4, 3),\n          material(0.2, 0.5, 0.6, 0.2),\n        ),\n      );\n    });\n\n    newModel(() => {\n      [6, 18].map((x) =>\n        meshAdd(\n          cylinder(),\n          translation(x - 76.9, x / -16 - 10, 24)\n            .rotate(0, 0, -2)\n            .skewX(-2)\n            .scale(2.8, 1.4, 3),\n          material(0.1, 0.4, 0.5, 0.2),\n        ),\n      );\n    });\n\n    // pad after elevators\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          // lever pad\n          polygons_transform(cylinder(5), translation(0, 0, -7).scale(2, 1.2, 2), material(0.2, 0.4, 0.7, 0.3)),\n          // blue pentagon\n          polygons_transform(cylinder(5), scaling(9, 1.2, 9), material(0, 0.2, 0.3, 0.5)),\n          // base\n          polygons_transform(cylinder(), scaling(11, 1, 13), material(0.3, 0.4, 0.6, 0.3)),\n        ),\n        polygons_transform(cylinder(5), scaling(5.4, 5, 5.4), material(0, 0.2, 0.3, 0.5)),\n      ),\n      translation(-38.9, -11.3, 17),\n    );\n\n    newLever(translation(-38.9, -9.6, 10));\n\n    // central sculpture/monument\n\n    newModel(() => {\n      meshAdd(\n        csg_polygons_subtract(\n          csg_union(\n            polygons_transform(cylinder(5), translation(0, 2).scale(5, 7, 5).skewY(8), material(0.2, 0.4, 0.5, 0.5)),\n            polygons_transform(\n              cylinder(5),\n              translation(0, 6).scale(1.1, 7, 1.1).skewY(-8),\n              material(0.25, 0.35, 0.5, 0.5),\n            ),\n            polygons_transform(\n              cylinder(5),\n              translation(0, 9).scale(0.6, 7, 0.6).skewY(8),\n              material(0.35, 0.3, 0.5, 0.5),\n            ),\n          ),\n          polygons_transform(cylinder(5), scaling(4, 8, 4), material(0.2, 0.4, 0.5, 0.5)),\n          polygons_transform(\n            cylinder(5),\n            translation(0, 5).scale(1.5, 1.5, 8).rotate(90, 0, 35),\n            material(0.2, 0.4, 0.5, 0.5),\n          ),\n        ),\n        translation(-38.9, -11.3, 17),\n      );\n\n      // SOUL 5 - soul over the central sculpture/monument\n      newSoul(translation(-39.1, -0.6, 17).rotate(11), ...polygon_regular(15).map(({ x, z }) => [x * 3, z * 3, 1.2]));\n    });\n\n    // columns\n\n    GQuad.map(({ x, z }) => {\n      meshAdd(cylinder(14, 1), translation(x * 9 - 38.9, -7.3, z * 11 + 17).scale(1, 4), material(0.25, 0.25, 0.25, 1));\n      [1.5, 8].map((y) =>\n        meshAdd(\n          cylinder(17, 1),\n          translation(x * 9 - 38.9, y - 11.3, z * 11 + 17).scale(1.5, 0.5, 1.5),\n          material(0.6, 0.6, 0.6, 0.3),\n        ),\n      );\n    });\n\n    // Grid with holes\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          // holed base\n          polygons_transform(cylinder(6), translation(0, 0, -36).scale(15, 1.2, 15), material(0.7, 0.7, 0.7, 0.3)),\n          // after monument continuation\n          polygons_transform(cylinder(), translation(0, 0, -18).scale(4, 1.2, 6), material(0.45, 0.4, 0.6, 0.3)),\n        ),\n        ...integers_map(6, (z) =>\n          integers_map(6, (x) =>\n            polygons_transform(\n              cylinder(6),\n              translation(x * 4.6 - 12 + 2 * (z & 1), 0, z * 4.6 - 50 + Math.sin(x * 4) * 2).scale(2, 5, 2),\n              material(0.7, 0.7, 0.7, 0.3),\n            ),\n          ),\n        ).flat(),\n      ),\n      translation(-38.9, -11.3, 17),\n    );\n\n    // SOUL 6 - soul over the grid with hex holes\n    newSoul(translation(-38.9, -8.4, -21), [-7, -2.5, 6], [6, -3, 6], [0, -5, 7]);\n\n    // Detour lever pad\n    meshAdd(cylinder(5), translation(-84, -2, 85).scale(4, 0.8, 4).rotate(0, 10), material(0.8, 0.1, 0.25, 0.4));\n\n    // Detour lever\n    newLever(translation(-84, -0.5, 85).rotate(0, 45));\n\n    // ******** SECOND BOAT ********\n\n    newModel(() => {\n      meshAdd(boatPolygons);\n      newLever(translation(0, -3, -4).rotate(0, 180));\n    });\n\n    // ******** LEVEL AFTER SECOND BOAT ********\n\n    // pushing rods\n\n    const pushingRod = csg_polygons_subtract(\n      polygons_transform(cylinder(), translation(0, -0.5, 1).scale(1.15, 1.2, 6.5), material(0.25, 0.25, 0.35, 0.3)),\n      csg_polygons_subtract(\n        polygons_transform(cylinder(3), translation(0, 0, -5.5).scale(3, 2), material(0.6, 0.3, 0.4, 0.3)),\n        polygons_transform(cylinder(), translation(0, 0, -3.65).scale(2.5, 3), material(0.6, 0.3, 0.4, 0.3)),\n      ),\n      ...[-1, 1].map((i) =>\n        polygons_transform(cylinder(), translation(i * 1.2, -0.5, 1).scale(0.14, 0.3, 6.5), material(0.7, 0.2, 0, 0.3)),\n      ),\n    );\n\n    newModel(() => integers_map(2, (x) => meshAdd(pushingRod, translation(-110 + x * 9 + (x & 1), 1.9, -12))));\n    newModel(() => integers_map(2, (x) => meshAdd(pushingRod, translation(-110 + (x + 2) * 9 + (x & 1), 1.9, -12))));\n    newModel(() => integers_map(3, (x) => meshAdd(pushingRod, translation(-106 + x * 9, 1.9, -12))));\n\n    // pushing rods container\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          polygons_transform(cylinder(), translation(26.5, -1.6, 10).scale(20, 2.08, 3)),\n          polygons_transform(cylinder(), translation(26.5, -0.5, 10).scale(19, 2, 0.5)),\n        ),\n        ...integers_map(4, (x) =>\n          polygons_transform(cylinder(), translation(13 + x * 9 + (x & 1), -0.8, 9).scale(1.35, 1.35, 9)),\n        ),\n        ...integers_map(3, (x) =>\n          polygons_transform(cylinder(), translation(17 + x * 9, -0.8, 9).scale(1.35, 1.35, 9)),\n        ),\n      ),\n      translation(-123, 0.2, -12),\n      material(0.5, 0.5, 0.6, 0.2),\n    );\n\n    // boat attachment\n\n    newLever(translation(-116, -1.4, -18).rotate(0, 180));\n\n    meshAdd(cylinder(), translation(-116, -2.6, -12).scale(3.2, 1.1, 4).skewX(3), material(0.8, 0.8, 0.8, 0.2));\n    meshAdd(cylinder(6), translation(-116, -2.6, -16.5).scale(3.2, 0.8, 3), material(0.6, 0.5, 0.7, 0.2));\n\n    meshAdd(cylinder(), translation(-115.5, -17, -12).scale(0.5, 15, 2.2), material(0.6, 0.6, 0.6, 0.3));\n\n    meshAdd(cylinder(8), translation(-114, -17, -2).scale(2, 15, 2), material(0.6, 0.6, 0.6, 0.3));\n    meshAdd(cylinder(8), translation(-79, -17, -2).scale(2, 15, 2), material(1, 1, 1, 0.3));\n\n    meshAdd(cylinder(), translation(-77, -17, -50.5).scale(2.2, 15, 0.5), material(0.6, 0.6, 0.6, 0.3));\n\n    // arcs\n\n    integers_map(3, (i) => {\n      meshAdd(makeBigArcPolygons(16), translation(i * 12 - 109, -9, -12), material(0.6, 0.6, 0.6, 0.3));\n\n      meshAdd(\n        makeBigArcPolygons(16),\n        translation(-77, -9, i * -12 - 8 - 12).rotate(0, 90),\n        material(0.6, 0.6, 0.6, 0.3),\n      );\n    });\n\n    // tower\n\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(cylinder(12), translation(-77, -14.5, -12).scale(4, 17.5, 4), material(0.7, 0.7, 0.7, 0.2)),\n        polygons_transform(cylinder(), translation(-79, 0.1, -12).scale(3.5, 2, 1.3), material(0.4, 0.5, 0.6, 0.2)),\n        polygons_transform(cylinder(), translation(-77, 0.1, -14).scale(1.5, 2, 2), material(0.4, 0.5, 0.6, 0.2)),\n        polygons_transform(cylinder(12), translation(-77, 3.1, -12).scale(3, 5, 3), material(0.4, 0.5, 0.6, 0.2)),\n      ),\n    );\n\n    // internal pad\n\n    meshAdd(cylinder(), translation(-84.9, -4.3, -40).rotate(12).scale(6, 1, 3), material(0.6, 0.6, 0.6, 0.3));\n    meshAdd(cylinder(9), translation(-98, -18.4, -40).scale(2.5, 13.5, 2.5), material(0.5, 0.5, 0.5, 0.3));\n\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(cylinder(), translation(-93, -5.8, -40).scale(9, 1, 5), material(0.8, 0.8, 0.8, 0.1)),\n        polygons_transform(cylinder(9), translation(-98, -5.8, -40).scale(3, 8, 3), material(0.7, 0.7, 0.7, 0.2)),\n      ),\n    );\n\n    newLever(translation(-98, -4.4, -40).rotate(0, 90));\n\n    // SOUL 7 - soul after the second boat\n    newSoul(translation(-115, 0.2, -12), [0, 0, 3.5]);\n\n    // SOUL 8 - soul in the internal pad after the pushing rods\n    newSoul(translation(-93, -3, -28 - 12).rotate(4), [0, -2, 3.5], [0, 2, 3.5]);\n\n    // ******** LEVEL AFTER CENTRAL GATE ********\n\n    // base\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          polygons_transform(\n            cylinder(6, 0, 0, 0.6),\n            translation(-100, 0.7, 105.5).scale(8, 1, 11),\n            material(0.7, 0.7, 0.7, 0.2),\n          ),\n          polygons_transform(\n            cylinder(),\n            translation(-101.5, 0.7, 93.5).scale(10.5, 1, 2),\n            material(0.7, 0.7, 0.7, 0.2),\n          ),\n        ),\n        polygons_transform(cylinder(5), translation(-100, 0.7, 113).scale(4, 3, 4), material(0.7, 0.7, 0.7, 0.2)),\n      ),\n    );\n\n    // oscillating hex pads\n\n    integers_map(4, (i) =>\n      newModel(() =>\n        meshAdd(\n          cylinder(6),\n          translation(-14.6 - i * 4.8 - (i > 2 ? 2 : 0), -i / 2.5 - 0.1, -21.5)\n            .rotate(0, 0, 3.5)\n            .skewX(3.5)\n            .scale(2.6, 1, 2.5),\n          material(0.5 - i / 8, i / 12 + 0.5, 0.7, 0.3),\n        ),\n      ),\n    );\n\n    // after the hex pads\n\n    // donut pad\n    newModel(() => {\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(10), scaling(6, 2, 6), material(0.1, 0.6, 0.5, 0.3)),\n          polygons_transform(cylinder(10), scaling(3.3, 6, 3.3), material(0.1, 0.6, 0.5, 0.5)),\n        ),\n      );\n\n      // second pad\n      meshAdd(cylinder(15, 1), translation(-7.5).rotate(0, 90).scale(3, 2.3, 3), material(0.4, 0.4, 0.4, 0.3));\n      meshAdd(cylinder(10), translation(-7.5).rotate(0, 90).scale(2, 2.5, 2), material(0.3, 0.8, 0.7, 0.3));\n      meshAdd(cylinder(5), translation(-7.5).rotate(0, 90).scale(1, 3), material(0.5, 0.5, 0.5, 0.5));\n      newLever(translation(-7.5).rotate(0, 90).translate(0, 3.4).rotate(0, 180));\n\n      // lateral horns\n      [-1, 1].map((i) =>\n        meshAdd(\n          hornPolygons,\n          rotation(i * 90, 180, 90)\n            .translate(0, 5)\n            .rotate(40)\n            .scale(1.3, 10, 1.3),\n          material(1, 1, 0.8, 0.2),\n        ),\n      );\n\n      // SOUL 9 - soul after the hex pads, in the hex donut with horns\n      newSoul(translation(-5, 4), [0, -1.2, 1.7], [0, 1.2, 1.7]);\n    });\n\n    // far arc gate\n    [-1, 1].map((x) => {\n      [7.2, 1.5].map((y) =>\n        meshAdd(\n          cylinder(15, 1),\n          translation(-7.5 * x - 100, y + 0.7, 96).scale(1.1, 0.5, 1.1),\n          material(0.5, 0.24, 0.2, 0.4),\n        ),\n      );\n\n      meshAdd(\n        hornPolygons,\n        translation(x * -5 - 100, 1.7, 114.5)\n          .scale(1.2, 10, 1.2)\n          .rotate(0, 90 * x - 90),\n        material(1, 1, 0.8),\n      );\n\n      meshAdd(cylinder(12, 1), translation(-7.5 * x - 100, 3.7, 96).scale(0.8, 4, 0.8), material(0.6, 0.24, 0.2, 0.5));\n\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(), translation(x * -4, 3.5, -0.5).scale(4, 4, 0.7), material(0.5, 0.5, 0.5, 0.4)),\n          polygons_transform(cylinder(), scaling(3, 3, 10), material(0.6, 0.24, 0.2, 0.5)),\n          polygons_transform(\n            cylinder(28, 1),\n            translation(0, 3, -5).scale(3, 4, 10).rotate(90, 0),\n            material(0.6, 0.24, 0.2, 0.5),\n          ),\n          polygons_transform(\n            cylinder(5),\n            translation(x * -5.3, 7)\n              .rotate(90, 0)\n              .scale(1.7, 5, 1.7),\n            material(0.6, 0.24, 0.2, 0.5),\n          ),\n          polygons_transform(\n            cylinder(5),\n            translation(x * -5.3, 3.8)\n              .rotate(90, 0, 35)\n              .scale(0.75, 5, 0.75),\n            material(0.6, 0.24, 0.2, 0.5),\n          ),\n        ),\n        translation(x - 100, 0.7, 97),\n      );\n    });\n\n    // left continuation with hole for rotating corridor\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(cylinder(), translation(-82.07, 0.8, 106).scale(11, 0.9, 2.2), material(0.7, 0.7, 0.7, 0.1)),\n        polygons_transform(cylinder(45, 1), translation(-81, 0.7, 106).scale3d(7.7), material(0.7, 0.7, 0.7, 0.1)),\n      ),\n    );\n\n    // rotating platforms\n\n    // First rotating platform (with hole)\n    newModel(() => {\n      checkModelId(\"ROTATING_PLATFORM\", MODEL_ID_ROTATING_PLATFORM);\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(45, 1), scaling(7.5, 1, 7.5), material(0.45, 0.45, 0.45, 0.2)),\n          polygons_transform(cylinder(), translation(0, 0, -5.5).scale(1.5, 3, 2.7), material(0.45, 0.45, 0.45, 0.2)),\n        ),\n      );\n      meshAdd(cylinder(8), translation(0, 2).scale(3, 1.5, 3).rotate(0, 22), material(0.7, 0.7, 0.7, 0.1));\n      meshAdd(cylinder(5), translation(0, 2).scale(1, 2), material(0.3, 0.3, 0.3, 0.2));\n\n      // SOUL 10 - soul over the first rotating platform\n      newSoul(translation(0, 3), ...polygon_regular(14).map(({ x, z }) => [x * 5.6, z * 5.6, 2]));\n    });\n\n    // Second rotating platform\n    newModel(() => {\n      // rotating platform horns\n      [-1, 1].map((x) =>\n        meshAdd(\n          hornPolygons,\n          rotation(0, 90)\n            .translate(x * -5, 1, -0.5)\n            .scale(1.2, 10, 1.2)\n            .rotate(0, 90 * x + 90),\n          material(1, 1, 0.8),\n        ),\n      );\n\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(28, 1), translation(0, 2).scale(7.5, 1, 7.5), material(0.35, 0, 0, 0.3)),\n          polygons_transform(cylinder(), scaling(9, 5, 2), material(0.3, 0, 0, 0.3)),\n        ),\n      );\n\n      meshAdd(polygons_transform(cylinder(28, 1), scaling(7.5, 1, 7.5), material(0.45, 0.45, 0.45, 0.2)));\n      meshAdd(polygons_transform(cylinder(5), translation(0, 1).scale(1, 0.2), material(0.3, 0.3, 0.3, 0.2)));\n    });\n\n    // Third rotating platform\n    newModel(() => {\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(28, 1), translation(0, 2).scale(7.5, 1, 7.5), material(0.35, 0, 0, 0.3)),\n          polygons_transform(cylinder(), translation(7).scale(9, 5, 2), material(0.3, 0, 0, 0.3)),\n          polygons_transform(cylinder(), translation(0, 0, 7).scale(2, 5, 9), material(0.3, 0, 0, 0.3)),\n        ),\n      );\n      meshAdd(polygons_transform(cylinder(28, 1), scaling(7.5, 1, 7.5), material(0.45, 0.45, 0.45, 0.2)));\n      meshAdd(polygons_transform(cylinder(5), translation(0, 1).scale(1, 0.2), material(0.3, 0.3, 0.3, 0.2)));\n    });\n\n    // Fourth rotating platform\n    newModel(() => {\n      meshAdd(\n        csg_polygons_subtract(\n          polygons_transform(cylinder(28, 1), translation(0, 2).scale(7.5, 1, 7.5), material(0.35, 0, 0, 0.3)),\n          polygons_transform(cylinder(), translation(7).scale(9, 5, 2), material(0.3, 0, 0, 0.3)),\n          polygons_transform(cylinder(), translation(0, 0, -7).scale(2, 5, 9), material(0.3, 0, 0, 0.3)),\n        ),\n      );\n      meshAdd(polygons_transform(cylinder(28, 1), scaling(7.5, 1, 7.5), material(0.45, 0.45, 0.45, 0.2)));\n      meshAdd(polygons_transform(cylinder(5), translation(0, 1).scale(1, 0.2), material(0.3, 0.3, 0.3, 0.2)));\n    });\n\n    // rotating platforms connecting pads\n    meshAdd(cylinder(), translation(-58, 1, 106).scale(2, 0.65, 2), material(0.7, 0.7, 0.7, 0.2));\n    meshAdd(cylinder(), translation(-50.7, 1, 99).scale(2, 0.65, 1), material(0.7, 0.7, 0.7, 0.2));\n\n    // exit from the rotating platforms\n    meshAdd(cylinder(), translation(-42, 0.4, 91).scale(5, 1, 2.5), material(0.7, 0.7, 0.7, 0.3));\n    meshAdd(cylinder(), translation(-34.2, 0.4, 91).scale(3, 1, 3), material(0.7, 0.7, 0.7, 0.3));\n\n    newLever(translation(-34, 2.7, 96).rotate(-12, 0));\n\n    // lever pad\n    meshAdd(cylinder(5), translation(-34, 0.2, 96).scale(3, 2, 4).rotate(-20, 0), material(0.2, 0.5, 0.5, 0.6));\n\n    // ******** LEVEL AFTER THE ROTATING PLATFORMS ********\n\n    // jumping pads\n\n    [material(0.1, 0.55, 0.45, 0.2), material(0.2, 0.5, 0.5, 0.3), material(0.3, 0.45, 0.55, 0.4)].map((m, i) =>\n      newModel(() => {\n        meshAdd(cylinder(), translation(-23.5, 0.5, 91 + 6.8 * i).scale(i === 1 ? 2 : 3.3, 1, 3.3), m);\n        if (i === 2) {\n          // in connection\n          meshAdd(cylinder(), translation(-29.1, 0.4, 91).scale(2.1, 1, 3), material(0.7, 0.7, 0.7, 0.3));\n        }\n        if (i === 1) {\n          // out connections\n          meshAdd(\n            cylinder(),\n            translation(-16.1, 0.5, 103.5).rotate(-3.5).scale(3.9, 0.8, 2).skewX(-1),\n            material(0.6, 0.6, 0.7, 0.3),\n          );\n        }\n      }),\n    );\n\n    // horns\n    [-1, 1].map((x) =>\n      meshAdd(\n        hornPolygons,\n        translation(x * -8, 1, 85)\n          .scale(1.2, 10, 1.2)\n          .rotate(0, 90 * x + 90),\n        material(1, 1, 0.8),\n      ),\n    );\n\n    integers_map(3, (i) =>\n      meshAdd(\n        makeBigArcPolygons(16 + 8.7 - (i & 1) * 0.7),\n        translation(i * 6 - 6, 4 - (i & 1), 111 - 0.2 * (i & 1)),\n        i & 1 ? material(0.5, 0.5, 0.5, 0.3) : material(0.35, 0.35, 0.35, 0.5),\n      ),\n    );\n\n    // middle base\n    meshAdd(\n      csg_polygons_subtract(\n        polygons_transform(\n          cylinder(6, 0, 0, 0.3),\n          translation(0, -0.92, 95).scale(14, 2, 14),\n          material(0.8, 0.8, 0.8, 0.2),\n        ),\n        polygons_transform(cylinder(5), translation(0, 0, 95).scale3d(6), material(0.3, 0.3, 0.3, 0.5)),\n      ),\n    );\n\n    newLever(translation(0, 1.7, 82).rotate(0, 180));\n\n    // lever pad\n\n    meshAdd(cylinder(5), translation(0, -15.7, 82).scale(2.5, 17, 2.5).rotate(0, 35), material(0.5, 0.3, 0.3, 0.4));\n\n    meshAdd(cylinder(6), translation(0, 16, 121).scale(2.5, 1, 2.1).rotate(0, 90), material(0.5, 0.6, 0.7, 0.3));\n    meshAdd(cylinder(), translation(0, 16, 129).scale(1.5, 1, 2), material(0.5, 0.6, 0.7, 0.3));\n    meshAdd(cylinder(7), translation(0, 16.2, 133).scale(5, 1, 5), material(0.4, 0.5, 0.6, 0.4));\n\n    meshAdd(\n      csg_polygons_subtract(\n        csg_union(\n          polygons_transform(cylinder(), translation(0, 16, 110.5).scale(12, 1, 3), material(0.5, 0.3, 0.3, 0.4)),\n          polygons_transform(cylinder(), translation(0, 16, 111).scale(3, 1, 3.8), material(0.5, 0.3, 0.3, 0.4)),\n        ),\n\n        polygons_transform(cylinder(5), translation(0, 16, 103.5).scale(5.5, 5, 5.5), material(0.5, 0.3, 0.3, 0.4)),\n      ),\n    );\n\n    // pendulums\n    newModel(() => {\n      meshAdd(\n        cylinder(3),\n        translation(0, -3, 118.8).scale(0.8, 0.8, 18).rotate(90, 0, 60),\n        material(0.5, 0.3, 0.3, 0.4),\n      );\n      [22, 30].map((z) => {\n        meshAdd(\n          cylinder(6),\n          translation(0, 16, z + 95)\n            .scale(3, 1, 2.3)\n            .rotate(0, 90),\n          material(0.7, 0.7, 0.7, 0.4),\n        );\n        meshAdd(cylinder(), translation(0, 6.2, z + 95).scale(0.5, 11, 0.5), material(0.5, 0.3, 0.3, 0.4));\n      });\n    });\n\n    // floating elevator pad\n    newModel(() => {\n      meshAdd(cylinder(5), scaling(5, 1.1, 5), material(0.5, 0.3, 0.3, 0.4));\n      meshAdd(cylinder(5), scaling(5.5, 0.9, 5.5), material(0.25, 0.25, 0.25, 0.4));\n\n      newLever(translation(0, 1.5, -1).rotate(0, 180));\n    });\n\n    // SOUL 11 - soul in the last platform\n    newSoul(translation(0, 3, 95), ...polygon_regular(9).map(({ x, z }) => [x * 9, z * 9, 4]));\n\n    // SOUL 12 - soul after the pendulums\n    newSoul(translation(0, 19, 134), [0, 0, 3.5]);\n  });\n\n  // ------ End of game models ------\n\n  // ------ player model and legs, must be declared just after level model ------\n\n  newModel(() => {\n    checkModelId(\"PLAYER_BODY\", MODEL_ID_PLAYER_BODY);\n\n    // head\n    meshAdd(sphere(20), translation(0, 1).scale3d(0.5), material(1, 0.3, 0.4));\n\n    // body\n    meshAdd(sphere(30), scaling(0.65, 0.8, 0.55), material(1, 0.3, 0.4));\n\n    // mouth\n    meshAdd(cylinder(), translation(0, 0.9, 0.45).scale(0.15, 0.02, 0.06), material(0.3, 0.3, 0.3));\n\n    [-1, 1].map((i) => {\n      // horns\n      meshAdd(\n        hornPolygons,\n        rotation(0, i > 0 ? 180 : 0)\n          .translate(0.2, 1.32)\n          .rotate(-30)\n          .scale(0.2, 0.6, 0.2),\n        material(1, 1, 0.8),\n      );\n\n      // eyes\n      meshAdd(\n        polygons_transform(\n          csg_polygons_subtract(cylinder(15, 1), polygons_transform(cylinder(), translation(0, 0, 1).scale(2, 2, 0.5))),\n          rotation(-90, 0).scale(0.1, 0.05, 0.1),\n          material(0.3, 0.3, 0.3),\n        ),\n        translation(i * 0.2, 1.2, 0.4).rotate(0, i * 20, i * 20),\n      );\n\n      // legs\n      newModel(() => {\n        checkModelId(\"PLAYER_LEG\" + (i < 0 ? 0 : 1), i < 0 ? MODEL_ID_PLAYER_LEG0 : MODEL_ID_PLAYER_LEG1);\n        meshAdd(cylinder(20, 1), translation(i * 0.3, -0.8).scale(0.2, 0.7, 0.24), material(1, 0.3, 0.4));\n      });\n    });\n  });\n\n  newModel(() => {\n    checkModelId(\"SOUL_COLLISION\", MODEL_ID_SOUL_COLLISION);\n    meshAdd(cylinder(6).slice(0, -1), scaling(0.77, 1, 0.77), material(1, 0.3, 0.5));\n  }, MODEL_KIND_MESH);\n\n  newModel(() => {\n    checkModelId(\"SOUL\", MODEL_ID_SOUL);\n    const GHOST_SLICES = 30;\n    const GHOST_STACKS = 24;\n\n    // body\n    meshAdd(\n      sphere(GHOST_SLICES, GHOST_STACKS, (a: number, b: number, polygon: Polygon) => {\n        const bm = b / GHOST_STACKS;\n        const theta = a * (Math.PI * (2 / GHOST_SLICES));\n        const phixz = Math.sin((bm ** 0.6 * Math.PI) / 2);\n        const osc = (bm * bm * Math.sin(a * Math.PI * (14 / GHOST_SLICES))) / 4;\n        return b > GHOST_STACKS - 1\n          ? { x: (polygon.$smooth = 0), y: -0.5, z: 0 }\n          : {\n              x: Math.cos(theta) * phixz,\n              y: Math.cos(bm * Math.PI) - bm - osc,\n              z: Math.sin(theta) * phixz + Math.sin(osc * Math.PI * 2) / 4,\n            };\n      }),\n      scaling(0.7, 0.7, 0.7),\n      material(1, 1, 1),\n    );\n\n    // eyes\n    [-1, 1].map((x) => meshAdd(sphere(12), translation(x * 0.16, 0.4, -0.36).scale3d(0.09)));\n  }, MODEL_KIND_MESH);\n\n  newModel(() => {\n    checkModelId(\"LEVER\", MODEL_ID_LEVER);\n    meshAdd(cylinder(6, 1), scaling(0.13, 1.4, 0.13), material(0.3, 0.3, 0.5, 0.1));\n    meshAdd(cylinder(10), translation(0, 1).scale(0.21, 0.3, 0.21), material(1, 0.5, 0.2));\n    meshAdd(cylinder(3), translation(0, -1).rotate(90, 90).scale(0.3, 0.4, 0.3), material(0.2, 0.2, 0.2, 0.1));\n  }, MODEL_KIND_MESH);\n\n  if (DEBUG) {\n    console.timeEnd(\"build_life_the_universe_and_everything\");\n    console.log(souls.length + \" souls, \" + levers.length + \" levers\");\n  }\n};\n","#version 300 es\n\nin vec4 aPosition;\n\nuniform mat4 viewMatrix;\nuniform mat4 worldMatrices[39];\n\n#define modelId aPosition.w\n\nvoid main() {\n  mat4 worldMatrix = worldMatrices[max(0, abs(int(modelId)) - 1) + gl_InstanceID];\n  worldMatrix[3][3] = 1.;\n  gl_Position = viewMatrix * (worldMatrix * vec4(aPosition.xyz, 1));\n}\n","#version 300 es\n\nlayout(location = 0) in vec4 aPosition;\nlayout(location = 1) in vec3 aNormal;\nlayout(location = 2) in vec4 aColor;\n\nout vec4 VNormal;\nout vec4 FragPos;\nout vec4 UntransformedFragPos;\nout lowp vec4 Color;\n\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 worldMatrices[39];\n\n#define modelId aPosition.w\n\nvoid main() {\n  mat4 worldMatrix = worldMatrices[max(0, abs(int(modelId)) - 1) + gl_InstanceID];\n  // trick - use worldMatrix[3][3] that normally is 1 as a way to color the handle of pulled levers\n  Color = mix(aColor, vec4(0.7, 1, 0.2, 0), aColor.w > 0. ? 0. : 1. - worldMatrix[3][3]);\n  worldMatrix[3][3] = 1.;\n  UntransformedFragPos = aPosition;\n  FragPos = worldMatrix * vec4(aPosition.xyz, 1);\n  gl_Position = projectionMatrix * (viewMatrix * FragPos);\n  FragPos.w = modelId;\n  VNormal = (worldMatrix * vec4(aNormal, 0));\n}\n","#version 300 es\nprecision highp float;\n\nin highp vec4 VNormal;\nin highp vec4 FragPos;\n\nuniform mat4 viewMatrix;\n\nout vec4 O;\n\n#define modelId FragPos.w\n\n#define orientation viewMatrix[0][0]\n#define COLLISION_TEXTURE_SIZE 128.\n#define PI 3.1415926\n\nvoid main() {\n  vec4 v = viewMatrix * vec4(vec3(0, 1.49, .3 * orientation) + FragPos.xyz, 1);\n  if (gl_FragCoord.y > 36.) {\n    // float xattenuation = (1. - sin((gl_FragCoord.x * (PI / COLLISION_TEXTURE_SIZE))));\n    //  linear attenuation, 0 at center, 1 at edge\n    float xattenuation = abs(gl_FragCoord.x / (COLLISION_TEXTURE_SIZE / 2.) - 1.);\n    float z = clamp(v.z + .7, 0., 1.);\n    O = v.y < .6 || v.y > 4. ? vec4(0)\n                             : vec4(\n                                 vec2(orientation * sign(v.x) * VNormal.x < 0. ? z * (.7 - abs(v.x)) * xattenuation : 0.),\n                                 vec2(orientation * VNormal.z > 0. ? z * (1. - xattenuation) : 0.)\n                               );\n  } else {\n    float h = VNormal.y > 0.45 && v.y < 1. ? v.y * clamp((v.z + .4) * 50., 0., 1.) : 0.;\n    O = vec4(vec2(h), vec2(h > 0. ? modelId / 255. : 0.));\n  }\n}\n","#version 300 es\n// Do nothing.\nvoid main() {}\n","#version 300 es\n\nin vec4 aPosition;\n\nvoid main() { gl_Position = vec4(aPosition.xy, 1, 1); }\n","#version 300 es\nprecision highp float;\n\nuniform vec3 iResolution;\nuniform vec3 viewPos;\nuniform mat4 viewMatrix;\n\nuniform highp sampler2D groundTexture;\n\nout vec4 O;\n\n#define gameTime iResolution.z\n\n/* 1 / Math.tan(fieldOfViewRadians / 2) */\nconst float fieldOfViewAmount = 1.73205;\n\nvoid main() {\n  vec2 fragCoord = (gl_FragCoord.xy / iResolution.xy) * 2. - 1.;\n  vec3 ray =\n    normalize(viewMatrix * vec4(fragCoord.x * -(iResolution.x / iResolution.y), -fragCoord.y, fieldOfViewAmount, 0.)).xyz;\n  float rayTracedLavalDistance = (-32. - viewPos.y) / ray.y;\n  float multiplier = (1. - clamp(abs(rayTracedLavalDistance / 9999.), 0., 1.));\n\n  O = vec4(0, 0, 0, 1);\n\n  if (multiplier > 0.01) {\n    if (rayTracedLavalDistance > 0.) {\n      // Render sky\n      float c = cos(gameTime / 30.), s = sin(gameTime / 30.);\n      ray.xz *= mat2(c, s, -s, c);\n      vec3 absRay = abs(ray);\n      O.xyz = vec3(dot(vec2(texture(groundTexture, ray.xy).z, texture(groundTexture, ray.yz * 2.).z), absRay.zx) * absRay.y);\n\n    } else {\n      // Render raytraced lava\n      ray = viewPos + ray * rayTracedLavalDistance;\n      O.x = multiplier *=\n        0.9 - texture(groundTexture, ray.xz / 150. + vec2(sin(ray.z / 35. + gameTime), cos(ray.x / 25. + gameTime)) / 80.).y;\n      O.y = multiplier * multiplier * multiplier;\n    }\n  }\n}\n","export const worldMatricesBuffer = new Float32Array(39 * 16);\n\nexport const objectsMatricesBuffer = new Float32Array(39 * 16);\n","export const gl: WebGL2RenderingContext = hC.getContext(\"webgl2\", { powerPreference: \"high-performance\" })!;\n\nfor (const s in gl) {\n  (gl as any)[s[0] + [...s].reduce((p, c, i) => (p * i + c.charCodeAt(0)) % 434, 0).toString(36)] = (gl as any)[s];\n}\n","import { constDef_COLLISION_TEXTURE_SIZE as COLLISION_TEXTURE_SIZE } from \"../shaders/collider-fragment.frag\";\nimport {\n  max,\n  clamp,\n  DEG_TO_RAD,\n  angle_lerp_degrees,\n  lerp,\n  angle_wrap_degrees,\n  min,\n  abs,\n  threshold,\n  hypot,\n} from \"../math/math\";\nimport {\n  levers,\n  allModels,\n  MODEL_KIND_GAME,\n  MODEL_ID_ROTATING_PLATFORM,\n  MODEL_ID_PLAYER_BODY,\n  MODEL_ID_STATIC_WORLD,\n} from \"./models\";\nimport { player_last_pulled_lever, camera_rotation, firstBoatLerp, player_position_final } from \"./world-state\";\nimport { input_forward, input_strafe, player_first_person } from \"../page\";\nimport { lerpDamp, gameTimeDelta, damp, gameTime } from \"./game-time\";\nimport { matrixCopy, matrixTransformPoint } from \"../math/matrix\";\nimport { gl } from \"../gl\";\nimport { shouldRotatePlatforms } from \"./level-update\";\n\nexport const CAMERA_PLAYER_Y_DIST = 13;\n\nexport const CAMERA_PLAYER_Z_DIST = -18;\n\nexport const PLAYER_LEGS_VELOCITY = 7 * 1.3;\n\nexport const PLAYER_RESPAWN_Z = -2.4;\n\nexport let camera_position_x: number = 0;\n\nexport let camera_position_y: number = 0;\n\nexport let camera_position_z: number = 0;\n\nexport const set_camera_position = (x: number, y: number, z: number) => {\n  camera_position_x = x;\n  camera_position_y = y;\n  camera_position_z = z;\n};\n\nconst collision_buffer = new Uint8Array(COLLISION_TEXTURE_SIZE * COLLISION_TEXTURE_SIZE * 4);\n\nexport let player_update: (nextModelMatrix: () => DOMMatrix) => void;\n\nexport const player_init = () => {\n  let boot: 0 | 1 = 1;\n  let player_gravity = 15;\n  let player_respawned: 0 | 1 | 2 = 2;\n  let player_look_angle_target: number;\n  let player_look_angle: number;\n  let player_legs_speed: number;\n  let player_on_rotating_platforms: number;\n  let player_fly_velocity_x: number;\n  let player_fly_velocity_z: number;\n  let player_speed: number;\n  let player_speed_collision_limiter: number;\n  let player_model_y: number;\n\n  let currentModelId: number;\n  let oldModelId: number | undefined;\n\n  let camera_pos_lookat_x: number;\n  let camera_pos_lookat_y: number;\n  let camera_pos_lookat_z: number;\n\n  let player_position_global_x = 0;\n  let player_position_global_y = 0;\n  let player_position_global_z = 0;\n\n  const loadReferenceMatrix = () =>\n    matrixCopy(\n      (player_respawned\n        ? levers[player_last_pulled_lever]!\n        : allModels[(oldModelId && allModels[oldModelId]!.$kind === MODEL_KIND_GAME && oldModelId) || 0]!\n      ).$matrix,\n    );\n\n  const updatePlayerPositionFinal = (updateVelocity?: unknown) => {\n    if (player_respawned > 1) {\n      matrixCopy(levers[player_last_pulled_lever]!.$matrix).multiplySelf(levers[player_last_pulled_lever]!.$transform);\n      matrixTransformPoint(0, player_last_pulled_lever || firstBoatLerp > 0.9 ? 15 : 1, PLAYER_RESPAWN_Z);\n    } else {\n      loadReferenceMatrix();\n      matrixTransformPoint(player_position_global_x, player_position_global_y, player_position_global_z);\n    }\n\n    if (updateVelocity) {\n      player_fly_velocity_x = (matrixTransformPoint.x - player_position_final.x) / gameTimeDelta;\n      player_fly_velocity_z = (matrixTransformPoint.z - player_position_final.z) / gameTimeDelta;\n    }\n\n    player_position_final.x = matrixTransformPoint.x;\n    player_position_final.y = matrixTransformPoint.y;\n    player_position_final.z = matrixTransformPoint.z;\n  };\n\n  const movePlayer = (mx: number, my: number, mz: number) => {\n    loadReferenceMatrix().invertSelf();\n    matrixTransformPoint(mx, my, mz, 0);\n    player_position_global_x += matrixTransformPoint.x;\n    player_position_global_y += my;\n    player_position_global_z += matrixTransformPoint.z;\n    updatePlayerPositionFinal();\n  };\n\n  const doCollisions = () => {\n    let modelACount = 0;\n    let modelB = 0;\n    let modelBCount = 0;\n    let movY = 0;\n    let lineToProcess = -1;\n\n    // vertical collisions\n\n    for (let y = 0; y < 36; ++y) {\n      const yindex = y * (COLLISION_TEXTURE_SIZE * 4);\n      for (let x = 24 * 4; x < (COLLISION_TEXTURE_SIZE - 24) * 4; x += 4) {\n        for (let k = 0; k < 2; ++k) {\n          const v = collision_buffer[yindex + x + k]!;\n          const m = collision_buffer[yindex + x + k + 2]!;\n          if (v > movY) {\n            movY = v;\n          }\n          if (v + m) {\n            if (lineToProcess < 0 || lineToProcess === y) {\n              lineToProcess = y;\n              if (m === currentModelId) {\n                ++modelACount;\n              } else if (!modelB || modelB === m) {\n                modelB = m;\n                ++modelBCount;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    currentModelId = lineToProcess >= 0 ? (modelBCount > modelACount * 2 ? modelB : currentModelId) : 0;\n\n    // horizontal collisions\n\n    let movX = 0;\n    let movZ = 0;\n    for (let y = 36; y < COLLISION_TEXTURE_SIZE; y += 1) {\n      const yindex = y * (COLLISION_TEXTURE_SIZE * 4);\n\n      let left = 0;\n      let right = 0;\n      let front = 0;\n      let back = 0;\n      for (let tx = 0; tx < COLLISION_TEXTURE_SIZE; tx += 1) {\n        const index = yindex + tx * 4;\n\n        for (let k = 0; k < 2; ++k) {\n          const vx = collision_buffer[index + k]!;\n          const vz = collision_buffer[index + k + 2]!;\n\n          if (k ? tx > COLLISION_TEXTURE_SIZE / 2 : tx < COLLISION_TEXTURE_SIZE / 2) {\n            left = max(left, vx);\n          } else {\n            right = max(right, vx);\n          }\n\n          if (k) {\n            back = max(back, vz);\n          } else {\n            front = max(front, vz);\n          }\n        }\n      }\n\n      if (abs(right - left) > abs(movX)) {\n        movX = right - left;\n      }\n      if (abs(back - front) > abs(movZ)) {\n        movZ = back - front;\n      }\n    }\n\n    // movX = movZ = 0; // TODO DeBUG\n\n    player_speed_collision_limiter = clamp(1 - max(abs(movX), abs(movZ)) * 0.02);\n\n    movePlayer(movX / 255, movY / 255, movZ / 255);\n  };\n\n  const interpolate_with_hysteresis = /* @__PURE__ */ (\n    previous: number,\n    desired: number,\n    hysteresis: number,\n    speed: number,\n  ) =>\n    lerp(previous, desired, boot || (clamp(abs(desired - previous) ** 0.5 - hysteresis) + 1 / 7) * damp(speed * 1.5));\n\n  player_update = (nextModelMatrix: () => DOMMatrix) => {\n    updatePlayerPositionFinal(currentModelId);\n\n    // ------- read collision renderBuffer -------\n\n    // gl.finish();\n    gl.readPixels(0, 0, COLLISION_TEXTURE_SIZE, COLLISION_TEXTURE_SIZE, gl.RGBA, gl.UNSIGNED_BYTE, collision_buffer);\n    // gl.invalidateFramebuffer(gl.READ_FRAMEBUFFER, [gl.COLOR_ATTACHMENT0, gl.DEPTH_ATTACHMENT]);\n    // gl.invalidateFramebuffer(gl.DRAW_FRAMEBUFFER, [gl.COLOR_ATTACHMENT0, gl.DEPTH_ATTACHMENT]);\n\n    if (DEBUG) {\n      const debugCanvas = document.getElementById(\"debug-canvas\") as HTMLCanvasElement;\n\n      const buf = new Uint8ClampedArray(COLLISION_TEXTURE_SIZE * COLLISION_TEXTURE_SIZE * 4);\n\n      if (debugCanvas) {\n        for (let y = 0; y < COLLISION_TEXTURE_SIZE; ++y) {\n          for (let x = 0; x < COLLISION_TEXTURE_SIZE; ++x) {\n            const i = ((COLLISION_TEXTURE_SIZE - y) * COLLISION_TEXTURE_SIZE + x) * 4;\n            const r = collision_buffer[i]!;\n            const g = collision_buffer[i + 1]!;\n            const b = collision_buffer[i + 2]!;\n\n            buf[(y * COLLISION_TEXTURE_SIZE + x) * 4] = r;\n            buf[(y * COLLISION_TEXTURE_SIZE + x) * 4 + 1] = g * 30;\n            buf[(y * COLLISION_TEXTURE_SIZE + x) * 4 + 2] = b ? 200 : 0;\n            buf[(y * COLLISION_TEXTURE_SIZE + x) * 4 + 3] = 255;\n          }\n        }\n\n        const imgdata = new ImageData(buf, COLLISION_TEXTURE_SIZE, COLLISION_TEXTURE_SIZE);\n\n        if (!(window as any).debug2dctx) {\n          (window as any).debug2dctx = debugCanvas.getContext(\"2d\")!;\n        }\n        (window as any).debug2dctx.putImageData(imgdata, 0, 0, 0, 0, COLLISION_TEXTURE_SIZE, COLLISION_TEXTURE_SIZE);\n      }\n    }\n\n    // ------- process collision renderBuffer -------\n\n    NO_INLINE(doCollisions)();\n\n    if (player_respawned || currentModelId !== oldModelId) {\n      if (DEBUG && currentModelId !== oldModelId) {\n        console.log(\"modelId: \" + oldModelId + \" -> \" + currentModelId);\n      }\n\n      oldModelId = currentModelId;\n\n      loadReferenceMatrix().invertSelf();\n      matrixTransformPoint(player_position_final.x, player_position_final.y, player_position_final.z);\n      player_position_global_x = matrixTransformPoint.x;\n      player_position_global_y = matrixTransformPoint.y;\n      player_position_global_z = matrixTransformPoint.z;\n    }\n\n    if (player_respawned) {\n      player_respawned = currentModelId ? 0 : 1;\n    }\n\n    const { x, y, z } = player_position_final;\n\n    if (y < (x < -20 || z < 109 ? -25 : -9)) {\n      // Player fell in lava\n      player_respawned = 2;\n    }\n\n    // Special handling for the second boat (lever 7) - the boat must be on the side of the map the player is\n    if (currentModelId === MODEL_ID_STATIC_WORLD) {\n      levers[9]!.$value = x < -15 && z < 0 ? 1 : 0;\n    }\n\n    player_model_y = lerp(lerpDamp(player_model_y, y, 2), y, player_respawned || abs(player_model_y - y) * 8);\n    camera_pos_lookat_y = interpolate_with_hysteresis(camera_pos_lookat_y, player_model_y, 2, 1);\n    camera_pos_lookat_x = interpolate_with_hysteresis(camera_pos_lookat_x, x, 0.5, 1);\n    camera_pos_lookat_z = interpolate_with_hysteresis(camera_pos_lookat_z, z, 0.5, 1);\n\n    // Special handling for the rotating platforms, better camera for mobile that allows to see more\n    player_on_rotating_platforms = lerpDamp(\n      player_on_rotating_platforms,\n      shouldRotatePlatforms *\n        ((currentModelId > MODEL_ID_ROTATING_PLATFORM - 1 && currentModelId < MODEL_ID_ROTATING_PLATFORM + 4) as any),\n      2,\n    );\n\n    if (!DEBUG_CAMERA) {\n      if (player_first_person) {\n        const d = player_respawned + damp(18);\n        camera_position_x = lerp(camera_position_x, x, d);\n        camera_position_y = lerp(camera_position_y, player_model_y + 1.5, d);\n        camera_position_z = lerp(camera_position_z, z, d);\n        camera_rotation.y = angle_wrap_degrees(camera_rotation.y);\n      } else {\n        camera_position_z = interpolate_with_hysteresis(\n          camera_position_z,\n          camera_pos_lookat_z + CAMERA_PLAYER_Z_DIST + player_on_rotating_platforms * 5,\n          1,\n          2 + player_on_rotating_platforms,\n        );\n\n        camera_position_y = interpolate_with_hysteresis(\n          camera_position_y,\n          max(\n            camera_pos_lookat_y + clamp((-60 - z) / 8, 0, 20) + CAMERA_PLAYER_Y_DIST + player_on_rotating_platforms * 9,\n            6,\n          ),\n          4,\n          2,\n        );\n\n        camera_position_x = interpolate_with_hysteresis(\n          camera_position_x,\n          camera_pos_lookat_x,\n          1,\n          2 + player_on_rotating_platforms,\n        );\n\n        const viewDirDiffz = min(CAMERA_PLAYER_Z_DIST / 3, -abs(camera_pos_lookat_z - camera_position_z));\n        const viewDirDiffx = camera_pos_lookat_x - camera_position_x;\n\n        camera_rotation.y = angle_lerp_degrees(\n          camera_rotation.y,\n          90 - angle_wrap_degrees(Math.atan2(viewDirDiffz, viewDirDiffx) / DEG_TO_RAD),\n          boot + damp(10),\n        );\n\n        camera_rotation.x = angle_lerp_degrees(\n          camera_rotation.x,\n          90 - Math.atan2(hypot(viewDirDiffz, viewDirDiffx), camera_position_y - camera_pos_lookat_y) / DEG_TO_RAD,\n          boot + damp(10),\n        );\n      }\n\n      camera_rotation.x = clamp(camera_rotation.x, -87, 87);\n    }\n\n    boot = 0;\n\n    // ---- process user input ----\n\n    let forward = clamp(input_forward, -1);\n    let strafe = clamp(input_strafe, -1);\n\n    const movAmount = threshold(hypot(forward, strafe) ** 0.5, 0.1);\n    let movAngle = Math.atan2(forward, strafe);\n\n    forward = movAmount * abs(forward) * Math.sin(movAngle);\n    strafe = movAmount * abs(strafe) * Math.cos(movAngle);\n\n    if (movAmount) {\n      player_look_angle_target = 90 - movAngle / DEG_TO_RAD;\n    }\n\n    player_look_angle = angle_lerp_degrees(player_look_angle, player_look_angle_target, damp(8));\n    player_legs_speed = lerpDamp(player_legs_speed, movAmount, 10);\n\n    // Update player body and legs matrices\n\n    nextModelMatrix().translateSelf(x, player_model_y, z).rotateSelf(0, player_look_angle);\n\n    for (let i = 0; i < 2; ++i) {\n      const t = gameTime * PLAYER_LEGS_VELOCITY - Math.PI * i;\n      matrixCopy(allModels[MODEL_ID_PLAYER_BODY]!.$matrix, nextModelMatrix())\n        .translateSelf(0, player_legs_speed * clamp(Math.sin(t - Math.PI / 2) * 0.45))\n        .rotateSelf(player_legs_speed * Math.sin(t) * (0.25 / DEG_TO_RAD), 0);\n    }\n\n    // Move player\n\n    player_gravity = currentModelId\n      ? 5\n      : lerpDamp(player_gravity, player_respawned ? 13 : 19 - min(0, y + 10) * 2, 2.2);\n\n    player_fly_velocity_x = currentModelId || player_respawned ? 0 : lerpDamp(player_fly_velocity_x, 0, 3);\n    player_fly_velocity_z = currentModelId || player_respawned ? 0 : lerpDamp(player_fly_velocity_z, 0, 3);\n    player_speed = player_respawned\n      ? 0\n      : lerpDamp(\n          player_speed,\n          currentModelId ? clamp(2 * movAmount) * 7 * player_speed_collision_limiter : 0,\n          currentModelId ? 9 : 1,\n        );\n\n    // Angle is dependant on where the player is looking in first person. Is 0 in third person\n    movAngle = player_first_person ? (180 + camera_rotation.y) * DEG_TO_RAD : 0;\n\n    movePlayer(\n      // x\n      gameTimeDelta *\n        (player_fly_velocity_x + player_speed * (strafe * Math.cos(movAngle) - forward * Math.sin(movAngle))),\n      // y\n      -player_gravity * gameTimeDelta,\n      // z\n      gameTimeDelta *\n        (player_fly_velocity_z + player_speed * (strafe * Math.sin(movAngle) + forward * Math.cos(movAngle))),\n    );\n  };\n};\n","import { clamp, max, abs, lerpneg, min, angle_wrap_degrees, lerp } from \"../math/math\";\nimport { allModels, levers, LEVERS_COUNT, souls, SOULS_COUNT } from \"./models\";\nimport { objectsMatricesBuffer, worldMatricesBuffer } from \"./models-matrices\";\nimport { matrixCopy, identity, matrixToArray, tempMatrix } from \"../math/matrix\";\nimport { gameTime, gameTimeDelta, lerpDamp } from \"./game-time\";\nimport { firstBoatLerp, secondBoatLerp } from \"./world-state\";\nimport { player_update } from \"./player\";\n\nexport let shouldRotatePlatforms: number;\n\nlet rotatingPlatform1Rotation: number;\n\nlet rotatingPlatform2Rotation: number;\n\nlet rotatingHexCorridorRotation: number;\n\nconst boatAnimationMatrix = (matrix: DOMMatrix, x: number, y: number, z: number) =>\n  matrix\n    .translateSelf(x + Math.sin(gameTime + 2) / 5, y + Math.sin(gameTime * 0.8) / 3, z)\n    .rotateSelf(Math.sin(gameTime) * 2, Math.sin(gameTime * 0.7), Math.sin(gameTime * 0.9));\n\nexport const eppur_si_muove = () => {\n  let counter = 1;\n\n  const next = () => matrixCopy(identity, allModels[++counter]!.$matrix);\n\n  shouldRotatePlatforms = lerpneg(levers[12]!.$lerpValue, levers[13]!.$lerpValue);\n\n  rotatingHexCorridorRotation = lerp(\n    lerpDamp(rotatingHexCorridorRotation, 0, 1),\n    angle_wrap_degrees(rotatingHexCorridorRotation + gameTimeDelta * 60),\n    levers[5]!.$lerpValue - levers[6]!.$lerpValue2,\n  );\n\n  rotatingPlatform1Rotation = lerp(\n    lerpDamp(rotatingPlatform1Rotation, 0, 5),\n    angle_wrap_degrees(rotatingPlatform1Rotation + gameTimeDelta * 56),\n    shouldRotatePlatforms,\n  );\n\n  rotatingPlatform2Rotation = lerp(\n    lerpDamp(rotatingPlatform2Rotation, 0, 4),\n    angle_wrap_degrees(rotatingPlatform2Rotation + gameTimeDelta * 48),\n    shouldRotatePlatforms,\n  );\n\n  // first boad\n  boatAnimationMatrix(next(), -12, 4.2, -66 + firstBoatLerp * 40);\n\n  // in and out gate bars\n\n  next()\n    .translateSelf(0, 0, -15)\n    .scaleSelf(1, clamp(1.22 - levers[1]!.$lerpValue), 1);\n\n  next()\n    .translateSelf(0, 0, 15)\n    .scaleSelf(1, clamp(1.22 - levers[2]!.$lerpValue), 1);\n\n  // central gate bars\n\n  next()\n    .translateSelf(-99.7, -1.9, 63.5)\n    .scaleSelf(1, clamp(1.1 - levers[6]!.$lerpValue), 1);\n\n  // far arc gate bars\n\n  next()\n    .translateSelf(-100, 0.6, 96.5)\n    .scaleSelf(0.88, 1.2 - levers[12]!.$lerpValue);\n\n  // moving central platform in the first level\n\n  next().translateSelf(\n    0,\n    levers[3]!.$lerpValue < 0.01\n      ? -500\n      : (1 - levers[2]!.$lerpValue) * levers[3]!.$lerpValue2 * (Math.cos(gameTime * 1.5) * 5 + 2) +\n          15 * (levers[3]!.$lerpValue - 1),\n    0,\n  );\n\n  // central oscillating platform\n\n  let oscillation = min(levers[2]!.$lerpValue2, 1 - levers[4]!.$lerpValue2);\n\n  next().translateSelf(oscillation * Math.sin(gameTime / 1.5 + 2) * 12);\n\n  // blackPlatforms\n\n  next().translateSelf(oscillation * Math.sin(gameTime * 0.7 + 2) * 12);\n\n  next().translateSelf(oscillation * Math.sin(gameTime + 3) * 8.2);\n\n  // triangle platform\n\n  next().translateSelf((1 - oscillation) * 9.8);\n\n  // vertically oscillating mini platforms\n\n  oscillation = clamp(1 - oscillation * 5) * lerpneg(levers[4]!.$lerpValue, levers[5]!.$lerpValue);\n\n  next().translateSelf(0, oscillation * Math.sin(gameTime * 1.35) * 4);\n\n  // horizontaly oscillating mini platforms\n\n  next().translateSelf(0, 0, oscillation * Math.sin(gameTime * 0.9) * 8);\n\n  // hex corridor door\n\n  next().translateSelf(0, levers[4]!.$lerpValue2 * -6.5);\n\n  // rotating hex corridor\n\n  next()\n    .translateSelf(-75, (1 - levers[5]!.$lerpValue2) * (1 - levers[6]!.$lerpValue) * 3, 55)\n    .rotateSelf(180 * (1 - levers[5]!.$lerpValue2) + rotatingHexCorridorRotation, 0);\n\n  // elevators\n\n  oscillation = lerpneg(levers[7]!.$lerpValue2, levers[6]!.$lerpValue2);\n\n  next().translateSelf(\n    0,\n    oscillation * Math.sin(gameTime) * 5 + (1 - max(levers[6]!.$lerpValue, levers[7]!.$lerpValue)) * 3.5,\n  );\n\n  next().translateSelf(0, oscillation * Math.sin(gameTime + 3) * 6, oscillation * Math.sin(gameTime * 0.6 + 1) * 6);\n\n  // central sculpture/monument\n\n  next().translateSelf(0, levers[7]!.$lerpValue2 * -7.3);\n\n  // second boat\n\n  boatAnimationMatrix(next(), -123, 1.4, 55 + secondBoatLerp * -65);\n\n  // pushing rods\n\n  oscillation = lerpneg(levers[10]!.$lerpValue, levers[11]!.$lerpValue);\n\n  next().translateSelf(0, -2, oscillation * abs(Math.sin(gameTime * 1.1)) * -8.5 + 10);\n\n  next().translateSelf(0, -2, oscillation * abs(Math.sin(gameTime * 2.1)) * -8.5 + 10);\n\n  next().translateSelf(\n    0,\n    -2,\n    max(\n      // block rods\n      (1 - levers[10]!.$lerpValue) * (1 - oscillation),\n      // push rods\n      oscillation * abs(Math.sin(gameTime * 1.5)),\n    ) *\n      -8.5 +\n      10,\n  );\n\n  // oscillating hex pads\n\n  oscillation = lerpneg(levers[8]!.$lerpValue2, levers[12]!.$lerpValue2);\n\n  for (let i = 0; i < 4; i++) {\n    next().translateSelf(\n      (i > 2 ? (1 - oscillation) * 2 + oscillation : 0) - 100,\n      oscillation * Math.sin(gameTime * 1.3 + i * 1.7) * (3 + i / 3) + 0.7,\n      (i & 1 ? -1 : 1) * (1 - levers[8]!.$lerpValue2) * (1 - levers[12]!.$lerpValue2) * -7 +\n        max(oscillation, 0.05) * Math.cos(gameTime * 1.3 + i * 7) * (4 - 2 * (1 - i / 3)) +\n        115,\n    );\n  }\n\n  // donut pad\n\n  next()\n    .translateSelf(\n      (1 - oscillation) * 2.5 - 139.7,\n      (1 - levers[8]!.$lerpValue) * -3 + oscillation * Math.sin(gameTime * 0.8) * -1 - 1.8,\n      93.5,\n    )\n    .rotateSelf(Math.cos(gameTime * 1.3) * (oscillation * 3 + 3), 0);\n\n  // First rotating platform (with hole)\n\n  next()\n    .translateSelf(-81, 0.6, 106)\n    .rotateSelf(0, 40 + rotatingPlatform1Rotation);\n\n  // Second rotating platform\n\n  next().translateSelf(-65.8, 0.8, 106).rotateSelf(0, rotatingPlatform2Rotation);\n\n  // Third rotating platform\n\n  next()\n    .translateSelf(-50.7, 0.8, 106)\n    .rotateSelf(0, 180 - rotatingPlatform2Rotation);\n\n  // Fourth rotating platform\n\n  next()\n    .translateSelf(-50.7, 0.8, 91)\n    .rotateSelf(0, 270 + rotatingPlatform2Rotation);\n\n  // jumping pads\n\n  oscillation = lerpneg(levers[13]!.$lerpValue2, levers[14]!.$lerpValue2);\n\n  for (let i = 0; i < 3; ++i) {\n    next().translateSelf(\n      0,\n      oscillation * Math.sin(gameTime * 1.5 + i * 1.5) * 4 +\n        (i ? 0 : (1 - levers[13]!.$lerpValue2) * (1 - levers[14]!.$lerpValue2)),\n    );\n  }\n\n  // pendulums\n\n  next()\n    .translateSelf(Math.sin(gameTime) * -2)\n    .rotateSelf(Math.sin(gameTime) * 25);\n\n  // floating elevator pad\n\n  const floatingElevatorPad = lerpneg(\n    lerpneg((levers[14]!.$lerpValue + levers[14]!.$lerpValue2) / 2, levers[13]!.$lerpValue2),\n    (levers[15]!.$lerpValue + levers[15]!.$lerpValue2) / 2,\n  );\n\n  next().translateSelf(0, floatingElevatorPad * 16, clamp(floatingElevatorPad * 2 - 1) * 8.5 + 95);\n\n  // Update souls\n\n  for (let i = 0; i < SOULS_COUNT; ++i) {\n    souls[i]!._update();\n    matrixToArray(tempMatrix, objectsMatricesBuffer, i);\n  }\n\n  // Update levers\n\n  for (let i = 0; i < LEVERS_COUNT; ++i) {\n    levers[i]!._update();\n    matrixToArray(tempMatrix, objectsMatricesBuffer, i + SOULS_COUNT);\n\n    // Encode lerp value in matrix m44 so fragmemt shader can change the lever handle color\n    objectsMatricesBuffer[i * 16 + (15 + SOULS_COUNT * 16)] = 1 - levers[i]!.$lerpValue;\n  }\n\n  // Player body and legs\n\n  player_update(next);\n\n  // Copy all models matrices to the world uniform buffer\n\n  for (let i = 0; i <= counter; ++i) {\n    matrixToArray(allModels[i]!.$matrix, worldMatricesBuffer, i - 1);\n  }\n};\n","import {\n  allModels,\n  levers,\n  souls,\n  MODEL_ID_LEVER,\n  MODEL_ID_PLAYER_BODY,\n  MODEL_ID_PLAYER_LEG0,\n  MODEL_ID_PLAYER_LEG1,\n  type MODEL_ID_SOUL,\n  type MODEL_ID_SOUL_COLLISION,\n} from \"./models\";\nimport { absoluteTime, mainMenuVisible } from \"./game-time\";\nimport { matrixCopy, matrixToArray, tempMatrix } from \"../math/matrix\";\nimport { gl } from \"../gl\";\nimport { worldMatricesBuffer, objectsMatricesBuffer } from \"./models-matrices\";\n\nexport const renderModels = (\n  worldMatrixLoc: WebGLUniformLocation,\n  renderPlayer: 0 | 1 | boolean,\n  soulModelId: typeof MODEL_ID_SOUL | typeof MODEL_ID_SOUL_COLLISION,\n) => {\n  if (mainMenuVisible) {\n    if (hC.width > 1100) {\n      matrixCopy().rotateSelf(0, Math.sin(absoluteTime) * 40 - 80, -8);\n\n      matrixToArray(tempMatrix, worldMatricesBuffer, MODEL_ID_PLAYER_BODY - 1);\n      matrixToArray(tempMatrix, worldMatricesBuffer, MODEL_ID_PLAYER_LEG0 - 1);\n      matrixToArray(tempMatrix, worldMatricesBuffer, MODEL_ID_PLAYER_LEG1 - 1);\n\n      gl.uniformMatrix4fv(worldMatrixLoc, false, worldMatricesBuffer);\n      gl.drawElements(\n        gl.TRIANGLES,\n        allModels[MODEL_ID_PLAYER_LEG1]!.$vertexEnd! - allModels[MODEL_ID_PLAYER_BODY]!.$vertexBegin!,\n        gl.UNSIGNED_SHORT,\n        allModels[MODEL_ID_PLAYER_BODY]!.$vertexBegin! * 2,\n      );\n    }\n\n    return;\n  }\n\n  // Render world\n\n  gl.uniformMatrix4fv(worldMatrixLoc, false, worldMatricesBuffer);\n\n  gl.drawElements(\n    gl.TRIANGLES,\n    (renderPlayer ? allModels[MODEL_ID_PLAYER_LEG1]!.$vertexEnd! : allModels[MODEL_ID_PLAYER_BODY]!.$vertexBegin!) - 3,\n    gl.UNSIGNED_SHORT,\n    3 * 2,\n  );\n\n  gl.uniformMatrix4fv(worldMatrixLoc, false, objectsMatricesBuffer);\n\n  // Render souls\n\n  gl.drawElementsInstanced(\n    gl.TRIANGLES,\n    allModels[soulModelId]!.$vertexEnd! - allModels[soulModelId]!.$vertexBegin!,\n    gl.UNSIGNED_SHORT,\n    allModels[soulModelId]!.$vertexBegin! * 2,\n    souls.length,\n  );\n\n  // Render levers\n\n  gl.drawElementsInstanced(\n    gl.TRIANGLES,\n    allModels[MODEL_ID_LEVER]!.$vertexEnd! - allModels[MODEL_ID_LEVER]!.$vertexBegin!,\n    gl.UNSIGNED_SHORT,\n    allModels[MODEL_ID_LEVER]!.$vertexBegin! * 2,\n    levers.length,\n  );\n};\n","import { gl } from \"./gl\";\n\nexport interface WebglProgramAbstraction {\n  (name: string): WebGLUniformLocation;\n  (): void;\n}\n\nexport const loadShader = (source: string, type: number = gl.VERTEX_SHADER): WebGLShader => {\n  const shader = gl.createShader(type)!;\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n\n  if (DEBUG && !gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    throw new Error(\"An error occurred compiling the shaders: \" + gl.getShaderInfoLog(shader));\n  }\n\n  return shader;\n};\n\nexport const initShaderProgram = (vertexShader: WebGLShader, sfsSource: string): WebglProgramAbstraction => {\n  const uniforms: Record<string, WebGLUniformLocation> = {};\n  const program = gl.createProgram()!;\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, loadShader(sfsSource, gl.FRAGMENT_SHADER));\n  gl.linkProgram(program);\n\n  if (DEBUG && !gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    throw new Error(\"Unable to initialize the shader program: \" + gl.getProgramInfoLog(program));\n  }\n\n  return (name?: string): any =>\n    name ? uniforms[name] || (uniforms[name] = gl.getUniformLocation(program, name)!) : gl.useProgram(program);\n};\n","// shaders\nimport csm_vsSource from \"./shaders/csm-vertex.vert\";\nimport main_vsSource, {\n  uniformName_projectionMatrix,\n  uniformName_viewMatrix,\n  uniformName_worldMatrices,\n} from \"./shaders/main-vertex.vert\";\nimport main_fsSource, {\n  uniformName_viewPos,\n  uniformName_csm_matrix0,\n  uniformName_csm_matrix1,\n  uniformName_csm_texture0,\n  uniformName_csm_texture1,\n  uniformName_groundTexture,\n  constDef_CSM_TEXTURE_SIZE as CSM_TEXTURE_SIZE,\n  constDef_CSM_PLANE_DISTANCE as CSM_PLANE_DISTANCE,\n} from \"./shaders/main-fragment.frag\";\nimport collider_fsSource, {\n  constDef_COLLISION_TEXTURE_SIZE as COLLISION_TEXTURE_SIZE,\n} from \"./shaders/collider-fragment.frag\";\nimport void_fsSource from \"./shaders/void-fragment.frag\";\nimport sky_vsSource from \"./shaders/sky-vertex.vert\";\nimport sky_fsSource, { uniformName_iResolution } from \"./shaders/sky-fragment.frag\";\n\nimport { gameTimeUpdate, gameTimeDelta, mainMenuVisible, absoluteTime } from \"./game/game-time\";\nimport { MODEL_ID_SOUL, MODEL_ID_SOUL_COLLISION } from \"./game/models\";\nimport { camera_rotation, player_position_final, worldStateUpdate } from \"./game/world-state\";\nimport { integers_map } from \"./math/integers-map\";\nimport { identity, matrixCopy, matrixToArray, matrixTransformPoint, tempMatrix } from \"./math/matrix\";\nimport { mat_perspective, zFar, zNear } from \"./math/matrix-perspective\";\nimport { eppur_si_muove } from \"./game/level-update\";\nimport { max, min } from \"./math/math\";\nimport type { Vec3 } from \"./math/vectors\";\nimport { renderModels } from \"./game/models-render\";\nimport { loadShader, initShaderProgram } from \"./shaders-utils\";\nimport { initPage, csm_projections, player_first_person, projection, resetInteractPressed, updateInput } from \"./page\";\nimport { player_init, camera_position_x, camera_position_y, camera_position_z } from \"./game/player\";\nimport { gl } from \"./gl\";\n\nconst LIGHT_ROT_X = 298;\nconst LIGHT_ROT_Y = 139;\n\nexport const startMainLoop = (groundTextureImage: HTMLImageElement) => {\n  const camera_view = new DOMMatrix();\n  const mainVertexShader = loadShader(main_vsSource);\n  const csmShader = initShaderProgram(loadShader(csm_vsSource), void_fsSource);\n  const skyShader = initShaderProgram(loadShader(sky_vsSource), sky_fsSource);\n  const collisionShader = initShaderProgram(mainVertexShader, collider_fsSource);\n  const mainShader = initShaderProgram(mainVertexShader, main_fsSource);\n\n  const csm_lightSpaceMatrices = [new Float32Array(16), new Float32Array(16)];\n\n  const csm_tempMatrix = new DOMMatrix();\n  const csm_tempFrustumCorners: Vec3[] = integers_map(8, () => ({} as Vec3));\n\n  const csm_render = integers_map(2, (split: number) => {\n    const texture = gl.createTexture()!;\n    gl.activeTexture(gl.TEXTURE0 + split);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.DEPTH_COMPONENT24,\n      CSM_TEXTURE_SIZE,\n      CSM_TEXTURE_SIZE,\n      0,\n      gl.DEPTH_COMPONENT,\n      gl.UNSIGNED_INT,\n      null,\n    );\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_FUNC, gl.LEQUAL); // Can be LESS or LEQUAL\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\n    return (roundingRadius: number) => {\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, texture, 0);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n\n      matrixCopy()\n        .scale3dSelf(roundingRadius)\n        .multiplySelf(matrixCopy(csm_projections[split], csm_tempMatrix).multiplySelf(camera_view).invertSelf());\n\n      let tx = 0;\n      let ty = 0;\n      let tz = 0;\n\n      for (let i = 0; i < 8; ++i) {\n        const p = csm_tempFrustumCorners[i]!;\n        matrixTransformPoint(4 & i ? 1 : -1, 2 & i ? 1 : -1, 1 & i ? 1 : -1);\n        // Round to reduce shimmering\n        tx -= p.x = (matrixTransformPoint.x | 0) / (roundingRadius * matrixTransformPoint.w);\n        ty -= p.y = (matrixTransformPoint.y | 0) / (roundingRadius * matrixTransformPoint.w);\n        tz -= p.z = (matrixTransformPoint.z | 0) / (roundingRadius * matrixTransformPoint.w);\n      }\n\n      matrixCopy()\n        .rotateSelf(LIGHT_ROT_X, LIGHT_ROT_Y)\n        .translateSelf(tx / 8, ty / 8, tz / 8);\n\n      let left = Infinity;\n      let right = -Infinity;\n      let bottom = Infinity;\n      let top = -Infinity;\n      let near = Infinity;\n      let far = -Infinity;\n\n      // Compute the frustum bouding box\n      for (let i = 0; i < 8; ++i) {\n        const { x, y, z } = csm_tempFrustumCorners[i]!;\n        matrixTransformPoint(x, y, z);\n        left = min(left, matrixTransformPoint.x);\n        right = max(right, matrixTransformPoint.x);\n        bottom = min(bottom, matrixTransformPoint.y);\n        top = max(top, matrixTransformPoint.y);\n        near = min(near, matrixTransformPoint.z);\n        far = max(far, matrixTransformPoint.z);\n      }\n\n      const zMultiplier = 10 + split;\n      near *= near < 0 ? zMultiplier : 1 / zMultiplier;\n      far *= far > 0 ? zMultiplier : 1 / zMultiplier;\n\n      // Build the ortographic matrix, multiply it with the light space view matrix.\n\n      gl.uniformMatrix4fv(\n        csmShader(uniformName_viewMatrix),\n        false,\n        matrixToArray(\n          matrixCopy(identity, csm_tempMatrix)\n            .scaleSelf(2 / (right - left), 2 / (top - bottom), 2 / (near - far))\n            .translateSelf((right + left) / -2, (top + bottom) / -2, (near + far) / 2)\n            .multiplySelf(tempMatrix),\n          csm_lightSpaceMatrices[split],\n        ),\n      );\n\n      renderModels(csmShader(uniformName_worldMatrices), !player_first_person, MODEL_ID_SOUL);\n    };\n  });\n\n  const csm_framebuffer = gl.createFramebuffer();\n\n  const collision_texture = gl.createTexture()!;\n  const collision_renderBuffer = gl.createRenderbuffer();\n  const collision_frameBuffer = gl.createFramebuffer()!;\n\n  const mainLoop = (globalTime: number) => {\n    // gl.flush();\n\n    requestAnimationFrame(mainLoop);\n\n    gameTimeUpdate(globalTime);\n\n    if (gameTimeDelta > 0) {\n      updateInput();\n\n      worldStateUpdate();\n\n      eppur_si_muove();\n\n      // Reset interact button\n      resetInteractPressed();\n\n      // *** COLLISION RENDERER ***\n\n      collisionShader();\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, collision_frameBuffer);\n      gl.viewport(0, 0, COLLISION_TEXTURE_SIZE, COLLISION_TEXTURE_SIZE);\n\n      // first collision render\n\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n      gl.colorMask(true, false, true, false);\n\n      const { x, y, z } = player_position_final;\n\n      gl.uniformMatrix4fv(\n        collisionShader(uniformName_viewMatrix),\n        false,\n        matrixToArray(\n          matrixCopy()\n            .rotateSelf(0, 180)\n            .invertSelf()\n            .translateSelf(-x, -y, 0.3 - z),\n        ),\n      );\n      renderModels(collisionShader(uniformName_worldMatrices), 0, MODEL_ID_SOUL_COLLISION);\n\n      // second collision render\n\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n      gl.colorMask(false, true, false, true);\n      gl.uniformMatrix4fv(\n        collisionShader(uniformName_viewMatrix),\n        false,\n        matrixToArray(matrixCopy().translateSelf(-x, -y, -z - 0.3)),\n      );\n      renderModels(collisionShader(uniformName_worldMatrices), 0, MODEL_ID_SOUL_COLLISION);\n\n      // Flushing collision render\n      gl.flush();\n    }\n\n    // view camera\n\n    let cameraX = camera_position_x;\n    let cameraY = camera_position_y;\n    let cameraZ = camera_position_z;\n\n    if (mainMenuVisible) {\n      matrixCopy(projection).invertSelf();\n      matrixTransformPoint(3.6, 3.5);\n      cameraX = matrixTransformPoint.x;\n      cameraY = matrixTransformPoint.y;\n      cameraZ = 5;\n      matrixCopy(identity, camera_view)\n        .rotateSelf(-20, 0)\n        .invertSelf()\n        .translateSelf(-cameraX, -cameraY, -cameraZ)\n        .rotateSelf(0, 99);\n    } else {\n      matrixCopy(identity, camera_view)\n        .rotateSelf(-camera_rotation.x, -camera_rotation.y)\n        .invertSelf()\n        .translateSelf(-cameraX, -cameraY, -cameraZ);\n    }\n\n    // *** CASCADED SHADOWMAPS ***\n\n    csmShader();\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, csm_framebuffer);\n    gl.viewport(0, 0, CSM_TEXTURE_SIZE, CSM_TEXTURE_SIZE);\n\n    csm_render[0]!((CSM_PLANE_DISTANCE - zNear) * 1.1);\n    csm_render[1]!((zFar - CSM_PLANE_DISTANCE) * 1.1);\n\n    // *** MAIN RENDER ***\n\n    mainShader();\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n    gl.colorMask(true, true, true, true);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    gl.uniformMatrix4fv(mainShader(uniformName_projectionMatrix), false, matrixToArray(projection));\n    gl.uniformMatrix4fv(mainShader(uniformName_viewMatrix), false, matrixToArray(camera_view));\n    gl.uniformMatrix4fv(mainShader(uniformName_csm_matrix0), false, csm_lightSpaceMatrices[0]!);\n    gl.uniformMatrix4fv(mainShader(uniformName_csm_matrix1), false, csm_lightSpaceMatrices[1]!);\n    gl.uniform3f(mainShader(uniformName_viewPos), cameraX, cameraY, cameraZ);\n\n    renderModels(mainShader(uniformName_worldMatrices), !player_first_person, MODEL_ID_SOUL);\n\n    // *** SKY RENDER ***\n\n    skyShader();\n\n    gl.uniform3f(skyShader(uniformName_iResolution), gl.drawingBufferWidth, gl.drawingBufferHeight, absoluteTime);\n    gl.uniform3f(skyShader(uniformName_viewPos), cameraX, cameraY, cameraZ);\n    gl.uniformMatrix4fv(skyShader(uniformName_viewMatrix), false, matrixToArray(matrixCopy(camera_view).invertSelf()));\n\n    gl.drawElements(gl.TRIANGLES, 3, gl.UNSIGNED_SHORT, 0);\n\n    // Prepare for collision reading on next frame.\n    // Flushing here increase the chance of the GPU finishing the rendering before we read the texture.\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, collision_frameBuffer);\n    gl.flush();\n  };\n\n  collisionShader();\n  gl.uniformMatrix4fv(\n    collisionShader(uniformName_projectionMatrix),\n    false,\n    matrixToArray(mat_perspective(0.0001, 2, 1.4, 0.4)),\n    // matrixToArray(mat_perspective(0.0001, 10, 1.4, 0.59)),\n  );\n\n  mainShader();\n  gl.uniform1i(mainShader(uniformName_groundTexture), 2);\n  gl.uniform1i(mainShader(uniformName_csm_texture1), 1);\n  gl.uniform1i(mainShader(uniformName_csm_texture0), 0);\n\n  skyShader();\n  gl.uniform1i(skyShader(uniformName_groundTexture), 2);\n\n  // Shadows framebuffer\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, csm_framebuffer);\n  // Disable rendering to the csm color buffer, we just need the depth buffer\n  gl.drawBuffers([gl.NONE]);\n  gl.readBuffer(gl.NONE);\n\n  // Collision framebuffer\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, collision_frameBuffer);\n  gl.bindRenderbuffer(gl.RENDERBUFFER, collision_renderBuffer);\n\n  gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT24, COLLISION_TEXTURE_SIZE, COLLISION_TEXTURE_SIZE);\n  gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, collision_renderBuffer);\n\n  gl.activeTexture(gl.TEXTURE2);\n\n  gl.bindTexture(gl.TEXTURE_2D, collision_texture);\n  gl.texImage2D(\n    gl.TEXTURE_2D,\n    0,\n    gl.RGBA,\n    COLLISION_TEXTURE_SIZE,\n    COLLISION_TEXTURE_SIZE,\n    0,\n    gl.RGBA,\n    gl.UNSIGNED_BYTE,\n    null,\n  );\n\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, collision_texture, 0);\n\n  // Ground texture\n\n  gl.bindTexture(gl.TEXTURE_2D, gl.createTexture());\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1024, 1024, 0, gl.RGBA, gl.UNSIGNED_BYTE, groundTextureImage);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  gl.generateMipmap(gl.TEXTURE_2D);\n\n  // GL Setup\n\n  gl.enable(gl.DEPTH_TEST); // Enable depth testing\n  gl.enable(gl.CULL_FACE); // Don't render triangle backs\n\n  gl.clearDepth(1); // Clear everything. Default value is 1\n  gl.cullFace(gl.BACK); // Default value is already BACK\n  gl.depthFunc(gl.LEQUAL); // LEQUAL to make sky works\n  gl.clearColor(0, 0, 0, 0); // Clear to black, alpha 0 as is used for collision, it will be in any case overwritten when rendering triangles with 1.\n\n  NO_INLINE(initPage)();\n\n  NO_INLINE(player_init)();\n\n  requestAnimationFrame(mainLoop);\n};\n","export const loadStep = (fn: () => void) => {\n  // loading dots ...\n  h4.innerHTML += \".\";\n  setTimeout(fn);\n};\n","// This music has been exported by SoundBox and modified manually to minify better.\n\n// Beethoven's Piano Sonata No. 14, 3rd movement, readapted by Ryan Malm for this game\n\nexport const song_patterns = '000001234556112341234556011111111112011111111112000001111112'\n\nexport const song_columns = [\n  [ // Columns 0\n    \"(.15:15:=5:=A:=AF=AFIFIMRMRUY(Y(((((((((((((((((((((((((((((M(M(((((((((((((((((((((((((((((R(R(((((((((((((((((((((((((((((U(U\",\n    \"(059<59<A9<AE<AEHAEHMEHMQMQTY(Y\",\n    \"(5:>A:>AF>AFJAFJMFJMRJMRVMRVY(Y\",\n    \"(:?BFFKNRRWZ^(^((:=@FFILRRUX^(^\",\n    \"Q(M(M(O(Q(R(T(Q(T(R(W(U(T(R(Q(N(W((Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(Y(X]\",\n    \"QN(M(N(M(N(M(N(M((((((((((((((((W(Y(Y(Y(Y(Y(Y(Y(Y(((((((((((((((]\",\n  ],\n  [ // Columns 1\n    \".(5(.(5(.(5(.(5(.(5(.(5(.(5(.(5\",\n    \"-(5(-(5(-(5(-(5(-(5(-(5(-(5(-(5\",\n    \",(5(,(5(,(5(,(5(,(5(,(5(,(5(,(5\",\n    \"*(6(*(6(*(6(*(6(*(6(*(6(*(6(*(6\",\n    \"5(E(E(F(H(I(K(H(K(I(N(M(K(I(H(F(A(((((((((((((((((((((((((((((((5(((5(((5(((5(((5(((5(((5(((5\",\n    \"5(6(5(6(5(6(5(6(5((()(((((((((((A(B(A(B(A(B(A(B(A(((5\",\n  ],[ // Columns 2\n    \"9(((9(((9(((9(((9(((9(((9(((9\",\n    \"9(((Q(((Q(((Q\",\n  ],[ // Columns 3\n    \"9(9(9(9(9(9(9(999(9(9(9(999(9(9\",\n    \"9(9(9(9(9(999(9(((((Q\",\n  ],[ // Columns 4\n    \"((((Q(((((((Q(((((((Q(((((((Q\",\n    \"Q((Q((Q((Q((Q((Q((((Q\",\n  ]\n] as const;\n\nexport const song_instruments = [\n  [ // instrument 0\n    69, // OSC1_VOL\n    128, // OSC1_SEMI\n    0, // OSC1_XENV\n    143, // OSC2_VOL\n    128, // OSC2_SEMI\n    0, // OSC2_XENV\n    0, // NOISE_VOL\n    196, // ENV_ATTACK ** 2 * 4\n    100, // ENV_SUSTAIN ** 2 * 4\n    36, // ENV_RELEASE\n    0, // ENV_EXP_DECAY\n    0, // LFO_FREQ\n    149, // FX_FREQ\n    110, // FX_RESONANCE\n    31, // FX_DRIVE\n    47, // FX_PAN_AMT\n    3, // FX_PAN_FREQ\n    56, // FX_DELAY_AMT\n    2, // FX_DELAY_TIME\n    0, // LFO_AMT\n  ],\n  [ // Instrument 1\n    100, // OSC1_VOL\n    128, // OSC1_SEMI\n    0, // OSC1_XENV\n    201, // OSC2_VOL\n    128, // OSC2_SEMI\n    0, // OSC2_XENV\n    0, // NOISE_VOL\n    100, // ENV_ATTACK ** 2 * 4\n    144, // ENV_SUSTAIN ** 2 * 4\n    35, // ENV_RELEASE\n    0, // ENV_EXP_DECAY\n    6, // LFO_FREQ\n    135, // FX_FREQ\n    0, // FX_RESONANCE\n    32, // FX_DRIVE\n    147, // FX_PAN_AMT\n    6, // FX_PAN_FREQ\n    0, // FX_DELAY_AMT\n    6, // FX_DELAY_TIME\n    195, // LFO_AMT\n  ],\n  [ // Instrument 2\n    255, // OSC1_VOL\n    116, // OSC1_SEMI\n    85, // OSC1_XENV\n    255, // OSC2_VOL\n    116, // OSC2_SEMI\n    37, // OSC2_XENV\n    14, // NOISE_VOL\n    64, // ENV_ATTACK ** 2 * 4\n    144, // ENV_SUSTAIN ** 2 * 4\n    73, // ENV_RELEASE\n    99, // ENV_EXP_DECAY\n    0, // LFO_FREQ\n    136, // FX_FREQ\n    15, // FX_RESONANCE\n    32, // FX_DRIVE\n    0, // FX_PAN_AMT\n    0, // FX_PAN_FREQ\n    66, // FX_DELAY_AMT\n    6, // FX_DELAY_TIME\n    0, // LFO_AMT\n  ],\n  [ // Instrument 3\n    0, // OSC1_VOL\n    140, // OSC1_SEMI\n    0, // OSC1_XENV\n    0, // OSC2_VOL\n    140, // OSC2_SEMI\n    0, // OSC2_XENV\n    81, // NOISE_VOL\n    64, // ENV_ATTACK ** 2 * 4\n    400, // ENV_SUSTAIN ** 2 * 4\n    47, // ENV_RELEASE\n    55, // ENV_EXP_DECAY\n    5, // LFO_FREQ\n    239, // FX_FREQ\n    135, // FX_RESONANCE\n    13, // FX_DRIVE\n    176, // FX_PAN_AMT\n    5, // FX_PAN_FREQ\n    16, // FX_DELAY_AMT\n    4, // FX_DELAY_TIME\n    187, // LFO_AMT\n  ],\n  [ // Instrument 4\n    221, // OSC1_VOL\n    128, // OSC1_SEMI\n    64, // OSC1_XENV\n    210, // OSC2_VOL\n    128, // OSC2_SEMI\n    64, // OSC2_XENV\n    255, // NOISE_VOL\n    64, // ENV_ATTACK ** 2 * 4\n    144, // ENV_SUSTAIN ** 2 * 4\n    73, // ENV_RELEASE\n    79, // ENV_EXP_DECAY\n    7, // LFO_FREQ\n    195, // FX_FREQ\n    15, // FX_RESONANCE\n    21, // FX_DRIVE\n    20, // FX_PAN_AMT\n    0, // FX_PAN_FREQ\n    9, // FX_DELAY_AMT\n    3, // FX_DELAY_TIME\n    64, // LFO_AMT\n  ],\n] as const\n\nexport const song_rowLen0 = 5513\n\nexport const song_rowLen1 = 4562\n\nexport const song_rowLen2 = 3891\n\n// Rows per pattern\nexport const song_patternLen = 32\n\n// End pattern\nexport const song_endPattern = 11\n\n// Number of channels\nexport const song_numChannels = 5\n\n","/* -*- mode: javascript; tab-width: 4; indent-tabs-mode: nil; -*-\n *\n * Copyright (c) 2011-2013 Marcus Geelnard\n *\n * This software is provided 'as-is', without any express or implied\n * warranty. In no event will the authors be held liable for any damages\n * arising from the use of this software.\n *\n * Permission is granted to anyone to use this software for any purpose,\n * including commercial applications, and to alter it and redistribute it\n * freely, subject to the following restrictions:\n *\n * 1. The origin of this software must not be misrepresented; you must not\n *    claim that you wrote the original software. If you use this software\n *    in a product, an acknowledgment in the product documentation would be\n *    appreciated but is not required.\n *\n * 2. Altered source versions must be plainly marked as such, and must not be\n *    misrepresented as being the original software.\n *\n * 3. This notice may not be removed or altered from any source\n *    distribution.\n *\n */\n\n// WARNING: Source code of the original player was heavily manually modified to reduce bundle size.\n// This player plays only the game song and is modified.\n// This makes this version not compatible with default soundbox songs.\n\nimport { audioContext, songAudioSource } from \"./audio-context\";\nimport {\n  song_endPattern,\n  song_patternLen,\n  song_patterns,\n  song_instruments,\n  song_rowLen0,\n  song_rowLen1,\n  song_rowLen2,\n  song_numChannels,\n  song_columns,\n} from \"./song\";\nimport { loadStep } from \"../load-step\";\n\nconst getnotefreq = (n: number) => 0.003959503758 * 2 ** ((n - 256) / 12);\n\n/** oscillator 0 */\nconst osc_sin = (value: number) => Math.sin(value * Math.PI * 2);\n\n/** oscillator 1 */\nconst osc_square = (value: number) => (value % 1 < 0.5 ? 1 : -1);\n\n/** oscillator 2 */\nconst osc_saw = (value: number) => 2 * (value % 1) - 1;\n\n/** oscillator 3 */\nconst osc_tri = (value: number) => {\n  const v2 = (value % 1) * 4;\n  return v2 < 2 ? v2 - 1 : 3 - v2;\n};\n\nconst SONG_WORDS = song_patternLen * (song_endPattern + 1) * 2;\nconst SONG_TOTAL_WORDS = (song_rowLen0 + song_rowLen1 + song_rowLen2) * SONG_WORDS;\n\nexport const loadSong = (done: () => void) => {\n  let channelIndex = 0;\n\n  const audioBuffer = audioContext.createBuffer(2, SONG_TOTAL_WORDS / 2, 44100);\n  const mixBufferA = audioBuffer.getChannelData(0);\n  const mixBufferB = audioBuffer.getChannelData(1);\n\n  // Load the buffer into the audio source\n  songAudioSource.buffer = audioBuffer;\n\n  // Loop forever\n  songAudioSource.loop = true;\n\n  const next = () => {\n    // Generate audio data for a single track/channel.\n    let mixIndex = 0;\n\n    const COLUMNS = song_columns[channelIndex]!;\n    const [\n      OSC1_VOL,\n      OSC1_SEMI,\n      OSC1_XENV,\n      OSC2_VOL,\n      OSC2_SEMI,\n      OSC2_XENV,\n      NOISE_VOL,\n      ENV_ATTACK,\n      ENV_SUSTAIN,\n      _ENV_RELEASE,\n      ENV_EXP_DECAY,\n      LFO_FREQ,\n      FX_FREQ,\n      FX_RESONANCE,\n      FX_DRIVE,\n      FX_PAN_AMT,\n      FX_PAN_FREQ,\n      FX_DELAY_AMT,\n      FX_DELAY_TIME,\n      LFO_AMT,\n    ] = song_instruments[channelIndex]!;\n\n    const ENV_RELEASE = _ENV_RELEASE ** 2 * 4;\n\n    const make = (song_rowLen: number) => {\n      const createNote = (note: number) => {\n        const OSC1_WAVEFORM = channelIndex < 2 ? osc_saw : osc_sin;\n        const OSC2_WAVEFORM = channelIndex < 2 ? (channelIndex < 1 ? osc_square : osc_tri) : osc_sin;\n\n        // Re-trig oscillators\n        let c1 = 0;\n        let c2 = 0;\n\n        // Local variables.\n        let o1t: number;\n        let o2t: number;\n\n        const noteBuf = new Int32Array(ENV_ATTACK + ENV_SUSTAIN + ENV_RELEASE);\n\n        // Generate one note (attack + sustain + release)\n        for (let j1 = 0, j2 = 0; j1 < ENV_ATTACK + ENV_SUSTAIN + ENV_RELEASE; ++j1, ++j2) {\n          let e = 1;\n          // Envelope\n          if (j1 < ENV_ATTACK) {\n            e = j1 / ENV_ATTACK;\n          } else if (j1 >= ENV_ATTACK + ENV_SUSTAIN) {\n            e = (j1 - ENV_ATTACK - ENV_SUSTAIN) / ENV_RELEASE;\n            e = (1 - e) * 3 ** ((-ENV_EXP_DECAY / 16) * e);\n          }\n\n          if (j2 >= 0) {\n            // Switch arpeggio note.\n            j2 -= song_rowLen * 4;\n\n            // Calculate note frequencies for the oscillators\n            o1t = getnotefreq(note + OSC1_SEMI);\n            o2t = getnotefreq(note + OSC2_SEMI) * (1 + (channelIndex ? 0 : 0.0008 * 9));\n          }\n\n          // Add to (mono) channel buffer\n          noteBuf[j1] =\n            (80 * // Oscillator 1\n              (OSC1_WAVEFORM((c1 += o1t! * e ** (OSC1_XENV / 32))) * OSC1_VOL +\n                // Oscillator 2\n                OSC2_WAVEFORM((c2 += o2t! * e ** (OSC2_XENV / 32))) * OSC2_VOL +\n                // Noise oscillator\n                (NOISE_VOL ? (Math.random() * 2 - 1) * NOISE_VOL : 0)) *\n              e) |\n            0;\n        }\n        return noteBuf;\n      };\n\n      // Local variables\n      let n;\n      let t;\n      let f;\n\n      // Clear effect state\n      let low = 0;\n      let band = 0;\n      let high;\n      let filterActive: boolean | undefined;\n\n      const noteCache = [];\n      const chnBuf = new Int32Array(song_rowLen * SONG_WORDS);\n\n      const lfoFreq = 2 ** (LFO_FREQ - 9) / song_rowLen;\n      const panFreq = (Math.PI * 2 ** (FX_PAN_FREQ - 8)) / song_rowLen;\n      const dly = (FX_DELAY_TIME * song_rowLen) & ~1; // Must be an even number\n\n      // Patterns\n      for (let p = 0; p <= song_endPattern; ++p) {\n        // Pattern rows\n        for (let row = 0, cp = +song_patterns[channelIndex * 12 + p]!; row < song_patternLen; ++row) {\n          // Calculate start sample number for this row in the pattern\n          const rowStartSample = (p * song_patternLen + row) * song_rowLen;\n\n          // Generate notes for this pattern row\n          for (let col = 0; col < 4; ++col) {\n            n = 0;\n            if (cp) {\n              n = COLUMNS[cp - 1]!.charCodeAt(row + col * song_patternLen) - 40;\n              n += n > 0 ? 106 : 0;\n            }\n            if (n) {\n              const noteBuf = noteCache[n] || (noteCache[n] = createNote(n));\n              for (let j = 0, i = rowStartSample * 2; j < noteBuf.length; ++j, i += 2) {\n                chnBuf[i] += noteBuf[j]!;\n              }\n            }\n          }\n\n          // Perform effects for this pattern row\n          for (let j = 0, rsample; j < song_rowLen; ++j) {\n            // Dry mono-sample\n            let k = (rowStartSample + j) * 2;\n            let lsample = 0;\n            rsample = chnBuf[k]!;\n\n            // We only do effects if we have some sound input\n            if (rsample || filterActive) {\n              // State variable filter\n              f = FX_FREQ * ((43.23529 * 3.141592) / 44100);\n              if (channelIndex === 1 || channelIndex === 4) {\n                f *= (osc_sin(lfoFreq * k) * LFO_AMT) / 512 + 0.5;\n              }\n              f = 1.5 * Math.sin(f);\n              low += f * band;\n              high = (1 - FX_RESONANCE / 255) * (rsample - band) - low;\n              band += f * high;\n              rsample = channelIndex === 4 ? band : channelIndex === 3 ? high : low;\n\n              // Distortion\n              if (!channelIndex) {\n                rsample *= 22 * 1e-5;\n                rsample = rsample < 1 ? (rsample > -1 ? osc_sin(rsample / 4) : -1) : 1;\n                rsample /= 22 * 1e-5;\n              }\n\n              // Drive\n              rsample *= FX_DRIVE / 32;\n\n              // Is the filter active (i.e. still audiable)?\n              filterActive = rsample * rsample > 1e-5;\n\n              // Panning\n              t = (Math.sin(panFreq * k) * FX_PAN_AMT) / 512 + 0.5;\n              lsample = rsample * (1 - t);\n              rsample *= t;\n            }\n\n            // Delay is always done, since it does not need sound input\n            if (k >= dly) {\n              // Left channel = left + right[-p] * t\n              lsample += (chnBuf[k - dly + 1]! * FX_DELAY_AMT) / 255;\n\n              // Right channel = right + left[-p] * t\n              rsample += (chnBuf[k - dly]! * FX_DELAY_AMT) / 255;\n            }\n\n            const mixBufferIndex = (mixIndex + k) >> 1;\n\n            mixBufferA[mixBufferIndex] += (chnBuf[k] = lsample) / 65536;\n            mixBufferB[mixBufferIndex] += (chnBuf[++k] = rsample) / 65536;\n          }\n        }\n      }\n\n      mixIndex += song_rowLen * SONG_WORDS;\n    };\n\n    make(song_rowLen0);\n    make(song_rowLen1);\n    make(song_rowLen2);\n\n    loadStep(++channelIndex < song_numChannels ? next : done);\n  };\n\n  loadStep(next);\n};\n","import { allModels, souls, MODEL_ID_SOUL, SOULS_COUNT } from \"./models\";\nimport { gl } from \"../gl\";\nimport { plane_fromPolygon } from \"../math/vectors\";\nimport type { Polygon } from \"../geometry/polygon\";\n\nexport const initTriangleBuffers = () => {\n  const _triangleIndices: number[] = [];\n  const _vertexPositions: number[] = [];\n  const _vertexColors: number[] = [];\n  const _vertexNormals: number[] = [];\n\n  const _vertexInts = new Int32Array(8);\n  const _vertexIntsSmooth = new Int32Array(_vertexInts.buffer, 0, 5);\n  const _vertexFloats = new Float32Array(_vertexInts.buffer);\n  const _vertexMap = new Map<string, number>();\n\n  let meshFirstIndex: number = 0;\n\n  if (DEBUG) {\n    console.time(\"initTriangleBuffers\");\n  }\n\n  allModels.map((model, index) => {\n    let polygon: Polygon | undefined;\n\n    const getVertex = (i: number): number => {\n      let { x, y, z } = polygon![i]!;\n      _vertexFloats[0] = x;\n      _vertexFloats[1] = y;\n      _vertexFloats[2] = z;\n      const key = \"\" + (polygon!.$smooth ? _vertexIntsSmooth : _vertexInts);\n      let vertexIndex = _vertexMap.get(key);\n      if (vertexIndex !== undefined) {\n        x = vertexIndex * 3;\n        _vertexNormals[x] = (_vertexNormals[x++]! + _vertexInts[5]!) / 2;\n        _vertexNormals[x] = (_vertexNormals[x++]! + _vertexInts[6]!) / 2;\n        _vertexNormals[x] = (_vertexNormals[x]! + _vertexInts[7]!) / 2;\n      } else {\n        _vertexMap.set(key, (vertexIndex = _vertexMap.size));\n        _vertexPositions.push(x, y, z, _vertexFloats[3]!);\n        _vertexColors.push(_vertexInts[4]!);\n        _vertexNormals.push(_vertexInts[5]!, _vertexInts[6]!, _vertexInts[7]!);\n      }\n      return vertexIndex;\n    };\n\n    _vertexFloats[3] = index > MODEL_ID_SOUL ? -SOULS_COUNT - 1 : model.$kind && index;\n\n    for (polygon of model.$polygons!) {\n      const { x, y, z } = plane_fromPolygon(polygon);\n      _vertexInts[4] = polygon.$color! | 0;\n      _vertexInts[5] = x * 32767;\n      _vertexInts[6] = y * 32767;\n      _vertexInts[7] = z * 32767;\n      for (let i = 2, a = getVertex(0), b = getVertex(1); i < polygon.length; ++i) {\n        _triangleIndices.push(a, b, (b = getVertex(i)));\n      }\n    }\n\n    // free memory\n    model.$polygons = null;\n\n    // write the indices offset and count\n    model.$vertexBegin = meshFirstIndex;\n    model.$vertexEnd = meshFirstIndex = _triangleIndices.length;\n  });\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(_vertexPositions), gl.STATIC_DRAW);\n  gl.vertexAttribPointer(0, 4, gl.FLOAT, false, 0, 0);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ARRAY_BUFFER, new Int16Array(_vertexNormals), gl.STATIC_DRAW);\n  gl.vertexAttribPointer(1, 3, gl.SHORT, true, 0, 0);\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ARRAY_BUFFER, new Uint32Array(_vertexColors), gl.STATIC_DRAW);\n  gl.vertexAttribPointer(2, 4, gl.UNSIGNED_BYTE, true, 0, 0);\n\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());\n  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(_triangleIndices), gl.STATIC_DRAW);\n\n  gl.enableVertexAttribArray(0);\n  gl.enableVertexAttribArray(1);\n  gl.enableVertexAttribArray(2);\n\n  if (DEBUG) {\n    console.timeEnd(\"initTriangleBuffers\");\n    console.table({\n      \"game models\": allModels.filter((m) => !!m.$kind).length,\n      \"all models\": allModels.length,\n      \"vertices\": _vertexMap.size,\n      \"triangles\": _triangleIndices.length / 3,\n      \"indices\": _triangleIndices.length,\n    });\n\n    if (souls.length !== SOULS_COUNT) {\n      throw new Error(\"Souls must be \" + SOULS_COUNT + \" but is \" + souls.length);\n    }\n  }\n};\n","import \"./index.css\";\n\nimport \"./dev-tools/dev-main\";\n\nif (DEBUG) {\n  console.time(\"boot\");\n}\n\nimport groundTextureSvg from \"./groundTexture.svg\";\n\nimport { build_life_the_universe_and_everything } from \"./game/level\";\nimport { startMainLoop } from \"./main-loop\";\nimport { loadGame } from \"./game/world-state\";\nimport { loadStep } from \"./load-step\";\nimport { loadSong } from \"./music/music-player\";\nimport { initTriangleBuffers } from \"./game/triangle-buffers\";\n\nloadStep(() => {\n  const image = new Image();\n\n  if (DEBUG) {\n    console.time(\"load\");\n  }\n\n  let loadStatus = 0;\n\n  const end = () => {\n    if (++loadStatus === 2) {\n      if (DEBUG) {\n        console.timeEnd(\"load\");\n      }\n\n      if (DEBUG) {\n        console.time(\"startMainLoop\");\n      }\n\n      startMainLoop(image);\n\n      if (DEBUG) {\n        console.timeEnd(\"startMainLoop\");\n      }\n    }\n  };\n\n  image.onload = image.onerror = end;\n  image.src = groundTextureSvg;\n\n  const songLoaded = () => {\n    loadStep(() => {\n      initTriangleBuffers();\n      loadGame();\n      loadStep(end);\n    });\n    build_life_the_universe_and_everything();\n  };\n\n  if (DEBUG_FLAG1) {\n    songLoaded();\n  } else {\n    NO_INLINE(loadSong)(songLoaded);\n  }\n\n  if (DEBUG) {\n    console.timeEnd(\"boot\");\n  }\n});\n"],"names":["code","CSM_PLANE_DISTANCE","COLLISION_TEXTURE_SIZE","y","CSM_TEXTURE_SIZE","main_vsSource","csm_vsSource","void_fsSource","sky_vsSource","sky_fsSource","main_fsSource"],"mappings":"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"}